(()=>{var _n=Object.defineProperty;var $s=(r,t,e)=>t in r?_n(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var xn=(r,t)=>{for(var e in t)_n(r,e,{get:t[e],enumerable:!0})};var ft=(r,t,e)=>($s(r,typeof t!="symbol"?t+"":t,e),e);var p;function yn(r){p=r}var Ws={CCW:-1,CW:1,NOT_ORIENTABLE:0},qs=2*Math.PI,ne=1,Cn=0,H=2,js=3,zs=4,Ys=1,Hs=2,Or=0,Pe=1,Nt=2,Ce=Object.freeze({CCW:!0,CW:!1,ORIENTATION:Ws,PIx2:qs,INSIDE:ne,OUTSIDE:Cn,BOUNDARY:H,CONTAINS:js,INTERLACE:zs,OVERLAP_SAME:Ys,OVERLAP_OPPOSITE:Hs,NOT_VERTEX:Or,START_VERTEX:Pe,END_VERTEX:Nt}),J=1e-6;function On(r){J=r}function Nn(){return J}var Xs=3;function vr(r){return r<J&&r>-J}function vt(r,t){return r-t<J&&r-t>-J}function Ln(r,t){return r-t>J}function Qs(r,t){return r-t>-J}function Rn(r,t){return r-t<-J}function Js(r,t){return r-t<J}var Ks=Object.freeze({setTolerance:On,getTolerance:Nn,DECIMALS:Xs,EQ_0:vr,EQ:vt,GT:Ln,GE:Qs,LT:Rn,LE:Js}),Oe=class{static get ILLEGAL_PARAMETERS(){return new ReferenceError("Illegal Parameters")}static get ZERO_DIVISION(){return new Error("Zero division")}static get UNRESOLVED_BOUNDARY_CONFLICT(){return new Error("Unresolved boundary conflict in boolean operation")}static get INFINITE_LOOP(){return new Error("Infinite loop")}};var o={Utils:Ks,Errors:Oe,Matrix:void 0,Planar_set:void 0,Point:void 0,Vector:void 0,Line:void 0,Circle:void 0,Segment:void 0,Arc:void 0,Box:void 0,Edge:void 0,Face:void 0,Ray:void 0,Ray_shooting:void 0,Multiline:void 0,Polygon:void 0,Distance:void 0,Inversion:void 0};for(let r in Ce)o[r]=Ce[r];Object.defineProperty(o,"DP_TOL",{get:function(){return Nn()},set:function(r){On(r)}});var Ne=class{constructor(t,e){this.first=t,this.last=e||this.first}static testInfiniteLoop(t){let e=t,n=t;do{if(e!=t&&e===n)throw o.Errors.INFINITE_LOOP;e=e.next,n=n.next.next}while(e!=t)}get size(){let t=0;for(let e of this)t++;return t}toArray(t=void 0,e=void 0){let n=[],i=t||this.first,s=e||this.last,a=i;if(a===void 0)return n;do n.push(a),a=a.next;while(a!==s.next);return n}append(t){return this.isEmpty()?this.first=t:(t.prev=this.last,this.last.next=t),this.last=t,this.last.next=void 0,this.first.prev=void 0,this}insert(t,e){if(this.isEmpty())this.first=t,this.last=t;else if(e==null)t.next=this.first,this.first.prev=t,this.first=t;else{let n=e.next;e.next=t,n&&(n.prev=t),t.prev=e,t.next=n,this.last===e&&(this.last=t)}return this.last.next=void 0,this.first.prev=void 0,this}remove(t){return t===this.first&&t===this.last?(this.first=void 0,this.last=void 0):(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t===this.first&&(this.first=t.next),t===this.last&&(this.last=t.prev)),this}isEmpty(){return this.first===void 0}[Symbol.iterator](){let t;return{next:()=>(t=t?t.next:this.first,{value:t,done:t===void 0})}}};function kt(r,t,e){let n=e.length,i=r.shape.split(t);if(i.length===0)return;let s=0;i[0]===null?s=0:i[1]===null?s=r.shape.length:s=i[0].length;let a=Or;vt(s,0)&&(a|=Pe),vt(s,r.shape.length)&&(a|=Nt);let l=a&Nt&&r.next.arc_length===0?0:r.arc_length+s;e.push({id:n,pt:t,arc_length:l,edge_before:r,edge_after:void 0,face:r.face,is_vertex:a})}function se(r){r.int_points1_sorted=ie(r.int_points1),r.int_points2_sorted=ie(r.int_points2)}function ie(r){let t=new Map,e=0;for(let i of r)t.has(i.face)||(t.set(i.face,e),e++);for(let i of r)i.faceId=t.get(i.face);return r.slice().sort(Zs)}function Zs(r,t){return r.faceId<t.faceId?-1:r.faceId>t.faceId?1:r.arc_length<t.arc_length?-1:r.arc_length>t.arc_length?1:0}function xr(r,t){return t.slice().sort((e,n)=>r.coord(e.pt)<r.coord(n.pt)?-1:r.coord(e.pt)>r.coord(n.pt)?1:0)}function Nr(r){if(r.int_points1.length<2)return;let t=!1,e,n,i,s;for(let a=0;a<r.int_points1_sorted.length;a++)if(r.int_points1_sorted[a].id!==-1){e=r.int_points1_sorted[a],n=r.int_points2[e.id];for(let l=a+1;l<r.int_points1_sorted.length&&(i=r.int_points1_sorted[l],!!vt(i.arc_length,e.arc_length));l++)i.id!==-1&&(s=r.int_points2[i.id],s.id!==-1&&i.edge_before===e.edge_before&&i.edge_after===e.edge_after&&s.edge_before===n.edge_before&&s.edge_after===n.edge_after&&(i.id=-1,s.id=-1,t=!0))}n=r.int_points2_sorted[0],e=r.int_points1[n.id];for(let a=1;a<r.int_points2_sorted.length;a++){let l=r.int_points2_sorted[a];if(l.id==-1)continue;if(n.id==-1||!vt(l.arc_length,n.arc_length)){n=l,e=r.int_points1[n.id];continue}let f=r.int_points1[l.id];f.edge_before===e.edge_before&&f.edge_after===e.edge_after&&l.edge_before===n.edge_before&&l.edge_after===n.edge_after&&(f.id=-1,l.id=-1,t=!0)}t&&(r.int_points1=r.int_points1.filter(a=>a.id>=0),r.int_points2=r.int_points2.filter(a=>a.id>=0),r.int_points1.forEach((a,l)=>a.id=l),r.int_points2.forEach((a,l)=>a.id=l))}function wr(r){for(let t of r)t.edge_before.bvStart=void 0,t.edge_before.bvEnd=void 0,t.edge_before.bv=void 0,t.edge_before.overlap=void 0,t.edge_after.bvStart=void 0,t.edge_after.bvEnd=void 0,t.edge_after.bv=void 0,t.edge_after.overlap=void 0;for(let t of r)t.edge_before.bvEnd=H,t.edge_after.bvStart=H}function Er(r,t){for(let e of r)e.edge_before.setInclusion(t),e.edge_after.setInclusion(t)}function ta(r){let t,e,n,i=r.int_points1.length;for(let s=0;s<i;s++){let a=r.int_points1_sorted[s];a.face!==t&&(e=s,t=a.face);let l=s,f=Mt(r.int_points1_sorted,s,t),u;l+f<i&&r.int_points1_sorted[l+f].face===t?u=l+f:u=e;let d=Mt(r.int_points1_sorted,u,t);n=null;for(let _=u;_<u+d;_++){let E=r.int_points1_sorted[_];if(E.face===t&&r.int_points2[E.id].face===r.int_points2[a.id].face){n=E;break}}if(n===null)continue;let c=a.edge_after,h=n.edge_before;if(!(c.bv===H&&h.bv===H)||c!==h)continue;let v=r.int_points2[a.id],y=r.int_points2[n.id],b=v.edge_after,w=y.edge_before;b.bv===H&&w.bv===H&&b===w||(v=r.int_points2[n.id],y=r.int_points2[a.id],b=v.edge_after,w=y.edge_before),b.bv===H&&w.bv===H&&b===w&&c.setOverlap(b)}}function Mt(r,t,e){let n,i,s=1;if(r.length==1)return 1;n=r[t];for(let a=t+1;a<r.length&&!(n.face!=e||(i=r[a],!(i.pt.equalTo(n.pt)&&i.edge_before===n.edge_before&&i.edge_after===n.edge_after)));a++)s++;return s}function Ft(r,t){if(!!t){for(let e of t){let n=e.edge_before;if(e.is_vertex=Or,n.shape.start&&n.shape.start.equalTo(e.pt)&&(e.is_vertex|=Pe),n.shape.end&&n.shape.end.equalTo(e.pt)&&(e.is_vertex|=Nt),e.is_vertex&Pe){e.edge_before=n.prev,e.is_vertex=Nt;continue}if(e.is_vertex&Nt)continue;let i=r.addVertex(e.pt,n);e.edge_before=i}for(let e of t)e.edge_after=e.edge_before.next}}function bn(r,t,e){let n=r.edge_before,i=t.edge_after;n.next=e,e.prev=n,e.next=i,i.prev=e}var{INSIDE:X,OUTSIDE:Q,BOUNDARY:M,OVERLAP_SAME:ea,OVERLAP_OPPOSITE:ra}=Ce,{NOT_VERTEX:xp,START_VERTEX:vn,END_VERTEX:wn}=Ce,Le=1,fe=2,wt=3;function na(r,t){let[e,n]=ue(r,t,Le,!0);return e}function Tr(r,t){let n=t.clone().reverse(),[i,s]=ue(r,n,wt,!0);return i}function kn(r,t){let[e,n]=ue(r,t,fe,!0);return e}function Mn(r,t){let[e,n]=ue(r,t,fe,!1),i=[];for(let a of e.faces)i=[...i,...[...a.edges].map(l=>l.shape)];let s=[];for(let a of n.faces)s=[...s,...[...a.edges].map(l=>l.shape)];return[i,s]}function Ir(r,t){let[e,n]=ue(r,t,wt,!1),i=[];for(let s of e.faces)i=[...i,...[...s.edges].map(a=>a.shape)];return i}function Fn(r,t){let e=r.clone(),n=t.clone(),i=Bn(e,n);se(i),Ft(e,i.int_points1_sorted),Ft(n,i.int_points2_sorted),Nr(i),se(i);let s=i.int_points1_sorted.map(l=>l.pt),a=i.int_points2_sorted.map(l=>l.pt);return[s,a]}function ia(r,t,e,n){let i=En(r,e.int_points1),s=En(t,e.int_points2);for(Tn(i,t),Tn(s,r),wr(e.int_points1),wr(e.int_points2),Er(e.int_points1,t),Er(e.int_points2,r);sa(r,t,e.int_points1,e.int_points1_sorted,e.int_points2,e););ta(e),Sr(r,n,e.int_points1_sorted,!0),Sr(t,n,e.int_points2_sorted,!1),In(r,i,n,!0),In(t,s,n,!1)}function oa(r,t,e,n){aa(r,t,n,e.int_points2),la(r,t,e),Ar(r,e.int_points1),Ar(t,e.int_points2),Pr(r,e.int_points1,e.int_points2),Pr(r,e.int_points2,e.int_points1)}function ue(r,t,e,n){let i=r.clone(),s=t.clone(),a=Bn(i,s);return se(a),Ft(i,a.int_points1_sorted),Ft(s,a.int_points2_sorted),Nr(a),se(a),ia(i,s,a,e),n&&oa(i,s,a,e),[i,s]}function Bn(r,t){let e={int_points1:[],int_points2:[]};for(let n of r.edges){let i=t.edges.search(n.box);for(let s of i){let a=n.shape.intersect(s.shape);for(let l of a)kt(n,l,e.int_points1),kt(s,l,e.int_points2)}}return e}function En(r,t){let e=[];for(let n of r.faces)t.find(i=>i.face===n)||e.push(n);return e}function Tn(r,t){for(let e of r)e.first.bv=e.first.bvStart=e.first.bvEnd=void 0,e.first.setInclusion(t)}function sa(r,t,e,n,i,s){let a,l,f,u=n.length,d=!1;for(let c=0;c<u;c++){let h=n[c];h.face!==a&&(l=c,a=h.face);let v=c,y=Mt(n,c,a),b;v+y<u&&n[v+y].face===a?b=v+y:b=l;let w=Mt(n,b,a);f=null;for(let m=b;m<b+w;m++){let I=n[m];if(I.face===a&&i[I.id].face===i[h.id].face){f=I;break}}if(f===null)continue;let _=h.edge_after,E=f.edge_before;if(_.bv===M&&E.bv!=M){_.bv=E.bv;continue}if(_.bv!=M&&E.bv===M){E.bv=_.bv;continue}if(_.bv===M&&E.bv===M&&_!=E||_.bv===X&&E.bv===Q||_.bv===Q&&E.bv===X){let m=_.next;for(;m!=E;)m.bvStart=void 0,m.bvEnd=void 0,m.bv=void 0,m.setInclusion(t),m=m.next}if(_.bv===M&&E.bv===M&&_!=E){let m=_.next,I;for(;m!=E;){if(m.bv!=M){if(I===void 0)I=m.bv;else if(m.bv!=I)throw Oe.UNRESOLVED_BOUNDARY_CONFLICT}m=m.next}I!=null&&(_.bv=I,E.bv=I);continue}if(_.bv===X&&E.bv===Q||_.bv===Q&&E.bv===X){let m=_;for(;m!=E;){if(m.bvStart===_.bv&&m.bvEnd===E.bv){let[I,k]=m.shape.distanceTo(t);if(I<10*o.DP_TOL){kt(m,k.ps,e);let T=e[e.length-1];if(T.is_vertex&vn)T.edge_after=m,T.edge_before=m.prev,m.bvStart=M,m.bv=void 0,m.setInclusion(t);else if(T.is_vertex&wn)T.edge_after=m.next,m.bvEnd=M,m.bv=void 0,m.setInclusion(t);else{let A=t.addVertex(T.pt,m);T.edge_before=A,T.edge_after=A.next,A.setInclusion(t),A.next.bvStart=M,A.next.bvEnd=void 0,A.next.bv=void 0,A.next.setInclusion(t)}let P=t.findEdgeByPoint(k.pe);kt(P,k.pe,i);let C=i[i.length-1];if(C.is_vertex&vn)C.edge_after=P,C.edge_before=P.prev;else if(C.is_vertex&wn)C.edge_after=P.next;else{let A=i.find(re=>re.edge_after===P),O=t.addVertex(C.pt,P);C.edge_before=O,C.edge_after=O.next,A&&(A.edge_after=O),O.bvStart=void 0,O.bvEnd=M,O.bv=void 0,O.setInclusion(r),O.next.bvStart=M,O.next.bvEnd=void 0,O.next.bv=void 0,O.next.setInclusion(r)}se(s),d=!0;break}}m=m.next}if(d)break;throw Oe.UNRESOLVED_BOUNDARY_CONFLICT}}return d}function Sr(r,t,e,n){if(!e)return;let i,s,a,l;for(let f=0;f<e.length;f++){if(a=e[f],a.face!==i&&(s=f,i=a.face),i.isEmpty())continue;let u=f,d=Mt(e,f,i),c;u+d<e.length&&e[u+d].face===a.face?c=u+d:c=s,l=e[c];let h=c,v=Mt(e,h,i),y=a.edge_after,b=l.edge_before;if(y.bv===X&&b.bv===X&&t===Le||y.bv===Q&&b.bv===Q&&t===fe||(y.bv===Q||b.bv===Q)&&t===wt&&!n||(y.bv===X||b.bv===X)&&t===wt&&n||y.bv===M&&b.bv===M&&y.overlap&ea&&n||y.bv===M&&b.bv===M&&y.overlap&ra){r.removeChain(i,y,b);for(let w=u;w<u+d;w++)e[w].edge_after=void 0;for(let w=h;w<h+v;w++)e[w].edge_before=void 0}f+=d-1}}function aa(r,t,e,n){for(let i of t.faces){for(let s of i)r.edges.add(s);n.find(s=>s.face===i)===void 0&&r.addFace(i.first,i.last)}}function la(r,t,e){if(e.int_points1.length!==0)for(let n=0;n<e.int_points1.length;n++){let i=e.int_points1[n],s=e.int_points2[n];if(i.edge_before!==void 0&&i.edge_after===void 0&&s.edge_before===void 0&&s.edge_after!==void 0&&(i.edge_before.next=s.edge_after,s.edge_after.prev=i.edge_before,i.edge_after=s.edge_after,s.edge_before=i.edge_before),s.edge_before!==void 0&&s.edge_after===void 0&&i.edge_before===void 0&&i.edge_after!==void 0&&(s.edge_before.next=i.edge_after,i.edge_after.prev=s.edge_before,s.edge_after=i.edge_after,i.edge_before=s.edge_before),i.edge_before!==void 0&&i.edge_after===void 0)for(let a of e.int_points1_sorted)a!==i&&a.edge_before===void 0&&a.edge_after!==void 0&&a.pt.equalTo(i.pt)&&(i.edge_before.next=a.edge_after,a.edge_after.prev=i.edge_before,i.edge_after=a.edge_after,a.edge_before=i.edge_before);if(s.edge_before!==void 0&&s.edge_after===void 0)for(let a of e.int_points2_sorted)a!==s&&a.edge_before===void 0&&a.edge_after!==void 0&&a.pt.equalTo(s.pt)&&(s.edge_before.next=a.edge_after,a.edge_after.prev=s.edge_before,s.edge_after=a.edge_after,a.edge_before=s.edge_before)}}function Ar(r,t){for(let e of t)r.faces.delete(e.face),e.face=void 0,e.edge_before&&(e.edge_before.face=void 0),e.edge_after&&(e.edge_after.face=void 0)}function Pr(r,t,e){for(let n of t){if(n.edge_before===void 0||n.edge_after===void 0||n.face||n.edge_after.face||n.edge_before.face)continue;let i=n.edge_after,s=n.edge_before;Ne.testInfiniteLoop(i);let a=r.addFace(i,s);for(let l of t)l.edge_before&&l.edge_after&&l.edge_before.face===a&&l.edge_after.face===a&&(l.face=a);for(let l of e)l.edge_before&&l.edge_after&&l.edge_before.face===a&&l.edge_after.face===a&&(l.face=a)}}function In(r,t,e,n){for(let i of t){let s=i.first.bv;(e===Le&&s===X||e===wt&&s===X&&n||e===wt&&s===Q&&!n||e===fe&&s===Q)&&r.deleteFace(i)}}var fa=Object.freeze({BOOLEAN_UNION:Le,BOOLEAN_INTERSECT:fe,BOOLEAN_SUBTRACT:wt,unify:na,subtract:Tr,intersect:kn,innerClip:Mn,outerClip:Ir,calculateIntersections:Fn,removeNotRelevantChains:Sr,removeOldFaces:Ar,restoreFaces:Pr}),ua=RegExp("T.F..FFF.|T.F...F.."),da=RegExp("T........|.T.......|...T.....|....T...."),ca=RegExp("FT.......|F..T.....|F...T...."),pa=RegExp("T.F..F..."),ha=RegExp("T.F..F...|.TF..F...|..FT.F...|..F.TF..."),Tt=class{constructor(){this.m=new Array(9).fill(void 0)}get I2I(){return this.m[0]}set I2I(t){this.m[0]=t}get I2B(){return this.m[1]}set I2B(t){this.m[1]=t}get I2E(){return this.m[2]}set I2E(t){this.m[2]=t}get B2I(){return this.m[3]}set B2I(t){this.m[3]=t}get B2B(){return this.m[4]}set B2B(t){this.m[4]=t}get B2E(){return this.m[5]}set B2E(t){this.m[5]=t}get E2I(){return this.m[6]}set E2I(t){this.m[6]=t}get E2B(){return this.m[7]}set E2B(t){this.m[7]=t}get E2E(){return this.m[8]}set E2E(t){this.m[8]=t}toString(){return this.m.map(t=>t instanceof Array&&t.length>0?"T":t instanceof Array&&t.length===0?"F":"*").join("")}equal(){return ua.test(this.toString())}intersect(){return da.test(this.toString())}touch(){return ca.test(this.toString())}inside(){return pa.test(this.toString())}covered(){return ha.test(this.toString())}};function Re(r,t){let e=[],[n,i,s]=r.standard,[a,l,f]=t.standard,u=n*l-i*a,d=s*l-i*f,c=n*f-s*a;if(!o.Utils.EQ_0(u)){let h,v;i===0?(h=s/n,v=c/u):l===0?(h=f/a,v=c/u):n===0?(h=d/u,v=s/i):a===0?(h=d/u,v=f/l):(h=d/u,v=c/u),e.push(new o.Point(h,v))}return e}function Ut(r,t){let e=[],n=t.pc.projectionOn(r),i=t.pc.distanceTo(n)[0];if(o.Utils.EQ(i,t.r))e.push(n);else if(o.Utils.LT(i,t.r)){let s=Math.sqrt(t.r*t.r-i*i),a,l;a=r.norm.rotate90CCW().multiply(s),l=n.translate(a),e.push(l),a=r.norm.rotate90CW().multiply(s),l=n.translate(a),e.push(l)}return e}function ae(r,t){let e=[];for(let n of t.toSegments()){let i=ke(n,r);for(let s of i)Dn(s,e)||e.push(s)}return e}function Lr(r,t){let e=[];if(ae(r,t.box).length===0)return e;let n=new o.Circle(t.pc,t.r),i=Ut(r,n);for(let s of i)s.on(t)&&e.push(s);return e}function ke(r,t){let e=[];if(r.ps.on(t)&&e.push(r.ps),r.pe.on(t)&&!r.isZeroLength()&&e.push(r.pe),e.length>0||r.isZeroLength()||r.ps.leftTo(t)&&r.pe.leftTo(t)||!r.ps.leftTo(t)&&!r.pe.leftTo(t))return e;let n=new o.Line(r.ps,r.pe);return Re(n,t)}function de(r,t){let e=[];if(r.box.not_intersect(t.box))return e;if(r.isZeroLength())return r.ps.on(t)&&e.push(r.ps),e;if(t.isZeroLength())return t.ps.on(r)&&e.push(t.ps),e;let n=new o.Line(r.ps,r.pe),i=new o.Line(t.ps,t.pe);if(n.incidentTo(i))r.ps.on(t)&&e.push(r.ps),r.pe.on(t)&&e.push(r.pe),t.ps.on(r)&&!t.ps.equalTo(r.ps)&&!t.ps.equalTo(r.pe)&&e.push(t.ps),t.pe.on(r)&&!t.pe.equalTo(r.ps)&&!t.pe.equalTo(r.pe)&&e.push(t.pe);else{let s=Re(n,i);s.length>0&&s[0].on(r)&&s[0].on(t)&&e.push(s[0])}return e}function Me(r,t){let e=[];if(r.box.not_intersect(t.box))return e;if(r.isZeroLength()){let[s,a]=r.ps.distanceTo(t.pc);return o.Utils.EQ(s,t.r)&&e.push(r.ps),e}let n=new o.Line(r.ps,r.pe),i=Ut(n,t);for(let s of i)s.on(r)&&e.push(s);return e}function Et(r,t){let e=[];if(r.box.not_intersect(t.box))return e;if(r.isZeroLength())return r.ps.on(t)&&e.push(r.ps),e;let n=new o.Line(r.ps,r.pe),i=new o.Circle(t.pc,t.r),s=Ut(n,i);for(let a of s)a.on(r)&&a.on(t)&&e.push(a);return e}function ma(r,t){let e=[];for(let n of t.toSegments()){let i=de(n,r);for(let s of i)e.push(s)}return e}function Un(r,t){let e=[];if(r.box.not_intersect(t.box))return e;let n=new o.Vector(r.pc,t.pc),i=r.r,s=t.r;if(o.Utils.EQ_0(i)||o.Utils.EQ_0(s))return e;if(o.Utils.EQ_0(n.x)&&o.Utils.EQ_0(n.y)&&o.Utils.EQ(i,s))return e.push(r.pc.translate(-i,0)),e;let a=r.pc.distanceTo(t.pc)[0];if(o.Utils.GT(a,i+s)||o.Utils.LT(a,Math.abs(i-s)))return e;n.x/=a,n.y/=a;let l;if(o.Utils.EQ(a,i+s)||o.Utils.EQ(a,Math.abs(i-s)))return l=r.pc.translate(i*n.x,i*n.y),e.push(l),e;let f=i*i/(2*a)-s*s/(2*a)+a/2,u=r.pc.translate(f*n.x,f*n.y),d=Math.sqrt(i*i-f*f);return l=u.translate(n.rotate90CCW().multiply(d)),e.push(l),l=u.translate(n.rotate90CW().multiply(d)),e.push(l),e}function ga(r,t){let e=[];for(let n of t.toSegments()){let i=Me(n,r);for(let s of i)e.push(s)}return e}function Rr(r,t){var e=[];if(r.box.not_intersect(t.box))return e;if(r.pc.equalTo(t.pc)&&o.Utils.EQ(r.r,t.r)){let a;return a=r.start,a.on(t)&&e.push(a),a=r.end,a.on(t)&&e.push(a),a=t.start,a.on(r)&&e.push(a),a=t.end,a.on(r)&&e.push(a),e}let n=new o.Circle(r.pc,r.r),i=new o.Circle(t.pc,t.r),s=n.intersect(i);for(let a of s)a.on(r)&&a.on(t)&&e.push(a);return e}function kr(r,t){let e=[];if(r.box.not_intersect(t.box))return e;if(t.pc.equalTo(r.pc)&&o.Utils.EQ(t.r,r.r))return e.push(r.start),e.push(r.end),e;let n=t,i=new o.Circle(r.pc,r.r),s=Un(n,i);for(let a of s)a.on(r)&&e.push(a);return e}function _a(r,t){let e=[];for(let n of t.toSegments()){let i=Et(n,r);for(let s of i)e.push(s)}return e}function xa(r,t){return r.isSegment()?de(r.shape,t):Et(t,r.shape)}function ya(r,t){return r.isSegment()?Et(r.shape,t):Rr(r.shape,t)}function Vn(r,t){return r.isSegment()?ke(r.shape,t):Lr(t,r.shape)}function ba(r,t){return r.isSegment()?Me(r.shape,t):kr(r.shape,t)}function Mr(r,t){let e=[];for(let n of t.edges)for(let i of xa(n,r))e.push(i);return e}function Fr(r,t){let e=[];for(let n of t.edges)for(let i of ya(n,r))e.push(i);return e}function Fe(r,t){let e=[];if(t.isEmpty())return e;for(let n of t.edges)for(let i of Vn(n,r))Dn(i,e)||e.push(i);return r.sortPoints(e)}function Gn(r,t){let e=[];if(t.isEmpty())return e;for(let n of t.edges)for(let i of ba(n,r))e.push(i);return e}function va(r,t){let e=r.shape,n=t.shape;return r.isSegment()?t.isSegment()?de(e,n):Et(e,n):t.isSegment()?Et(n,e):Rr(e,n)}function wa(r,t){let e=[];if(t.isEmpty()||r.shape.box.not_intersect(t.box))return e;let n=t.edges.search(r.shape.box);for(let i of n)for(let s of va(r,i))e.push(s);return e}function Ea(r,t){let e=[];if(r.isEmpty()||t.isEmpty()||r.box.not_intersect(t.box))return e;for(let n of r.edges)for(let i of wa(n,t))e.push(i);return e}function Ta(r,t){return r instanceof o.Line?Fe(r,t):r instanceof o.Segment?Mr(r,t):r instanceof o.Arc?Fr(r,t):[]}function Dn(r,t){return t.some(e=>e.equalTo(r))}var q=class extends Ne{constructor(...t){super();if(t.length!==0&&t.length==1&&t[0]instanceof Array){let e=t[0];if(e.length==0)return;let n=e.every(i=>i instanceof o.Segment||i instanceof o.Arc||i instanceof o.Ray||i instanceof o.Line);for(let i of e){let s=new o.Edge(i);this.append(s)}}}get edges(){return[...this]}get box(){return this.edges.reduce((t,e)=>t=t.merge(e.box),new o.Box)}get vertices(){let t=this.edges.map(e=>e.start);return t.push(this.last.end),t}clone(){return new q(this.toShapes())}addVertex(t,e){let n=e.shape.split(t);if(n[0]===null)return e.prev;if(n[1]===null)return e;let i=new o.Edge(n[0]),s=e.prev;return this.insert(i,s),e.shape=n[1],i}split(t){for(let e of t){let n=this.findEdgeByPoint(e);this.addVertex(e,n)}return this}findEdgeByPoint(t){let e;for(let n of this)if(n.shape.contains(t)){e=n;break}return e}translate(t){return new q(this.edges.map(e=>e.shape.translate(t)))}rotate(t=0,e=new o.Point){return new q(this.edges.map(n=>n.shape.rotate(t,e)))}transform(t=new o.Matrix){return new q(this.edges.map(e=>e.shape.transform(t)))}toShapes(){return this.edges.map(t=>t.shape.clone())}toJSON(){return this.edges.map(t=>t.toJSON())}svg(t={}){let{stroke:e,strokeWidth:n,fill:i,fillRule:s,fillOpacity:a,id:l,className:f}=t,u=l&&l.length>0?`id="${l}"`:"",d=f&&f.length>0?`class="${f}"`:"",c=`
<path stroke="${e||"black"}" stroke-width="${n||1}" fill="${i||"none"}" fill-opacity="${a||1}" ${u} ${d} d="`;c+=`
M${this.first.start.x},${this.first.start.y}`;for(let h of this)c+=h.svg();return c+=`" >
</path>`,c}};o.Multiline=q;var Ia=(...r)=>new o.Multiline(...r);o.multiline=Ia;function oe(r,t){let e,n=new o.Ray(t),i=new o.Line(n.pt,n.norm),s=new o.Box(n.box.xmin-o.DP_TOL,n.box.ymin-o.DP_TOL,n.box.xmax,n.box.ymax+o.DP_TOL);if(r.box.not_intersect(s))return o.OUTSIDE;let a=r.edges.search(s);if(a.length==0)return o.OUTSIDE;for(let u of a)if(u.shape.contains(t))return o.BOUNDARY;let l=[];for(let u of a)for(let d of n.intersect(u.shape)){if(d.equalTo(t))return o.BOUNDARY;l.push({pt:d,edge:u})}l.sort((u,d)=>Rn(u.pt.x,d.pt.x)?-1:Ln(u.pt.x,d.pt.x)?1:0);let f=0;for(let u=0;u<l.length;u++){let d=l[u];if(d.pt.equalTo(d.edge.shape.start)){if(u>0&&d.pt.equalTo(l[u-1].pt)&&d.edge.prev===l[u-1].edge)continue;let c=d.edge.prev;for(;vr(c.length);)c=c.prev;let h=c.shape.tangentInEnd(),v=d.pt.translate(h),y=d.edge.shape.tangentInStart(),b=d.pt.translate(y),w=v.leftTo(i),_=b.leftTo(i);(w&&!_||!w&&_)&&f++}else if(d.pt.equalTo(d.edge.shape.end)){if(u>0&&d.pt.equalTo(l[u-1].pt)&&d.edge.next===l[u-1].edge)continue;let c=d.edge.next;for(;vr(c.length);)c=c.next;let h=c.shape.tangentInStart(),v=d.pt.translate(h),y=d.edge.shape.tangentInEnd(),b=d.pt.translate(y),w=v.leftTo(i),_=b.leftTo(i);(w&&!_||!w&&_)&&f++}else if(d.edge.shape instanceof o.Segment)f++;else{let c=d.edge.shape.box;vt(d.pt.y,c.ymin)||vt(d.pt.y,c.ymax)||f++}}return e=f%2==1?ne:Cn,e}function Sa(r,t){return Vt(r,t).equal()}function $n(r,t){return Vt(r,t).intersect()}function Aa(r,t){return Vt(r,t).touch()}function Pa(r,t){return!$n(r,t)}function Wn(r,t){return Vt(r,t).inside()}function qn(r,t){return Vt(r,t).covered()}function Ca(r,t){return Wn(t,r)}function jn(r,t){return qn(t,r)}function Vt(r,t){if(r instanceof o.Line&&t instanceof o.Line)return Oa(r,t);if(r instanceof o.Line&&t instanceof o.Circle)return Na(r,t);if(r instanceof o.Line&&t instanceof o.Box)return La(r,t);if(r instanceof o.Line&&t instanceof o.Polygon)return Ra(r,t);if((r instanceof o.Segment||r instanceof o.Arc)&&t instanceof o.Polygon)return Sn(r,t);if((r instanceof o.Segment||r instanceof o.Arc)&&(t instanceof o.Circle||t instanceof o.Box))return Sn(r,new o.Polygon(t));if(r instanceof o.Polygon&&t instanceof o.Polygon)return Ie(r,t);if((r instanceof o.Circle||r instanceof o.Box)&&(t instanceof o.Circle||t instanceof o.Box))return Ie(new o.Polygon(r),new o.Polygon(t));if((r instanceof o.Circle||r instanceof o.Box)&&t instanceof o.Polygon)return Ie(new o.Polygon(r),t);if(r instanceof o.Polygon&&(t instanceof o.Circle||t instanceof o.Box))return Ie(r,new o.Polygon(t))}function Oa(r,t){let e=new Tt,n=Re(r,t);return n.length===0?r.contains(t.pt)&&t.contains(r.pt)?(e.I2I=[r],e.I2E=[],e.E2I=[]):(e.I2I=[],e.I2E=[r],e.E2I=[t]):(e.I2I=n,e.I2E=r.split(n),e.E2I=t.split(n)),e}function Na(r,t){let e=new Tt,n=Ut(r,t);if(n.length===0)e.I2I=[],e.I2B=[],e.I2E=[r],e.E2I=[t];else if(n.length===1)e.I2I=[],e.I2B=n,e.I2E=r.split(n),e.E2I=[t];else{let i=new q([r]),s=r.sortPoints(n);i.split(s);let a=i.toShapes();e.I2I=[a[1]],e.I2B=s,e.I2E=[a[0],a[2]],e.E2I=new o.Polygon([t.toArc()]).cut(i)}return e}function La(r,t){let e=new Tt,n=ae(r,t);if(n.length===0)e.I2I=[],e.I2B=[],e.I2E=[r],e.E2I=[t];else if(n.length===1)e.I2I=[],e.I2B=n,e.I2E=r.split(n),e.E2I=[t];else{let i=new q([r]),s=r.sortPoints(n);i.split(s);let a=i.toShapes();t.toSegments().some(l=>l.contains(n[0])&&l.contains(n[1]))?(e.I2I=[],e.I2B=[a[1]],e.I2E=[a[0],a[2]],e.E2I=[t]):(e.I2I=[a[1]],e.I2B=s,e.I2E=[a[0],a[2]],e.E2I=new o.Polygon(t.toSegments()).cut(i))}return e}function Ra(r,t){let e=new Tt,n=Fe(r,t),i=new q([r]),s=n.length>0?n.slice():r.sortPoints(n);return i.split(s),[...i].forEach(a=>a.setInclusion(t)),e.I2I=[...i].filter(a=>a.bv===o.INSIDE).map(a=>a.shape),e.I2B=[...i].slice(1).map(a=>a.bv===o.BOUNDARY?a.shape:a.shape.start),e.I2E=[...i].filter(a=>a.bv===o.OUTSIDE).map(a=>a.shape),e.E2I=t.cut(i),e}function Sn(r,t){let e=new Tt,n=Ta(r,t),i=n.length>0?n.slice():r.sortPoints(n),s=new q([r]);s.split(i),[...s].forEach(a=>a.setInclusion(t)),e.I2I=[...s].filter(a=>a.bv===o.INSIDE).map(a=>a.shape),e.I2B=[...s].slice(1).map(a=>a.bv===o.BOUNDARY?a.shape:a.shape.start),e.I2E=[...s].filter(a=>a.bv===o.OUTSIDE).map(a=>a.shape),e.B2I=[],e.B2B=[],e.B2E=[];for(let a of[r.start,r.end])switch(oe(t,a)){case o.INSIDE:e.B2I.push(a);break;case o.BOUNDARY:e.B2B.push(a);break;case o.OUTSIDE:e.B2E.push(a);break;default:break}return e}function Ie(r,t){let e=new Tt,[n,i]=Fn(r,t),s=kn(r,t),a=Tr(r,t),l=Tr(t,r),[f,u]=Mn(r,t),d=Ir(r,t),c=Ir(t,r);return e.I2I=s.isEmpty()?[]:[s],e.I2B=u,e.I2E=a.isEmpty()?[]:[a],e.B2I=f,e.B2B=n,e.B2E=d,e.E2I=l.isEmpty()?[]:[l],e.E2B=c,e}var ka=Object.freeze({equal:Sa,intersect:$n,touch:Aa,disjoint:Pa,inside:Wn,covered:qn,contain:Ca,cover:jn,relate:Vt}),ut=class{constructor(t=1,e=0,n=0,i=1,s=0,a=0){this.a=t,this.b=e,this.c=n,this.d=i,this.tx=s,this.ty=a}clone(){return new ut(this.a,this.b,this.c,this.d,this.tx,this.ty)}transform(t){return[t[0]*this.a+t[1]*this.c+this.tx,t[0]*this.b+t[1]*this.d+this.ty]}multiply(t){return new ut(this.a*t.a+this.c*t.b,this.b*t.a+this.d*t.b,this.a*t.c+this.c*t.d,this.b*t.c+this.d*t.d,this.a*t.tx+this.c*t.ty+this.tx,this.b*t.tx+this.d*t.ty+this.ty)}translate(...t){let e,n;if(t.length==1&&t[0]instanceof o.Vector)e=t[0].x,n=t[0].y;else if(t.length==2&&typeof t[0]=="number"&&typeof t[1]=="number")e=t[0],n=t[1];else throw o.Errors.ILLEGAL_PARAMETERS;return this.multiply(new ut(1,0,0,1,e,n))}rotate(t){let e=Math.cos(t),n=Math.sin(t);return this.multiply(new ut(e,n,-n,e,0,0))}scale(t,e){return this.multiply(new ut(t,0,0,e,0,0))}equalTo(t){return!(!o.Utils.EQ(this.tx,t.tx)||!o.Utils.EQ(this.ty,t.ty)||!o.Utils.EQ(this.a,t.a)||!o.Utils.EQ(this.b,t.b)||!o.Utils.EQ(this.c,t.c)||!o.Utils.EQ(this.d,t.d))}};o.Matrix=ut;var Ma=(...r)=>new o.Matrix(...r);o.matrix=Ma;var Fa=class Cr{constructor(t,e){this.low=t,this.high=e}clone(){return new Cr(this.low,this.high)}get max(){return this.clone()}less_than(t){return this.low<t.low||this.low==t.low&&this.high<t.high}equal_to(t){return this.low==t.low&&this.high==t.high}intersect(t){return!this.not_intersect(t)}not_intersect(t){return this.high<t.low||t.high<this.low}merge(t){return new Cr(this.low===void 0?t.low:Math.min(this.low,t.low),this.high===void 0?t.high:Math.max(this.high,t.high))}output(){return[this.low,this.high]}static comparable_max(t,e){return t.merge(e)}static comparable_less_than(t,e){return t<e}},B=0,S=1,xt=class{constructor(t=void 0,e=void 0,n=null,i=null,s=null,a=S){this.left=n,this.right=i,this.parent=s,this.color=a,this.item={key:t,value:e},t&&t instanceof Array&&t.length==2&&!Number.isNaN(t[0])&&!Number.isNaN(t[1])&&(this.item.key=new Fa(Math.min(t[0],t[1]),Math.max(t[0],t[1]))),this.max=this.item.key?this.item.key.max:void 0}isNil(){return this.item.key===void 0&&this.item.value===void 0&&this.left===null&&this.right===null&&this.color===S}less_than(t){if(this.item.value===this.item.key&&t.item.value===t.item.key)return this.item.key.less_than(t.item.key);{let e=this.item.value&&t.item.value&&this.item.value.less_than?this.item.value.less_than(t.item.value):this.item.value<t.item.value;return this.item.key.less_than(t.item.key)||this.item.key.equal_to(t.item.key)&&e}}equal_to(t){if(this.item.value===this.item.key&&t.item.value===t.item.key)return this.item.key.equal_to(t.item.key);{let e=this.item.value&&t.item.value&&this.item.value.equal_to?this.item.value.equal_to(t.item.value):this.item.value==t.item.value;return this.item.key.equal_to(t.item.key)&&e}}intersect(t){return this.item.key.intersect(t.item.key)}copy_data(t){this.item.key=t.item.key.clone(),this.item.value=t.item.value&&t.item.value.clone?t.item.value.clone():t.item.value}update_max(){if(this.max=this.item.key?this.item.key.max:void 0,this.right&&this.right.max){let t=this.item.key.constructor.comparable_max;this.max=t(this.max,this.right.max)}if(this.left&&this.left.max){let t=this.item.key.constructor.comparable_max;this.max=t(this.max,this.left.max)}}not_intersect_left_subtree(t){let e=this.item.key.constructor.comparable_less_than,n=this.left.max.high!==void 0?this.left.max.high:this.left.max;return e(n,t.item.key.low)}not_intersect_right_subtree(t){let e=this.item.key.constructor.comparable_less_than,n=this.right.max.low!==void 0?this.right.max.low:this.right.item.key.low;return e(t.item.key.high,n)}},Bt=class{constructor(){this.root=null,this.nil_node=new xt}get size(){let t=0;return this.tree_walk(this.root,()=>t++),t}get keys(){let t=[];return this.tree_walk(this.root,e=>t.push(e.item.key.output?e.item.key.output():e.item.key)),t}get values(){let t=[];return this.tree_walk(this.root,e=>t.push(e.item.value)),t}get items(){let t=[];return this.tree_walk(this.root,e=>t.push({key:e.item.key.output?e.item.key.output():e.item.key,value:e.item.value})),t}isEmpty(){return this.root==null||this.root==this.nil_node}insert(t,e=t){if(t===void 0)return;let n=new xt(t,e,this.nil_node,this.nil_node,null,B);return this.tree_insert(n),this.recalc_max(n),n}exist(t,e=t){let n=new xt(t,e);return!!this.tree_search(this.root,n)}remove(t,e=t){let n=new xt(t,e),i=this.tree_search(this.root,n);return i&&this.tree_delete(i),i}search(t,e=(n,i)=>n===i?i.output():n){let n=new xt(t),i=[];return this.tree_search_interval(this.root,n,i),i.map(s=>e(s.item.value,s.item.key))}intersect_any(t){let e=new xt(t);return this.tree_find_any_interval(this.root,e)}forEach(t){this.tree_walk(this.root,e=>t(e.item.key,e.item.value))}map(t){let e=new Bt;return this.tree_walk(this.root,n=>e.insert(n.item.key,t(n.item.value,n.item.key))),e}recalc_max(t){let e=t;for(;e.parent!=null;)e.parent.update_max(),e=e.parent}tree_insert(t){let e=this.root,n=null;if(this.root==null||this.root==this.nil_node)this.root=t;else{for(;e!=this.nil_node;)n=e,t.less_than(e)?e=e.left:e=e.right;t.parent=n,t.less_than(n)?n.left=t:n.right=t}this.insert_fixup(t)}insert_fixup(t){let e,n;for(e=t;e!=this.root&&e.parent.color==B;)e.parent==e.parent.parent.left?(n=e.parent.parent.right,n.color==B?(e.parent.color=S,n.color=S,e.parent.parent.color=B,e=e.parent.parent):(e==e.parent.right&&(e=e.parent,this.rotate_left(e)),e.parent.color=S,e.parent.parent.color=B,this.rotate_right(e.parent.parent))):(n=e.parent.parent.left,n.color==B?(e.parent.color=S,n.color=S,e.parent.parent.color=B,e=e.parent.parent):(e==e.parent.left&&(e=e.parent,this.rotate_right(e)),e.parent.color=S,e.parent.parent.color=B,this.rotate_left(e.parent.parent)));this.root.color=S}tree_delete(t){let e,n;t.left==this.nil_node||t.right==this.nil_node?e=t:e=this.tree_successor(t),e.left!=this.nil_node?n=e.left:n=e.right,n.parent=e.parent,e==this.root?this.root=n:(e==e.parent.left?e.parent.left=n:e.parent.right=n,e.parent.update_max()),this.recalc_max(n),e!=t&&(t.copy_data(e),t.update_max(),this.recalc_max(t)),e.color==S&&this.delete_fixup(n)}delete_fixup(t){let e=t,n;for(;e!=this.root&&e.parent!=null&&e.color==S;)e==e.parent.left?(n=e.parent.right,n.color==B&&(n.color=S,e.parent.color=B,this.rotate_left(e.parent),n=e.parent.right),n.left.color==S&&n.right.color==S?(n.color=B,e=e.parent):(n.right.color==S&&(n.color=B,n.left.color=S,this.rotate_right(n),n=e.parent.right),n.color=e.parent.color,e.parent.color=S,n.right.color=S,this.rotate_left(e.parent),e=this.root)):(n=e.parent.left,n.color==B&&(n.color=S,e.parent.color=B,this.rotate_right(e.parent),n=e.parent.left),n.left.color==S&&n.right.color==S?(n.color=B,e=e.parent):(n.left.color==S&&(n.color=B,n.right.color=S,this.rotate_left(n),n=e.parent.left),n.color=e.parent.color,e.parent.color=S,n.left.color=S,this.rotate_right(e.parent),e=this.root));e.color=S}tree_search(t,e){if(!(t==null||t==this.nil_node))return e.equal_to(t)?t:e.less_than(t)?this.tree_search(t.left,e):this.tree_search(t.right,e)}tree_search_interval(t,e,n){t!=null&&t!=this.nil_node&&(t.left!=this.nil_node&&!t.not_intersect_left_subtree(e)&&this.tree_search_interval(t.left,e,n),t.intersect(e)&&n.push(t),t.right!=this.nil_node&&!t.not_intersect_right_subtree(e)&&this.tree_search_interval(t.right,e,n))}tree_find_any_interval(t,e){let n=!1;return t!=null&&t!=this.nil_node&&(t.left!=this.nil_node&&!t.not_intersect_left_subtree(e)&&(n=this.tree_find_any_interval(t.left,e)),n||(n=t.intersect(e)),!n&&t.right!=this.nil_node&&!t.not_intersect_right_subtree(e)&&(n=this.tree_find_any_interval(t.right,e))),n}local_minimum(t){let e=t;for(;e.left!=null&&e.left!=this.nil_node;)e=e.left;return e}local_maximum(t){let e=t;for(;e.right!=null&&e.right!=this.nil_node;)e=e.right;return e}tree_successor(t){let e,n,i;if(t.right!=this.nil_node)e=this.local_minimum(t.right);else{for(n=t,i=t.parent;i!=null&&i.right==n;)n=i,i=i.parent;e=i}return e}rotate_left(t){let e=t.right;t.right=e.left,e.left!=this.nil_node&&(e.left.parent=t),e.parent=t.parent,t==this.root?this.root=e:t==t.parent.left?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e,t!=null&&t!=this.nil_node&&t.update_max(),e=t.parent,e!=null&&e!=this.nil_node&&e.update_max()}rotate_right(t){let e=t.left;t.left=e.right,e.right!=this.nil_node&&(e.right.parent=t),e.parent=t.parent,t==this.root?this.root=e:t==t.parent.left?t.parent.left=e:t.parent.right=e,e.right=t,t.parent=e,t!=null&&t!=this.nil_node&&t.update_max(),e=t.parent,e!=null&&e!=this.nil_node&&e.update_max()}tree_walk(t,e){t!=null&&t!=this.nil_node&&(this.tree_walk(t.left,e),e(t),this.tree_walk(t.right,e))}testRedBlackProperty(){let t=!0;return this.tree_walk(this.root,function(e){e.color==B&&(e.left.color==S&&e.right.color==S||(t=!1))}),t}testBlackHeightProperty(t){let e=0,n=0,i=0;if(t.color==S&&e++,t.left!=this.nil_node?n=this.testBlackHeightProperty(t.left):n=1,t.right!=this.nil_node?i=this.testBlackHeightProperty(t.right):i=1,n!=i)throw new Error("Red-black height property violated");return e+=n,e}},zn=class extends Set{constructor(t){super(t);this.index=new Bt,this.forEach(e=>this.index.insert(e))}add(t){let e=this.size;if(super.add(t),this.size>e){let n=this.index.insert(t.box,t)}return this}delete(t){let e=super.delete(t);return e&&this.index.remove(t.box,t),e}clear(){super.clear(),this.index=new Bt}search(t){return this.index.search(t)}hit(t){let e=new o.Box(t.x-1,t.y-1,t.x+1,t.y+1);return this.index.search(e).filter(i=>t.on(i))}svg(){return[...this].reduce((e,n)=>e+n.svg(),"")}};o.PlanarSet=zn;var Be=class{constructor(...t){if(this.x=0,this.y=0,t.length!==0){if(t.length===1&&t[0]instanceof Array&&t[0].length===2){let e=t[0];if(typeof e[0]=="number"&&typeof e[1]=="number"){this.x=e[0],this.y=e[1];return}}if(t.length===1&&t[0]instanceof Object&&t[0].name==="point"){let{x:e,y:n}=t[0];this.x=e,this.y=n;return}if(t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number"){this.x=t[0],this.y=t[1];return}throw o.Errors.ILLEGAL_PARAMETERS}}get box(){return new o.Box(this.x,this.y,this.x,this.y)}clone(){return new o.Point(this.x,this.y)}get vertices(){return[this.clone()]}equalTo(t){return o.Utils.EQ(this.x,t.x)&&o.Utils.EQ(this.y,t.y)}lessThan(t){return!!(o.Utils.LT(this.y,t.y)||o.Utils.EQ(this.y,t.y)&&o.Utils.LT(this.x,t.x))}rotate(t,e={x:0,y:0}){var n=e.x+(this.x-e.x)*Math.cos(t)-(this.y-e.y)*Math.sin(t),i=e.y+(this.x-e.x)*Math.sin(t)+(this.y-e.y)*Math.cos(t);return new o.Point(n,i)}translate(...t){if(t.length==1&&(t[0]instanceof o.Vector||!isNaN(t[0].x)&&!isNaN(t[0].y)))return new o.Point(this.x+t[0].x,this.y+t[0].y);if(t.length==2&&typeof t[0]=="number"&&typeof t[1]=="number")return new o.Point(this.x+t[0],this.y+t[1]);throw o.Errors.ILLEGAL_PARAMETERS}transform(t){return new o.Point(t.transform([this.x,this.y]))}projectionOn(t){if(this.equalTo(t.pt))return this.clone();let e=new o.Vector(this,t.pt);if(o.Utils.EQ_0(e.cross(t.norm)))return t.pt.clone();let n=e.dot(t.norm),i=t.norm.multiply(n);return this.translate(i)}leftTo(t){let e=new o.Vector(t.pt,this);return o.Utils.GT(e.dot(t.norm),0)}distanceTo(t){if(t instanceof Be){let e=t.x-this.x,n=t.y-this.y;return[Math.sqrt(e*e+n*n),new o.Segment(this,t)]}if(t instanceof o.Line)return o.Distance.point2line(this,t);if(t instanceof o.Circle)return o.Distance.point2circle(this,t);if(t instanceof o.Segment)return o.Distance.point2segment(this,t);if(t instanceof o.Arc)return o.Distance.point2arc(this,t);if(t instanceof o.Polygon)return o.Distance.point2polygon(this,t);if(t instanceof o.PlanarSet)return o.Distance.shape2planarSet(this,t)}on(t){if(t instanceof o.Point)return this.equalTo(t);if(t instanceof o.Line)return t.contains(this);if(t instanceof o.Circle)return t.contains(this);if(t instanceof o.Segment)return t.contains(this);if(t instanceof o.Arc)return t.contains(this);if(t instanceof o.Polygon)return t.contains(this)}toJSON(){return Object.assign({},this,{name:"point"})}svg(t={}){let{r:e,stroke:n,strokeWidth:i,fill:s,id:a,className:l}=t,f=a&&a.length>0?`id="${a}"`:"",u=l&&l.length>0?`class="${l}"`:"";return`
<circle cx="${this.x}" cy="${this.y}" r="${e||3}" stroke="${n||"black"}" stroke-width="${i||1}" fill="${s||"red"}" ${f} ${u} />`}};o.Point=Be;var Ba=(...r)=>new o.Point(...r);o.point=Ba;var Yn=class{constructor(...t){if(this.x=0,this.y=0,t.length!==0){if(t.length===1&&t[0]instanceof Array&&t[0].length===2){let e=t[0];if(typeof e[0]=="number"&&typeof e[1]=="number"){this.x=e[0],this.y=e[1];return}}if(t.length===1&&t[0]instanceof Object&&t[0].name==="vector"){let{x:e,y:n}=t[0];this.x=e,this.y=n;return}if(t.length===2){let e=t[0],n=t[1];if(typeof e=="number"&&typeof n=="number"){this.x=e,this.y=n;return}if(e instanceof o.Point&&n instanceof o.Point){this.x=n.x-e.x,this.y=n.y-e.y;return}}throw o.Errors.ILLEGAL_PARAMETERS}}clone(){return new o.Vector(this.x,this.y)}get slope(){let t=Math.atan2(this.y,this.x);return t<0&&(t=2*Math.PI+t),t}get length(){return Math.sqrt(this.dot(this))}equalTo(t){return o.Utils.EQ(this.x,t.x)&&o.Utils.EQ(this.y,t.y)}multiply(t){return new o.Vector(t*this.x,t*this.y)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}normalize(){if(!o.Utils.EQ_0(this.length))return new o.Vector(this.x/this.length,this.y/this.length);throw o.Errors.ZERO_DIVISION}rotate(t){let n=new o.Point(this.x,this.y).rotate(t);return new o.Vector(n.x,n.y)}rotate90CCW(){return new o.Vector(-this.y,this.x)}rotate90CW(){return new o.Vector(this.y,-this.x)}invert(){return new o.Vector(-this.x,-this.y)}add(t){return new o.Vector(this.x+t.x,this.y+t.y)}subtract(t){return new o.Vector(this.x-t.x,this.y-t.y)}angleTo(t){let e=this.normalize(),n=t.normalize(),i=Math.atan2(e.cross(n),e.dot(n));return i<0&&(i+=2*Math.PI),i}projectionOn(t){let e=t.normalize(),n=this.dot(e);return e.multiply(n)}toJSON(){return Object.assign({},this,{name:"vector"})}};o.Vector=Yn;var Ua=(...r)=>new o.Vector(...r);o.vector=Ua;var Lt=class{constructor(...t){if(this.ps=new o.Point,this.pe=new o.Point,t.length!==0){if(t.length===1&&t[0]instanceof Array&&t[0].length===4){let e=t[0];this.ps=new o.Point(e[0],e[1]),this.pe=new o.Point(e[2],e[3]);return}if(t.length===1&&t[0]instanceof Object&&t[0].name==="segment"){let{ps:e,pe:n}=t[0];this.ps=new o.Point(e.x,e.y),this.pe=new o.Point(n.x,n.y);return}if(t.length===1&&t[0]instanceof o.Point){this.ps=t[0].clone();return}if(t.length===2&&t[0]instanceof o.Point&&t[1]instanceof o.Point){this.ps=t[0].clone(),this.pe=t[1].clone();return}if(t.length===4){this.ps=new o.Point(t[0],t[1]),this.pe=new o.Point(t[2],t[3]);return}throw o.Errors.ILLEGAL_PARAMETERS}}clone(){return new o.Segment(this.start,this.end)}get start(){return this.ps}get end(){return this.pe}get vertices(){return[this.ps.clone(),this.pe.clone()]}get length(){return this.start.distanceTo(this.end)[0]}get slope(){return new o.Vector(this.start,this.end).slope}get box(){return new o.Box(Math.min(this.start.x,this.end.x),Math.min(this.start.y,this.end.y),Math.max(this.start.x,this.end.x),Math.max(this.start.y,this.end.y))}equalTo(t){return this.ps.equalTo(t.ps)&&this.pe.equalTo(t.pe)}contains(t){return o.Utils.EQ_0(this.distanceToPoint(t))}intersect(t){if(t instanceof o.Point)return this.contains(t)?[t]:[];if(t instanceof o.Line)return ke(this,t);if(t instanceof o.Segment)return de(this,t);if(t instanceof o.Circle)return Me(this,t);if(t instanceof o.Box)return ma(this,t);if(t instanceof o.Arc)return Et(this,t);if(t instanceof o.Polygon)return Mr(this,t)}distanceTo(t){if(t instanceof o.Point){let[e,n]=o.Distance.point2segment(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Circle){let[e,n]=o.Distance.segment2circle(this,t);return[e,n]}if(t instanceof o.Line){let[e,n]=o.Distance.segment2line(this,t);return[e,n]}if(t instanceof o.Segment){let[e,n]=o.Distance.segment2segment(this,t);return[e,n]}if(t instanceof o.Arc){let[e,n]=o.Distance.segment2arc(this,t);return[e,n]}if(t instanceof o.Polygon){let[e,n]=o.Distance.shape2polygon(this,t);return[e,n]}if(t instanceof o.PlanarSet){let[e,n]=o.Distance.shape2planarSet(this,t);return[e,n]}}tangentInStart(){return new o.Vector(this.start,this.end).normalize()}tangentInEnd(){return new o.Vector(this.end,this.start).normalize()}reverse(){return new Lt(this.end,this.start)}split(t){return this.start.equalTo(t)?[null,this.clone()]:this.end.equalTo(t)?[this.clone(),null]:[new o.Segment(this.start,t),new o.Segment(t,this.end)]}middle(){return new o.Point((this.start.x+this.end.x)/2,(this.start.y+this.end.y)/2)}pointAtLength(t){if(t>this.length||t<0)return null;if(t==0)return this.start;if(t==this.length)return this.end;let e=t/this.length;return new o.Point((this.end.x-this.start.x)*e+this.start.x,(this.end.y-this.start.y)*e+this.start.y)}distanceToPoint(t){let[e,...n]=o.Distance.point2segment(t,this);return e}definiteIntegral(t=0){let e=this.end.x-this.start.x,n=this.start.y-t,i=this.end.y-t;return e*(n+i)/2}translate(...t){return new Lt(this.ps.translate(...t),this.pe.translate(...t))}rotate(t=0,e=new o.Point){let n=new o.Matrix;return n=n.translate(e.x,e.y).rotate(t).translate(-e.x,-e.y),this.transform(n)}transform(t=new o.Matrix){return new Lt(this.ps.transform(t),this.pe.transform(t))}isZeroLength(){return this.ps.equalTo(this.pe)}sortPoints(t){return new o.Line(this.start,this.end).sortPoints(t)}toJSON(){return Object.assign({},this,{name:"segment"})}svg(t={}){let{stroke:e,strokeWidth:n,id:i,className:s}=t,a=i&&i.length>0?`id="${i}"`:"",l=s&&s.length>0?`class="${s}"`:"";return`
<line x1="${this.start.x}" y1="${this.start.y}" x2="${this.end.x}" y2="${this.end.y}" stroke="${e||"black"}" stroke-width="${n||1}" ${a} ${l} />`}};o.Segment=Lt;var Va=(...r)=>new o.Segment(...r);o.segment=Va;var{vector:Se}=o,Ue=class{constructor(...t){if(this.pt=new o.Point,this.norm=new o.Vector(0,1),t.length!=0){if(t.length==1&&t[0]instanceof Object&&t[0].name==="line"){let{pt:e,norm:n}=t[0];this.pt=new o.Point(e),this.norm=new o.Vector(n);return}if(t.length==2){let e=t[0],n=t[1];if(e instanceof o.Point&&n instanceof o.Point){this.pt=e,this.norm=Ue.points2norm(e,n),this.norm.dot(Se(this.pt.x,this.pt.y))>=0&&this.norm.invert();return}if(e instanceof o.Point&&n instanceof o.Vector){if(o.Utils.EQ_0(n.x)&&o.Utils.EQ_0(n.y))throw o.Errors.ILLEGAL_PARAMETERS;this.pt=e.clone(),this.norm=n.clone(),this.norm=this.norm.normalize(),this.norm.dot(Se(this.pt.x,this.pt.y))>=0&&this.norm.invert();return}if(e instanceof o.Vector&&n instanceof o.Point){if(o.Utils.EQ_0(e.x)&&o.Utils.EQ_0(e.y))throw o.Errors.ILLEGAL_PARAMETERS;this.pt=n.clone(),this.norm=e.clone(),this.norm=this.norm.normalize(),this.norm.dot(Se(this.pt.x,this.pt.y))>=0&&this.norm.invert();return}}throw o.Errors.ILLEGAL_PARAMETERS}}clone(){return new o.Line(this.pt,this.norm)}get start(){}get end(){}get length(){return Number.POSITIVE_INFINITY}get box(){return new o.Box(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY)}get middle(){}get slope(){return new o.Vector(this.norm.y,-this.norm.x).slope}get standard(){let t=this.norm.x,e=this.norm.y,n=this.norm.dot(this.pt);return[t,e,n]}parallelTo(t){return o.Utils.EQ_0(this.norm.cross(t.norm))}incidentTo(t){return this.parallelTo(t)&&this.pt.on(t)}contains(t){if(this.pt.equalTo(t))return!0;let e=new o.Vector(this.pt,t);return o.Utils.EQ_0(this.norm.dot(e))}coord(t){return Se(t.x,t.y).cross(this.norm)}intersect(t){if(t instanceof o.Point)return this.contains(t)?[t]:[];if(t instanceof o.Line)return Re(this,t);if(t instanceof o.Circle)return Ut(this,t);if(t instanceof o.Box)return ae(this,t);if(t instanceof o.Segment)return ke(t,this);if(t instanceof o.Arc)return Lr(this,t);if(t instanceof o.Polygon)return Fe(this,t)}distanceTo(t){if(t instanceof o.Point){let[e,n]=o.Distance.point2line(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Circle){let[e,n]=o.Distance.circle2line(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Segment){let[e,n]=o.Distance.segment2line(t,this);return[e,n.reverse()]}if(t instanceof o.Arc){let[e,n]=o.Distance.arc2line(t,this);return[e,n.reverse()]}if(t instanceof o.Polygon){let[e,n]=o.Distance.shape2polygon(this,t);return[e,n]}}split(t){if(t instanceof o.Point)return[new o.Ray(t,this.norm.invert()),new o.Ray(t,this.norm)];{let e=new o.Multiline([this]),n=this.sortPoints(t);return e.split(n),e.toShapes()}}sortPoints(t){return t.slice().sort((e,n)=>this.coord(e)<this.coord(n)?-1:this.coord(e)>this.coord(n)?1:0)}toJSON(){return Object.assign({},this,{name:"line"})}svg(t,e={}){let n=ae(this,t);if(n.length===0)return"";let i=n[0],s=n.length==2?n[1]:n.find(l=>!l.equalTo(i));return s===void 0&&(s=i),new o.Segment(i,s).svg(e)}static points2norm(t,e){if(t.equalTo(e))throw o.Errors.ILLEGAL_PARAMETERS;return new o.Vector(t,e).normalize().rotate90CCW()}};o.Line=Ue;var Ga=(...r)=>new o.Line(...r);o.line=Ga;var Hn=class{constructor(...t){if(this.pc=new o.Point,this.r=1,t.length==1&&t[0]instanceof Object&&t[0].name==="circle"){let{pc:e,r:n}=t[0];this.pc=new o.Point(e),this.r=n;return}else{let[e,n]=[...t];e&&e instanceof o.Point&&(this.pc=e.clone()),n!==void 0&&(this.r=n);return}throw o.Errors.ILLEGAL_PARAMETERS}clone(){return new o.Circle(this.pc.clone(),this.r)}get center(){return this.pc}get box(){return new o.Box(this.pc.x-this.r,this.pc.y-this.r,this.pc.x+this.r,this.pc.y+this.r)}contains(t){if(t instanceof o.Point)return o.Utils.LE(t.distanceTo(this.center)[0],this.r);if(t instanceof o.Segment)return o.Utils.LE(t.start.distanceTo(this.center)[0],this.r)&&o.Utils.LE(t.end.distanceTo(this.center)[0],this.r);if(t instanceof o.Arc)return this.intersect(t).length===0&&o.Utils.LE(t.start.distanceTo(this.center)[0],this.r)&&o.Utils.LE(t.end.distanceTo(this.center)[0],this.r);if(t instanceof o.Circle)return this.intersect(t).length===0&&o.Utils.LE(t.r,this.r)&&o.Utils.LE(t.center.distanceTo(this.center)[0],this.r)}toArc(t=!0){return new o.Arc(this.center,this.r,Math.PI,-Math.PI,t)}intersect(t){if(t instanceof o.Point)return this.contains(t)?[t]:[];if(t instanceof o.Line)return Ut(t,this);if(t instanceof o.Segment)return Me(t,this);if(t instanceof o.Circle)return Un(t,this);if(t instanceof o.Box)return ga(this,t);if(t instanceof o.Arc)return kr(t,this);if(t instanceof o.Polygon)return Gn(this,t)}distanceTo(t){if(t instanceof o.Point){let[e,n]=o.Distance.point2circle(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Circle){let[e,n]=o.Distance.circle2circle(this,t);return[e,n]}if(t instanceof o.Line){let[e,n]=o.Distance.circle2line(this,t);return[e,n]}if(t instanceof o.Segment){let[e,n]=o.Distance.segment2circle(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Arc){let[e,n]=o.Distance.arc2circle(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Polygon){let[e,n]=o.Distance.shape2polygon(this,t);return[e,n]}if(t instanceof o.PlanarSet){let[e,n]=o.Distance.shape2planarSet(this,t);return[e,n]}}toJSON(){return Object.assign({},this,{name:"circle"})}svg(t={}){let{stroke:e,strokeWidth:n,fill:i,fillOpacity:s,id:a,className:l}=t,f=a&&a.length>0?`id="${a}"`:"",u=l&&l.length>0?`class="${l}"`:"";return`
<circle cx="${this.pc.x}" cy="${this.pc.y}" r="${this.r}" stroke="${e||"black"}" stroke-width="${n||1}" fill="${i||"none"}" fill-opacity="${s||1}" ${f} ${u} />`}};o.Circle=Hn;var Da=(...r)=>new o.Circle(...r);o.circle=Da;var Xn=class{constructor(...t){if(this.pc=new o.Point,this.r=1,this.startAngle=0,this.endAngle=2*Math.PI,this.counterClockwise=o.CCW,t.length!=0){if(t.length==1&&t[0]instanceof Object&&t[0].name==="arc"){let{pc:e,r:n,startAngle:i,endAngle:s,counterClockwise:a}=t[0];this.pc=new o.Point(e.x,e.y),this.r=n,this.startAngle=i,this.endAngle=s,this.counterClockwise=a;return}else{let[e,n,i,s,a]=[...t];e&&e instanceof o.Point&&(this.pc=e.clone()),n!==void 0&&(this.r=n),i!==void 0&&(this.startAngle=i),s!==void 0&&(this.endAngle=s),a!==void 0&&(this.counterClockwise=a);return}throw o.Errors.ILLEGAL_PARAMETERS}}clone(){return new o.Arc(this.pc.clone(),this.r,this.startAngle,this.endAngle,this.counterClockwise)}get sweep(){if(o.Utils.EQ(this.startAngle,this.endAngle))return 0;if(o.Utils.EQ(Math.abs(this.startAngle-this.endAngle),o.PIx2))return o.PIx2;let t;return this.counterClockwise?t=o.Utils.GT(this.endAngle,this.startAngle)?this.endAngle-this.startAngle:this.endAngle-this.startAngle+o.PIx2:t=o.Utils.GT(this.startAngle,this.endAngle)?this.startAngle-this.endAngle:this.startAngle-this.endAngle+o.PIx2,o.Utils.GT(t,o.PIx2)&&(t-=o.PIx2),o.Utils.LT(t,0)&&(t+=o.PIx2),t}get start(){return new o.Point(this.pc.x+this.r,this.pc.y).rotate(this.startAngle,this.pc)}get end(){return new o.Point(this.pc.x+this.r,this.pc.y).rotate(this.endAngle,this.pc)}get center(){return this.pc.clone()}get vertices(){return[this.start.clone(),this.end.clone()]}get length(){return Math.abs(this.sweep*this.r)}get box(){let e=this.breakToFunctional().reduce((n,i)=>n.merge(i.start.box),new o.Box);return e=e.merge(this.end.box),e}contains(t){if(!o.Utils.EQ(this.pc.distanceTo(t)[0],this.r))return!1;if(t.equalTo(this.start))return!0;let e=new o.Vector(this.pc,t).slope,n=new o.Arc(this.pc,this.r,this.startAngle,e,this.counterClockwise);return o.Utils.LE(n.length,this.length)}split(t){if(this.start.equalTo(t))return[null,this.clone()];if(this.end.equalTo(t))return[this.clone(),null];let e=new o.Vector(this.pc,t).slope;return[new o.Arc(this.pc,this.r,this.startAngle,e,this.counterClockwise),new o.Arc(this.pc,this.r,e,this.endAngle,this.counterClockwise)]}middle(){let t=this.counterClockwise?this.startAngle+this.sweep/2:this.startAngle-this.sweep/2;return new o.Arc(this.pc,this.r,this.startAngle,t,this.counterClockwise).end}pointAtLength(t){if(t>this.length||t<0)return null;if(t==0)return this.start;if(t==this.length)return this.end;let e=t/this.length,n=this.counterClockwise?this.startAngle+this.sweep*e:this.startAngle-this.sweep*e;return new o.Arc(this.pc,this.r,this.startAngle,n,this.counterClockwise).end}chordHeight(){return(1-Math.cos(Math.abs(this.sweep/2)))*this.r}intersect(t){if(t instanceof o.Point)return this.contains(t)?[t]:[];if(t instanceof o.Line)return Lr(t,this);if(t instanceof o.Circle)return kr(this,t);if(t instanceof o.Segment)return Et(t,this);if(t instanceof o.Box)return _a(this,t);if(t instanceof o.Arc)return Rr(this,t);if(t instanceof o.Polygon)return Fr(this,t)}distanceTo(t){if(t instanceof o.Point){let[e,n]=o.Distance.point2arc(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Circle){let[e,n]=o.Distance.arc2circle(this,t);return[e,n]}if(t instanceof o.Line){let[e,n]=o.Distance.arc2line(this,t);return[e,n]}if(t instanceof o.Segment){let[e,n]=o.Distance.segment2arc(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Arc){let[e,n]=o.Distance.arc2arc(this,t);return[e,n]}if(t instanceof o.Polygon){let[e,n]=o.Distance.shape2polygon(this,t);return[e,n]}if(t instanceof o.PlanarSet){let[e,n]=o.Distance.shape2planarSet(this,t);return[e,n]}}breakToFunctional(){let t=[],e=[0,Math.PI/2,2*Math.PI/2,3*Math.PI/2],n=[this.pc.translate(this.r,0),this.pc.translate(0,this.r),this.pc.translate(-this.r,0),this.pc.translate(0,-this.r)],i=[];for(let s=0;s<4;s++)n[s].on(this)&&i.push(new o.Arc(this.pc,this.r,this.startAngle,e[s],this.counterClockwise));if(i.length==0)t.push(this.clone());else{i.sort((l,f)=>l.length-f.length);for(let l=0;l<i.length;l++){let f=t.length>0?t[t.length-1]:void 0,u;f?u=new o.Arc(this.pc,this.r,f.endAngle,i[l].endAngle,this.counterClockwise):u=new o.Arc(this.pc,this.r,this.startAngle,i[l].endAngle,this.counterClockwise),o.Utils.EQ_0(u.length)||t.push(u.clone())}let s=t.length>0?t[t.length-1]:void 0,a;s?a=new o.Arc(this.pc,this.r,s.endAngle,this.endAngle,this.counterClockwise):a=new o.Arc(this.pc,this.r,this.startAngle,this.endAngle,this.counterClockwise),!o.Utils.EQ_0(a.length)&&!o.Utils.EQ(a.sweep,2*Math.PI)&&t.push(a.clone())}return t}tangentInStart(){let t=new o.Vector(this.pc,this.start),e=this.counterClockwise?Math.PI/2:-Math.PI/2;return t.rotate(e).normalize()}tangentInEnd(){let t=new o.Vector(this.pc,this.end),e=this.counterClockwise?-Math.PI/2:Math.PI/2;return t.rotate(e).normalize()}reverse(){return new o.Arc(this.pc,this.r,this.endAngle,this.startAngle,!this.counterClockwise)}translate(...t){let e=this.clone();return e.pc=this.pc.translate(...t),e}rotate(t=0,e=new o.Point){let n=new o.Matrix;return n=n.translate(e.x,e.y).rotate(t).translate(-e.x,-e.y),this.transform(n)}scale(t=1,e=1){let n=new o.Matrix;return n=n.scale(t,e),this.transform(n)}transform(t=new o.Matrix){let e=this.start.transform(t),n=this.end.transform(t),i=this.pc.transform(t),s=this.counterClockwise;return t.a*t.d<0&&(s=!s),o.Arc.arcSE(i,e,n,s)}static arcSE(t,e,n,i){let{vector:s}=o,a=s(t,e).slope,l=s(t,n).slope;o.Utils.EQ(a,l)&&(l+=2*Math.PI,i=!0);let f=s(t,e).length;return new o.Arc(t,f,a,l,i)}definiteIntegral(t=0){return this.breakToFunctional().reduce((i,s)=>i+s.circularSegmentDefiniteIntegral(t),0)}circularSegmentDefiniteIntegral(t){let e=new o.Line(this.start,this.end),n=this.pc.leftTo(e),s=new o.Segment(this.start,this.end).definiteIntegral(t),a=this.circularSegmentArea();return n?s-a:s+a}circularSegmentArea(){return .5*this.r*this.r*(this.sweep-Math.sin(this.sweep))}sortPoints(t){let{vector:e}=o;return t.slice().sort((n,i)=>{let s=e(this.pc,n).slope,a=e(this.pc,i).slope;return s<a?-1:s>a?1:0})}toJSON(){return Object.assign({},this,{name:"arc"})}svg(t={}){let e=this.sweep<=Math.PI?"0":"1",n=this.counterClockwise?"1":"0",{stroke:i,strokeWidth:s,fill:a,id:l,className:f}=t,u=l&&l.length>0?`id="${l}"`:"",d=f&&f.length>0?`class="${f}"`:"";return o.Utils.EQ(this.sweep,2*Math.PI)?new o.Circle(this.pc,this.r).svg(t):`
<path d="M${this.start.x},${this.start.y}
                             A${this.r},${this.r} 0 ${e},${n} ${this.end.x},${this.end.y}"
                    stroke="${i||"black"}" stroke-width="${s||1}" fill="${a||"none"}" ${u} ${d} />`}};o.Arc=Xn;var $a=(...r)=>new o.Arc(...r);o.arc=$a;var le=class{constructor(t=void 0,e=void 0,n=void 0,i=void 0){this.xmin=t,this.ymin=e,this.xmax=n,this.ymax=i}clone(){return new le(this.xmin,this.ymin,this.xmax,this.ymax)}get low(){return new o.Point(this.xmin,this.ymin)}get high(){return new o.Point(this.xmax,this.ymax)}get max(){return this.clone()}get center(){return new o.Point((this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)}get width(){return Math.abs(this.xmax-this.xmin)}get height(){return Math.abs(this.ymax-this.ymin)}get box(){return this.clone()}not_intersect(t){return this.xmax<t.xmin||this.xmin>t.xmax||this.ymax<t.ymin||this.ymin>t.ymax}intersect(t){return!this.not_intersect(t)}merge(t){return new le(this.xmin===void 0?t.xmin:Math.min(this.xmin,t.xmin),this.ymin===void 0?t.ymin:Math.min(this.ymin,t.ymin),this.xmax===void 0?t.xmax:Math.max(this.xmax,t.xmax),this.ymax===void 0?t.ymax:Math.max(this.ymax,t.ymax))}less_than(t){return!!(this.low.lessThan(t.low)||this.low.equalTo(t.low)&&this.high.lessThan(t.high))}equal_to(t){return this.low.equalTo(t.low)&&this.high.equalTo(t.high)}output(){return this.clone()}static comparable_max(t,e){return t.merge(e)}static comparable_less_than(t,e){return t.lessThan(e)}set(t,e,n,i){this.xmin=t,this.ymin=e,this.xmax=n,this.ymax=i}toPoints(){return[new o.Point(this.xmin,this.ymin),new o.Point(this.xmax,this.ymin),new o.Point(this.xmax,this.ymax),new o.Point(this.xmin,this.ymax)]}toSegments(){let t=this.toPoints();return[new o.Segment(t[0],t[1]),new o.Segment(t[1],t[2]),new o.Segment(t[2],t[3]),new o.Segment(t[3],t[0])]}svg(t={}){let{stroke:e,strokeWidth:n,fill:i,id:s,className:a}=t,l=s&&s.length>0?`id="${s}"`:"",f=a&&a.length>0?`class="${a}"`:"",u=this.xmax-this.xmin,d=this.ymax-this.ymin;return`
<rect x="${this.xmin}" y="${this.ymin}" width=${u} height=${d} stroke="${e||"black"}" stroke-width="${n||1}" fill="${i||"none"}" ${l} ${f} />`}};o.Box=le;var Wa=(...r)=>new o.Box(...r);o.box=Wa;var Qn=class{constructor(t){this.shape=t,this.next=void 0,this.prev=void 0,this.face=void 0,this.arc_length=0,this.bvStart=void 0,this.bvEnd=void 0,this.bv=void 0,this.overlap=void 0}get start(){return this.shape.start}get end(){return this.shape.end}get length(){return this.shape.length}get box(){return this.shape.box}isSegment(){return this.shape instanceof o.Segment}isArc(){return this.shape instanceof o.Arc}middle(){return this.shape.middle()}pointAtLength(t){return this.shape.pointAtLength(t)}contains(t){return this.shape.contains(t)}setInclusion(t){if(this.bv!==void 0)return this.bv;if(this.shape instanceof o.Line||this.shape instanceof o.Ray)return this.bv=o.OUTSIDE,this.bv;if(this.bvStart===void 0&&(this.bvStart=oe(t,this.start)),this.bvEnd===void 0&&(this.bvEnd=oe(t,this.end)),this.bvStart===o.OUTSIDE||this.bvEnd==o.OUTSIDE)this.bv=o.OUTSIDE;else if(this.bvStart===o.INSIDE||this.bvEnd==o.INSIDE)this.bv=o.INSIDE;else{let e=oe(t,this.middle());this.bv=e}return this.bv}setOverlap(t){let e,n=this.shape,i=t.shape;n instanceof o.Segment&&i instanceof o.Segment?n.start.equalTo(i.start)&&n.end.equalTo(i.end)?e=o.OVERLAP_SAME:n.start.equalTo(i.end)&&n.end.equalTo(i.start)&&(e=o.OVERLAP_OPPOSITE):(n instanceof o.Arc&&i instanceof o.Arc||n instanceof o.Segment&&i instanceof o.Arc||n instanceof o.Arc&&i instanceof o.Segment)&&(n.start.equalTo(i.start)&&n.end.equalTo(i.end)&&n.middle().equalTo(i.middle())?e=o.OVERLAP_SAME:n.start.equalTo(i.end)&&n.end.equalTo(i.start)&&n.middle().equalTo(i.middle())&&(e=o.OVERLAP_OPPOSITE)),this.overlap===void 0&&(this.overlap=e),t.overlap===void 0&&(t.overlap=e)}svg(){if(this.shape instanceof o.Segment)return` L${this.shape.end.x},${this.shape.end.y}`;if(this.shape instanceof o.Arc){let t=this.shape,e,n=t.counterClockwise?"1":"0";if(o.Utils.EQ(t.sweep,2*Math.PI)){let i=t.counterClockwise?1:-1,s=new o.Arc(t.pc,t.r,t.startAngle,t.startAngle+i*Math.PI,t.counterClockwise),a=new o.Arc(t.pc,t.r,t.startAngle+i*Math.PI,t.endAngle,t.counterClockwise);return e="0",` A${s.r},${s.r} 0 ${e},${n} ${s.end.x},${s.end.y}
                    A${a.r},${a.r} 0 ${e},${n} ${a.end.x},${a.end.y}`}else return e=t.sweep<=Math.PI?"0":"1",` A${t.r},${t.r} 0 ${e},${n} ${t.end.x},${t.end.y}`}}toJSON(){return this.shape.toJSON()}};o.Edge=Qn;var Jn=class extends Ne{constructor(t,e){super(t,e);this.setCircularLinks()}setCircularLinks(){this.isEmpty()||(this.last.next=this.first,this.first.prev=this.last)}[Symbol.iterator](){let t;return{next:()=>{let e=t||this.first,n=this.first?t?t===this.first:!1:!0;return t=e?e.next:void 0,{value:e,done:n}}}}append(t){return super.append(t),this.setCircularLinks(),this}insert(t,e){return super.insert(t,e),this.setCircularLinks(),this}remove(t){return super.remove(t),this}},yt=class extends Jn{constructor(t,...e){super();if(this._box=void 0,this._orientation=void 0,e.length!=0){if(e.length==1){if(e[0]instanceof Array){let n=e[0];if(n.length==0)return;if(n.every(i=>i instanceof o.Point)){let i=yt.points2segments(n);this.shapes2face(t.edges,i)}else if(n.every(i=>i instanceof Array&&i.length===2)){let i=n.map(a=>new o.Point(a[0],a[1])),s=yt.points2segments(i);this.shapes2face(t.edges,s)}else if(n.every(i=>i instanceof o.Segment||i instanceof o.Arc))this.shapes2face(t.edges,n);else if(n.every(i=>i.name==="segment"||i.name==="arc")){let i=[];for(let s of n){let a;s.name==="segment"?a=new o.Segment(s):a=new o.Arc(s),i.push(a)}this.shapes2face(t.edges,i)}}else if(e[0]instanceof yt){let n=e[0];this.first=n.first,this.last=n.last;for(let i of n)t.edges.add(i)}else if(e[0]instanceof o.Circle)this.shapes2face(t.edges,[e[0].toArc(o.CCW)]);else if(e[0]instanceof o.Box){let n=e[0];this.shapes2face(t.edges,[new o.Segment(new o.Point(n.xmin,n.ymin),new o.Point(n.xmax,n.ymin)),new o.Segment(new o.Point(n.xmax,n.ymin),new o.Point(n.xmax,n.ymax)),new o.Segment(new o.Point(n.xmax,n.ymax),new o.Point(n.xmin,n.ymax)),new o.Segment(new o.Point(n.xmin,n.ymax),new o.Point(n.xmin,n.ymin))])}}e.length==2&&e[0]instanceof o.Edge&&e[1]instanceof o.Edge&&(this.first=e[0],this.last=e[1],this.last.next=this.first,this.first.prev=this.last,this.setArcLength())}}get edges(){return this.toArray()}get shapes(){return this.edges.map(t=>t.shape.clone())}get box(){if(this._box===void 0){let t=new o.Box;for(let e of this)t=t.merge(e.box);this._box=t}return this._box}get perimeter(){return this.last.arc_length+this.last.length}pointAtLength(t){if(t>this.perimeter||t<0)return null;let e=null;for(let n of this)if(t>=n.arc_length&&(n===this.last||t<n.next.arc_length)){e=n.pointAtLength(t-n.arc_length);break}return e}static points2segments(t){let e=[];for(let n=0;n<t.length;n++)t[n].equalTo(t[(n+1)%t.length])||e.push(new o.Segment(t[n],t[(n+1)%t.length]));return e}shapes2face(t,e){for(let n of e){let i=new o.Edge(n);this.append(i),t.add(i)}}append(t){return super.append(t),this.setOneEdgeArcLength(t),t.face=this,this}insert(t,e){return super.insert(t,e),this.setOneEdgeArcLength(t),t.face=this,this}remove(t){return super.remove(t),this.setArcLength(),this}reverse(){let t=[],e=this.last;do e.shape=e.shape.reverse(),t.push(e),e=e.prev;while(e!==this.last);this.first=void 0,this.last=void 0;for(let n of t)this.first===void 0?(n.prev=n,n.next=n,this.first=n,this.last=n):(n.prev=this.last,this.last.next=n,this.last=n,this.last.next=this.first,this.first.prev=this.last),this.setOneEdgeArcLength(n);this._orientation!==void 0&&(this._orientation=void 0,this._orientation=this.orientation())}setArcLength(){for(let t of this)this.setOneEdgeArcLength(t),t.face=this}setOneEdgeArcLength(t){t===this.first?t.arc_length=0:t.arc_length=t.prev.arc_length+t.prev.length}area(){return Math.abs(this.signedArea())}signedArea(){let t=0,e=this.box.ymin;for(let n of this)t+=n.shape.definiteIntegral(e);return t}orientation(){if(this._orientation===void 0){let t=this.signedArea();o.Utils.EQ_0(t)?this._orientation=o.ORIENTATION.NOT_ORIENTABLE:o.Utils.LT(t,0)?this._orientation=o.ORIENTATION.CCW:this._orientation=o.ORIENTATION.CW}return this._orientation}isSimple(t){return yt.getSelfIntersections(this,t,!0).length==0}static getSelfIntersections(t,e,n=!1){let i=[];for(let s of t){let a=e.search(s.box);for(let l of a){if(s===l||l.face!==t||s.shape instanceof o.Segment&&l.shape instanceof o.Segment&&(s.next===l||s.prev===l))continue;let f=s.shape.intersect(l.shape);for(let u of f)if(!(u.equalTo(s.start)&&u.equalTo(l.end)&&l===s.prev)&&!(u.equalTo(s.end)&&u.equalTo(l.start)&&l===s.next)&&(i.push(u),n))break;if(i.length>0&&n)break}if(i.length>0&&n)break}return i}findEdgeByPoint(t){let e;for(let n of this)if(n.shape.contains(t)){e=n;break}return e}toPolygon(){return new o.Polygon(this.shapes)}toJSON(){return this.edges.map(t=>t.toJSON())}svg(){let t=`
M${this.first.start.x},${this.first.start.y}`;for(let e of this)t+=e.svg();return t+=" z",t}};o.Face=yt;var Ve=class{constructor(...t){if(this.pt=new o.Point,this.norm=new o.Vector(0,1),t.length!=0&&(t.length>=1&&t[0]instanceof o.Point&&(this.pt=t[0].clone()),t.length!==1)){if(t.length===2&&t[1]instanceof o.Vector){this.norm=t[1].clone();return}throw o.Errors.ILLEGAL_PARAMETERS}}clone(){return new Ve(this.pt,this.norm)}get slope(){return new o.Vector(this.norm.y,-this.norm.x).slope}get box(){let t=this.slope;return new o.Box(t>Math.PI/2&&t<3*Math.PI/2?Number.NEGATIVE_INFINITY:this.pt.x,t>=0&&t<=Math.PI?this.pt.y:Number.NEGATIVE_INFINITY,t>=Math.PI/2&&t<=3*Math.PI/2?this.pt.x:Number.POSITIVE_INFINITY,t>=Math.PI&&t<=2*Math.PI||t==0?this.pt.y:Number.POSITIVE_INFINITY)}get start(){return this.pt}get end(){}get length(){return Number.POSITIVE_INFINITY}contains(t){if(this.pt.equalTo(t))return!0;let e=new o.Vector(this.pt,t);return o.Utils.EQ_0(this.norm.dot(e))&&o.Utils.GE(e.cross(this.norm),0)}split(t){return this.contains(t)?this.pt.equalTo(t)?[this]:[new o.Segment(this.pt,t),new o.Ray(t,this.norm)]:[]}intersect(t){if(t instanceof o.Segment)return this.intersectRay2Segment(this,t);if(t instanceof o.Arc)return this.intersectRay2Arc(this,t)}intersectRay2Segment(t,e){let n=[],i=new o.Line(t.start,t.norm),s=i.intersect(e);for(let a of s)t.contains(a)&&n.push(a);return s.length==2&&n.length==1&&t.start.on(i)&&n.push(t.start),n}intersectRay2Arc(t,e){let n=[],s=new o.Line(t.start,t.norm).intersect(e);for(let a of s)t.contains(a)&&n.push(a);return n}svg(t,e={}){let n=new o.Line(this.pt,this.norm),i=ae(n,t);return i=i.filter(a=>this.contains(a)),i.length===0||i.length===2?"":new o.Segment(this.pt,i[0]).svg(e)}};o.Ray=Ve;var qa=(...r)=>new o.Ray(...r);o.ray=qa;var bt=class{constructor(){this.faces=new o.PlanarSet,this.edges=new o.PlanarSet;let t=[...arguments];if(t.length===1&&(t[0]instanceof Array&&t[0].length>0||t[0]instanceof o.Circle||t[0]instanceof o.Box)){let e=t[0];if(t[0]instanceof Array&&t[0].every(n=>n instanceof Array))if(e.every(n=>n instanceof Array&&n.length===2&&typeof n[0]=="number"&&typeof n[1]=="number"))this.faces.add(new o.Face(this,e));else for(let n of e)if(n instanceof Array&&n[0]instanceof Array&&n[0].every(i=>i instanceof Array&&i.length===2&&typeof i[0]=="number"&&typeof i[1]=="number"))for(let i of n)this.faces.add(new o.Face(this,i));else this.faces.add(new o.Face(this,n));else this.faces.add(new o.Face(this,e))}}get box(){return[...this.faces].reduce((t,e)=>t.merge(e.box),new o.Box)}get vertices(){return[...this.edges].map(t=>t.start)}clone(){let t=new bt;for(let e of this.faces)t.addFace(e.shapes);return t}isEmpty(){return this.edges.size===0}isValid(){let t=!0;for(let e of this.faces)if(!e.isSimple(this.edges)){t=!1;break}return t}area(){let t=[...this.faces].reduce((e,n)=>e+n.signedArea(),0);return Math.abs(t)}addFace(...t){let e=new o.Face(this,...t);return this.faces.add(e),e}deleteFace(t){for(let e of t)this.edges.delete(e);return this.faces.delete(t)}recreateFaces(){this.faces.clear();for(let n of this.edges)n.face=null;let t,e=!0;for(;e;){e=!1;for(let n of this.edges)if(n.face===null){t=n,e=!0;break}if(e){let n=t;do n=n.next;while(n.next!==t);this.addFace(t,n)}}}removeChain(t,e,n){if(n.next===e){this.deleteFace(t);return}for(let i=e;i!==n.next;i=i.next)if(t.remove(i),this.edges.delete(i),t.isEmpty()){this.deleteFace(t);break}}addVertex(t,e){let n=e.shape.split(t);if(n[0]===null)return e.prev;if(n[1]===null)return e;let i=new o.Edge(n[0]),s=e.prev;return e.face.insert(i,s),this.edges.delete(e),this.edges.add(i),e.shape=n[1],this.edges.add(e),i}cut(t){let e=[this.clone()];for(let n of t){if(n.setInclusion(this)!==ne)continue;let i=n.shape.start,s=n.shape.end,a=[];for(let l of e)if(l.findEdgeByPoint(i)===void 0)a.push(l);else{let[f,u]=l.cutFace(i,s);a.push(f,u)}e=a}return e}cutFace(t,e){let n=this.findEdgeByPoint(t),i=this.findEdgeByPoint(e);if(n.face!==i.face)return[];let s=this.addVertex(t,n);i=this.findEdgeByPoint(e);let a=this.addVertex(e,i),l=s.face,f=new o.Edge(new o.Segment(s.end,a.end)),u=new o.Edge(new o.Segment(a.end,s.end));s.next.prev=u,u.next=s.next,s.next=f,f.prev=s,a.next.prev=f,f.next=a.next,a.next=u,u.prev=a,this.edges.add(f),this.edges.add(u);let d=this.addFace(f,s),c=this.addFace(u,a);return this.faces.delete(l),[d.toPolygon(),c.toPolygon()]}cutWithLine(t){let e=this.clone(),n=new q([t]),i={int_points1:[],int_points2:[],int_points1_sorted:[],int_points2_sorted:[]};for(let l of e.edges){let f=Vn(l,t);for(let u of f)kt(n.first,u,i.int_points1),kt(l,u,i.int_points2)}if(i.int_points1.length===0)return e;i.int_points1_sorted=xr(t,i.int_points1),i.int_points2_sorted=ie(i.int_points2),Ft(n,i.int_points1_sorted),Ft(e,i.int_points2_sorted),Nr(i),i.int_points1_sorted=xr(t,i.int_points1),i.int_points2_sorted=ie(i.int_points2),wr(i.int_points1),Er(i.int_points1,e);for(let l of i.int_points1_sorted)l.edge_before.bv===l.edge_after.bv&&(i.int_points2[l.id]=-1,l.id=-1);if(i.int_points1=i.int_points1.filter(l=>l.id>=0),i.int_points2=i.int_points2.filter(l=>l.id>=0),i.int_points1.length===0)return e;i.int_points1_sorted=xr(t,i.int_points1),i.int_points2_sorted=ie(i.int_points2);let s=i.int_points1[0],a;for(let l of i.int_points1_sorted)l.edge_before.bv===ne&&(a=new o.Edge(new o.Segment(s.pt,l.pt)),bn(i.int_points2[s.id],i.int_points2[l.id],a),e.edges.add(a),a=new o.Edge(new o.Segment(l.pt,s.pt)),bn(i.int_points2[l.id],i.int_points2[s.id],a),e.edges.add(a)),s=l;return e.recreateFaces(),e}findEdgeByPoint(t){let e;for(let n of this.faces)if(e=n.findEdgeByPoint(t),e!==void 0)break;return e}splitToIslands(){let t=this.toArray();t.sort((i,s)=>s.area()-i.area());let e=[...t[0].faces][0].orientation(),n=t.filter(i=>[...i.faces][0].orientation()===e);for(let i of t){let s=[...i.faces][0];if(s.orientation()!==e){for(let a of n)if(s.shapes.every(l=>a.contains(l))){a.addFace(s.shapes);break}}}return n}reverse(){for(let t of this.faces)t.reverse();return this}contains(t){if(t instanceof o.Point){let e=oe(this,t);return e===ne||e===H}else return jn(this,t)}distanceTo(t){if(t instanceof o.Point){let[e,n]=o.Distance.point2polygon(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Circle||t instanceof o.Line||t instanceof o.Segment||t instanceof o.Arc){let[e,n]=o.Distance.shape2polygon(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Polygon){let e=[Number.POSITIVE_INFINITY,new o.Segment],n,i;for(let s of this.edges){let a=e[0];[n,i]=o.Distance.shape2planarSet(s.shape,t.edges,a),o.Utils.LT(n,a)&&(e=[n,i])}return e}}intersect(t){if(t instanceof o.Point)return this.contains(t)?[t]:[];if(t instanceof o.Line)return Fe(t,this);if(t instanceof o.Circle)return Gn(t,this);if(t instanceof o.Segment)return Mr(t,this);if(t instanceof o.Arc)return Fr(t,this);if(t instanceof o.Polygon)return Ea(t,this)}translate(t){let e=new bt;for(let n of this.faces)e.addFace(n.shapes.map(i=>i.translate(t)));return e}rotate(t=0,e=new o.Point){let n=new bt;for(let i of this.faces)n.addFace(i.shapes.map(s=>s.rotate(t,e)));return n}transform(t=new o.Matrix){let e=new bt;for(let n of this.faces)e.addFace(n.shapes.map(i=>i.transform(t)));return e}toJSON(){return[...this.faces].map(t=>t.toJSON())}toArray(){return[...this.faces].map(t=>t.toPolygon())}svg(t={}){let{stroke:e,strokeWidth:n,fill:i,fillRule:s,fillOpacity:a,id:l,className:f}=t,u=l&&l.length>0?`id="${l}"`:"",d=f&&f.length>0?`class="${f}"`:"",c=`
<path stroke="${e||"black"}" stroke-width="${n||1}" fill="${i||"lightcyan"}" fill-rule="${s||"evenodd"}" fill-opacity="${a||1}" ${u} ${d} d="`;for(let h of this.faces)c+=h.svg();return c+=`" >
</path>`,c}};o.Polygon=bt;var ja=(...r)=>new o.Polygon(...r);o.polygon=ja;var{Circle:yr,Line:An,Point:Pn,Vector:Ae,Utils:br}=o,Rt=class{constructor(t){this.circle=t}get inversion_circle(){return this.circle}static inversePoint(t,e){let n=new Ae(t.pc,e),i=t.r*t.r,s=n.dot(n);return br.EQ_0(s)?new Pn(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY):t.pc.translate(n.multiply(i/s))}static inverseCircle(t,e){let n=t.pc.distanceTo(e.pc)[0];if(br.EQ(n,e.r)){let i=t.r*t.r/(2*e.r),s=new Ae(t.pc,e.pc);s=s.normalize();let a=t.pc.translate(s.multiply(i));return new An(a,s)}else{let i=new Ae(t.pc,e.pc),s=t.r*t.r/(i.dot(i)-e.r*e.r),a=t.pc.translate(i.multiply(s)),l=Math.abs(s)*e.r;return new yr(a,l)}}static inverseLine(t,e){let[n,i]=t.pc.distanceTo(e);if(br.EQ_0(n))return e.clone();{let s=t.r*t.r/(2*n),a=new Ae(t.pc,i.end);return a=a.multiply(s/n),new yr(t.pc.translate(a),s)}}inverse(t){if(t instanceof Pn)return Rt.inversePoint(this.circle,t);if(t instanceof yr)return Rt.inverseCircle(this.circle,t);if(t instanceof An)return Rt.inverseLine(this.circle,t)}};o.Inversion=Rt;var za=r=>new o.Inversion(r);o.inversion=za;var x=class{static point2point(t,e){return t.distanceTo(e)}static point2line(t,e){let n=t.projectionOn(e);return[new o.Vector(t,n).length,new o.Segment(t,n)]}static point2circle(t,e){let[n,i]=t.distanceTo(e.center);if(o.Utils.EQ_0(n))return[e.r,new o.Segment(t,e.toArc().start)];{let s=Math.abs(n-e.r),a=new o.Vector(e.pc,t).normalize().multiply(e.r),l=e.pc.translate(a);return[s,new o.Segment(t,l)]}}static point2segment(t,e){if(e.start.equalTo(e.end))return x.point2point(t,e.start);let n=new o.Vector(e.start,e.end),i=new o.Vector(e.start,t),s=new o.Vector(e.end,t),a=n.dot(i),l=-n.dot(s),f,u;if(o.Utils.GE(a,0)&&o.Utils.GE(l,0)){let d=e.tangentInStart();return f=Math.abs(d.cross(i)),u=e.start.translate(d.multiply(d.dot(i))),[f,new o.Segment(t,u)]}else return a<0?t.distanceTo(e.start):t.distanceTo(e.end)}static point2arc(t,e){let n=new o.Circle(e.pc,e.r),i=[],s,a;return[s,a]=x.point2circle(t,n),a.end.on(e)&&i.push(x.point2circle(t,n)),i.push(x.point2point(t,e.start)),i.push(x.point2point(t,e.end)),x.sort(i),i[0]}static segment2line(t,e){let n=t.intersect(e);if(n.length>0)return[0,new o.Segment(n[0],n[0])];let i=[];return i.push(x.point2line(t.start,e)),i.push(x.point2line(t.end,e)),x.sort(i),i[0]}static segment2segment(t,e){let n=de(t,e);if(n.length>0)return[0,new o.Segment(n[0],n[0])];let i=[],s,a;return[s,a]=x.point2segment(e.start,t),i.push([s,a.reverse()]),[s,a]=x.point2segment(e.end,t),i.push([s,a.reverse()]),i.push(x.point2segment(t.start,e)),i.push(x.point2segment(t.end,e)),x.sort(i),i[0]}static segment2circle(t,e){let n=t.intersect(e);if(n.length>0)return[0,new o.Segment(n[0],n[0])];let i=new o.Line(t.ps,t.pe),[s,a]=x.point2line(e.center,i);if(o.Utils.GE(s,e.r)&&a.end.on(t))return x.point2circle(a.end,e);{let[l,f]=x.point2circle(t.start,e),[u,d]=x.point2circle(t.end,e);return o.Utils.LT(l,u)?[l,f]:[u,d]}}static segment2arc(t,e){let n=t.intersect(e);if(n.length>0)return[0,new o.Segment(n[0],n[0])];let i=new o.Line(t.ps,t.pe),s=new o.Circle(e.pc,e.r),[a,l]=x.point2line(s.center,i);if(o.Utils.GE(a,s.r)&&l.end.on(t)){let[c,h]=x.point2circle(l.end,s);if(h.end.on(e))return[c,h]}let f=[];f.push(x.point2arc(t.start,e)),f.push(x.point2arc(t.end,e));let u,d;return[u,d]=x.point2segment(e.start,t),f.push([u,d.reverse()]),[u,d]=x.point2segment(e.end,t),f.push([u,d.reverse()]),x.sort(f),f[0]}static circle2circle(t,e){let n=t.intersect(e);if(n.length>0)return[0,new o.Segment(n[0],n[0])];if(t.center.equalTo(e.center)){let i=t.toArc(),s=e.toArc();return x.point2point(i.start,s.start)}else{let i=new o.Line(t.center,e.center),s=i.intersect(t),a=i.intersect(e),l=[];return l.push(x.point2point(s[0],a[0])),l.push(x.point2point(s[0],a[1])),l.push(x.point2point(s[1],a[0])),l.push(x.point2point(s[1],a[1])),x.sort(l),l[0]}}static circle2line(t,e){let n=t.intersect(e);if(n.length>0)return[0,new o.Segment(n[0],n[0])];let[i,s]=x.point2line(t.center,e),[a,l]=x.point2circle(s.end,t);return l=l.reverse(),[a,l]}static arc2line(t,e){let n=e.intersect(t);if(n.length>0)return[0,new o.Segment(n[0],n[0])];let i=new o.Circle(t.center,t.r),[s,a]=x.point2line(i.center,e);if(o.Utils.GE(s,i.r)){let[l,f]=x.point2circle(a.end,i);if(f.end.on(t))return[l,f]}else{let l=[];return l.push(x.point2line(t.start,e)),l.push(x.point2line(t.end,e)),x.sort(l),l[0]}}static arc2circle(t,e){let n=t.intersect(e);if(n.length>0)return[0,new o.Segment(n[0],n[0])];let i=new o.Circle(t.center,t.r),[s,a]=x.circle2circle(i,e);if(a.start.on(t))return[s,a];{let l=[];return l.push(x.point2circle(t.start,e)),l.push(x.point2circle(t.end,e)),x.sort(l),l[0]}}static arc2arc(t,e){let n=t.intersect(e);if(n.length>0)return[0,new o.Segment(n[0],n[0])];let i=new o.Circle(t.center,t.r),s=new o.Circle(e.center,e.r),[a,l]=x.circle2circle(i,s);if(l.start.on(t)&&l.end.on(e))return[a,l];{let f=[],u,d;return[u,d]=x.point2arc(t.start,e),d.end.on(e)&&f.push([u,d]),[u,d]=x.point2arc(t.end,e),d.end.on(e)&&f.push([u,d]),[u,d]=x.point2arc(e.start,t),d.end.on(t)&&f.push([u,d.reverse()]),[u,d]=x.point2arc(e.end,t),d.end.on(t)&&f.push([u,d.reverse()]),[u,d]=x.point2point(t.start,e.start),f.push([u,d]),[u,d]=x.point2point(t.start,e.end),f.push([u,d]),[u,d]=x.point2point(t.end,e.start),f.push([u,d]),[u,d]=x.point2point(t.end,e.end),f.push([u,d]),x.sort(f),f[0]}}static point2polygon(t,e){let n=[Number.POSITIVE_INFINITY,new o.Segment];for(let i of e.edges){let[s,a]=i.shape instanceof o.Segment?x.point2segment(t,i.shape):x.point2arc(t,i.shape);o.Utils.LT(s,n[0])&&(n=[s,a])}return n}static shape2polygon(t,e){let n=[Number.POSITIVE_INFINITY,new o.Segment];for(let i of e.edges){let[s,a]=t.distanceTo(i.shape);o.Utils.LT(s,n[0])&&(n=[s,a])}return n}static polygon2polygon(t,e){let n=[Number.POSITIVE_INFINITY,new o.Segment];for(let i of t.edges)for(let s of e.edges){let[a,l]=i.shape.distanceTo(s.shape);o.Utils.LT(a,n[0])&&(n=[a,l])}return n}static box2box_minmax(t,e){let n=Math.max(Math.max(t.xmin-e.xmax,0),Math.max(e.xmin-t.xmax,0)),i=Math.max(Math.max(t.ymin-e.ymax,0),Math.max(e.ymin-t.ymax,0)),s=n*n+i*i,a=t.merge(e),l=a.xmax-a.xmin,f=a.ymax-a.ymin,u=l*l+f*f;return[s,u]}static minmax_tree_process_level(t,e,n,i){let s,a;for(let d of e)[s,a]=x.box2box_minmax(t.box,d.item.key),d.item.value instanceof o.Edge?i.insert([s,a],d.item.value.shape):i.insert([s,a],d.item.value),o.Utils.LT(a,n)&&(n=a);if(e.length===0)return n;let l=e.map(d=>d.left.isNil()?void 0:d.left).filter(d=>d!==void 0),f=e.map(d=>d.right.isNil()?void 0:d.right).filter(d=>d!==void 0),u=[...l,...f].filter(d=>{let[c,h]=x.box2box_minmax(t.box,d.max);return o.Utils.LE(c,n)});return n=x.minmax_tree_process_level(t,u,n,i),n}static minmax_tree(t,e,n){let i=new Bt,s=[e.index.root],a=n<Number.POSITIVE_INFINITY?n*n:Number.POSITIVE_INFINITY;return a=x.minmax_tree_process_level(t,s,a,i),i}static minmax_tree_calc_distance(t,e,n){let i,s;if(e!=null&&!e.isNil()){if([i,s]=x.minmax_tree_calc_distance(t,e.left,n),s)return[i,s];if(o.Utils.LT(i[0],Math.sqrt(e.item.key.low)))return[i,!0];let[a,l]=x.distance(t,e.item.value);return o.Utils.LT(a,i[0])&&(i=[a,l]),[i,s]=x.minmax_tree_calc_distance(t,e.right,i),[i,s]}return[n,!1]}static shape2planarSet(t,e,n=Number.POSITIVE_INFINITY){let i=[n,new o.Segment],s=!1;if(e instanceof o.PlanarSet){let a=x.minmax_tree(t,e,n);[i,s]=x.minmax_tree_calc_distance(t,a.root,i)}return i}static sort(t){t.sort((e,n)=>o.Utils.LT(e[0],n[0])?-1:o.Utils.GT(e[0],n[0])?1:0)}static distance(t,e){return t.distanceTo(e)}};o.Distance=x;o.BooleanOperations=fa;o.Relations=ka;var g=o;var V=class{};ft(V,"weaponBox",{spriteName:"weaponBox",frameCount:16}),ft(V,"rabbitBreath",{spriteName:"rabbitBreath",frameCount:60}),ft(V,"bubbles",{spriteName:"bubbles",frameCount:68}),ft(V,"rabbitGo",{spriteName:"rabbitGo",frameCount:24}),ft(V,"rabbitPrepareToJump",{spriteName:"rabbitPrepareToJump",frameCount:9}),ft(V,"rabbitJumpBack",{spriteName:"rabbitJumpBack",frameCount:30}),ft(V,"rabbitJump",{spriteName:"rabbitJump",frameCount:9});var ot=class{anim;startTime;constructor(t){this.anim=t,this.startTime=performance.now()}};var Ya=typeof global=="object"&&global&&global.Object===Object&&global,Ge=Ya;var Ha=typeof self=="object"&&self&&self.Object===Object&&self,Xa=Ge||Ha||Function("return this")(),R=Xa;var Qa=R.Symbol,G=Qa;var Kn=Object.prototype,Ja=Kn.hasOwnProperty,Ka=Kn.toString,ce=G?G.toStringTag:void 0;function Za(r){var t=Ja.call(r,ce),e=r[ce];try{r[ce]=void 0;var n=!0}catch{}var i=Ka.call(r);return n&&(t?r[ce]=e:delete r[ce]),i}var Zn=Za;var tl=Object.prototype,el=tl.toString;function rl(r){return el.call(r)}var ti=rl;var nl="[object Null]",il="[object Undefined]",ei=G?G.toStringTag:void 0;function ol(r){return r==null?r===void 0?il:nl:ei&&ei in Object(r)?Zn(r):ti(r)}var z=ol;function sl(r){return r!=null&&typeof r=="object"}var Y=sl;var al="[object Symbol]";function ll(r){return typeof r=="symbol"||Y(r)&&z(r)==al}var K=ll;function fl(r,t){for(var e=-1,n=r==null?0:r.length,i=Array(n);++e<n;)i[e]=t(r[e],e,r);return i}var De=fl;var ul=Array.isArray,L=ul;var dl=1/0,ri=G?G.prototype:void 0,ni=ri?ri.toString:void 0;function ii(r){if(typeof r=="string")return r;if(L(r))return De(r,ii)+"";if(K(r))return ni?ni.call(r):"";var t=r+"";return t=="0"&&1/r==-dl?"-0":t}var oi=ii;var cl=/\s/;function pl(r){for(var t=r.length;t--&&cl.test(r.charAt(t)););return t}var si=pl;var hl=/^\s+/;function ml(r){return r&&r.slice(0,si(r)+1).replace(hl,"")}var ai=ml;function gl(r){var t=typeof r;return r!=null&&(t=="object"||t=="function")}var D=gl;var li=0/0,_l=/^[-+]0x[0-9a-f]+$/i,xl=/^0b[01]+$/i,yl=/^0o[0-7]+$/i,bl=parseInt;function vl(r){if(typeof r=="number")return r;if(K(r))return li;if(D(r)){var t=typeof r.valueOf=="function"?r.valueOf():r;r=D(t)?t+"":t}if(typeof r!="string")return r===0?r:+r;r=ai(r);var e=xl.test(r);return e||yl.test(r)?bl(r.slice(2),e?2:8):_l.test(r)?li:+r}var st=vl;var fi=1/0,wl=17976931348623157e292;function El(r){if(!r)return r===0?r:0;if(r=st(r),r===fi||r===-fi){var t=r<0?-1:1;return t*wl}return r===r?r:0}var pe=El;function Tl(r){var t=pe(r),e=t%1;return t===t?e?t-e:t:0}var $e=Tl;function Il(r){return r}var ui=Il;var Sl="[object AsyncFunction]",Al="[object Function]",Pl="[object GeneratorFunction]",Cl="[object Proxy]";function Ol(r){if(!D(r))return!1;var t=z(r);return t==Al||t==Pl||t==Sl||t==Cl}var We=Ol;var Nl=R["__core-js_shared__"],qe=Nl;var di=function(){var r=/[^.]+$/.exec(qe&&qe.keys&&qe.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function Ll(r){return!!di&&di in r}var ci=Ll;var Rl=Function.prototype,kl=Rl.toString;function Ml(r){if(r!=null){try{return kl.call(r)}catch{}try{return r+""}catch{}}return""}var at=Ml;var Fl=/[\\^$.*+?()[\]{}|]/g,Bl=/^\[object .+?Constructor\]$/,Ul=Function.prototype,Vl=Object.prototype,Gl=Ul.toString,Dl=Vl.hasOwnProperty,$l=RegExp("^"+Gl.call(Dl).replace(Fl,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Wl(r){if(!D(r)||ci(r))return!1;var t=We(r)?$l:Bl;return t.test(at(r))}var pi=Wl;function ql(r,t){return r==null?void 0:r[t]}var hi=ql;function jl(r,t){var e=hi(r,t);return pi(e)?e:void 0}var j=jl;var zl=j(R,"WeakMap"),je=zl;function Yl(r,t,e,n){for(var i=r.length,s=e+(n?1:-1);n?s--:++s<i;)if(t(r[s],s,r))return s;return-1}var mi=Yl;var Hl=9007199254740991,Xl=/^(?:0|[1-9]\d*)$/;function Ql(r,t){var e=typeof r;return t=t??Hl,!!t&&(e=="number"||e!="symbol"&&Xl.test(r))&&r>-1&&r%1==0&&r<t}var Gt=Ql;function Jl(r,t){return r===t||r!==r&&t!==t}var Dt=Jl;var Kl=9007199254740991;function Zl(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=Kl}var $t=Zl;function tf(r){return r!=null&&$t(r.length)&&!We(r)}var Z=tf;function ef(r,t,e){if(!D(e))return!1;var n=typeof t;return(n=="number"?Z(e)&&Gt(t,e.length):n=="string"&&t in e)?Dt(e[t],r):!1}var ze=ef;var rf=Object.prototype;function nf(r){var t=r&&r.constructor,e=typeof t=="function"&&t.prototype||rf;return r===e}var gi=nf;function of(r,t){for(var e=-1,n=Array(r);++e<r;)n[e]=t(e);return n}var _i=of;var sf="[object Arguments]";function af(r){return Y(r)&&z(r)==sf}var Br=af;var xi=Object.prototype,lf=xi.hasOwnProperty,ff=xi.propertyIsEnumerable,uf=Br(function(){return arguments}())?Br:function(r){return Y(r)&&lf.call(r,"callee")&&!ff.call(r,"callee")},Wt=uf;function df(){return!1}var yi=df;var wi=typeof exports=="object"&&exports&&!exports.nodeType&&exports,bi=wi&&typeof module=="object"&&module&&!module.nodeType&&module,cf=bi&&bi.exports===wi,vi=cf?R.Buffer:void 0,pf=vi?vi.isBuffer:void 0,hf=pf||yi,he=hf;var mf="[object Arguments]",gf="[object Array]",_f="[object Boolean]",xf="[object Date]",yf="[object Error]",bf="[object Function]",vf="[object Map]",wf="[object Number]",Ef="[object Object]",Tf="[object RegExp]",If="[object Set]",Sf="[object String]",Af="[object WeakMap]",Pf="[object ArrayBuffer]",Cf="[object DataView]",Of="[object Float32Array]",Nf="[object Float64Array]",Lf="[object Int8Array]",Rf="[object Int16Array]",kf="[object Int32Array]",Mf="[object Uint8Array]",Ff="[object Uint8ClampedArray]",Bf="[object Uint16Array]",Uf="[object Uint32Array]",N={};N[Of]=N[Nf]=N[Lf]=N[Rf]=N[kf]=N[Mf]=N[Ff]=N[Bf]=N[Uf]=!0;N[mf]=N[gf]=N[Pf]=N[_f]=N[Cf]=N[xf]=N[yf]=N[bf]=N[vf]=N[wf]=N[Ef]=N[Tf]=N[If]=N[Sf]=N[Af]=!1;function Vf(r){return Y(r)&&$t(r.length)&&!!N[z(r)]}var Ei=Vf;function Gf(r){return function(t){return r(t)}}var Ti=Gf;var Ii=typeof exports=="object"&&exports&&!exports.nodeType&&exports,me=Ii&&typeof module=="object"&&module&&!module.nodeType&&module,Df=me&&me.exports===Ii,Ur=Df&&Ge.process,$f=function(){try{var r=me&&me.require&&me.require("util").types;return r||Ur&&Ur.binding&&Ur.binding("util")}catch{}}(),Vr=$f;var Si=Vr&&Vr.isTypedArray,Wf=Si?Ti(Si):Ei,Ye=Wf;var qf=Object.prototype,jf=qf.hasOwnProperty;function zf(r,t){var e=L(r),n=!e&&Wt(r),i=!e&&!n&&he(r),s=!e&&!n&&!i&&Ye(r),a=e||n||i||s,l=a?_i(r.length,String):[],f=l.length;for(var u in r)(t||jf.call(r,u))&&!(a&&(u=="length"||i&&(u=="offset"||u=="parent")||s&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||Gt(u,f)))&&l.push(u);return l}var Ai=zf;function Yf(r,t){return function(e){return r(t(e))}}var Pi=Yf;var Hf=Pi(Object.keys,Object),Ci=Hf;var Xf=Object.prototype,Qf=Xf.hasOwnProperty;function Jf(r){if(!gi(r))return Ci(r);var t=[];for(var e in Object(r))Qf.call(r,e)&&e!="constructor"&&t.push(e);return t}var Oi=Jf;function Kf(r){return Z(r)?Ai(r):Oi(r)}var dt=Kf;var Zf=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,tu=/^\w*$/;function eu(r,t){if(L(r))return!1;var e=typeof r;return e=="number"||e=="symbol"||e=="boolean"||r==null||K(r)?!0:tu.test(r)||!Zf.test(r)||t!=null&&r in Object(t)}var qt=eu;var ru=j(Object,"create"),lt=ru;function nu(){this.__data__=lt?lt(null):{},this.size=0}var Ni=nu;function iu(r){var t=this.has(r)&&delete this.__data__[r];return this.size-=t?1:0,t}var Li=iu;var ou="__lodash_hash_undefined__",su=Object.prototype,au=su.hasOwnProperty;function lu(r){var t=this.__data__;if(lt){var e=t[r];return e===ou?void 0:e}return au.call(t,r)?t[r]:void 0}var Ri=lu;var fu=Object.prototype,uu=fu.hasOwnProperty;function du(r){var t=this.__data__;return lt?t[r]!==void 0:uu.call(t,r)}var ki=du;var cu="__lodash_hash_undefined__";function pu(r,t){var e=this.__data__;return this.size+=this.has(r)?0:1,e[r]=lt&&t===void 0?cu:t,this}var Mi=pu;function jt(r){var t=-1,e=r==null?0:r.length;for(this.clear();++t<e;){var n=r[t];this.set(n[0],n[1])}}jt.prototype.clear=Ni;jt.prototype.delete=Li;jt.prototype.get=Ri;jt.prototype.has=ki;jt.prototype.set=Mi;var Gr=jt;function hu(){this.__data__=[],this.size=0}var Fi=hu;function mu(r,t){for(var e=r.length;e--;)if(Dt(r[e][0],t))return e;return-1}var ct=mu;var gu=Array.prototype,_u=gu.splice;function xu(r){var t=this.__data__,e=ct(t,r);if(e<0)return!1;var n=t.length-1;return e==n?t.pop():_u.call(t,e,1),--this.size,!0}var Bi=xu;function yu(r){var t=this.__data__,e=ct(t,r);return e<0?void 0:t[e][1]}var Ui=yu;function bu(r){return ct(this.__data__,r)>-1}var Vi=bu;function vu(r,t){var e=this.__data__,n=ct(e,r);return n<0?(++this.size,e.push([r,t])):e[n][1]=t,this}var Gi=vu;function zt(r){var t=-1,e=r==null?0:r.length;for(this.clear();++t<e;){var n=r[t];this.set(n[0],n[1])}}zt.prototype.clear=Fi;zt.prototype.delete=Bi;zt.prototype.get=Ui;zt.prototype.has=Vi;zt.prototype.set=Gi;var pt=zt;var wu=j(R,"Map"),ht=wu;function Eu(){this.size=0,this.__data__={hash:new Gr,map:new(ht||pt),string:new Gr}}var Di=Eu;function Tu(r){var t=typeof r;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?r!=="__proto__":r===null}var $i=Tu;function Iu(r,t){var e=r.__data__;return $i(t)?e[typeof t=="string"?"string":"hash"]:e.map}var mt=Iu;function Su(r){var t=mt(this,r).delete(r);return this.size-=t?1:0,t}var Wi=Su;function Au(r){return mt(this,r).get(r)}var qi=Au;function Pu(r){return mt(this,r).has(r)}var ji=Pu;function Cu(r,t){var e=mt(this,r),n=e.size;return e.set(r,t),this.size+=e.size==n?0:1,this}var zi=Cu;function Yt(r){var t=-1,e=r==null?0:r.length;for(this.clear();++t<e;){var n=r[t];this.set(n[0],n[1])}}Yt.prototype.clear=Di;Yt.prototype.delete=Wi;Yt.prototype.get=qi;Yt.prototype.has=ji;Yt.prototype.set=zi;var It=Yt;var Ou="Expected a function";function Dr(r,t){if(typeof r!="function"||t!=null&&typeof t!="function")throw new TypeError(Ou);var e=function(){var n=arguments,i=t?t.apply(this,n):n[0],s=e.cache;if(s.has(i))return s.get(i);var a=r.apply(this,n);return e.cache=s.set(i,a)||s,a};return e.cache=new(Dr.Cache||It),e}Dr.Cache=It;var ge=Dr;var Nu=500;function Lu(r){var t=ge(r,function(n){return e.size===Nu&&e.clear(),n}),e=t.cache;return t}var Yi=Lu;var Ru=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ku=/\\(\\)?/g,Mu=Yi(function(r){var t=[];return r.charCodeAt(0)===46&&t.push(""),r.replace(Ru,function(e,n,i,s){t.push(i?s.replace(ku,"$1"):n||e)}),t}),Hi=Mu;function Fu(r){return r==null?"":oi(r)}var Xi=Fu;function Bu(r,t){return L(r)?r:qt(r,t)?[r]:Hi(Xi(r))}var He=Bu;var Uu=1/0;function Vu(r){if(typeof r=="string"||K(r))return r;var t=r+"";return t=="0"&&1/r==-Uu?"-0":t}var gt=Vu;function Gu(r,t){t=He(t,r);for(var e=0,n=t.length;r!=null&&e<n;)r=r[gt(t[e++])];return e&&e==n?r:void 0}var Xe=Gu;function Du(r,t,e){var n=r==null?void 0:Xe(r,t);return n===void 0?e:n}var Qi=Du;function $u(r,t){for(var e=-1,n=t.length,i=r.length;++e<n;)r[i+e]=t[e];return r}var Qe=$u;var Ji=G?G.isConcatSpreadable:void 0;function Wu(r){return L(r)||Wt(r)||!!(Ji&&r&&r[Ji])}var Ki=Wu;function Zi(r,t,e,n,i){var s=-1,a=r.length;for(e||(e=Ki),i||(i=[]);++s<a;){var l=r[s];t>0&&e(l)?t>1?Zi(l,t-1,e,n,i):Qe(i,l):n||(i[i.length]=l)}return i}var to=Zi;var qu="Expected a function";function ju(r,t){var e;if(typeof t!="function")throw new TypeError(qu);return r=$e(r),function(){return--r>0&&(e=t.apply(this,arguments)),r<=1&&(t=void 0),e}}var eo=ju;function zu(r,t,e){return r===r&&(e!==void 0&&(r=r<=e?r:e),t!==void 0&&(r=r>=t?r:t)),r}var ro=zu;function Yu(r,t,e){return e===void 0&&(e=t,t=void 0),e!==void 0&&(e=st(e),e=e===e?e:0),t!==void 0&&(t=st(t),t=t===t?t:0),ro(st(r),t,e)}var $r=Yu;function Hu(){this.__data__=new pt,this.size=0}var no=Hu;function Xu(r){var t=this.__data__,e=t.delete(r);return this.size=t.size,e}var io=Xu;function Qu(r){return this.__data__.get(r)}var oo=Qu;function Ju(r){return this.__data__.has(r)}var so=Ju;var Ku=200;function Zu(r,t){var e=this.__data__;if(e instanceof pt){var n=e.__data__;if(!ht||n.length<Ku-1)return n.push([r,t]),this.size=++e.size,this;e=this.__data__=new It(n)}return e.set(r,t),this.size=e.size,this}var ao=Zu;function Ht(r){var t=this.__data__=new pt(r);this.size=t.size}Ht.prototype.clear=no;Ht.prototype.delete=io;Ht.prototype.get=oo;Ht.prototype.has=so;Ht.prototype.set=ao;var Xt=Ht;function td(r,t){for(var e=-1,n=r==null?0:r.length,i=0,s=[];++e<n;){var a=r[e];t(a,e,r)&&(s[i++]=a)}return s}var lo=td;function ed(){return[]}var fo=ed;var rd=Object.prototype,nd=rd.propertyIsEnumerable,uo=Object.getOwnPropertySymbols,id=uo?function(r){return r==null?[]:(r=Object(r),lo(uo(r),function(t){return nd.call(r,t)}))}:fo,co=id;function od(r,t,e){var n=t(r);return L(r)?n:Qe(n,e(r))}var po=od;function sd(r){return po(r,dt,co)}var Wr=sd;var ad=j(R,"DataView"),Je=ad;var ld=j(R,"Promise"),Ke=ld;var fd=j(R,"Set"),Ze=fd;var ho="[object Map]",ud="[object Object]",mo="[object Promise]",go="[object Set]",_o="[object WeakMap]",xo="[object DataView]",dd=at(Je),cd=at(ht),pd=at(Ke),hd=at(Ze),md=at(je),St=z;(Je&&St(new Je(new ArrayBuffer(1)))!=xo||ht&&St(new ht)!=ho||Ke&&St(Ke.resolve())!=mo||Ze&&St(new Ze)!=go||je&&St(new je)!=_o)&&(St=function(r){var t=z(r),e=t==ud?r.constructor:void 0,n=e?at(e):"";if(n)switch(n){case dd:return xo;case cd:return ho;case pd:return mo;case hd:return go;case md:return _o}return t});var qr=St;var gd=R.Uint8Array,jr=gd;var _d="__lodash_hash_undefined__";function xd(r){return this.__data__.set(r,_d),this}var yo=xd;function yd(r){return this.__data__.has(r)}var bo=yd;function tr(r){var t=-1,e=r==null?0:r.length;for(this.__data__=new It;++t<e;)this.add(r[t])}tr.prototype.add=tr.prototype.push=yo;tr.prototype.has=bo;var vo=tr;function bd(r,t){for(var e=-1,n=r==null?0:r.length;++e<n;)if(t(r[e],e,r))return!0;return!1}var er=bd;function vd(r,t){return r.has(t)}var wo=vd;var wd=1,Ed=2;function Td(r,t,e,n,i,s){var a=e&wd,l=r.length,f=t.length;if(l!=f&&!(a&&f>l))return!1;var u=s.get(r),d=s.get(t);if(u&&d)return u==t&&d==r;var c=-1,h=!0,v=e&Ed?new vo:void 0;for(s.set(r,t),s.set(t,r);++c<l;){var y=r[c],b=t[c];if(n)var w=a?n(b,y,c,t,r,s):n(y,b,c,r,t,s);if(w!==void 0){if(w)continue;h=!1;break}if(v){if(!er(t,function(_,E){if(!wo(v,E)&&(y===_||i(y,_,e,n,s)))return v.push(E)})){h=!1;break}}else if(!(y===b||i(y,b,e,n,s))){h=!1;break}}return s.delete(r),s.delete(t),h}var rr=Td;function Id(r){var t=-1,e=Array(r.size);return r.forEach(function(n,i){e[++t]=[i,n]}),e}var Eo=Id;function Sd(r){var t=-1,e=Array(r.size);return r.forEach(function(n){e[++t]=n}),e}var To=Sd;var Ad=1,Pd=2,Cd="[object Boolean]",Od="[object Date]",Nd="[object Error]",Ld="[object Map]",Rd="[object Number]",kd="[object RegExp]",Md="[object Set]",Fd="[object String]",Bd="[object Symbol]",Ud="[object ArrayBuffer]",Vd="[object DataView]",Io=G?G.prototype:void 0,zr=Io?Io.valueOf:void 0;function Gd(r,t,e,n,i,s,a){switch(e){case Vd:if(r.byteLength!=t.byteLength||r.byteOffset!=t.byteOffset)return!1;r=r.buffer,t=t.buffer;case Ud:return!(r.byteLength!=t.byteLength||!s(new jr(r),new jr(t)));case Cd:case Od:case Rd:return Dt(+r,+t);case Nd:return r.name==t.name&&r.message==t.message;case kd:case Fd:return r==t+"";case Ld:var l=Eo;case Md:var f=n&Ad;if(l||(l=To),r.size!=t.size&&!f)return!1;var u=a.get(r);if(u)return u==t;n|=Pd,a.set(r,t);var d=rr(l(r),l(t),n,i,s,a);return a.delete(r),d;case Bd:if(zr)return zr.call(r)==zr.call(t)}return!1}var So=Gd;var Dd=1,$d=Object.prototype,Wd=$d.hasOwnProperty;function qd(r,t,e,n,i,s){var a=e&Dd,l=Wr(r),f=l.length,u=Wr(t),d=u.length;if(f!=d&&!a)return!1;for(var c=f;c--;){var h=l[c];if(!(a?h in t:Wd.call(t,h)))return!1}var v=s.get(r),y=s.get(t);if(v&&y)return v==t&&y==r;var b=!0;s.set(r,t),s.set(t,r);for(var w=a;++c<f;){h=l[c];var _=r[h],E=t[h];if(n)var m=a?n(E,_,h,t,r,s):n(_,E,h,r,t,s);if(!(m===void 0?_===E||i(_,E,e,n,s):m)){b=!1;break}w||(w=h=="constructor")}if(b&&!w){var I=r.constructor,k=t.constructor;I!=k&&"constructor"in r&&"constructor"in t&&!(typeof I=="function"&&I instanceof I&&typeof k=="function"&&k instanceof k)&&(b=!1)}return s.delete(r),s.delete(t),b}var Ao=qd;var jd=1,Po="[object Arguments]",Co="[object Array]",nr="[object Object]",zd=Object.prototype,Oo=zd.hasOwnProperty;function Yd(r,t,e,n,i,s){var a=L(r),l=L(t),f=a?Co:qr(r),u=l?Co:qr(t);f=f==Po?nr:f,u=u==Po?nr:u;var d=f==nr,c=u==nr,h=f==u;if(h&&he(r)){if(!he(t))return!1;a=!0,d=!1}if(h&&!d)return s||(s=new Xt),a||Ye(r)?rr(r,t,e,n,i,s):So(r,t,f,e,n,i,s);if(!(e&jd)){var v=d&&Oo.call(r,"__wrapped__"),y=c&&Oo.call(t,"__wrapped__");if(v||y){var b=v?r.value():r,w=y?t.value():t;return s||(s=new Xt),i(b,w,e,n,s)}}return h?(s||(s=new Xt),Ao(r,t,e,n,i,s)):!1}var No=Yd;function Lo(r,t,e,n,i){return r===t?!0:r==null||t==null||!Y(r)&&!Y(t)?r!==r&&t!==t:No(r,t,e,n,Lo,i)}var ir=Lo;var Hd=1,Xd=2;function Qd(r,t,e,n){var i=e.length,s=i,a=!n;if(r==null)return!s;for(r=Object(r);i--;){var l=e[i];if(a&&l[2]?l[1]!==r[l[0]]:!(l[0]in r))return!1}for(;++i<s;){l=e[i];var f=l[0],u=r[f],d=l[1];if(a&&l[2]){if(u===void 0&&!(f in r))return!1}else{var c=new Xt;if(n)var h=n(u,d,f,r,t,c);if(!(h===void 0?ir(d,u,Hd|Xd,n,c):h))return!1}}return!0}var Ro=Qd;function Jd(r){return r===r&&!D(r)}var or=Jd;function Kd(r){for(var t=dt(r),e=t.length;e--;){var n=t[e],i=r[n];t[e]=[n,i,or(i)]}return t}var ko=Kd;function Zd(r,t){return function(e){return e==null?!1:e[r]===t&&(t!==void 0||r in Object(e))}}var sr=Zd;function tc(r){var t=ko(r);return t.length==1&&t[0][2]?sr(t[0][0],t[0][1]):function(e){return e===r||Ro(e,r,t)}}var Mo=tc;function ec(r,t){return r!=null&&t in Object(r)}var Fo=ec;function rc(r,t,e){t=He(t,r);for(var n=-1,i=t.length,s=!1;++n<i;){var a=gt(t[n]);if(!(s=r!=null&&e(r,a)))break;r=r[a]}return s||++n!=i?s:(i=r==null?0:r.length,!!i&&$t(i)&&Gt(a,i)&&(L(r)||Wt(r)))}var Bo=rc;function nc(r,t){return r!=null&&Bo(r,t,Fo)}var Uo=nc;var ic=1,oc=2;function sc(r,t){return qt(r)&&or(t)?sr(gt(r),t):function(e){var n=Qi(e,r);return n===void 0&&n===t?Uo(e,r):ir(t,n,ic|oc)}}var Vo=sc;function ac(r){return function(t){return t==null?void 0:t[r]}}var Go=ac;function lc(r){return function(t){return Xe(t,r)}}var Do=lc;function fc(r){return qt(r)?Go(gt(r)):Do(r)}var $o=fc;function uc(r){return typeof r=="function"?r:r==null?ui:typeof r=="object"?L(r)?Vo(r[0],r[1]):Mo(r):$o(r)}var tt=uc;function dc(r){return function(t,e,n){for(var i=-1,s=Object(t),a=n(t),l=a.length;l--;){var f=a[r?l:++i];if(e(s[f],f,s)===!1)break}return t}}var Wo=dc;var cc=Wo(),qo=cc;function pc(r,t){return r&&qo(r,t,dt)}var jo=pc;function hc(r,t){return function(e,n){if(e==null)return e;if(!Z(e))return r(e,n);for(var i=e.length,s=t?i:-1,a=Object(e);(t?s--:++s<i)&&n(a[s],s,a)!==!1;);return e}}var zo=hc;var mc=zo(jo),ar=mc;var gc=function(){return R.Date.now()},lr=gc;var _c="Expected a function",xc=Math.max,yc=Math.min;function bc(r,t,e){var n,i,s,a,l,f,u=0,d=!1,c=!1,h=!0;if(typeof r!="function")throw new TypeError(_c);t=st(t)||0,D(e)&&(d=!!e.leading,c="maxWait"in e,s=c?xc(st(e.maxWait)||0,t):s,h="trailing"in e?!!e.trailing:h);function v(T){var P=n,C=i;return n=i=void 0,u=T,a=r.apply(C,P),a}function y(T){return u=T,l=setTimeout(_,t),d?v(T):a}function b(T){var P=T-f,C=T-u,A=t-P;return c?yc(A,s-C):A}function w(T){var P=T-f,C=T-u;return f===void 0||P>=t||P<0||c&&C>=s}function _(){var T=lr();if(w(T))return E(T);l=setTimeout(_,b(T))}function E(T){return l=void 0,h&&n?v(T):(n=i=void 0,a)}function m(){l!==void 0&&clearTimeout(l),u=0,n=f=i=l=void 0}function I(){return l===void 0?a:E(lr())}function k(){var T=lr(),P=w(T);if(n=arguments,i=this,f=T,P){if(l===void 0)return y(f);if(c)return clearTimeout(l),l=setTimeout(_,t),v(f)}return l===void 0&&(l=setTimeout(_,t)),a}return k.cancel=m,k.flush=I,k}var Yo=bc;function vc(r){return function(t,e,n){var i=Object(t);if(!Z(t)){var s=tt(e,3);t=dt(t),e=function(l){return s(i[l],l,i)}}var a=r(t,e,n);return a>-1?i[s?t[a]:a]:void 0}}var Ho=vc;var wc=Math.max;function Ec(r,t,e){var n=r==null?0:r.length;if(!n)return-1;var i=e==null?0:$e(e);return i<0&&(i=wc(n+i,0)),mi(r,tt(t,3),i)}var Xo=Ec;var Tc=Ho(Xo),Qt=Tc;function Ic(r,t){var e=-1,n=Z(r)?Array(r.length):[];return ar(r,function(i,s,a){n[++e]=t(i,s,a)}),n}var Qo=Ic;function Sc(r,t){var e=L(r)?De:Qo;return e(r,tt(t,3))}var Jo=Sc;function Ac(r,t){return to(Jo(r,t),1)}var Yr=Ac;function Pc(r,t){return r<t}var Ko=Pc;function Cc(r,t,e){for(var n=-1,i=r.length;++n<i;){var s=r[n],a=t(s);if(a!=null&&(l===void 0?a===a&&!K(a):e(a,l)))var l=a,f=s}return f}var Zo=Cc;function Oc(r,t){return r&&r.length?Zo(r,tt(t,2),Ko):void 0}var Hr=Oc;function Nc(r){return eo(2,r)}var Xr=Nc;var Lc=Math.floor,Rc=Math.random;function kc(r,t){return r+Lc(Rc()*(t-r+1))}var ts=kc;var Mc=parseFloat,Fc=Math.min,Bc=Math.random;function Uc(r,t,e){if(e&&typeof e!="boolean"&&ze(r,t,e)&&(t=e=void 0),e===void 0&&(typeof t=="boolean"?(e=t,t=void 0):typeof r=="boolean"&&(e=r,r=void 0)),r===void 0&&t===void 0?(r=0,t=1):(r=pe(r),t===void 0?(t=r,r=0):t=pe(t)),r>t){var n=r;r=t,t=n}if(e||r%1||t%1){var i=Bc();return Fc(r+i*(t-r+Mc("1e-"+((i+"").length-1))),t)}return ts(r,t)}var _e=Uc;function Vc(r,t){var e;return ar(r,function(n,i,s){return e=t(n,i,s),!e}),!!e}var es=Vc;function Gc(r,t,e){var n=L(r)?er:es;return e&&ze(r,t,e)&&(t=void 0),n(r,tt(t,3))}var Qr=Gc;var Dc="Expected a function";function $c(r,t,e){var n=!0,i=!0;if(typeof r!="function")throw new TypeError(Dc);return D(e)&&(n="leading"in e?!!e.leading:n,i="trailing"in e?!!e.trailing:i),Yo(r,t,{leading:n,maxWait:t,trailing:i})}var Jr=$c;var _t={};xn(_t,{BOUNDARY:()=>et,CCW:()=>Wc,CONTAINS:()=>Xc,CW:()=>qc,END_VERTEX:()=>At,INSIDE:()=>Yc,INTERLACE:()=>Qc,NOT_VERTEX:()=>fr,ORIENTATION:()=>jc,OUTSIDE:()=>Hc,OVERLAP_OPPOSITE:()=>Kc,OVERLAP_SAME:()=>Jc,PIx2:()=>zc,START_VERTEX:()=>xe});var Wc=!0,qc=!1,jc={CCW:-1,CW:1,NOT_ORIENTABLE:0},zc=2*Math.PI,Yc=1,Hc=0,et=2,Xc=3,Qc=4,Jc=1,Kc=2,fr=0,xe=1,At=2;var ur={};xn(ur,{DECIMALS:()=>Zc,EQ:()=>Jt,EQ_0:()=>tp,GE:()=>rp,GT:()=>ep,LE:()=>ip,LT:()=>np,getTolerance:()=>Zr,setTolerance:()=>Kr});var rt=1e-6;function Kr(r){rt=r}function Zr(){return rt}var Zc=3;function tp(r){return r<rt&&r>-rt}function Jt(r,t){return r-t<rt&&r-t>-rt}function ep(r,t){return r-t>rt}function rp(r,t){return r-t>-rt}function np(r,t){return r-t<-rt}function ip(r,t){return r-t<rt}var rs=class{static get ILLEGAL_PARAMETERS(){return new ReferenceError("Illegal Parameters")}static get ZERO_DIVISION(){return new Error("Zero division")}static get UNRESOLVED_BOUNDARY_CONFLICT(){return new Error("Unresolved boundary conflict in boolean operation")}static get INFINITE_LOOP(){return new Error("Infinite loop")}},ye=rs;var tn={Utils:ur,Errors:ye,Matrix:void 0,Planar_set:void 0,Point:void 0,Vector:void 0,Line:void 0,Circle:void 0,Segment:void 0,Arc:void 0,Box:void 0,Edge:void 0,Face:void 0,Ray:void 0,Ray_shooting:void 0,Multiline:void 0,Polygon:void 0,Distance:void 0,Inversion:void 0};for(let r in _t)tn[r]=_t[r];Object.defineProperty(tn,"DP_TOL",{get:function(){return Zr()},set:function(r){Kr(r)}});var dr=tn;var ns=class{constructor(t,e){this.first=t,this.last=e||this.first}[Symbol.iterator](){let t;return{next:()=>(t=t?t.next:this.first,{value:t,done:t===void 0})}}get size(){let t=0;for(let e of this)t++;return t}toArray(t=void 0,e=void 0){let n=[],i=t||this.first,s=e||this.last,a=i;if(a===void 0)return n;do n.push(a),a=a.next;while(a!==s.next);return n}append(t){return this.isEmpty()?this.first=t:(t.prev=this.last,this.last.next=t),this.last=t,this.last.next=void 0,this.first.prev=void 0,this}insert(t,e){if(this.isEmpty())this.first=t,this.last=t;else if(e==null)t.next=this.first,this.first.prev=t,this.first=t;else{let n=e.next;e.next=t,n&&(n.prev=t),t.prev=e,t.next=n,this.last===e&&(this.last=t)}return this.last.next=void 0,this.first.prev=void 0,this}remove(t){return t===this.first&&t===this.last?(this.first=void 0,this.last=void 0):(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t===this.first&&(this.first=t.next),t===this.last&&(this.last=t.prev)),this}isEmpty(){return this.first===void 0}static testInfiniteLoop(t){let e=t,n=t;do{if(e!=t&&e===n)throw dr.Errors.INFINITE_LOOP;e=e.next,n=n.next.next}while(e!=t)}},is=ns;function be(r,t,e){let n=e.length,i=r.shape.split(t);if(i.length===0)return;let s=0;i[0]===null?s=0:i[1]===null?s=r.shape.length:s=i[0].length;let a=fr;Jt(s,0)&&(a|=xe),Jt(s,r.shape.length)&&(a|=At);let l=a&At&&r.next.arc_length===0?0:r.arc_length+s;e.push({id:n,pt:t,arc_length:l,edge_before:r,edge_after:void 0,face:r.face,is_vertex:a})}function cr(r){r.int_points1_sorted=os(r.int_points1),r.int_points2_sorted=os(r.int_points2)}function os(r){let t=new Map,e=0;for(let i of r)t.has(i.face)||(t.set(i.face,e),e++);for(let i of r)i.faceId=t.get(i.face);return r.slice().sort(op)}function op(r,t){return r.faceId<t.faceId?-1:r.faceId>t.faceId?1:r.arc_length<t.arc_length?-1:r.arc_length>t.arc_length?1:0}function ss(r){if(r.int_points1.length<2)return;let t=!1,e,n,i,s;for(let a=0;a<r.int_points1_sorted.length;a++)if(r.int_points1_sorted[a].id!==-1){e=r.int_points1_sorted[a],n=r.int_points2[e.id];for(let l=a+1;l<r.int_points1_sorted.length&&(i=r.int_points1_sorted[l],!!Jt(i.arc_length,e.arc_length));l++)i.id!==-1&&(s=r.int_points2[i.id],s.id!==-1&&i.edge_before===e.edge_before&&i.edge_after===e.edge_after&&s.edge_before===n.edge_before&&s.edge_after===n.edge_after&&(i.id=-1,s.id=-1,t=!0))}n=r.int_points2_sorted[0],e=r.int_points1[n.id];for(let a=1;a<r.int_points2_sorted.length;a++){let l=r.int_points2_sorted[a];if(l.id==-1)continue;if(n.id==-1||!Jt(l.arc_length,n.arc_length)){n=l,e=r.int_points1[n.id];continue}let f=r.int_points1[l.id];f.edge_before===e.edge_before&&f.edge_after===e.edge_after&&l.edge_before===n.edge_before&&l.edge_after===n.edge_after&&(f.id=-1,l.id=-1,t=!0)}t&&(r.int_points1=r.int_points1.filter(a=>a.id>=0),r.int_points2=r.int_points2.filter(a=>a.id>=0),r.int_points1.forEach((a,l)=>a.id=l),r.int_points2.forEach((a,l)=>a.id=l))}function en(r){for(let t of r)t.edge_before.bvStart=void 0,t.edge_before.bvEnd=void 0,t.edge_before.bv=void 0,t.edge_before.overlap=void 0,t.edge_after.bvStart=void 0,t.edge_after.bvEnd=void 0,t.edge_after.bv=void 0,t.edge_after.overlap=void 0;for(let t of r)t.edge_before.bvEnd=et,t.edge_after.bvStart=et}function rn(r,t){for(let e of r)e.edge_before.setInclusion(t),e.edge_after.setInclusion(t)}function as(r){let t,e,n,i=r.int_points1.length;for(let s=0;s<i;s++){let a=r.int_points1_sorted[s];a.face!==t&&(e=s,t=a.face);let l=s,f=Pt(r.int_points1_sorted,s,t),u;l+f<i&&r.int_points1_sorted[l+f].face===t?u=l+f:u=e;let d=Pt(r.int_points1_sorted,u,t);n=null;for(let _=u;_<u+d;_++){let E=r.int_points1_sorted[_];if(E.face===t&&r.int_points2[E.id].face===r.int_points2[a.id].face){n=E;break}}if(n===null)continue;let c=a.edge_after,h=n.edge_before;if(!(c.bv===et&&h.bv===et)||c!==h)continue;let v=r.int_points2[a.id],y=r.int_points2[n.id],b=v.edge_after,w=y.edge_before;b.bv===et&&w.bv===et&&b===w||(v=r.int_points2[n.id],y=r.int_points2[a.id],b=v.edge_after,w=y.edge_before),b.bv===et&&w.bv===et&&b===w&&c.setOverlap(b)}}function Pt(r,t,e){let n,i,s=1;if(r.length==1)return 1;n=r[t];for(let a=t+1;a<r.length&&!(n.face!=e||(i=r[a],!(i.pt.equalTo(n.pt)&&i.edge_before===n.edge_before&&i.edge_after===n.edge_after)));a++)s++;return s}function nn(r,t){if(!!t){for(let e of t){let n=e.edge_before;if(e.is_vertex=fr,n.shape.start&&n.shape.start.equalTo(e.pt)&&(e.is_vertex|=xe),n.shape.end&&n.shape.end.equalTo(e.pt)&&(e.is_vertex|=At),e.is_vertex&xe){e.edge_before=n.prev,e.is_vertex=At;continue}if(e.is_vertex&At)continue;let i=r.addVertex(e.pt,n);e.edge_before=i}for(let e of t)e.edge_after=e.edge_before.next}}var{INSIDE:nt,OUTSIDE:it,BOUNDARY:F,OVERLAP_SAME:sp,OVERLAP_OPPOSITE:ap}=_t,{NOT_VERTEX:iv,START_VERTEX:ls,END_VERTEX:fs}=_t,on=1,gs=2,ve=3;function _s(r,t){let[e,n]=ys(r,t,on,!0);return e}function xs(r,t){let n=t.clone().reverse(),[i,s]=ys(r,n,ve,!0);return i}function lp(r,t,e,n){let i=us(r,e.int_points1),s=us(t,e.int_points2);for(ds(i,t),ds(s,r),en(e.int_points1),en(e.int_points2),rn(e.int_points1,t),rn(e.int_points2,r);dp(r,t,e.int_points1,e.int_points1_sorted,e.int_points2,e););as(e),cs(r,n,e.int_points1_sorted,!0),cs(t,n,e.int_points2_sorted,!1),ms(r,i,n,!0),ms(t,s,n,!1)}function fp(r,t,e,n){cp(r,t,n,e.int_points2),pp(r,t,e),ps(r,e.int_points1),ps(t,e.int_points2),hs(r,e.int_points1,e.int_points2),hs(r,e.int_points2,e.int_points1)}function ys(r,t,e,n){let i=r,s=t.clone(),a=up(i,s);return cr(a),nn(i,a.int_points1_sorted),nn(s,a.int_points2_sorted),ss(a),cr(a),lp(i,s,a,e),n&&fp(i,s,a,e),[i,s]}function up(r,t){let e={int_points1:[],int_points2:[]};for(let n of t.edges){let i=r.edges.search(n.box);for(let s of i){let a=n.shape.intersect(s.shape);for(let l of a)be(n,l,e.int_points2),be(s,l,e.int_points1)}}return e}function us(r,t){let e=[];for(let n of r.faces)t.find(i=>i.face===n)||e.push(n);return e}function ds(r,t){for(let e of r)e.first.bv=e.first.bvStart=e.first.bvEnd=void 0,e.first.setInclusion(t)}function dp(r,t,e,n,i,s){let a,l,f,u=n.length,d=!1;for(let c=0;c<u;c++){let h=n[c];h.face!==a&&(l=c,a=h.face);let v=c,y=Pt(n,c,a),b;v+y<u&&n[v+y].face===a?b=v+y:b=l;let w=Pt(n,b,a);f=null;for(let m=b;m<b+w;m++){let I=n[m];if(I.face===a&&i[I.id].face===i[h.id].face){f=I;break}}if(f===null)continue;let _=h.edge_after,E=f.edge_before;if(_.bv===F&&E.bv!=F){_.bv=E.bv;continue}if(_.bv!=F&&E.bv===F){E.bv=_.bv;continue}if(_.bv===F&&E.bv===F&&_!=E||_.bv===nt&&E.bv===it||_.bv===it&&E.bv===nt){let m=_.next;for(;m!=E;)m.bvStart=void 0,m.bvEnd=void 0,m.bv=void 0,m.setInclusion(t),m=m.next}if(_.bv===F&&E.bv===F&&_!=E){let m=_.next,I;for(;m!=E;){if(m.bv!=F){if(I===void 0)I=m.bv;else if(m.bv!=I)throw ye.UNRESOLVED_BOUNDARY_CONFLICT}m=m.next}I!=null&&(_.bv=I,E.bv=I);continue}if(_.bv===nt&&E.bv===it||_.bv===it&&E.bv===nt){let m=_;for(;m!=E;){if(m.bvStart===_.bv&&m.bvEnd===E.bv){let[I,k]=m.shape.distanceTo(t);if(I<10*dr.DP_TOL){be(m,k.ps,e);let T=e[e.length-1];if(T.is_vertex&ls)T.edge_after=m,T.edge_before=m.prev,m.bvStart=F,m.bv=void 0,m.setInclusion(t);else if(T.is_vertex&fs)T.edge_after=m.next,m.bvEnd=F,m.bv=void 0,m.setInclusion(t);else{let A=t.addVertex(T.pt,m);T.edge_before=A,T.edge_after=A.next,A.setInclusion(t),A.next.bvStart=F,A.next.bvEnd=void 0,A.next.bv=void 0,A.next.setInclusion(t)}let P=t.findEdgeByPoint(k.pe);be(P,k.pe,i);let C=i[i.length-1];if(C.is_vertex&ls)C.edge_after=P,C.edge_before=P.prev;else if(C.is_vertex&fs)C.edge_after=P.next;else{let A=i.find(re=>re.edge_after===P),O=t.addVertex(C.pt,P);C.edge_before=O,C.edge_after=O.next,A&&(A.edge_after=O),O.bvStart=void 0,O.bvEnd=F,O.bv=void 0,O.setInclusion(r),O.next.bvStart=F,O.next.bvEnd=void 0,O.next.bv=void 0,O.next.setInclusion(r)}cr(s),d=!0;break}}m=m.next}if(d)break;throw ye.UNRESOLVED_BOUNDARY_CONFLICT}}return d}function cs(r,t,e,n){if(!e)return;let i,s,a,l;for(let f=0;f<e.length;f++){if(a=e[f],a.face!==i&&(s=f,i=a.face),i.isEmpty())continue;let u=f,d=Pt(e,f,i),c;u+d<e.length&&e[u+d].face===a.face?c=u+d:c=s,l=e[c];let h=c,v=Pt(e,h,i),y=a.edge_after,b=l.edge_before;if(y.bv===nt&&b.bv===nt&&t===on||y.bv===it&&b.bv===it&&t===gs||(y.bv===it||b.bv===it)&&t===ve&&!n||(y.bv===nt||b.bv===nt)&&t===ve&&n||y.bv===F&&b.bv===F&&y.overlap&sp&&n||y.bv===F&&b.bv===F&&y.overlap&ap){r.removeChain(i,y,b);for(let w=u;w<u+d;w++)e[w].edge_after=void 0;for(let w=h;w<h+v;w++)e[w].edge_before=void 0}f+=d-1}}function cp(r,t,e,n){for(let i of t.faces){for(let s of i)r.edges.add(s);n.find(s=>s.face===i)===void 0&&r.addFace(i.first,i.last)}}function pp(r,t,e){if(e.int_points1.length!==0)for(let n=0;n<e.int_points1.length;n++){let i=e.int_points1[n],s=e.int_points2[n];if(i.edge_before!==void 0&&i.edge_after===void 0&&s.edge_before===void 0&&s.edge_after!==void 0&&(i.edge_before.next=s.edge_after,s.edge_after.prev=i.edge_before,i.edge_after=s.edge_after,s.edge_before=i.edge_before),s.edge_before!==void 0&&s.edge_after===void 0&&i.edge_before===void 0&&i.edge_after!==void 0&&(s.edge_before.next=i.edge_after,i.edge_after.prev=s.edge_before,s.edge_after=i.edge_after,i.edge_before=s.edge_before),i.edge_before!==void 0&&i.edge_after===void 0)for(let a of e.int_points1_sorted)a!==i&&a.edge_before===void 0&&a.edge_after!==void 0&&a.pt.equalTo(i.pt)&&(i.edge_before.next=a.edge_after,a.edge_after.prev=i.edge_before,i.edge_after=a.edge_after,a.edge_before=i.edge_before);if(s.edge_before!==void 0&&s.edge_after===void 0)for(let a of e.int_points2_sorted)a!==s&&a.edge_before===void 0&&a.edge_after!==void 0&&a.pt.equalTo(s.pt)&&(s.edge_before.next=a.edge_after,a.edge_after.prev=s.edge_before,s.edge_after=a.edge_after,a.edge_before=s.edge_before)}}function ps(r,t){for(let e of t)r.faces.delete(e.face),e.face=void 0,e.edge_before&&(e.edge_before.face=void 0),e.edge_after&&(e.edge_after.face=void 0)}function hs(r,t,e){for(let n of t){if(n.edge_before===void 0||n.edge_after===void 0||n.face||n.edge_after.face||n.edge_before.face)continue;let i=n.edge_after,s=n.edge_before;is.testInfiniteLoop(i);let a=r.addFace(i,s);for(let l of t)l.edge_before&&l.edge_after&&l.edge_before.face===a&&l.edge_after.face===a&&(l.face=a);for(let l of e)l.edge_before&&l.edge_after&&l.edge_before.face===a&&l.edge_after.face===a&&(l.face=a)}}function ms(r,t,e,n){for(let i of t){let s=i.first.bv;(e===on&&s===nt||e===ve&&s===nt&&n||e===ve&&s===it&&!n||e===gs&&s===it)&&r.deleteFace(i)}}var sn=class{multipolygon=new g.Polygon;constructor(t){let e=ge(this.intersects,n=>{let{cache:i}=e;return i.size===3e4&&i.clear?.(),`${n.xmin}_${n.xmax}_${n.ymin}_${n.ymax}`});this.intersects=e;for(let n of t)this.multipolygon.addFace(n.map(i=>new g.Point(i.x,i.y)))}makeHole(t,e,n){xs(this.multipolygon,new g.Polygon(new g.Circle(new g.Point(t,e),n))),this.intersects.cache.clear()}draw(t,e,n){_s(this.multipolygon,new g.Polygon(new g.Circle(new g.Point(t,e),n))),this.intersects.cache.clear()}intersects(t){let e=new Array;for(let{shape:n}of this.multipolygon.edges.search(t)){let i=n.intersect(t);i.length>0&&e.push({shape:n,points:i})}return e}intersectsShapeSome(t){for(let e of this.multipolygon.edges.search(t.box))if(e.shape.intersect(t).length>0)return!0;return!1}intersectsSeg(t){for(let{shape:e}of this.multipolygon.edges.search(t.box))if(e.intersect(t).length>0)return!0;return!1}intersectsSeg2(t){let e=new Array;for(let{shape:n}of this.multipolygon.edges.search(t.box)){let i=n.intersect(t);i.length>0&&e.push(...i)}return e}};var $=class{x;y;velocity;constructor(t,e,n=0,i=0){this.x=t,this.y=e,this.velocity=new g.Vector(n,i)}beforeUpdate(t){}onEntityCollide(t){}onOutOfWorld(t){}onUnderwater(){}onGroundCollide(t,e,n){return!0}onResolve(t,e){}};var an=new Map;function bs(r){for(let t of p.gameEntities){an.set(t,{x:t.x,y:t.y,velocity:t.velocity.clone()});let e=1/r;if(t.beforeUpdate(e),t.type===1){let i=new g.Vector(0,t.mass*1540);t.velocity=t.velocity.add(i.multiply(e))}t.x+=t.velocity.x*e,t.y+=t.velocity.y*e}for(let t of p.gameEntities){if(t.collideWithEntities)for(let s of p.gameEntities){if(s===t)continue;let a=new g.Box(t.x,t.y,t.x+t.width,t.y+t.height),l=new g.Box(s.x,s.y,s.x+s.width,s.y+s.height);a.intersect(l)&&t.onEntityCollide(s)}t.y<=-5e3||t.x>=5e3||t.x<=-5e3?(t.onOutOfWorld(!1),t.type===0&&p.gameEntities.delete(t)):t.y>=p.waterOffset+150&&(t.onOutOfWorld(!0),p.gameEntities.delete(t)),t.y>=p.waterOffset-t.height&&t.onUnderwater();let e=t.x,n=t.y,i=t.collideWithGround?p.terrain.intersects(new g.Box(e,n,e+t.width,n+t.height)):[];if(i.length>0){if(!t.onGroundCollide(e,n,i))continue;let a=an.get(t);if(t.x=a.x,t.y=a.y,t.velocity=a.velocity,t.velocity.length<t.bounceThreshold){t.velocity=new g.Vector,t.onResolve(!0,i);continue}let l=i[0],f;l.shape instanceof g.Arc?f=new g.Vector(l.points[0],l.shape.pc).normalize():f=new g.Vector(l.shape.ps,l.shape.pe).rotate90CCW().normalize();let u=f.multiply(t.velocity.dot(f)),d=t.velocity.subtract(u);t.velocity=d.multiply(t.COF).subtract(u.multiply(t.COR))}t.onResolve(!1,i)}an.clear()}var ln=450,fn=10,Ct=class extends ${type=0;width=10;height=10;COF=1;COR=1;bounceThreshold=9e3;collideWithEntities=!1;collideWithGround=!1;mass=1;pinPoint=null;initialPosition;charCol;center(){return new g.Point(this.x+this.width/2,this.y+this.height/2)}constructor(t,e){let n=p.currentControlledChar.collider,i=n.center();super(i.x-5,i.y-5,t,e);this.charCol=n,p.hookShot=this;let s=this.velocity.normalize().multiply(ln),a=p.terrain.multipolygon.intersect(new g.Segment(i,new g.Point(i.x+s.x,i.y+s.y)));a.length>0&&(this.pinPoint=Hr(a,l=>l.distanceTo(i)[0]),this.initialPosition=i)}beforeUpdate(t){let e=this.charCol,n=this.center();if(e.testGavnina===!1){let i=e.center(),[s]=i.distanceTo(n);if(s>ln){p.gameEntities.delete(this),Kt("idle");return}if(this.pinPoint===null)return;let a=1/t,l=this.velocity.length/a,f=this.velocity.normalize().multiply(l),u=new g.Point(n.x+f.x,n.y+f.y),[d]=this.initialPosition.distanceTo(u),[c]=this.initialPosition.distanceTo(this.pinPoint);if(d>=c){this.velocity=new g.Vector,this.x=this.pinPoint.x-this.width/2,this.y=this.pinPoint.y-this.height/2,this.pinPoint=null;let h=this.center(),v=e.center(),y=new g.Vector(v,h);if(p.terrain.intersectsSeg2(new g.Segment(v,new g.Point(v.x+y.x,v.y+y.y))).filter(w=>w.equalTo(h)===!1).length>0){p.gameEntities.delete(this),Kt("idle");return}e.initialPointX=h.x,e.initialPointY=h.y,globalThis.point_i=0,p.hookSegments.length=0;for(let w=1;w<ln/fn;w++){let _=new Ot(0,0);_.i=w,_.updateToMatchChar(!0),p.gameEntities.add(_),p.hookSegments.push(_)}e.testGavnina=!0}}}onOutOfWorld(t){let e=this.charCol;e.testGavnina=!1}};var Av=Jr((...r)=>{console.log(...r)},75),un=!1,Ot=class extends ${type=0;width=6;height=6;COF=1;COR=1;bounceThreshold=1/0;collideWithEntities=!1;mass=1;get collideWithGround(){return!1}i;active=!0;checkpoint=!1;halfWidth=this.width/2;halfHeight=this.height/2;arr;updateToMatchChar(t){let e=p.hookShot.charCol,n=e.pointX,i=e.pointY;t&&(n=e.initialPointX,i=e.initialPointY);let s=e.center(),a=(this.i-globalThis.point_i)*10,l=new g.Vector(new g.Point(n,i),s).normalize().multiply(a);this.x=n+l.x-this.halfWidth,this.y=i+l.y-this.halfHeight}beforeUpdate(t){let e=p.hookShot.charCol;un=!1,e.testGavnina===!1,this.active&&this.updateToMatchChar(!1)}onResolve(t){let e=p.hookShot.charCol;if(this.active){let s=new g.Point(this.x+this.halfWidth,this.y+this.halfHeight),a=new g.Point(e.pointX??e.initialPointX,e.pointY??e.initialPointY),l=new g.Vector(s,a),f=fn,u=l.normalize().multiply(f/2),d=u.rotate(Math.PI);p.terrain.intersectsSeg(new g.Segment(new g.Point(s.x+u.x,s.y+u.y),new g.Point(s.x+d.x,s.y+d.y)))&&this.handleCollision()}let n=p.hookSegments;if(this!==n[0])return;let i=new Array;for(let s of n)s.checkpoint&&i.push(s);i.reverse(),i=i.slice(0,1);for(let s of i){let[a,l,f,u,d,c]=s.arr,h=new g.Vector(new g.Point(l,f),new g.Point(e.x+e.width/2,e.y+e.height/2)).cross(u);if(c==="RIGHT"&&h<0||c==="LEFT"&&h>0){if(d===0)for(let v of n)v.active=!0;else for(let v of n)v.i>d&&(v.active=!0);e.pointX=l,e.pointY=f,globalThis.point_i=d,a.checkpoint=!1;break}}}handleCollision(){if(un)return!1;let t=p.hookShot.charCol,e=new g.Point(t.pointX??t.initialPointX,t.pointY??t.initialPointY),[n]=e.distanceTo(new g.Point(t.x+t.width/2,t.y+t.height/2)),[i]=e.distanceTo(new g.Point(this.x+this.halfWidth,this.y+this.halfHeight));if(i<n){t.x=t.prevState.x,t.y=t.prevState.y,t.velocity=t.prevState.velocity,t.aVelocity=t.prevState.aVelocity;for(let s of p.hookSegments)s.active&&s.updateToMatchChar(!1);un=!0,this.checkpoint=!0,this.arr=[this,t.pointX,t.pointY,new g.Vector(new g.Point(t.pointX,t.pointY),new g.Point(t.x+t.width/2,t.y+t.height/2)),globalThis.point_i,t.aVelocity<0?"LEFT":t.aVelocity===0?"STOP":"RIGHT"];for(let s=0;s<this.i-1+1;s++)p.hookSegments[s].active=!1;t.pointX=this.x+this.halfWidth,t.pointY=this.y+this.halfHeight,globalThis.point_i=this.i}return!1}};var we=class extends ${type=1;width=15;height=25;COF=.3;COR=.5;bounceThreshold=75;collideWithEntities=!1;collideWithGround=!0;mass=1;angle=0;boom=Xr(()=>{setTimeout(()=>{p.holes2.push({cx:this.x,cy:this.y,r:75}),p.terrain.makeHole(this.x,this.y,75),p.gameEntities.delete(this),W("grenadeExplosion");let t=new g.Circle(new g.Point(this.x,this.y),90);for(let e of p.gameEntities)if(!(e instanceof Ot||e instanceof Ct)){for(let n of new g.Box(e.x,e.y,e.x+e.width,e.y+e.height).toPoints())if(t.contains(n)){let i=new g.Vector(0,-1e3);e.velocity=e.velocity.add(i);break}}},1e3)});beforeUpdate(t){let e=i(this.velocity.slope),n=40;this.angle+=this.velocity.length/n*(e>270||e<90?1:-1)*t,this.angle%=Math.PI*2;function i(s){var a=Math.PI;return s*(180/a)}}onResolve(t,e){e.length>0&&!t&&W("grenadeBounce"),t&&this.boom()}onOutOfWorld(t){t&&W("waterSplash1")}};var Ee=class extends ${type=1;width=20;height=20;COF=1;COR=1;bounceThreshold=1e3;collideWithEntities=!0;collideWithGround=!0;mass=1;beforeUpdate(t){let e=new g.Vector(-1e3,0);this.velocity=this.velocity.add(e.multiply(t))}onOutOfWorld(t){t&&W("waterSplash1")}onGroundCollide(t,e){return this.boom(),!1}boom(){p.holes2.push({cx:this.x,cy:this.y,r:75}),p.terrain.makeHole(this.x,this.y,75),p.gameEntities.delete(this),W("rocketExplosion")}};var Te=class extends ${type=0;width=10;height=10;COF=1;COR=1;bounceThreshold=1e3;collideWithEntities=!0;collideWithGround=!0;mass=1;beforeUpdate(t){}onOutOfWorld(t){t&&W("waterSplash1")}onGroundCollide(t,e){return this.boom(),!1}boom(){p.holes2.push({cx:this.x,cy:this.y,r:30}),p.terrain.makeHole(this.x,this.y,30),p.gameEntities.delete(this),W("grenadeExplosion")}};var te=class extends ${type=1;width=13;height=60;COF=.7;COR=.15;bounceThreshold=1100;collideWithEntities=!1;collideWithGround=!0;mass=1;_testGavnina=!1;pointX;pointY;initialPointX;initialPointY;aVelocity=0;pull="none";prevState;center(){return new g.Point(this.x+this.width/2,this.y+this.height/2)}set testGavnina(t){if(this._testGavnina=t,t){Kt("rope"),Qt([...p.characters],a=>a.collider===this).characterService.send("GRAB_ONTO_HOOK"),this.type=0,this.bounceThreshold=1/0;let n=p.hookShot;this.pointX=n.x+n.width/2,this.pointY=n.y+n.height/2;let i=new g.Vector(new g.Point(this.x+this.width/2,this.y+this.height/2),new g.Point(this.pointX,this.pointY)),s=i.slope;this.aVelocity=(s>=1.5*Math.PI||s<=.5*Math.PI?this.velocity.length:-this.velocity.length)/2,this.aVelocity=i.cross(this.velocity)/300,this.aVelocity=i.normalize().cross(this.velocity)*.66,this.velocity=new g.Vector}else{this.type=1,this.bounceThreshold=1100,p.gameEntities.delete(p.hookShot);for(let n of p.hookSegments)p.gameEntities.delete(n);Kt("idle");let e=Qt([...p.characters],n=>n.collider===this);e.startJumpAnim="FORWARD",e.characterService.send("DEATTACH_ROPE")}}get testGavnina(){return this._testGavnina}beforeUpdate(t){if(this.prevState={x:this.x,y:this.y,velocity:this.velocity,aVelocity:this.aVelocity},this.testGavnina===!1){let c=Qt([...p.characters],h=>h.collider===this);if(c.statNew==="preparationForJump"){let h=performance.now()-c.animState.startTime,v=1e3/24,y=globalThis.tickCounter,w=c.animState.anim.frameCount*v/(t*1e3);if(y>=c.startJumpTick+w){if(c.collider.testGavnina)return;c.jump()}}return}let e=this.center(),n=new g.Point(this.pointX,this.pointY),i=new g.Vector(e,n),s=4,a=.997,l=new g.Vector(0,1).cross(i)/i.length;this.aVelocity+=-1*s*l,this.aVelocity*=a;let f=i.normalize().multiply(this.aVelocity),u=f.rotate90CCW(),d=new g.Vector(0,0);if(this.pull==="W")d=i.normalize().multiply(200);else if(this.pull==="S"){let c=p.hookSegments.at(-1),[h]=n.distanceTo(e),[v]=n.distanceTo(new g.Point(c.x+c.halfWidth,c.y+c.halfHeight));v<h||(d=i.normalize().multiply(-200))}this.velocity=u.add(f.multiply(t).add(d))}onGroundCollide(t,e,n){return this.testGavnina&&(this.aVelocity*=-1),!0}onResolve(t,e){let n=Qt([...p.characters],s=>s.collider===this),i=n.collider;if(t===!1&&e.length>0){n.startJumpAnim="FORWARD";return}if(t&&Qr(Yr(e,s=>s.points),s=>s.y>=i.y+this.height*.75)&&n.characterService.send("GROUND"),n.moves!=="none"&&n.isGrounded&&(n.looksToLeft=n.moves==="left",n.characterService.send("START_MOVING")),i.velocity.length>90){n.startJumpAnim="FORWARD",n.characterService.send("TELEPORT");return}n.statNew==="moves"&&vs(i,150*(n.looksToLeft?-1:1))}onUnderwater(){this.testGavnina===!0&&(this.testGavnina=!1),this.velocity=new g.Vector,this.x=_e(300,3100),this.y=-300}};function ws(r,t){var e=typeof Symbol=="function"&&r[Symbol.iterator];if(!e)return r;var n,i,s=e.call(r),a=[];try{for(;(t===void 0||t-- >0)&&!(n=s.next()).done;)a.push(n.value)}catch(l){i={error:l}}finally{try{n&&!n.done&&(e=s.return)&&e.call(s)}finally{if(i)throw i.error}}return a}var ee;(function(r){r[r.NotStarted=0]="NotStarted",r[r.Running=1]="Running",r[r.Stopped=2]="Stopped"})(ee||(ee={}));var As={type:"xstate.init"};function dn(r){return r===void 0?[]:[].concat(r)}function Es(r,t){return typeof(r=typeof r=="string"&&t&&t[r]?t[r]:r)=="string"?{type:r}:typeof r=="function"?{type:r.name,exec:r}:r}function pr(r){return function(t){return r===t}}function Ps(r){return typeof r=="string"?{type:r}:r}function Ts(r,t){return{value:r,context:t,actions:[],changed:!1,matches:pr(r)}}function Is(r,t,e){var n=t,i=!1;return[r.filter(function(s){if(s.type==="xstate.assign"){i=!0;var a=Object.assign({},n);return typeof s.assignment=="function"?a=s.assignment(n,e):Object.keys(s.assignment).forEach(function(l){a[l]=typeof s.assignment[l]=="function"?s.assignment[l](n,e):s.assignment[l]}),n=a,!1}return!0}),n,i]}function Cs(r,t){t===void 0&&(t={});var e=ws(Is(dn(r.states[r.initial].entry).map(function(a){return Es(a,t.actions)}),r.context,As),2),n=e[0],i=e[1],s={config:r,_options:t,initialState:{value:r.initial,actions:n,context:i,matches:pr(r.initial)},transition:function(a,l){var f,u,d=typeof a=="string"?{value:a,context:r.context}:a,c=d.value,h=d.context,v=Ps(l),y=r.states[c];if(y.on){var b=dn(y.on[v.type]);try{for(var w=function(U){var _r=typeof Symbol=="function"&&Symbol.iterator,mn=_r&&U[_r],gn=0;if(mn)return mn.call(U);if(U&&typeof U.length=="number")return{next:function(){return U&&gn>=U.length&&(U=void 0),{value:U&&U[gn++],done:!U}}};throw new TypeError(_r?"Object is not iterable.":"Symbol.iterator is not defined.")}(b),_=w.next();!_.done;_=w.next()){var E=_.value;if(E===void 0)return Ts(c,h);var m=typeof E=="string"?{target:E}:E,I=m.target,k=m.actions,T=k===void 0?[]:k,P=m.cond,C=P===void 0?function(){return!0}:P,A=I===void 0,O=I??c,re=r.states[O];if(C(h,v)){var gr=ws(Is((A?dn(T):[].concat(y.exit,T,re.entry).filter(function(U){return U})).map(function(U){return Es(U,s._options.actions)}),h,v),3),pn=gr[0],Gs=gr[1],Ds=gr[2],hn=I??c;return{value:hn,context:Gs,actions:pn,changed:I!==c||pn.length>0||Ds,matches:pr(hn)}}}}catch(U){f={error:U}}finally{try{_&&!_.done&&(u=w.return)&&u.call(w)}finally{if(f)throw f.error}}}return Ts(c,h)}};return s}var Ss=function(r,t){return r.actions.forEach(function(e){var n=e.exec;return n&&n(r.context,t)})};function Os(r){var t=r.initialState,e=ee.NotStarted,n=new Set,i={_machine:r,send:function(s){e===ee.Running&&(t=r.transition(t,s),Ss(t,Ps(s)),n.forEach(function(a){return a(t)}))},subscribe:function(s){return n.add(s),s(t),{unsubscribe:function(){return n.delete(s)}}},start:function(s){if(s){var a=typeof s=="object"?s:{context:r.config.context,value:s};t={value:a.value,actions:[],context:a.context,matches:pr(a.value)}}else t=r.initialState;return e=ee.Running,Ss(t,As),i},stop:function(){return e=ee.Stopped,n.clear(),i},get state(){return t},get status(){return e}};return i}var Ns=Cs({id:"character",initial:"idle",states:{idle:{on:{START_MOVING:"moves",START_JUMP:"preparationForJump",TELEPORT:"falls",GRAB_ONTO_HOOK:"onRope",DAMAGE:"damage"}},moves:{on:{STOP_MOVING:"idle",START_JUMP:"preparationForJump",GRAB_ONTO_HOOK:"onRope",DAMAGE:"damage",TELEPORT:"falls"}},preparationForJump:{on:{TELEPORT:"falls",GRAB_ONTO_HOOK:"onRope",DAMAGE:"damage"}},falls:{on:{GROUND:"idle",GRAB_ONTO_HOOK:"onRope",DAMAGE:"damage"}},onRope:{on:{DEATTACH_ROPE:"falls"}},damage:{on:{GROUND:"idle"}}}});var hr=144;function Ls(r){let e=0;for(let n of r)for(let i of n)i.y>e&&(e=i.y);yn({terrain:new sn(r),waterOffset:e-150,gameEntities:new Set,characters:new Set,weaponBoxes:new Set,holes2:[],terrainOffsetX:0,terrainOffsetY:0,hookSegments:[]}),setInterval(function(){if(p.weaponBoxes.size===25)return;let i=new ks(_e(300,2900),-300);p.gameEntities.add(i.collider),p.weaponBoxes.add(i)},3e3),setInterval(hp,1e3/hr)}var Rs=class extends ${type=1;width=30;height=30;COF=.7;COR=.15;bounceThreshold=100;collideWithEntities=!0;collideWithGround=!0;mass=1;onOutOfWorld(){}onEntityCollide(t){t instanceof te&&(p.gameEntities.delete(this),[...p.weaponBoxes].forEach(e=>{e.collider===this&&p.weaponBoxes.delete(e)}))}},ks=class{collider;creationTime;constructor(t,e){this.collider=new Rs(t,e),this.creationTime=performance.now()}},mr=class{collider;looksToLeft;name;health;team;animState;startJumpAnim;startJumpTick;handTool="bazooka";angle=90;aim="none";moves="none";stateMachine;characterService;get statNew(){return this.characterService.state.value}constructor(t,e,n){this.collider=t,this.looksToLeft=!1,this.name=e,this.health=530,this.team=n,this.stateMachine=Ns;let i=Os(this.stateMachine);i.subscribe(s=>{if(s.changed===!1)return;let a;switch(s.value){case"idle":a=new ot(V.rabbitBreath);break;case"moves":a=new ot(V.rabbitGo);break;case"preparationForJump":a=new ot(V.rabbitPrepareToJump);break;case"falls":this.startJumpAnim==="FORWARD"?a=new ot(V.rabbitJump):a=new ot(V.rabbitJumpBack);break;case"onRope":a=new ot(V.rabbitBreath);break;case"damage":a=new ot(V.rabbitBreath);break}this.animState=a}),i.start(),this.characterService=i,globalThis.test3=i,globalThis.test4=this.stateMachine}get isGrounded(){return this.collider.velocity.x===0&&this.collider.velocity.y===0}jump(){this.startJumpAnim==="FORWARD"?this.collider.velocity=new g.Vector(this.looksToLeft?-265:265,-420):this.collider.velocity=new g.Vector(this.looksToLeft?60:-60,-575)}};globalThis.tickCounter=0;function hp(){globalThis.tickStartTime=performance.now(),globalThis.callback!==void 0&&globalThis.callback();let r=p.currentControlledChar;if(r.aim!=="none"){let t=1/hr;r.aim==="up"?r.angle+=130*t:r.angle-=130*t,r.angle=$r(r.angle,0,180)}bs(hr*(globalThis.bulletTime?7:1)),globalThis.tickCounter++,globalThis.callback2!==void 0&&globalThis.callback2()}function Ms(r){let t=p.currentControlledChar,e=1500;r<1e3&&(e=75*Math.ceil(r/50));let n=t.handTool;n==="rifle"?e=1500:n==="hook"&&(e=1400);let i=t.angle,s=(t.looksToLeft?i+90:450-i)*Math.PI/180,a=e*Math.cos(s),l=e*Math.sin(s);switch(n){case"gren":p.gameEntities.add(new we(t.collider.x,t.collider.y,a,l)),W("grenadeAttack");break;case"bazooka":p.gameEntities.add(new Ee(t.collider.x,t.collider.y,a,l)),W("rocketAttack");break;case"rifle":W("grenadeAttack"),p.gameEntities.add(new Te(t.collider.x,t.collider.y,a,l));break;case"hook":p.gameEntities.add(new Ct(a,l)),W("grenadeAttack");break}}function vs(r,t){let n=t/hr,i=0,s=r.x+n;for(let a=.9375;a<=.9375*8;a+=.9375){let l=r.y+a;if(p.terrain.intersectsShapeSome(new g.Box(s,l,s+r.width,l+r.height))){i=a-.9375;break}}if(i>0){r.y+=i,r.x+=n;return}for(let a=0;a<=.9375*7;a+=.9375){let l=r.y-a;if(p.terrain.intersectsShapeSome(new g.Box(s,l,s+r.width,l+r.height))===!1){r.y-=a,r.x+=n;return}}}var Bs=class{events=new Array;active=!1;play(){globalThis.callback2=()=>{this.stop();let t=p.currentControlledChar;for(let[e,n]of Object.entries(this.initChar))t[e]=n;for(let[e,n]of Object.entries(this.initCharCol))t.collider[e]=n;globalThis.tickCounter=this.initTick,globalThis.callback2=()=>{this.events.forEach(({req:e,tick:n})=>{globalThis.tickCounter===n&&Us(e,e.params,t,t.collider)})},globalThis.callback2()}}start(){globalThis.callback2=()=>{this.events=[],this.active=!0;let t=p.currentControlledChar;this.initCharCol={...t.collider},this.initChar={...t},this.initTick=globalThis.tickCounter,globalThis.callback2=void 0}}stop(){this.active=!1}test(){let t=[];return this.events.forEach(e=>{e.t3<e.t2&&t.push(e)}),t}test2(){let t=[];return this.events.forEach(e=>{e.t3>e.t2&&t.push(e)}),t}addEvent(t){this.active&&this.events.push({req:t,tick:globalThis.tickCounter,t2:globalThis.tickStartTime,t3:performance.now()})}};globalThis.onmessage=async r=>{let t=r.data,e=t.params,n,i;switch(p&&(n=p.currentControlledChar,i=n.collider),Us(t,e,n,i),t.method){case"join":{Ls(t.params.polygons);let f=new te(1570,-200);p.gameEntities.add(f);let u=new mr(f,t.params.nickname??"\u041A\u043E\u043B\u044F",1);p.characters.add(u),p.currentControlledChar=u;let d=new te(1370,-200);p.gameEntities.add(d);let c=new mr(d,"\u041F\u0435\u0442\u044F",0);p.characters.add(c),globalThis.record=new Bs,cn(!0),setTimeout(cn,1e3/Vs);break}case"toggleBulletTime":globalThis.bulletTime=!globalThis.bulletTime;break;case"changeChar":i.testGavnina&&(i.testGavnina=!1);let s=[...p.characters],l=(s.indexOf(n)+1)%s.length;p.currentControlledChar=s[l];break;case"draw":{p.terrain.draw(e.cx,e.cy,20);break}case"makeHole":return p.holes2.push({cx:e.cx,cy:e.cy,r:60}),p.terrain.makeHole(e.cx,e.cy,60),new Response(JSON.stringify({result:{data:""}}))}};var Fs;function Us(r,t,e,n){let i=JSON.stringify(r);if(!(i===Fs&&r.method!=="startJumping")&&!(r.method==="startJumping"&&!(e.statNew==="moves"||e.statNew==="idle")))switch(Fs=i,globalThis.record!==void 0&&globalThis.record.addEvent(r),r.method){case"startMoving":(e.collider.testGavnina||!(e.statNew==="preparationForJump"||e.statNew==="falls"))&&(e.looksToLeft=t.direction),e.collider.testGavnina===!1&&(e.moves=t.direction?"left":"right");break;case"stopMoving":e.moves="none",e.characterService.send("STOP_MOVING");break;case"startJumping":e.startJumpAnim=t.direction,e.startJumpTick=globalThis.tickCounter,e.characterService.send("START_JUMP");break;case"setWeapon":e.handTool=t.name;break;case"fireTest":Ms(t.force);break;case"startPull":if(n.testGavnina){n.pull=t.direction;break}e.aim=t.direction==="W"?"up":"down";break;case"stopPull":n.pull="none",e.aim="none";break;case"deattach":n.testGavnina&&(n.testGavnina=!1);break}}var mp={},Vs=64;async function cn(r=!1){let t={characters:[...p.characters].map(e=>({name:e.name,health:e.health,team:e.team,colX:e.collider.x,colY:e.collider.y,colWidth:e.collider.width,colHeight:e.collider.height,direction:e.looksToLeft,visual:e.animState,handTool:e.handTool,angle:e.angle})),weaponBoxes:[...p.weaponBoxes].map(e=>({colX:e.collider.x,colY:e.collider.y,colWidth:e.collider.width,colHeight:e.collider.height,creationTime:e.creationTime})),holes:[...p.holes2],meta:{terrainOffsetX:p.terrainOffsetX,terrainOffsetY:p.terrainOffsetY,waterOffset:p.waterOffset,currentControlledCharIdx:[...p.characters].indexOf(p.currentControlledChar),currentControlledCharState:p.currentControlledChar.statNew.toUpperCase()}};t.testGrenades=[];for(let e of p.gameEntities)e instanceof we&&t.testGrenades.push({x:e.x,y:e.y,w:e.width,h:e.height,angle:e.angle});t.testBullets=[];for(let e of p.gameEntities)e instanceof Te&&t.testBullets.push({x:e.x,y:e.y,w:e.width,h:e.height,angle:e.velocity.slope});t.testBazookas=[];for(let e of p.gameEntities)e instanceof Ee&&t.testBazookas.push({x:e.x,y:e.y,w:e.width,h:e.height,angle:e.velocity.slope});t.testHookShot=[];for(let e of p.gameEntities)e instanceof Ct&&t.testHookShot.push({x:e.x,y:e.y,w:e.width,h:e.height});t.testHookSegments=[];for(let e of p.gameEntities)if(e instanceof Ot){let i=p.currentControlledChar.collider;if(i.pointX===void 0)continue;let s=new g.Vector(new g.Point(i.pointX,i.pointY),new g.Point(i.x+i.width/2,i.y+i.height/2)),a=new g.Vector(new g.Point(i.pointX,i.pointY),new g.Point(e.x+e.width/2,e.y+e.height/2));(e.active===!1||a.length<s.length)&&t.testHookSegments.push({x:e.x,y:e.y,w:e.width,h:e.height})}mp=t,globalThis.postMessage({type:"fullSnapshot",data:t}),setTimeout(cn,1e3/Vs)}function W(r){globalThis.postMessage({type:"playSound",data:r})}function Kt(r){globalThis.postMessage({type:"setInputMode",data:r})}globalThis.postMessage({type:"loaded",data:""});})();
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/**
 * @license
 * Lodash (Custom Build) <https://lodash.com/>
 * Build: `lodash modularize exports="es" -o ./`
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
