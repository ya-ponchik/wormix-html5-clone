(()=>{var rr=Object.create;var At=Object.defineProperty;var or=Object.getOwnPropertyDescriptor;var sr=Object.getOwnPropertyNames;var ar=Object.getPrototypeOf,lr=Object.prototype.hasOwnProperty;var fr=(i,t,e)=>t in i?At(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var dr=i=>At(i,"__esModule",{value:!0});var ur=(i,t)=>()=>(t||i((t={exports:{}}).exports,t),t.exports),dn=(i,t)=>{for(var e in t)At(i,e,{get:t[e],enumerable:!0})},cr=(i,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of sr(t))!lr.call(i,r)&&(e||r!=="default")&&At(i,r,{get:()=>t[r],enumerable:!(n=or(t,r))||n.enumerable});return i},hr=(i,t)=>cr(dr(At(i!=null?rr(ar(i)):{},"default",!t&&i&&i.__esModule?{get:()=>i.default,enumerable:!0}:{value:i,enumerable:!0})),i);var H=(i,t,e)=>(fr(i,typeof t!="symbol"?t+"":t,e),e);var jn=ur((Xa,ce)=>{(function(){function i(t,e,n,r){this.max_objects=e||10,this.max_levels=n||4,this.level=r||0,this.bounds=t,this.objects=[],this.nodes=[]}i.prototype.split=function(){var t=this.level+1,e=this.bounds.width/2,n=this.bounds.height/2,r=this.bounds.x,a=this.bounds.y;this.nodes[0]=new i({x:r+e,y:a,width:e,height:n},this.max_objects,this.max_levels,t),this.nodes[1]=new i({x:r,y:a,width:e,height:n},this.max_objects,this.max_levels,t),this.nodes[2]=new i({x:r,y:a+n,width:e,height:n},this.max_objects,this.max_levels,t),this.nodes[3]=new i({x:r+e,y:a+n,width:e,height:n},this.max_objects,this.max_levels,t)},i.prototype.getIndex=function(t){var e=[],n=this.bounds.x+this.bounds.width/2,r=this.bounds.y+this.bounds.height/2,a=t.y<r,s=t.x<n,l=t.x+t.width>n,f=t.y+t.height>r;return a&&l&&e.push(0),s&&a&&e.push(1),s&&f&&e.push(2),l&&f&&e.push(3),e},i.prototype.insert=function(t){var e=0,n;if(this.nodes.length){for(n=this.getIndex(t),e=0;e<n.length;e++)this.nodes[n[e]].insert(t);return}if(this.objects.push(t),this.objects.length>this.max_objects&&this.level<this.max_levels){for(this.nodes.length||this.split(),e=0;e<this.objects.length;e++){n=this.getIndex(this.objects[e]);for(var r=0;r<n.length;r++)this.nodes[n[r]].insert(this.objects[e])}this.objects=[]}},i.prototype.retrieve=function(t){var e=this.getIndex(t),n=this.objects;if(this.nodes.length)for(var r=0;r<e.length;r++)n=n.concat(this.nodes[e[r]].retrieve(t));return n=n.filter(function(a,s){return n.indexOf(a)>=s}),n},i.prototype.clear=function(){this.objects=[];for(var t=0;t<this.nodes.length;t++)this.nodes.length&&this.nodes[t].clear();this.nodes=[]},typeof ce<"u"&&typeof ce.exports<"u"?ce.exports=i:window.Quadtree=i})()});var h;function un(i){h=i}var N=class{};H(N,"weaponBox",{spriteName:"weaponBox",frameCount:16}),H(N,"rabbitBreath",{spriteName:"rabbitBreath",frameCount:60}),H(N,"bubbles",{spriteName:"bubbles",frameCount:68}),H(N,"rabbitGo",{spriteName:"rabbitGo",frameCount:24}),H(N,"rabbitPrepareToJump",{spriteName:"rabbitPrepareToJump",frameCount:9}),H(N,"rabbitJumpBack",{spriteName:"rabbitJumpBack",frameCount:30}),H(N,"rabbitJump",{spriteName:"rabbitJump",frameCount:9});var V=class{anim;startTime;constructor(t){this.anim=t,this.startTime=performance.now()}};var pr={CCW:-1,CW:1,NOT_ORIENTABLE:0},mr=2*Math.PI,Ct=1,vn=0,G=2,gr=3,_r=4,xr=1,br=2,Ve=0,te=1,ht=2,ee=Object.freeze({CCW:!0,CW:!1,ORIENTATION:pr,PIx2:mr,INSIDE:Ct,OUTSIDE:vn,BOUNDARY:G,CONTAINS:gr,INTERLACE:_r,OVERLAP_SAME:xr,OVERLAP_OPPOSITE:br,NOT_VERTEX:Ve,START_VERTEX:te,END_VERTEX:ht}),j=1e-6;function wn(i){j=i}function En(){return j}var yr=3;function Ce(i){return i<j&&i>-j}function ot(i,t){return i-t<j&&i-t>-j}function Tn(i,t){return i-t>j}function vr(i,t){return i-t>-j}function In(i,t){return i-t<-j}function wr(i,t){return i-t<j}var Er=Object.freeze({setTolerance:wn,getTolerance:En,DECIMALS:yr,EQ_0:Ce,EQ:ot,GT:Tn,GE:vr,LT:In,LE:wr}),ne=class{static get ILLEGAL_PARAMETERS(){return new ReferenceError("Illegal Parameters")}static get ZERO_DIVISION(){return new Error("Zero division")}static get UNRESOLVED_BOUNDARY_CONFLICT(){return new Error("Unresolved boundary conflict in boolean operation")}static get INFINITE_LOOP(){return new Error("Infinite loop")}};var o={Utils:Er,Errors:ne,Matrix:void 0,Planar_set:void 0,Point:void 0,Vector:void 0,Line:void 0,Circle:void 0,Segment:void 0,Arc:void 0,Box:void 0,Edge:void 0,Face:void 0,Ray:void 0,Ray_shooting:void 0,Multiline:void 0,Polygon:void 0,Distance:void 0,Inversion:void 0};for(let i in ee)o[i]=ee[i];Object.defineProperty(o,"DP_TOL",{get:function(){return En()},set:function(i){wn(i)}});var ie=class{constructor(t,e){this.first=t,this.last=e||this.first}static testInfiniteLoop(t){let e=t,n=t;do{if(e!=t&&e===n)throw o.Errors.INFINITE_LOOP;e=e.next,n=n.next.next}while(e!=t)}get size(){let t=0;for(let e of this)t++;return t}toArray(t=void 0,e=void 0){let n=[],r=t||this.first,a=e||this.last,s=r;if(s===void 0)return n;do n.push(s),s=s.next;while(s!==a.next);return n}append(t){return this.isEmpty()?this.first=t:(t.prev=this.last,this.last.next=t),this.last=t,this.last.next=void 0,this.first.prev=void 0,this}insert(t,e){if(this.isEmpty())this.first=t,this.last=t;else if(e==null)t.next=this.first,this.first.prev=t,this.first=t;else{let n=e.next;e.next=t,n&&(n.prev=t),t.prev=e,t.next=n,this.last===e&&(this.last=t)}return this.last.next=void 0,this.first.prev=void 0,this}remove(t){return t===this.first&&t===this.last?(this.first=void 0,this.last=void 0):(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t===this.first&&(this.first=t.next),t===this.last&&(this.last=t.prev)),this}isEmpty(){return this.first===void 0}[Symbol.iterator](){let t;return{next:()=>(t=t?t.next:this.first,{value:t,done:t===void 0})}}};function gt(i,t,e){let n=e.length,r=i.shape.split(t);if(r.length===0)return;let a=0;r[0]===null?a=0:r[1]===null?a=i.shape.length:a=r[0].length;let s=Ve;ot(a,0)&&(s|=te),ot(a,i.shape.length)&&(s|=ht);let l=s&ht&&i.next.arc_length===0?0:i.arc_length+a;e.push({id:n,pt:t,arc_length:l,edge_before:i,edge_after:void 0,face:i.face,is_vertex:s})}function kt(i){i.int_points1_sorted=Ot(i.int_points1),i.int_points2_sorted=Ot(i.int_points2)}function Ot(i){let t=new Map,e=0;for(let r of i)t.has(r.face)||(t.set(r.face,e),e++);for(let r of i)r.faceId=t.get(r.face);return i.slice().sort(Tr)}function Tr(i,t){return i.faceId<t.faceId?-1:i.faceId>t.faceId?1:i.arc_length<t.arc_length?-1:i.arc_length>t.arc_length?1:0}function Se(i,t){return t.slice().sort((e,n)=>i.coord(e.pt)<i.coord(n.pt)?-1:i.coord(e.pt)>i.coord(n.pt)?1:0)}function Ue(i){if(i.int_points1.length<2)return;let t=!1,e,n,r,a;for(let s=0;s<i.int_points1_sorted.length;s++)if(i.int_points1_sorted[s].id!==-1){e=i.int_points1_sorted[s],n=i.int_points2[e.id];for(let l=s+1;l<i.int_points1_sorted.length&&(r=i.int_points1_sorted[l],!!ot(r.arc_length,e.arc_length));l++)r.id!==-1&&(a=i.int_points2[r.id],a.id!==-1&&r.edge_before===e.edge_before&&r.edge_after===e.edge_after&&a.edge_before===n.edge_before&&a.edge_after===n.edge_after&&(r.id=-1,a.id=-1,t=!0))}n=i.int_points2_sorted[0],e=i.int_points1[n.id];for(let s=1;s<i.int_points2_sorted.length;s++){let l=i.int_points2_sorted[s];if(l.id==-1)continue;if(n.id==-1||!ot(l.arc_length,n.arc_length)){n=l,e=i.int_points1[n.id];continue}let f=i.int_points1[l.id];f.edge_before===e.edge_before&&f.edge_after===e.edge_after&&l.edge_before===n.edge_before&&l.edge_after===n.edge_after&&(f.id=-1,l.id=-1,t=!0)}t&&(i.int_points1=i.int_points1.filter(s=>s.id>=0),i.int_points2=i.int_points2.filter(s=>s.id>=0),i.int_points1.forEach((s,l)=>s.id=l),i.int_points2.forEach((s,l)=>s.id=l))}function Oe(i){for(let t of i)t.edge_before.bvStart=void 0,t.edge_before.bvEnd=void 0,t.edge_before.bv=void 0,t.edge_before.overlap=void 0,t.edge_after.bvStart=void 0,t.edge_after.bvEnd=void 0,t.edge_after.bv=void 0,t.edge_after.overlap=void 0;for(let t of i)t.edge_before.bvEnd=G,t.edge_after.bvStart=G}function Ne(i,t){for(let e of i)e.edge_before.setInclusion(t),e.edge_after.setInclusion(t)}function Ir(i){let t,e,n,r=i.int_points1.length;for(let a=0;a<r;a++){let s=i.int_points1_sorted[a];s.face!==t&&(e=a,t=s.face);let l=a,f=_t(i.int_points1_sorted,a,t),d;l+f<r&&i.int_points1_sorted[l+f].face===t?d=l+f:d=e;let u=_t(i.int_points1_sorted,d,t);n=null;for(let x=d;x<d+u;x++){let v=i.int_points1_sorted[x];if(v.face===t&&i.int_points2[v.id].face===i.int_points2[s.id].face){n=v;break}}if(n===null)continue;let c=s.edge_after,_=n.edge_before;if(!(c.bv===G&&_.bv===G)||c!==_)continue;let w=i.int_points2[s.id],b=i.int_points2[n.id],y=w.edge_after,E=b.edge_before;y.bv===G&&E.bv===G&&y===E||(w=i.int_points2[n.id],b=i.int_points2[s.id],y=w.edge_after,E=b.edge_before),y.bv===G&&E.bv===G&&y===E&&c.setOverlap(y)}}function _t(i,t,e){let n,r,a=1;if(i.length==1)return 1;n=i[t];for(let s=t+1;s<i.length&&!(n.face!=e||(r=i[s],!(r.pt.equalTo(n.pt)&&r.edge_before===n.edge_before&&r.edge_after===n.edge_after)));s++)a++;return a}function xt(i,t){if(!!t){for(let e of t){let n=e.edge_before;if(e.is_vertex=Ve,n.shape.start&&n.shape.start.equalTo(e.pt)&&(e.is_vertex|=te),n.shape.end&&n.shape.end.equalTo(e.pt)&&(e.is_vertex|=ht),e.is_vertex&te){e.edge_before=n.prev,e.is_vertex=ht;continue}if(e.is_vertex&ht)continue;let r=i.addVertex(e.pt,n);e.edge_before=r}for(let e of t)e.edge_after=e.edge_before.next}}function cn(i,t,e){let n=i.edge_before,r=t.edge_after;n.next=e,e.prev=n,e.next=r,r.prev=e}var{INSIDE:W,OUTSIDE:D,BOUNDARY:k,OVERLAP_SAME:Sr,OVERLAP_OPPOSITE:Pr}=ee,{NOT_VERTEX:za,START_VERTEX:hn,END_VERTEX:pn}=ee,re=1,Bt=2,st=3;function Ar(i,t){let[e,n]=Mt(i,t,re,!0);return e}function ke(i,t){let n=t.clone().reverse(),[r,a]=Mt(i,n,st,!0);return r}function Sn(i,t){let[e,n]=Mt(i,t,Bt,!0);return e}function Pn(i,t){let[e,n]=Mt(i,t,Bt,!1),r=[];for(let s of e.faces)r=[...r,...[...s.edges].map(l=>l.shape)];let a=[];for(let s of n.faces)a=[...a,...[...s.edges].map(l=>l.shape)];return[r,a]}function Le(i,t){let[e,n]=Mt(i,t,st,!1),r=[];for(let a of e.faces)r=[...r,...[...a.edges].map(s=>s.shape)];return r}function An(i,t){let e=i.clone(),n=t.clone(),r=Cn(e,n);kt(r),xt(e,r.int_points1_sorted),xt(n,r.int_points2_sorted),Ue(r),kt(r);let a=r.int_points1_sorted.map(l=>l.pt),s=r.int_points2_sorted.map(l=>l.pt);return[a,s]}function Cr(i,t,e,n){let r=mn(i,e.int_points1),a=mn(t,e.int_points2);for(gn(r,t),gn(a,i),Oe(e.int_points1),Oe(e.int_points2),Ne(e.int_points1,t),Ne(e.int_points2,i);Nr(i,t,e.int_points1,e.int_points1_sorted,e.int_points2,e););Ir(e),Re(i,n,e.int_points1_sorted,!0),Re(t,n,e.int_points2_sorted,!1),_n(i,r,n,!0),_n(t,a,n,!1)}function Or(i,t,e,n){kr(i,t,n,e.int_points2),Lr(i,t,e),Be(i,e.int_points1),Be(t,e.int_points2),Me(i,e.int_points1,e.int_points2),Me(i,e.int_points2,e.int_points1)}function Mt(i,t,e,n){let r=i.clone(),a=t.clone(),s=Cn(r,a);return kt(s),xt(r,s.int_points1_sorted),xt(a,s.int_points2_sorted),Ue(s),kt(s),Cr(r,a,s,e),n&&Or(r,a,s,e),[r,a]}function Cn(i,t){let e={int_points1:[],int_points2:[]};for(let n of i.edges){let r=t.edges.search(n.box);for(let a of r){let s=n.shape.intersect(a.shape);for(let l of s)gt(n,l,e.int_points1),gt(a,l,e.int_points2)}}return e}function mn(i,t){let e=[];for(let n of i.faces)t.find(r=>r.face===n)||e.push(n);return e}function gn(i,t){for(let e of i)e.first.bv=e.first.bvStart=e.first.bvEnd=void 0,e.first.setInclusion(t)}function Nr(i,t,e,n,r,a){let s,l,f,d=n.length,u=!1;for(let c=0;c<d;c++){let _=n[c];_.face!==s&&(l=c,s=_.face);let w=c,b=_t(n,c,s),y;w+b<d&&n[w+b].face===s?y=w+b:y=l;let E=_t(n,y,s);f=null;for(let p=y;p<y+E;p++){let S=n[p];if(S.face===s&&r[S.id].face===r[_.id].face){f=S;break}}if(f===null)continue;let x=_.edge_after,v=f.edge_before;if(x.bv===k&&v.bv!=k){x.bv=v.bv;continue}if(x.bv!=k&&v.bv===k){v.bv=x.bv;continue}if(x.bv===k&&v.bv===k&&x!=v||x.bv===W&&v.bv===D||x.bv===D&&v.bv===W){let p=x.next;for(;p!=v;)p.bvStart=void 0,p.bvEnd=void 0,p.bv=void 0,p.setInclusion(t),p=p.next}if(x.bv===k&&v.bv===k&&x!=v){let p=x.next,S;for(;p!=v;){if(p.bv!=k){if(S===void 0)S=p.bv;else if(p.bv!=S)throw ne.UNRESOLVED_BOUNDARY_CONFLICT}p=p.next}S!=null&&(x.bv=S,v.bv=S);continue}if(x.bv===W&&v.bv===D||x.bv===D&&v.bv===W){let p=x;for(;p!=v;){if(p.bvStart===x.bv&&p.bvEnd===v.bv){let[S,$]=p.shape.distanceTo(t);if(S<10*o.DP_TOL){gt(p,$.ps,e);let T=e[e.length-1];if(T.is_vertex&hn)T.edge_after=p,T.edge_before=p.prev,p.bvStart=k,p.bv=void 0,p.setInclusion(t);else if(T.is_vertex&pn)T.edge_after=p.next,p.bvEnd=k,p.bv=void 0,p.setInclusion(t);else{let P=t.addVertex(T.pt,p);T.edge_before=P,T.edge_after=P.next,P.setInclusion(t),P.next.bvStart=k,P.next.bvEnd=void 0,P.next.bv=void 0,P.next.setInclusion(t)}let O=t.findEdgeByPoint($.pe);gt(O,$.pe,r);let A=r[r.length-1];if(A.is_vertex&hn)A.edge_after=O,A.edge_before=O.prev;else if(A.is_vertex&pn)A.edge_after=O.next;else{let P=r.find(Ie=>Ie.edge_after===O),C=t.addVertex(A.pt,O);A.edge_before=C,A.edge_after=C.next,P&&(P.edge_after=C),C.bvStart=void 0,C.bvEnd=k,C.bv=void 0,C.setInclusion(i),C.next.bvStart=k,C.next.bvEnd=void 0,C.next.bv=void 0,C.next.setInclusion(i)}kt(a),u=!0;break}}p=p.next}if(u)break;throw ne.UNRESOLVED_BOUNDARY_CONFLICT}}return u}function Re(i,t,e,n){if(!e)return;let r,a,s,l;for(let f=0;f<e.length;f++){if(s=e[f],s.face!==r&&(a=f,r=s.face),r.isEmpty())continue;let d=f,u=_t(e,f,r),c;d+u<e.length&&e[d+u].face===s.face?c=d+u:c=a,l=e[c];let _=c,w=_t(e,_,r),b=s.edge_after,y=l.edge_before;if(b.bv===W&&y.bv===W&&t===re||b.bv===D&&y.bv===D&&t===Bt||(b.bv===D||y.bv===D)&&t===st&&!n||(b.bv===W||y.bv===W)&&t===st&&n||b.bv===k&&y.bv===k&&b.overlap&Sr&&n||b.bv===k&&y.bv===k&&b.overlap&Pr){i.removeChain(r,b,y);for(let E=d;E<d+u;E++)e[E].edge_after=void 0;for(let E=_;E<_+w;E++)e[E].edge_before=void 0}f+=u-1}}function kr(i,t,e,n){for(let r of t.faces){for(let a of r)i.edges.add(a);n.find(a=>a.face===r)===void 0&&i.addFace(r.first,r.last)}}function Lr(i,t,e){if(e.int_points1.length!==0)for(let n=0;n<e.int_points1.length;n++){let r=e.int_points1[n],a=e.int_points2[n];if(r.edge_before!==void 0&&r.edge_after===void 0&&a.edge_before===void 0&&a.edge_after!==void 0&&(r.edge_before.next=a.edge_after,a.edge_after.prev=r.edge_before,r.edge_after=a.edge_after,a.edge_before=r.edge_before),a.edge_before!==void 0&&a.edge_after===void 0&&r.edge_before===void 0&&r.edge_after!==void 0&&(a.edge_before.next=r.edge_after,r.edge_after.prev=a.edge_before,a.edge_after=r.edge_after,r.edge_before=a.edge_before),r.edge_before!==void 0&&r.edge_after===void 0)for(let s of e.int_points1_sorted)s!==r&&s.edge_before===void 0&&s.edge_after!==void 0&&s.pt.equalTo(r.pt)&&(r.edge_before.next=s.edge_after,s.edge_after.prev=r.edge_before,r.edge_after=s.edge_after,s.edge_before=r.edge_before);if(a.edge_before!==void 0&&a.edge_after===void 0)for(let s of e.int_points2_sorted)s!==a&&s.edge_before===void 0&&s.edge_after!==void 0&&s.pt.equalTo(a.pt)&&(a.edge_before.next=s.edge_after,s.edge_after.prev=a.edge_before,a.edge_after=s.edge_after,s.edge_before=a.edge_before)}}function Be(i,t){for(let e of t)i.faces.delete(e.face),e.face=void 0,e.edge_before&&(e.edge_before.face=void 0),e.edge_after&&(e.edge_after.face=void 0)}function Me(i,t,e){for(let n of t){if(n.edge_before===void 0||n.edge_after===void 0||n.face||n.edge_after.face||n.edge_before.face)continue;let r=n.edge_after,a=n.edge_before;ie.testInfiniteLoop(r);let s=i.addFace(r,a);for(let l of t)l.edge_before&&l.edge_after&&l.edge_before.face===s&&l.edge_after.face===s&&(l.face=s);for(let l of e)l.edge_before&&l.edge_after&&l.edge_before.face===s&&l.edge_after.face===s&&(l.face=s)}}function _n(i,t,e,n){for(let r of t){let a=r.first.bv;(e===re&&a===W||e===st&&a===W&&n||e===st&&a===D&&!n||e===Bt&&a===D)&&i.deleteFace(r)}}var Rr=Object.freeze({BOOLEAN_UNION:re,BOOLEAN_INTERSECT:Bt,BOOLEAN_SUBTRACT:st,unify:Ar,subtract:ke,intersect:Sn,innerClip:Pn,outerClip:Le,calculateIntersections:An,removeNotRelevantChains:Re,removeOldFaces:Be,restoreFaces:Me}),Br=RegExp("T.F..FFF.|T.F...F.."),Mr=RegExp("T........|.T.......|...T.....|....T...."),Fr=RegExp("FT.......|F..T.....|F...T...."),Vr=RegExp("T.F..F..."),Ur=RegExp("T.F..F...|.TF..F...|..FT.F...|..F.TF..."),lt=class{constructor(){this.m=new Array(9).fill(void 0)}get I2I(){return this.m[0]}set I2I(t){this.m[0]=t}get I2B(){return this.m[1]}set I2B(t){this.m[1]=t}get I2E(){return this.m[2]}set I2E(t){this.m[2]=t}get B2I(){return this.m[3]}set B2I(t){this.m[3]=t}get B2B(){return this.m[4]}set B2B(t){this.m[4]=t}get B2E(){return this.m[5]}set B2E(t){this.m[5]=t}get E2I(){return this.m[6]}set E2I(t){this.m[6]=t}get E2B(){return this.m[7]}set E2B(t){this.m[7]=t}get E2E(){return this.m[8]}set E2E(t){this.m[8]=t}toString(){return this.m.map(t=>t instanceof Array&&t.length>0?"T":t instanceof Array&&t.length===0?"F":"*").join("")}equal(){return Br.test(this.toString())}intersect(){return Mr.test(this.toString())}touch(){return Fr.test(this.toString())}inside(){return Vr.test(this.toString())}covered(){return Ur.test(this.toString())}};function oe(i,t){let e=[],[n,r,a]=i.standard,[s,l,f]=t.standard,d=n*l-r*s,u=a*l-r*f,c=n*f-a*s;if(!o.Utils.EQ_0(d)){let _,w;r===0?(_=a/n,w=c/d):l===0?(_=f/s,w=c/d):n===0?(_=u/d,w=a/r):s===0?(_=u/d,w=f/l):(_=u/d,w=c/d),e.push(new o.Point(_,w))}return e}function yt(i,t){let e=[],n=t.pc.projectionOn(i),r=t.pc.distanceTo(n)[0];if(o.Utils.EQ(r,t.r))e.push(n);else if(o.Utils.LT(r,t.r)){let a=Math.sqrt(t.r*t.r-r*r),s,l;s=i.norm.rotate90CCW().multiply(a),l=n.translate(s),e.push(l),s=i.norm.rotate90CW().multiply(a),l=n.translate(s),e.push(l)}return e}function Lt(i,t){let e=[];for(let n of t.toSegments()){let r=se(n,i);for(let a of r)Ln(a,e)||e.push(a)}return e}function $e(i,t){let e=[];if(Lt(i,t.box).length===0)return e;let n=new o.Circle(t.pc,t.r),r=yt(i,n);for(let a of r)a.on(t)&&e.push(a);return e}function se(i,t){let e=[];if(i.ps.on(t)&&e.push(i.ps),i.pe.on(t)&&!i.isZeroLength()&&e.push(i.pe),e.length>0||i.isZeroLength()||i.ps.leftTo(t)&&i.pe.leftTo(t)||!i.ps.leftTo(t)&&!i.pe.leftTo(t))return e;let n=new o.Line(i.ps,i.pe);return oe(n,t)}function Ft(i,t){let e=[];if(i.box.not_intersect(t.box))return e;if(i.isZeroLength())return i.ps.on(t)&&e.push(i.ps),e;if(t.isZeroLength())return t.ps.on(i)&&e.push(t.ps),e;let n=new o.Line(i.ps,i.pe),r=new o.Line(t.ps,t.pe);if(n.incidentTo(r))i.ps.on(t)&&e.push(i.ps),i.pe.on(t)&&e.push(i.pe),t.ps.on(i)&&!t.ps.equalTo(i.ps)&&!t.ps.equalTo(i.pe)&&e.push(t.ps),t.pe.on(i)&&!t.pe.equalTo(i.ps)&&!t.pe.equalTo(i.pe)&&e.push(t.pe);else{let a=oe(n,r);a.length>0&&a[0].on(i)&&a[0].on(t)&&e.push(a[0])}return e}function ae(i,t){let e=[];if(i.box.not_intersect(t.box))return e;if(i.isZeroLength()){let[a,s]=i.ps.distanceTo(t.pc);return o.Utils.EQ(a,t.r)&&e.push(i.ps),e}let n=new o.Line(i.ps,i.pe),r=yt(n,t);for(let a of r)a.on(i)&&e.push(a);return e}function at(i,t){let e=[];if(i.box.not_intersect(t.box))return e;if(i.isZeroLength())return i.ps.on(t)&&e.push(i.ps),e;let n=new o.Line(i.ps,i.pe),r=new o.Circle(t.pc,t.r),a=yt(n,r);for(let s of a)s.on(i)&&s.on(t)&&e.push(s);return e}function $r(i,t){let e=[];for(let n of t.toSegments()){let r=Ft(n,i);for(let a of r)e.push(a)}return e}function On(i,t){let e=[];if(i.box.not_intersect(t.box))return e;let n=new o.Vector(i.pc,t.pc),r=i.r,a=t.r;if(o.Utils.EQ_0(r)||o.Utils.EQ_0(a))return e;if(o.Utils.EQ_0(n.x)&&o.Utils.EQ_0(n.y)&&o.Utils.EQ(r,a))return e.push(i.pc.translate(-r,0)),e;let s=i.pc.distanceTo(t.pc)[0];if(o.Utils.GT(s,r+a)||o.Utils.LT(s,Math.abs(r-a)))return e;n.x/=s,n.y/=s;let l;if(o.Utils.EQ(s,r+a)||o.Utils.EQ(s,Math.abs(r-a)))return l=i.pc.translate(r*n.x,r*n.y),e.push(l),e;let f=r*r/(2*s)-a*a/(2*s)+s/2,d=i.pc.translate(f*n.x,f*n.y),u=Math.sqrt(r*r-f*f);return l=d.translate(n.rotate90CCW().multiply(u)),e.push(l),l=d.translate(n.rotate90CW().multiply(u)),e.push(l),e}function Gr(i,t){let e=[];for(let n of t.toSegments()){let r=ae(n,i);for(let a of r)e.push(a)}return e}function Ge(i,t){var e=[];if(i.box.not_intersect(t.box))return e;if(i.pc.equalTo(t.pc)&&o.Utils.EQ(i.r,t.r)){let s;return s=i.start,s.on(t)&&e.push(s),s=i.end,s.on(t)&&e.push(s),s=t.start,s.on(i)&&e.push(s),s=t.end,s.on(i)&&e.push(s),e}let n=new o.Circle(i.pc,i.r),r=new o.Circle(t.pc,t.r),a=n.intersect(r);for(let s of a)s.on(i)&&s.on(t)&&e.push(s);return e}function We(i,t){let e=[];if(i.box.not_intersect(t.box))return e;if(t.pc.equalTo(i.pc)&&o.Utils.EQ(t.r,i.r))return e.push(i.start),e.push(i.end),e;let n=t,r=new o.Circle(i.pc,i.r),a=On(n,r);for(let s of a)s.on(i)&&e.push(s);return e}function Wr(i,t){let e=[];for(let n of t.toSegments()){let r=at(n,i);for(let a of r)e.push(a)}return e}function Dr(i,t){return i.isSegment()?Ft(i.shape,t):at(t,i.shape)}function jr(i,t){return i.isSegment()?at(i.shape,t):Ge(i.shape,t)}function Nn(i,t){return i.isSegment()?se(i.shape,t):$e(t,i.shape)}function qr(i,t){return i.isSegment()?ae(i.shape,t):We(i.shape,t)}function De(i,t){let e=[];for(let n of t.edges)for(let r of Dr(n,i))e.push(r);return e}function je(i,t){let e=[];for(let n of t.edges)for(let r of jr(n,i))e.push(r);return e}function le(i,t){let e=[];if(t.isEmpty())return e;for(let n of t.edges)for(let r of Nn(n,i))Ln(r,e)||e.push(r);return i.sortPoints(e)}function kn(i,t){let e=[];if(t.isEmpty())return e;for(let n of t.edges)for(let r of qr(n,i))e.push(r);return e}function zr(i,t){let e=i.shape,n=t.shape;return i.isSegment()?t.isSegment()?Ft(e,n):at(e,n):t.isSegment()?at(n,e):Ge(e,n)}function Yr(i,t){let e=[];if(t.isEmpty()||i.shape.box.not_intersect(t.box))return e;let n=t.edges.search(i.shape.box);for(let r of n)for(let a of zr(i,r))e.push(a);return e}function Xr(i,t){let e=[];if(i.isEmpty()||t.isEmpty()||i.box.not_intersect(t.box))return e;for(let n of i.edges)for(let r of Yr(n,t))e.push(r);return e}function Qr(i,t){return i instanceof o.Line?le(i,t):i instanceof o.Segment?De(i,t):i instanceof o.Arc?je(i,t):[]}function Ln(i,t){return t.some(e=>e.equalTo(i))}var U=class extends ie{constructor(...t){super();if(t.length!==0&&t.length==1&&t[0]instanceof Array){let e=t[0];if(e.length==0)return;let n=e.every(r=>r instanceof o.Segment||r instanceof o.Arc||r instanceof o.Ray||r instanceof o.Line);for(let r of e){let a=new o.Edge(r);this.append(a)}}}get edges(){return[...this]}get box(){return this.edges.reduce((t,e)=>t=t.merge(e.box),new o.Box)}get vertices(){let t=this.edges.map(e=>e.start);return t.push(this.last.end),t}clone(){return new U(this.toShapes())}addVertex(t,e){let n=e.shape.split(t);if(n[0]===null)return e.prev;if(n[1]===null)return e;let r=new o.Edge(n[0]),a=e.prev;return this.insert(r,a),e.shape=n[1],r}split(t){for(let e of t){let n=this.findEdgeByPoint(e);this.addVertex(e,n)}return this}findEdgeByPoint(t){let e;for(let n of this)if(n.shape.contains(t)){e=n;break}return e}translate(t){return new U(this.edges.map(e=>e.shape.translate(t)))}rotate(t=0,e=new o.Point){return new U(this.edges.map(n=>n.shape.rotate(t,e)))}transform(t=new o.Matrix){return new U(this.edges.map(e=>e.shape.transform(t)))}toShapes(){return this.edges.map(t=>t.shape.clone())}toJSON(){return this.edges.map(t=>t.toJSON())}svg(t={}){let{stroke:e,strokeWidth:n,fill:r,fillRule:a,fillOpacity:s,id:l,className:f}=t,d=l&&l.length>0?`id="${l}"`:"",u=f&&f.length>0?`class="${f}"`:"",c=`
<path stroke="${e||"black"}" stroke-width="${n||1}" fill="${r||"none"}" fill-opacity="${s||1}" ${d} ${u} d="`;c+=`
M${this.first.start.x},${this.first.start.y}`;for(let _ of this)c+=_.svg();return c+=`" >
</path>`,c}};o.Multiline=U;var Hr=(...i)=>new o.Multiline(...i);o.multiline=Hr;function Nt(i,t){let e,n=new o.Ray(t),r=new o.Line(n.pt,n.norm),a=new o.Box(n.box.xmin-o.DP_TOL,n.box.ymin-o.DP_TOL,n.box.xmax,n.box.ymax+o.DP_TOL);if(i.box.not_intersect(a))return o.OUTSIDE;let s=i.edges.search(a);if(s.length==0)return o.OUTSIDE;for(let d of s)if(d.shape.contains(t))return o.BOUNDARY;let l=[];for(let d of s)for(let u of n.intersect(d.shape)){if(u.equalTo(t))return o.BOUNDARY;l.push({pt:u,edge:d})}l.sort((d,u)=>In(d.pt.x,u.pt.x)?-1:Tn(d.pt.x,u.pt.x)?1:0);let f=0;for(let d=0;d<l.length;d++){let u=l[d];if(u.pt.equalTo(u.edge.shape.start)){if(d>0&&u.pt.equalTo(l[d-1].pt)&&u.edge.prev===l[d-1].edge)continue;let c=u.edge.prev;for(;Ce(c.length);)c=c.prev;let _=c.shape.tangentInEnd(),w=u.pt.translate(_),b=u.edge.shape.tangentInStart(),y=u.pt.translate(b),E=w.leftTo(r),x=y.leftTo(r);(E&&!x||!E&&x)&&f++}else if(u.pt.equalTo(u.edge.shape.end)){if(d>0&&u.pt.equalTo(l[d-1].pt)&&u.edge.next===l[d-1].edge)continue;let c=u.edge.next;for(;Ce(c.length);)c=c.next;let _=c.shape.tangentInStart(),w=u.pt.translate(_),b=u.edge.shape.tangentInEnd(),y=u.pt.translate(b),E=w.leftTo(r),x=y.leftTo(r);(E&&!x||!E&&x)&&f++}else if(u.edge.shape instanceof o.Segment)f++;else{let c=u.edge.shape.box;ot(u.pt.y,c.ymin)||ot(u.pt.y,c.ymax)||f++}}return e=f%2==1?Ct:vn,e}function Jr(i,t){return vt(i,t).equal()}function Rn(i,t){return vt(i,t).intersect()}function Kr(i,t){return vt(i,t).touch()}function Zr(i,t){return!Rn(i,t)}function Bn(i,t){return vt(i,t).inside()}function Mn(i,t){return vt(i,t).covered()}function to(i,t){return Bn(t,i)}function Fn(i,t){return Mn(t,i)}function vt(i,t){if(i instanceof o.Line&&t instanceof o.Line)return eo(i,t);if(i instanceof o.Line&&t instanceof o.Circle)return no(i,t);if(i instanceof o.Line&&t instanceof o.Box)return io(i,t);if(i instanceof o.Line&&t instanceof o.Polygon)return ro(i,t);if((i instanceof o.Segment||i instanceof o.Arc)&&t instanceof o.Polygon)return xn(i,t);if((i instanceof o.Segment||i instanceof o.Arc)&&(t instanceof o.Circle||t instanceof o.Box))return xn(i,new o.Polygon(t));if(i instanceof o.Polygon&&t instanceof o.Polygon)return Jt(i,t);if((i instanceof o.Circle||i instanceof o.Box)&&(t instanceof o.Circle||t instanceof o.Box))return Jt(new o.Polygon(i),new o.Polygon(t));if((i instanceof o.Circle||i instanceof o.Box)&&t instanceof o.Polygon)return Jt(new o.Polygon(i),t);if(i instanceof o.Polygon&&(t instanceof o.Circle||t instanceof o.Box))return Jt(i,new o.Polygon(t))}function eo(i,t){let e=new lt,n=oe(i,t);return n.length===0?i.contains(t.pt)&&t.contains(i.pt)?(e.I2I=[i],e.I2E=[],e.E2I=[]):(e.I2I=[],e.I2E=[i],e.E2I=[t]):(e.I2I=n,e.I2E=i.split(n),e.E2I=t.split(n)),e}function no(i,t){let e=new lt,n=yt(i,t);if(n.length===0)e.I2I=[],e.I2B=[],e.I2E=[i],e.E2I=[t];else if(n.length===1)e.I2I=[],e.I2B=n,e.I2E=i.split(n),e.E2I=[t];else{let r=new U([i]),a=i.sortPoints(n);r.split(a);let s=r.toShapes();e.I2I=[s[1]],e.I2B=a,e.I2E=[s[0],s[2]],e.E2I=new o.Polygon([t.toArc()]).cut(r)}return e}function io(i,t){let e=new lt,n=Lt(i,t);if(n.length===0)e.I2I=[],e.I2B=[],e.I2E=[i],e.E2I=[t];else if(n.length===1)e.I2I=[],e.I2B=n,e.I2E=i.split(n),e.E2I=[t];else{let r=new U([i]),a=i.sortPoints(n);r.split(a);let s=r.toShapes();t.toSegments().some(l=>l.contains(n[0])&&l.contains(n[1]))?(e.I2I=[],e.I2B=[s[1]],e.I2E=[s[0],s[2]],e.E2I=[t]):(e.I2I=[s[1]],e.I2B=a,e.I2E=[s[0],s[2]],e.E2I=new o.Polygon(t.toSegments()).cut(r))}return e}function ro(i,t){let e=new lt,n=le(i,t),r=new U([i]),a=n.length>0?n.slice():i.sortPoints(n);return r.split(a),[...r].forEach(s=>s.setInclusion(t)),e.I2I=[...r].filter(s=>s.bv===o.INSIDE).map(s=>s.shape),e.I2B=[...r].slice(1).map(s=>s.bv===o.BOUNDARY?s.shape:s.shape.start),e.I2E=[...r].filter(s=>s.bv===o.OUTSIDE).map(s=>s.shape),e.E2I=t.cut(r),e}function xn(i,t){let e=new lt,n=Qr(i,t),r=n.length>0?n.slice():i.sortPoints(n),a=new U([i]);a.split(r),[...a].forEach(s=>s.setInclusion(t)),e.I2I=[...a].filter(s=>s.bv===o.INSIDE).map(s=>s.shape),e.I2B=[...a].slice(1).map(s=>s.bv===o.BOUNDARY?s.shape:s.shape.start),e.I2E=[...a].filter(s=>s.bv===o.OUTSIDE).map(s=>s.shape),e.B2I=[],e.B2B=[],e.B2E=[];for(let s of[i.start,i.end])switch(Nt(t,s)){case o.INSIDE:e.B2I.push(s);break;case o.BOUNDARY:e.B2B.push(s);break;case o.OUTSIDE:e.B2E.push(s);break;default:break}return e}function Jt(i,t){let e=new lt,[n,r]=An(i,t),a=Sn(i,t),s=ke(i,t),l=ke(t,i),[f,d]=Pn(i,t),u=Le(i,t),c=Le(t,i);return e.I2I=a.isEmpty()?[]:[a],e.I2B=d,e.I2E=s.isEmpty()?[]:[s],e.B2I=f,e.B2B=n,e.B2E=u,e.E2I=l.isEmpty()?[]:[l],e.E2B=c,e}var oo=Object.freeze({equal:Jr,intersect:Rn,touch:Kr,disjoint:Zr,inside:Bn,covered:Mn,contain:to,cover:Fn,relate:vt}),J=class{constructor(t=1,e=0,n=0,r=1,a=0,s=0){this.a=t,this.b=e,this.c=n,this.d=r,this.tx=a,this.ty=s}clone(){return new J(this.a,this.b,this.c,this.d,this.tx,this.ty)}transform(t){return[t[0]*this.a+t[1]*this.c+this.tx,t[0]*this.b+t[1]*this.d+this.ty]}multiply(t){return new J(this.a*t.a+this.c*t.b,this.b*t.a+this.d*t.b,this.a*t.c+this.c*t.d,this.b*t.c+this.d*t.d,this.a*t.tx+this.c*t.ty+this.tx,this.b*t.tx+this.d*t.ty+this.ty)}translate(...t){let e,n;if(t.length==1&&t[0]instanceof o.Vector)e=t[0].x,n=t[0].y;else if(t.length==2&&typeof t[0]=="number"&&typeof t[1]=="number")e=t[0],n=t[1];else throw o.Errors.ILLEGAL_PARAMETERS;return this.multiply(new J(1,0,0,1,e,n))}rotate(t){let e=Math.cos(t),n=Math.sin(t);return this.multiply(new J(e,n,-n,e,0,0))}scale(t,e){return this.multiply(new J(t,0,0,e,0,0))}equalTo(t){return!(!o.Utils.EQ(this.tx,t.tx)||!o.Utils.EQ(this.ty,t.ty)||!o.Utils.EQ(this.a,t.a)||!o.Utils.EQ(this.b,t.b)||!o.Utils.EQ(this.c,t.c)||!o.Utils.EQ(this.d,t.d))}};o.Matrix=J;var so=(...i)=>new o.Matrix(...i);o.matrix=so;var ao=class Fe{constructor(t,e){this.low=t,this.high=e}clone(){return new Fe(this.low,this.high)}get max(){return this.clone()}less_than(t){return this.low<t.low||this.low==t.low&&this.high<t.high}equal_to(t){return this.low==t.low&&this.high==t.high}intersect(t){return!this.not_intersect(t)}not_intersect(t){return this.high<t.low||t.high<this.low}merge(t){return new Fe(this.low===void 0?t.low:Math.min(this.low,t.low),this.high===void 0?t.high:Math.max(this.high,t.high))}output(){return[this.low,this.high]}static comparable_max(t,e){return t.merge(e)}static comparable_less_than(t,e){return t<e}},R=0,I=1,nt=class{constructor(t=void 0,e=void 0,n=null,r=null,a=null,s=I){this.left=n,this.right=r,this.parent=a,this.color=s,this.item={key:t,value:e},t&&t instanceof Array&&t.length==2&&!Number.isNaN(t[0])&&!Number.isNaN(t[1])&&(this.item.key=new ao(Math.min(t[0],t[1]),Math.max(t[0],t[1]))),this.max=this.item.key?this.item.key.max:void 0}isNil(){return this.item.key===void 0&&this.item.value===void 0&&this.left===null&&this.right===null&&this.color===I}less_than(t){if(this.item.value===this.item.key&&t.item.value===t.item.key)return this.item.key.less_than(t.item.key);{let e=this.item.value&&t.item.value&&this.item.value.less_than?this.item.value.less_than(t.item.value):this.item.value<t.item.value;return this.item.key.less_than(t.item.key)||this.item.key.equal_to(t.item.key)&&e}}equal_to(t){if(this.item.value===this.item.key&&t.item.value===t.item.key)return this.item.key.equal_to(t.item.key);{let e=this.item.value&&t.item.value&&this.item.value.equal_to?this.item.value.equal_to(t.item.value):this.item.value==t.item.value;return this.item.key.equal_to(t.item.key)&&e}}intersect(t){return this.item.key.intersect(t.item.key)}copy_data(t){this.item.key=t.item.key.clone(),this.item.value=t.item.value&&t.item.value.clone?t.item.value.clone():t.item.value}update_max(){if(this.max=this.item.key?this.item.key.max:void 0,this.right&&this.right.max){let t=this.item.key.constructor.comparable_max;this.max=t(this.max,this.right.max)}if(this.left&&this.left.max){let t=this.item.key.constructor.comparable_max;this.max=t(this.max,this.left.max)}}not_intersect_left_subtree(t){let e=this.item.key.constructor.comparable_less_than,n=this.left.max.high!==void 0?this.left.max.high:this.left.max;return e(n,t.item.key.low)}not_intersect_right_subtree(t){let e=this.item.key.constructor.comparable_less_than,n=this.right.max.low!==void 0?this.right.max.low:this.right.item.key.low;return e(t.item.key.high,n)}},bt=class{constructor(){this.root=null,this.nil_node=new nt}get size(){let t=0;return this.tree_walk(this.root,()=>t++),t}get keys(){let t=[];return this.tree_walk(this.root,e=>t.push(e.item.key.output?e.item.key.output():e.item.key)),t}get values(){let t=[];return this.tree_walk(this.root,e=>t.push(e.item.value)),t}get items(){let t=[];return this.tree_walk(this.root,e=>t.push({key:e.item.key.output?e.item.key.output():e.item.key,value:e.item.value})),t}isEmpty(){return this.root==null||this.root==this.nil_node}insert(t,e=t){if(t===void 0)return;let n=new nt(t,e,this.nil_node,this.nil_node,null,R);return this.tree_insert(n),this.recalc_max(n),n}exist(t,e=t){let n=new nt(t,e);return!!this.tree_search(this.root,n)}remove(t,e=t){let n=new nt(t,e),r=this.tree_search(this.root,n);return r&&this.tree_delete(r),r}search(t,e=(n,r)=>n===r?r.output():n){let n=new nt(t),r=[];return this.tree_search_interval(this.root,n,r),r.map(a=>e(a.item.value,a.item.key))}intersect_any(t){let e=new nt(t);return this.tree_find_any_interval(this.root,e)}forEach(t){this.tree_walk(this.root,e=>t(e.item.key,e.item.value))}map(t){let e=new bt;return this.tree_walk(this.root,n=>e.insert(n.item.key,t(n.item.value,n.item.key))),e}recalc_max(t){let e=t;for(;e.parent!=null;)e.parent.update_max(),e=e.parent}tree_insert(t){let e=this.root,n=null;if(this.root==null||this.root==this.nil_node)this.root=t;else{for(;e!=this.nil_node;)n=e,t.less_than(e)?e=e.left:e=e.right;t.parent=n,t.less_than(n)?n.left=t:n.right=t}this.insert_fixup(t)}insert_fixup(t){let e,n;for(e=t;e!=this.root&&e.parent.color==R;)e.parent==e.parent.parent.left?(n=e.parent.parent.right,n.color==R?(e.parent.color=I,n.color=I,e.parent.parent.color=R,e=e.parent.parent):(e==e.parent.right&&(e=e.parent,this.rotate_left(e)),e.parent.color=I,e.parent.parent.color=R,this.rotate_right(e.parent.parent))):(n=e.parent.parent.left,n.color==R?(e.parent.color=I,n.color=I,e.parent.parent.color=R,e=e.parent.parent):(e==e.parent.left&&(e=e.parent,this.rotate_right(e)),e.parent.color=I,e.parent.parent.color=R,this.rotate_left(e.parent.parent)));this.root.color=I}tree_delete(t){let e,n;t.left==this.nil_node||t.right==this.nil_node?e=t:e=this.tree_successor(t),e.left!=this.nil_node?n=e.left:n=e.right,n.parent=e.parent,e==this.root?this.root=n:(e==e.parent.left?e.parent.left=n:e.parent.right=n,e.parent.update_max()),this.recalc_max(n),e!=t&&(t.copy_data(e),t.update_max(),this.recalc_max(t)),e.color==I&&this.delete_fixup(n)}delete_fixup(t){let e=t,n;for(;e!=this.root&&e.parent!=null&&e.color==I;)e==e.parent.left?(n=e.parent.right,n.color==R&&(n.color=I,e.parent.color=R,this.rotate_left(e.parent),n=e.parent.right),n.left.color==I&&n.right.color==I?(n.color=R,e=e.parent):(n.right.color==I&&(n.color=R,n.left.color=I,this.rotate_right(n),n=e.parent.right),n.color=e.parent.color,e.parent.color=I,n.right.color=I,this.rotate_left(e.parent),e=this.root)):(n=e.parent.left,n.color==R&&(n.color=I,e.parent.color=R,this.rotate_right(e.parent),n=e.parent.left),n.left.color==I&&n.right.color==I?(n.color=R,e=e.parent):(n.left.color==I&&(n.color=R,n.right.color=I,this.rotate_left(n),n=e.parent.left),n.color=e.parent.color,e.parent.color=I,n.left.color=I,this.rotate_right(e.parent),e=this.root));e.color=I}tree_search(t,e){if(!(t==null||t==this.nil_node))return e.equal_to(t)?t:e.less_than(t)?this.tree_search(t.left,e):this.tree_search(t.right,e)}tree_search_interval(t,e,n){t!=null&&t!=this.nil_node&&(t.left!=this.nil_node&&!t.not_intersect_left_subtree(e)&&this.tree_search_interval(t.left,e,n),t.intersect(e)&&n.push(t),t.right!=this.nil_node&&!t.not_intersect_right_subtree(e)&&this.tree_search_interval(t.right,e,n))}tree_find_any_interval(t,e){let n=!1;return t!=null&&t!=this.nil_node&&(t.left!=this.nil_node&&!t.not_intersect_left_subtree(e)&&(n=this.tree_find_any_interval(t.left,e)),n||(n=t.intersect(e)),!n&&t.right!=this.nil_node&&!t.not_intersect_right_subtree(e)&&(n=this.tree_find_any_interval(t.right,e))),n}local_minimum(t){let e=t;for(;e.left!=null&&e.left!=this.nil_node;)e=e.left;return e}local_maximum(t){let e=t;for(;e.right!=null&&e.right!=this.nil_node;)e=e.right;return e}tree_successor(t){let e,n,r;if(t.right!=this.nil_node)e=this.local_minimum(t.right);else{for(n=t,r=t.parent;r!=null&&r.right==n;)n=r,r=r.parent;e=r}return e}rotate_left(t){let e=t.right;t.right=e.left,e.left!=this.nil_node&&(e.left.parent=t),e.parent=t.parent,t==this.root?this.root=e:t==t.parent.left?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e,t!=null&&t!=this.nil_node&&t.update_max(),e=t.parent,e!=null&&e!=this.nil_node&&e.update_max()}rotate_right(t){let e=t.left;t.left=e.right,e.right!=this.nil_node&&(e.right.parent=t),e.parent=t.parent,t==this.root?this.root=e:t==t.parent.left?t.parent.left=e:t.parent.right=e,e.right=t,t.parent=e,t!=null&&t!=this.nil_node&&t.update_max(),e=t.parent,e!=null&&e!=this.nil_node&&e.update_max()}tree_walk(t,e){t!=null&&t!=this.nil_node&&(this.tree_walk(t.left,e),e(t),this.tree_walk(t.right,e))}testRedBlackProperty(){let t=!0;return this.tree_walk(this.root,function(e){e.color==R&&(e.left.color==I&&e.right.color==I||(t=!1))}),t}testBlackHeightProperty(t){let e=0,n=0,r=0;if(t.color==I&&e++,t.left!=this.nil_node?n=this.testBlackHeightProperty(t.left):n=1,t.right!=this.nil_node?r=this.testBlackHeightProperty(t.right):r=1,n!=r)throw new Error("Red-black height property violated");return e+=n,e}},Vn=class extends Set{constructor(t){super(t);this.index=new bt,this.forEach(e=>this.index.insert(e))}add(t){let e=this.size;if(super.add(t),this.size>e){let n=this.index.insert(t.box,t)}return this}delete(t){let e=super.delete(t);return e&&this.index.remove(t.box,t),e}clear(){super.clear(),this.index=new bt}search(t){return this.index.search(t)}hit(t){let e=new o.Box(t.x-1,t.y-1,t.x+1,t.y+1);return this.index.search(e).filter(r=>t.on(r))}svg(){return[...this].reduce((e,n)=>e+n.svg(),"")}};o.PlanarSet=Vn;var fe=class{constructor(...t){if(this.x=0,this.y=0,t.length!==0){if(t.length===1&&t[0]instanceof Array&&t[0].length===2){let e=t[0];if(typeof e[0]=="number"&&typeof e[1]=="number"){this.x=e[0],this.y=e[1];return}}if(t.length===1&&t[0]instanceof Object&&t[0].name==="point"){let{x:e,y:n}=t[0];this.x=e,this.y=n;return}if(t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number"){this.x=t[0],this.y=t[1];return}throw o.Errors.ILLEGAL_PARAMETERS}}get box(){return new o.Box(this.x,this.y,this.x,this.y)}clone(){return new o.Point(this.x,this.y)}get vertices(){return[this.clone()]}equalTo(t){return o.Utils.EQ(this.x,t.x)&&o.Utils.EQ(this.y,t.y)}lessThan(t){return!!(o.Utils.LT(this.y,t.y)||o.Utils.EQ(this.y,t.y)&&o.Utils.LT(this.x,t.x))}rotate(t,e={x:0,y:0}){var n=e.x+(this.x-e.x)*Math.cos(t)-(this.y-e.y)*Math.sin(t),r=e.y+(this.x-e.x)*Math.sin(t)+(this.y-e.y)*Math.cos(t);return new o.Point(n,r)}translate(...t){if(t.length==1&&(t[0]instanceof o.Vector||!isNaN(t[0].x)&&!isNaN(t[0].y)))return new o.Point(this.x+t[0].x,this.y+t[0].y);if(t.length==2&&typeof t[0]=="number"&&typeof t[1]=="number")return new o.Point(this.x+t[0],this.y+t[1]);throw o.Errors.ILLEGAL_PARAMETERS}transform(t){return new o.Point(t.transform([this.x,this.y]))}projectionOn(t){if(this.equalTo(t.pt))return this.clone();let e=new o.Vector(this,t.pt);if(o.Utils.EQ_0(e.cross(t.norm)))return t.pt.clone();let n=e.dot(t.norm),r=t.norm.multiply(n);return this.translate(r)}leftTo(t){let e=new o.Vector(t.pt,this);return o.Utils.GT(e.dot(t.norm),0)}distanceTo(t){if(t instanceof fe){let e=t.x-this.x,n=t.y-this.y;return[Math.sqrt(e*e+n*n),new o.Segment(this,t)]}if(t instanceof o.Line)return o.Distance.point2line(this,t);if(t instanceof o.Circle)return o.Distance.point2circle(this,t);if(t instanceof o.Segment)return o.Distance.point2segment(this,t);if(t instanceof o.Arc)return o.Distance.point2arc(this,t);if(t instanceof o.Polygon)return o.Distance.point2polygon(this,t);if(t instanceof o.PlanarSet)return o.Distance.shape2planarSet(this,t)}on(t){if(t instanceof o.Point)return this.equalTo(t);if(t instanceof o.Line)return t.contains(this);if(t instanceof o.Circle)return t.contains(this);if(t instanceof o.Segment)return t.contains(this);if(t instanceof o.Arc)return t.contains(this);if(t instanceof o.Polygon)return t.contains(this)}toJSON(){return Object.assign({},this,{name:"point"})}svg(t={}){let{r:e,stroke:n,strokeWidth:r,fill:a,id:s,className:l}=t,f=s&&s.length>0?`id="${s}"`:"",d=l&&l.length>0?`class="${l}"`:"";return`
<circle cx="${this.x}" cy="${this.y}" r="${e||3}" stroke="${n||"black"}" stroke-width="${r||1}" fill="${a||"red"}" ${f} ${d} />`}};o.Point=fe;var lo=(...i)=>new o.Point(...i);o.point=lo;var Un=class{constructor(...t){if(this.x=0,this.y=0,t.length!==0){if(t.length===1&&t[0]instanceof Array&&t[0].length===2){let e=t[0];if(typeof e[0]=="number"&&typeof e[1]=="number"){this.x=e[0],this.y=e[1];return}}if(t.length===1&&t[0]instanceof Object&&t[0].name==="vector"){let{x:e,y:n}=t[0];this.x=e,this.y=n;return}if(t.length===2){let e=t[0],n=t[1];if(typeof e=="number"&&typeof n=="number"){this.x=e,this.y=n;return}if(e instanceof o.Point&&n instanceof o.Point){this.x=n.x-e.x,this.y=n.y-e.y;return}}throw o.Errors.ILLEGAL_PARAMETERS}}clone(){return new o.Vector(this.x,this.y)}get slope(){let t=Math.atan2(this.y,this.x);return t<0&&(t=2*Math.PI+t),t}get length(){return Math.sqrt(this.dot(this))}equalTo(t){return o.Utils.EQ(this.x,t.x)&&o.Utils.EQ(this.y,t.y)}multiply(t){return new o.Vector(t*this.x,t*this.y)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}normalize(){if(!o.Utils.EQ_0(this.length))return new o.Vector(this.x/this.length,this.y/this.length);throw o.Errors.ZERO_DIVISION}rotate(t){let n=new o.Point(this.x,this.y).rotate(t);return new o.Vector(n.x,n.y)}rotate90CCW(){return new o.Vector(-this.y,this.x)}rotate90CW(){return new o.Vector(this.y,-this.x)}invert(){return new o.Vector(-this.x,-this.y)}add(t){return new o.Vector(this.x+t.x,this.y+t.y)}subtract(t){return new o.Vector(this.x-t.x,this.y-t.y)}angleTo(t){let e=this.normalize(),n=t.normalize(),r=Math.atan2(e.cross(n),e.dot(n));return r<0&&(r+=2*Math.PI),r}projectionOn(t){let e=t.normalize(),n=this.dot(e);return e.multiply(n)}toJSON(){return Object.assign({},this,{name:"vector"})}};o.Vector=Un;var fo=(...i)=>new o.Vector(...i);o.vector=fo;var pt=class{constructor(...t){if(this.ps=new o.Point,this.pe=new o.Point,t.length!==0){if(t.length===1&&t[0]instanceof Array&&t[0].length===4){let e=t[0];this.ps=new o.Point(e[0],e[1]),this.pe=new o.Point(e[2],e[3]);return}if(t.length===1&&t[0]instanceof Object&&t[0].name==="segment"){let{ps:e,pe:n}=t[0];this.ps=new o.Point(e.x,e.y),this.pe=new o.Point(n.x,n.y);return}if(t.length===1&&t[0]instanceof o.Point){this.ps=t[0].clone();return}if(t.length===2&&t[0]instanceof o.Point&&t[1]instanceof o.Point){this.ps=t[0].clone(),this.pe=t[1].clone();return}if(t.length===4){this.ps=new o.Point(t[0],t[1]),this.pe=new o.Point(t[2],t[3]);return}throw o.Errors.ILLEGAL_PARAMETERS}}clone(){return new o.Segment(this.start,this.end)}get start(){return this.ps}get end(){return this.pe}get vertices(){return[this.ps.clone(),this.pe.clone()]}get length(){return this.start.distanceTo(this.end)[0]}get slope(){return new o.Vector(this.start,this.end).slope}get box(){return new o.Box(Math.min(this.start.x,this.end.x),Math.min(this.start.y,this.end.y),Math.max(this.start.x,this.end.x),Math.max(this.start.y,this.end.y))}equalTo(t){return this.ps.equalTo(t.ps)&&this.pe.equalTo(t.pe)}contains(t){return o.Utils.EQ_0(this.distanceToPoint(t))}intersect(t){if(t instanceof o.Point)return this.contains(t)?[t]:[];if(t instanceof o.Line)return se(this,t);if(t instanceof o.Segment)return Ft(this,t);if(t instanceof o.Circle)return ae(this,t);if(t instanceof o.Box)return $r(this,t);if(t instanceof o.Arc)return at(this,t);if(t instanceof o.Polygon)return De(this,t)}distanceTo(t){if(t instanceof o.Point){let[e,n]=o.Distance.point2segment(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Circle){let[e,n]=o.Distance.segment2circle(this,t);return[e,n]}if(t instanceof o.Line){let[e,n]=o.Distance.segment2line(this,t);return[e,n]}if(t instanceof o.Segment){let[e,n]=o.Distance.segment2segment(this,t);return[e,n]}if(t instanceof o.Arc){let[e,n]=o.Distance.segment2arc(this,t);return[e,n]}if(t instanceof o.Polygon){let[e,n]=o.Distance.shape2polygon(this,t);return[e,n]}if(t instanceof o.PlanarSet){let[e,n]=o.Distance.shape2planarSet(this,t);return[e,n]}}tangentInStart(){return new o.Vector(this.start,this.end).normalize()}tangentInEnd(){return new o.Vector(this.end,this.start).normalize()}reverse(){return new pt(this.end,this.start)}split(t){return this.start.equalTo(t)?[null,this.clone()]:this.end.equalTo(t)?[this.clone(),null]:[new o.Segment(this.start,t),new o.Segment(t,this.end)]}middle(){return new o.Point((this.start.x+this.end.x)/2,(this.start.y+this.end.y)/2)}pointAtLength(t){if(t>this.length||t<0)return null;if(t==0)return this.start;if(t==this.length)return this.end;let e=t/this.length;return new o.Point((this.end.x-this.start.x)*e+this.start.x,(this.end.y-this.start.y)*e+this.start.y)}distanceToPoint(t){let[e,...n]=o.Distance.point2segment(t,this);return e}definiteIntegral(t=0){let e=this.end.x-this.start.x,n=this.start.y-t,r=this.end.y-t;return e*(n+r)/2}translate(...t){return new pt(this.ps.translate(...t),this.pe.translate(...t))}rotate(t=0,e=new o.Point){let n=new o.Matrix;return n=n.translate(e.x,e.y).rotate(t).translate(-e.x,-e.y),this.transform(n)}transform(t=new o.Matrix){return new pt(this.ps.transform(t),this.pe.transform(t))}isZeroLength(){return this.ps.equalTo(this.pe)}sortPoints(t){return new o.Line(this.start,this.end).sortPoints(t)}toJSON(){return Object.assign({},this,{name:"segment"})}svg(t={}){let{stroke:e,strokeWidth:n,id:r,className:a}=t,s=r&&r.length>0?`id="${r}"`:"",l=a&&a.length>0?`class="${a}"`:"";return`
<line x1="${this.start.x}" y1="${this.start.y}" x2="${this.end.x}" y2="${this.end.y}" stroke="${e||"black"}" stroke-width="${n||1}" ${s} ${l} />`}};o.Segment=pt;var uo=(...i)=>new o.Segment(...i);o.segment=uo;var{vector:Kt}=o,de=class{constructor(...t){if(this.pt=new o.Point,this.norm=new o.Vector(0,1),t.length!=0){if(t.length==1&&t[0]instanceof Object&&t[0].name==="line"){let{pt:e,norm:n}=t[0];this.pt=new o.Point(e),this.norm=new o.Vector(n);return}if(t.length==2){let e=t[0],n=t[1];if(e instanceof o.Point&&n instanceof o.Point){this.pt=e,this.norm=de.points2norm(e,n),this.norm.dot(Kt(this.pt.x,this.pt.y))>=0&&this.norm.invert();return}if(e instanceof o.Point&&n instanceof o.Vector){if(o.Utils.EQ_0(n.x)&&o.Utils.EQ_0(n.y))throw o.Errors.ILLEGAL_PARAMETERS;this.pt=e.clone(),this.norm=n.clone(),this.norm=this.norm.normalize(),this.norm.dot(Kt(this.pt.x,this.pt.y))>=0&&this.norm.invert();return}if(e instanceof o.Vector&&n instanceof o.Point){if(o.Utils.EQ_0(e.x)&&o.Utils.EQ_0(e.y))throw o.Errors.ILLEGAL_PARAMETERS;this.pt=n.clone(),this.norm=e.clone(),this.norm=this.norm.normalize(),this.norm.dot(Kt(this.pt.x,this.pt.y))>=0&&this.norm.invert();return}}throw o.Errors.ILLEGAL_PARAMETERS}}clone(){return new o.Line(this.pt,this.norm)}get start(){}get end(){}get length(){return Number.POSITIVE_INFINITY}get box(){return new o.Box(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY)}get middle(){}get slope(){return new o.Vector(this.norm.y,-this.norm.x).slope}get standard(){let t=this.norm.x,e=this.norm.y,n=this.norm.dot(this.pt);return[t,e,n]}parallelTo(t){return o.Utils.EQ_0(this.norm.cross(t.norm))}incidentTo(t){return this.parallelTo(t)&&this.pt.on(t)}contains(t){if(this.pt.equalTo(t))return!0;let e=new o.Vector(this.pt,t);return o.Utils.EQ_0(this.norm.dot(e))}coord(t){return Kt(t.x,t.y).cross(this.norm)}intersect(t){if(t instanceof o.Point)return this.contains(t)?[t]:[];if(t instanceof o.Line)return oe(this,t);if(t instanceof o.Circle)return yt(this,t);if(t instanceof o.Box)return Lt(this,t);if(t instanceof o.Segment)return se(t,this);if(t instanceof o.Arc)return $e(this,t);if(t instanceof o.Polygon)return le(this,t)}distanceTo(t){if(t instanceof o.Point){let[e,n]=o.Distance.point2line(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Circle){let[e,n]=o.Distance.circle2line(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Segment){let[e,n]=o.Distance.segment2line(t,this);return[e,n.reverse()]}if(t instanceof o.Arc){let[e,n]=o.Distance.arc2line(t,this);return[e,n.reverse()]}if(t instanceof o.Polygon){let[e,n]=o.Distance.shape2polygon(this,t);return[e,n]}}split(t){if(t instanceof o.Point)return[new o.Ray(t,this.norm.invert()),new o.Ray(t,this.norm)];{let e=new o.Multiline([this]),n=this.sortPoints(t);return e.split(n),e.toShapes()}}sortPoints(t){return t.slice().sort((e,n)=>this.coord(e)<this.coord(n)?-1:this.coord(e)>this.coord(n)?1:0)}toJSON(){return Object.assign({},this,{name:"line"})}svg(t,e={}){let n=Lt(this,t);if(n.length===0)return"";let r=n[0],a=n.length==2?n[1]:n.find(l=>!l.equalTo(r));return a===void 0&&(a=r),new o.Segment(r,a).svg(e)}static points2norm(t,e){if(t.equalTo(e))throw o.Errors.ILLEGAL_PARAMETERS;return new o.Vector(t,e).normalize().rotate90CCW()}};o.Line=de;var co=(...i)=>new o.Line(...i);o.line=co;var $n=class{constructor(...t){if(this.pc=new o.Point,this.r=1,t.length==1&&t[0]instanceof Object&&t[0].name==="circle"){let{pc:e,r:n}=t[0];this.pc=new o.Point(e),this.r=n;return}else{let[e,n]=[...t];e&&e instanceof o.Point&&(this.pc=e.clone()),n!==void 0&&(this.r=n);return}throw o.Errors.ILLEGAL_PARAMETERS}clone(){return new o.Circle(this.pc.clone(),this.r)}get center(){return this.pc}get box(){return new o.Box(this.pc.x-this.r,this.pc.y-this.r,this.pc.x+this.r,this.pc.y+this.r)}contains(t){if(t instanceof o.Point)return o.Utils.LE(t.distanceTo(this.center)[0],this.r);if(t instanceof o.Segment)return o.Utils.LE(t.start.distanceTo(this.center)[0],this.r)&&o.Utils.LE(t.end.distanceTo(this.center)[0],this.r);if(t instanceof o.Arc)return this.intersect(t).length===0&&o.Utils.LE(t.start.distanceTo(this.center)[0],this.r)&&o.Utils.LE(t.end.distanceTo(this.center)[0],this.r);if(t instanceof o.Circle)return this.intersect(t).length===0&&o.Utils.LE(t.r,this.r)&&o.Utils.LE(t.center.distanceTo(this.center)[0],this.r)}toArc(t=!0){return new o.Arc(this.center,this.r,Math.PI,-Math.PI,t)}intersect(t){if(t instanceof o.Point)return this.contains(t)?[t]:[];if(t instanceof o.Line)return yt(t,this);if(t instanceof o.Segment)return ae(t,this);if(t instanceof o.Circle)return On(t,this);if(t instanceof o.Box)return Gr(this,t);if(t instanceof o.Arc)return We(t,this);if(t instanceof o.Polygon)return kn(this,t)}distanceTo(t){if(t instanceof o.Point){let[e,n]=o.Distance.point2circle(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Circle){let[e,n]=o.Distance.circle2circle(this,t);return[e,n]}if(t instanceof o.Line){let[e,n]=o.Distance.circle2line(this,t);return[e,n]}if(t instanceof o.Segment){let[e,n]=o.Distance.segment2circle(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Arc){let[e,n]=o.Distance.arc2circle(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Polygon){let[e,n]=o.Distance.shape2polygon(this,t);return[e,n]}if(t instanceof o.PlanarSet){let[e,n]=o.Distance.shape2planarSet(this,t);return[e,n]}}toJSON(){return Object.assign({},this,{name:"circle"})}svg(t={}){let{stroke:e,strokeWidth:n,fill:r,fillOpacity:a,id:s,className:l}=t,f=s&&s.length>0?`id="${s}"`:"",d=l&&l.length>0?`class="${l}"`:"";return`
<circle cx="${this.pc.x}" cy="${this.pc.y}" r="${this.r}" stroke="${e||"black"}" stroke-width="${n||1}" fill="${r||"none"}" fill-opacity="${a||1}" ${f} ${d} />`}};o.Circle=$n;var ho=(...i)=>new o.Circle(...i);o.circle=ho;var Gn=class{constructor(...t){if(this.pc=new o.Point,this.r=1,this.startAngle=0,this.endAngle=2*Math.PI,this.counterClockwise=o.CCW,t.length!=0){if(t.length==1&&t[0]instanceof Object&&t[0].name==="arc"){let{pc:e,r:n,startAngle:r,endAngle:a,counterClockwise:s}=t[0];this.pc=new o.Point(e.x,e.y),this.r=n,this.startAngle=r,this.endAngle=a,this.counterClockwise=s;return}else{let[e,n,r,a,s]=[...t];e&&e instanceof o.Point&&(this.pc=e.clone()),n!==void 0&&(this.r=n),r!==void 0&&(this.startAngle=r),a!==void 0&&(this.endAngle=a),s!==void 0&&(this.counterClockwise=s);return}throw o.Errors.ILLEGAL_PARAMETERS}}clone(){return new o.Arc(this.pc.clone(),this.r,this.startAngle,this.endAngle,this.counterClockwise)}get sweep(){if(o.Utils.EQ(this.startAngle,this.endAngle))return 0;if(o.Utils.EQ(Math.abs(this.startAngle-this.endAngle),o.PIx2))return o.PIx2;let t;return this.counterClockwise?t=o.Utils.GT(this.endAngle,this.startAngle)?this.endAngle-this.startAngle:this.endAngle-this.startAngle+o.PIx2:t=o.Utils.GT(this.startAngle,this.endAngle)?this.startAngle-this.endAngle:this.startAngle-this.endAngle+o.PIx2,o.Utils.GT(t,o.PIx2)&&(t-=o.PIx2),o.Utils.LT(t,0)&&(t+=o.PIx2),t}get start(){return new o.Point(this.pc.x+this.r,this.pc.y).rotate(this.startAngle,this.pc)}get end(){return new o.Point(this.pc.x+this.r,this.pc.y).rotate(this.endAngle,this.pc)}get center(){return this.pc.clone()}get vertices(){return[this.start.clone(),this.end.clone()]}get length(){return Math.abs(this.sweep*this.r)}get box(){let e=this.breakToFunctional().reduce((n,r)=>n.merge(r.start.box),new o.Box);return e=e.merge(this.end.box),e}contains(t){if(!o.Utils.EQ(this.pc.distanceTo(t)[0],this.r))return!1;if(t.equalTo(this.start))return!0;let e=new o.Vector(this.pc,t).slope,n=new o.Arc(this.pc,this.r,this.startAngle,e,this.counterClockwise);return o.Utils.LE(n.length,this.length)}split(t){if(this.start.equalTo(t))return[null,this.clone()];if(this.end.equalTo(t))return[this.clone(),null];let e=new o.Vector(this.pc,t).slope;return[new o.Arc(this.pc,this.r,this.startAngle,e,this.counterClockwise),new o.Arc(this.pc,this.r,e,this.endAngle,this.counterClockwise)]}middle(){let t=this.counterClockwise?this.startAngle+this.sweep/2:this.startAngle-this.sweep/2;return new o.Arc(this.pc,this.r,this.startAngle,t,this.counterClockwise).end}pointAtLength(t){if(t>this.length||t<0)return null;if(t==0)return this.start;if(t==this.length)return this.end;let e=t/this.length,n=this.counterClockwise?this.startAngle+this.sweep*e:this.startAngle-this.sweep*e;return new o.Arc(this.pc,this.r,this.startAngle,n,this.counterClockwise).end}chordHeight(){return(1-Math.cos(Math.abs(this.sweep/2)))*this.r}intersect(t){if(t instanceof o.Point)return this.contains(t)?[t]:[];if(t instanceof o.Line)return $e(t,this);if(t instanceof o.Circle)return We(this,t);if(t instanceof o.Segment)return at(t,this);if(t instanceof o.Box)return Wr(this,t);if(t instanceof o.Arc)return Ge(this,t);if(t instanceof o.Polygon)return je(this,t)}distanceTo(t){if(t instanceof o.Point){let[e,n]=o.Distance.point2arc(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Circle){let[e,n]=o.Distance.arc2circle(this,t);return[e,n]}if(t instanceof o.Line){let[e,n]=o.Distance.arc2line(this,t);return[e,n]}if(t instanceof o.Segment){let[e,n]=o.Distance.segment2arc(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Arc){let[e,n]=o.Distance.arc2arc(this,t);return[e,n]}if(t instanceof o.Polygon){let[e,n]=o.Distance.shape2polygon(this,t);return[e,n]}if(t instanceof o.PlanarSet){let[e,n]=o.Distance.shape2planarSet(this,t);return[e,n]}}breakToFunctional(){let t=[],e=[0,Math.PI/2,2*Math.PI/2,3*Math.PI/2],n=[this.pc.translate(this.r,0),this.pc.translate(0,this.r),this.pc.translate(-this.r,0),this.pc.translate(0,-this.r)],r=[];for(let a=0;a<4;a++)n[a].on(this)&&r.push(new o.Arc(this.pc,this.r,this.startAngle,e[a],this.counterClockwise));if(r.length==0)t.push(this.clone());else{r.sort((l,f)=>l.length-f.length);for(let l=0;l<r.length;l++){let f=t.length>0?t[t.length-1]:void 0,d;f?d=new o.Arc(this.pc,this.r,f.endAngle,r[l].endAngle,this.counterClockwise):d=new o.Arc(this.pc,this.r,this.startAngle,r[l].endAngle,this.counterClockwise),o.Utils.EQ_0(d.length)||t.push(d.clone())}let a=t.length>0?t[t.length-1]:void 0,s;a?s=new o.Arc(this.pc,this.r,a.endAngle,this.endAngle,this.counterClockwise):s=new o.Arc(this.pc,this.r,this.startAngle,this.endAngle,this.counterClockwise),!o.Utils.EQ_0(s.length)&&!o.Utils.EQ(s.sweep,2*Math.PI)&&t.push(s.clone())}return t}tangentInStart(){let t=new o.Vector(this.pc,this.start),e=this.counterClockwise?Math.PI/2:-Math.PI/2;return t.rotate(e).normalize()}tangentInEnd(){let t=new o.Vector(this.pc,this.end),e=this.counterClockwise?-Math.PI/2:Math.PI/2;return t.rotate(e).normalize()}reverse(){return new o.Arc(this.pc,this.r,this.endAngle,this.startAngle,!this.counterClockwise)}translate(...t){let e=this.clone();return e.pc=this.pc.translate(...t),e}rotate(t=0,e=new o.Point){let n=new o.Matrix;return n=n.translate(e.x,e.y).rotate(t).translate(-e.x,-e.y),this.transform(n)}scale(t=1,e=1){let n=new o.Matrix;return n=n.scale(t,e),this.transform(n)}transform(t=new o.Matrix){let e=this.start.transform(t),n=this.end.transform(t),r=this.pc.transform(t),a=this.counterClockwise;return t.a*t.d<0&&(a=!a),o.Arc.arcSE(r,e,n,a)}static arcSE(t,e,n,r){let{vector:a}=o,s=a(t,e).slope,l=a(t,n).slope;o.Utils.EQ(s,l)&&(l+=2*Math.PI,r=!0);let f=a(t,e).length;return new o.Arc(t,f,s,l,r)}definiteIntegral(t=0){return this.breakToFunctional().reduce((r,a)=>r+a.circularSegmentDefiniteIntegral(t),0)}circularSegmentDefiniteIntegral(t){let e=new o.Line(this.start,this.end),n=this.pc.leftTo(e),a=new o.Segment(this.start,this.end).definiteIntegral(t),s=this.circularSegmentArea();return n?a-s:a+s}circularSegmentArea(){return .5*this.r*this.r*(this.sweep-Math.sin(this.sweep))}sortPoints(t){let{vector:e}=o;return t.slice().sort((n,r)=>{let a=e(this.pc,n).slope,s=e(this.pc,r).slope;return a<s?-1:a>s?1:0})}toJSON(){return Object.assign({},this,{name:"arc"})}svg(t={}){let e=this.sweep<=Math.PI?"0":"1",n=this.counterClockwise?"1":"0",{stroke:r,strokeWidth:a,fill:s,id:l,className:f}=t,d=l&&l.length>0?`id="${l}"`:"",u=f&&f.length>0?`class="${f}"`:"";return o.Utils.EQ(this.sweep,2*Math.PI)?new o.Circle(this.pc,this.r).svg(t):`
<path d="M${this.start.x},${this.start.y}
                             A${this.r},${this.r} 0 ${e},${n} ${this.end.x},${this.end.y}"
                    stroke="${r||"black"}" stroke-width="${a||1}" fill="${s||"none"}" ${d} ${u} />`}};o.Arc=Gn;var po=(...i)=>new o.Arc(...i);o.arc=po;var Rt=class{constructor(t=void 0,e=void 0,n=void 0,r=void 0){this.xmin=t,this.ymin=e,this.xmax=n,this.ymax=r}clone(){return new Rt(this.xmin,this.ymin,this.xmax,this.ymax)}get low(){return new o.Point(this.xmin,this.ymin)}get high(){return new o.Point(this.xmax,this.ymax)}get max(){return this.clone()}get center(){return new o.Point((this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)}get width(){return Math.abs(this.xmax-this.xmin)}get height(){return Math.abs(this.ymax-this.ymin)}get box(){return this.clone()}not_intersect(t){return this.xmax<t.xmin||this.xmin>t.xmax||this.ymax<t.ymin||this.ymin>t.ymax}intersect(t){return!this.not_intersect(t)}merge(t){return new Rt(this.xmin===void 0?t.xmin:Math.min(this.xmin,t.xmin),this.ymin===void 0?t.ymin:Math.min(this.ymin,t.ymin),this.xmax===void 0?t.xmax:Math.max(this.xmax,t.xmax),this.ymax===void 0?t.ymax:Math.max(this.ymax,t.ymax))}less_than(t){return!!(this.low.lessThan(t.low)||this.low.equalTo(t.low)&&this.high.lessThan(t.high))}equal_to(t){return this.low.equalTo(t.low)&&this.high.equalTo(t.high)}output(){return this.clone()}static comparable_max(t,e){return t.merge(e)}static comparable_less_than(t,e){return t.lessThan(e)}set(t,e,n,r){this.xmin=t,this.ymin=e,this.xmax=n,this.ymax=r}toPoints(){return[new o.Point(this.xmin,this.ymin),new o.Point(this.xmax,this.ymin),new o.Point(this.xmax,this.ymax),new o.Point(this.xmin,this.ymax)]}toSegments(){let t=this.toPoints();return[new o.Segment(t[0],t[1]),new o.Segment(t[1],t[2]),new o.Segment(t[2],t[3]),new o.Segment(t[3],t[0])]}svg(t={}){let{stroke:e,strokeWidth:n,fill:r,id:a,className:s}=t,l=a&&a.length>0?`id="${a}"`:"",f=s&&s.length>0?`class="${s}"`:"",d=this.xmax-this.xmin,u=this.ymax-this.ymin;return`
<rect x="${this.xmin}" y="${this.ymin}" width=${d} height=${u} stroke="${e||"black"}" stroke-width="${n||1}" fill="${r||"none"}" ${l} ${f} />`}};o.Box=Rt;var mo=(...i)=>new o.Box(...i);o.box=mo;var Wn=class{constructor(t){this.shape=t,this.next=void 0,this.prev=void 0,this.face=void 0,this.arc_length=0,this.bvStart=void 0,this.bvEnd=void 0,this.bv=void 0,this.overlap=void 0}get start(){return this.shape.start}get end(){return this.shape.end}get length(){return this.shape.length}get box(){return this.shape.box}isSegment(){return this.shape instanceof o.Segment}isArc(){return this.shape instanceof o.Arc}middle(){return this.shape.middle()}pointAtLength(t){return this.shape.pointAtLength(t)}contains(t){return this.shape.contains(t)}setInclusion(t){if(this.bv!==void 0)return this.bv;if(this.shape instanceof o.Line||this.shape instanceof o.Ray)return this.bv=o.OUTSIDE,this.bv;if(this.bvStart===void 0&&(this.bvStart=Nt(t,this.start)),this.bvEnd===void 0&&(this.bvEnd=Nt(t,this.end)),this.bvStart===o.OUTSIDE||this.bvEnd==o.OUTSIDE)this.bv=o.OUTSIDE;else if(this.bvStart===o.INSIDE||this.bvEnd==o.INSIDE)this.bv=o.INSIDE;else{let e=Nt(t,this.middle());this.bv=e}return this.bv}setOverlap(t){let e,n=this.shape,r=t.shape;n instanceof o.Segment&&r instanceof o.Segment?n.start.equalTo(r.start)&&n.end.equalTo(r.end)?e=o.OVERLAP_SAME:n.start.equalTo(r.end)&&n.end.equalTo(r.start)&&(e=o.OVERLAP_OPPOSITE):(n instanceof o.Arc&&r instanceof o.Arc||n instanceof o.Segment&&r instanceof o.Arc||n instanceof o.Arc&&r instanceof o.Segment)&&(n.start.equalTo(r.start)&&n.end.equalTo(r.end)&&n.middle().equalTo(r.middle())?e=o.OVERLAP_SAME:n.start.equalTo(r.end)&&n.end.equalTo(r.start)&&n.middle().equalTo(r.middle())&&(e=o.OVERLAP_OPPOSITE)),this.overlap===void 0&&(this.overlap=e),t.overlap===void 0&&(t.overlap=e)}svg(){if(this.shape instanceof o.Segment)return` L${this.shape.end.x},${this.shape.end.y}`;if(this.shape instanceof o.Arc){let t=this.shape,e,n=t.counterClockwise?"1":"0";if(o.Utils.EQ(t.sweep,2*Math.PI)){let r=t.counterClockwise?1:-1,a=new o.Arc(t.pc,t.r,t.startAngle,t.startAngle+r*Math.PI,t.counterClockwise),s=new o.Arc(t.pc,t.r,t.startAngle+r*Math.PI,t.endAngle,t.counterClockwise);return e="0",` A${a.r},${a.r} 0 ${e},${n} ${a.end.x},${a.end.y}
                    A${s.r},${s.r} 0 ${e},${n} ${s.end.x},${s.end.y}`}else return e=t.sweep<=Math.PI?"0":"1",` A${t.r},${t.r} 0 ${e},${n} ${t.end.x},${t.end.y}`}}toJSON(){return this.shape.toJSON()}};o.Edge=Wn;var Dn=class extends ie{constructor(t,e){super(t,e);this.setCircularLinks()}setCircularLinks(){this.isEmpty()||(this.last.next=this.first,this.first.prev=this.last)}[Symbol.iterator](){let t;return{next:()=>{let e=t||this.first,n=this.first?t?t===this.first:!1:!0;return t=e?e.next:void 0,{value:e,done:n}}}}append(t){return super.append(t),this.setCircularLinks(),this}insert(t,e){return super.insert(t,e),this.setCircularLinks(),this}remove(t){return super.remove(t),this}},it=class extends Dn{constructor(t,...e){super();if(this._box=void 0,this._orientation=void 0,e.length!=0){if(e.length==1){if(e[0]instanceof Array){let n=e[0];if(n.length==0)return;if(n.every(r=>r instanceof o.Point)){let r=it.points2segments(n);this.shapes2face(t.edges,r)}else if(n.every(r=>r instanceof Array&&r.length===2)){let r=n.map(s=>new o.Point(s[0],s[1])),a=it.points2segments(r);this.shapes2face(t.edges,a)}else if(n.every(r=>r instanceof o.Segment||r instanceof o.Arc))this.shapes2face(t.edges,n);else if(n.every(r=>r.name==="segment"||r.name==="arc")){let r=[];for(let a of n){let s;a.name==="segment"?s=new o.Segment(a):s=new o.Arc(a),r.push(s)}this.shapes2face(t.edges,r)}}else if(e[0]instanceof it){let n=e[0];this.first=n.first,this.last=n.last;for(let r of n)t.edges.add(r)}else if(e[0]instanceof o.Circle)this.shapes2face(t.edges,[e[0].toArc(o.CCW)]);else if(e[0]instanceof o.Box){let n=e[0];this.shapes2face(t.edges,[new o.Segment(new o.Point(n.xmin,n.ymin),new o.Point(n.xmax,n.ymin)),new o.Segment(new o.Point(n.xmax,n.ymin),new o.Point(n.xmax,n.ymax)),new o.Segment(new o.Point(n.xmax,n.ymax),new o.Point(n.xmin,n.ymax)),new o.Segment(new o.Point(n.xmin,n.ymax),new o.Point(n.xmin,n.ymin))])}}e.length==2&&e[0]instanceof o.Edge&&e[1]instanceof o.Edge&&(this.first=e[0],this.last=e[1],this.last.next=this.first,this.first.prev=this.last,this.setArcLength())}}get edges(){return this.toArray()}get shapes(){return this.edges.map(t=>t.shape.clone())}get box(){if(this._box===void 0){let t=new o.Box;for(let e of this)t=t.merge(e.box);this._box=t}return this._box}get perimeter(){return this.last.arc_length+this.last.length}pointAtLength(t){if(t>this.perimeter||t<0)return null;let e=null;for(let n of this)if(t>=n.arc_length&&(n===this.last||t<n.next.arc_length)){e=n.pointAtLength(t-n.arc_length);break}return e}static points2segments(t){let e=[];for(let n=0;n<t.length;n++)t[n].equalTo(t[(n+1)%t.length])||e.push(new o.Segment(t[n],t[(n+1)%t.length]));return e}shapes2face(t,e){for(let n of e){let r=new o.Edge(n);this.append(r),t.add(r)}}append(t){return super.append(t),this.setOneEdgeArcLength(t),t.face=this,this}insert(t,e){return super.insert(t,e),this.setOneEdgeArcLength(t),t.face=this,this}remove(t){return super.remove(t),this.setArcLength(),this}reverse(){let t=[],e=this.last;do e.shape=e.shape.reverse(),t.push(e),e=e.prev;while(e!==this.last);this.first=void 0,this.last=void 0;for(let n of t)this.first===void 0?(n.prev=n,n.next=n,this.first=n,this.last=n):(n.prev=this.last,this.last.next=n,this.last=n,this.last.next=this.first,this.first.prev=this.last),this.setOneEdgeArcLength(n);this._orientation!==void 0&&(this._orientation=void 0,this._orientation=this.orientation())}setArcLength(){for(let t of this)this.setOneEdgeArcLength(t),t.face=this}setOneEdgeArcLength(t){t===this.first?t.arc_length=0:t.arc_length=t.prev.arc_length+t.prev.length}area(){return Math.abs(this.signedArea())}signedArea(){let t=0,e=this.box.ymin;for(let n of this)t+=n.shape.definiteIntegral(e);return t}orientation(){if(this._orientation===void 0){let t=this.signedArea();o.Utils.EQ_0(t)?this._orientation=o.ORIENTATION.NOT_ORIENTABLE:o.Utils.LT(t,0)?this._orientation=o.ORIENTATION.CCW:this._orientation=o.ORIENTATION.CW}return this._orientation}isSimple(t){return it.getSelfIntersections(this,t,!0).length==0}static getSelfIntersections(t,e,n=!1){let r=[];for(let a of t){let s=e.search(a.box);for(let l of s){if(a===l||l.face!==t||a.shape instanceof o.Segment&&l.shape instanceof o.Segment&&(a.next===l||a.prev===l))continue;let f=a.shape.intersect(l.shape);for(let d of f)if(!(d.equalTo(a.start)&&d.equalTo(l.end)&&l===a.prev)&&!(d.equalTo(a.end)&&d.equalTo(l.start)&&l===a.next)&&(r.push(d),n))break;if(r.length>0&&n)break}if(r.length>0&&n)break}return r}findEdgeByPoint(t){let e;for(let n of this)if(n.shape.contains(t)){e=n;break}return e}toPolygon(){return new o.Polygon(this.shapes)}toJSON(){return this.edges.map(t=>t.toJSON())}svg(){let t=`
M${this.first.start.x},${this.first.start.y}`;for(let e of this)t+=e.svg();return t+=" z",t}};o.Face=it;var ue=class{constructor(...t){if(this.pt=new o.Point,this.norm=new o.Vector(0,1),t.length!=0&&(t.length>=1&&t[0]instanceof o.Point&&(this.pt=t[0].clone()),t.length!==1)){if(t.length===2&&t[1]instanceof o.Vector){this.norm=t[1].clone();return}throw o.Errors.ILLEGAL_PARAMETERS}}clone(){return new ue(this.pt,this.norm)}get slope(){return new o.Vector(this.norm.y,-this.norm.x).slope}get box(){let t=this.slope;return new o.Box(t>Math.PI/2&&t<3*Math.PI/2?Number.NEGATIVE_INFINITY:this.pt.x,t>=0&&t<=Math.PI?this.pt.y:Number.NEGATIVE_INFINITY,t>=Math.PI/2&&t<=3*Math.PI/2?this.pt.x:Number.POSITIVE_INFINITY,t>=Math.PI&&t<=2*Math.PI||t==0?this.pt.y:Number.POSITIVE_INFINITY)}get start(){return this.pt}get end(){}get length(){return Number.POSITIVE_INFINITY}contains(t){if(this.pt.equalTo(t))return!0;let e=new o.Vector(this.pt,t);return o.Utils.EQ_0(this.norm.dot(e))&&o.Utils.GE(e.cross(this.norm),0)}split(t){return this.contains(t)?this.pt.equalTo(t)?[this]:[new o.Segment(this.pt,t),new o.Ray(t,this.norm)]:[]}intersect(t){if(t instanceof o.Segment)return this.intersectRay2Segment(this,t);if(t instanceof o.Arc)return this.intersectRay2Arc(this,t)}intersectRay2Segment(t,e){let n=[],r=new o.Line(t.start,t.norm),a=r.intersect(e);for(let s of a)t.contains(s)&&n.push(s);return a.length==2&&n.length==1&&t.start.on(r)&&n.push(t.start),n}intersectRay2Arc(t,e){let n=[],a=new o.Line(t.start,t.norm).intersect(e);for(let s of a)t.contains(s)&&n.push(s);return n}svg(t,e={}){let n=new o.Line(this.pt,this.norm),r=Lt(n,t);return r=r.filter(s=>this.contains(s)),r.length===0||r.length===2?"":new o.Segment(this.pt,r[0]).svg(e)}};o.Ray=ue;var go=(...i)=>new o.Ray(...i);o.ray=go;var rt=class{constructor(){this.faces=new o.PlanarSet,this.edges=new o.PlanarSet;let t=[...arguments];if(t.length===1&&(t[0]instanceof Array&&t[0].length>0||t[0]instanceof o.Circle||t[0]instanceof o.Box)){let e=t[0];if(t[0]instanceof Array&&t[0].every(n=>n instanceof Array))if(e.every(n=>n instanceof Array&&n.length===2&&typeof n[0]=="number"&&typeof n[1]=="number"))this.faces.add(new o.Face(this,e));else for(let n of e)if(n instanceof Array&&n[0]instanceof Array&&n[0].every(r=>r instanceof Array&&r.length===2&&typeof r[0]=="number"&&typeof r[1]=="number"))for(let r of n)this.faces.add(new o.Face(this,r));else this.faces.add(new o.Face(this,n));else this.faces.add(new o.Face(this,e))}}get box(){return[...this.faces].reduce((t,e)=>t.merge(e.box),new o.Box)}get vertices(){return[...this.edges].map(t=>t.start)}clone(){let t=new rt;for(let e of this.faces)t.addFace(e.shapes);return t}isEmpty(){return this.edges.size===0}isValid(){let t=!0;for(let e of this.faces)if(!e.isSimple(this.edges)){t=!1;break}return t}area(){let t=[...this.faces].reduce((e,n)=>e+n.signedArea(),0);return Math.abs(t)}addFace(...t){let e=new o.Face(this,...t);return this.faces.add(e),e}deleteFace(t){for(let e of t)this.edges.delete(e);return this.faces.delete(t)}recreateFaces(){this.faces.clear();for(let n of this.edges)n.face=null;let t,e=!0;for(;e;){e=!1;for(let n of this.edges)if(n.face===null){t=n,e=!0;break}if(e){let n=t;do n=n.next;while(n.next!==t);this.addFace(t,n)}}}removeChain(t,e,n){if(n.next===e){this.deleteFace(t);return}for(let r=e;r!==n.next;r=r.next)if(t.remove(r),this.edges.delete(r),t.isEmpty()){this.deleteFace(t);break}}addVertex(t,e){let n=e.shape.split(t);if(n[0]===null)return e.prev;if(n[1]===null)return e;let r=new o.Edge(n[0]),a=e.prev;return e.face.insert(r,a),this.edges.delete(e),this.edges.add(r),e.shape=n[1],this.edges.add(e),r}cut(t){let e=[this.clone()];for(let n of t){if(n.setInclusion(this)!==Ct)continue;let r=n.shape.start,a=n.shape.end,s=[];for(let l of e)if(l.findEdgeByPoint(r)===void 0)s.push(l);else{let[f,d]=l.cutFace(r,a);s.push(f,d)}e=s}return e}cutFace(t,e){let n=this.findEdgeByPoint(t),r=this.findEdgeByPoint(e);if(n.face!==r.face)return[];let a=this.addVertex(t,n);r=this.findEdgeByPoint(e);let s=this.addVertex(e,r),l=a.face,f=new o.Edge(new o.Segment(a.end,s.end)),d=new o.Edge(new o.Segment(s.end,a.end));a.next.prev=d,d.next=a.next,a.next=f,f.prev=a,s.next.prev=f,f.next=s.next,s.next=d,d.prev=s,this.edges.add(f),this.edges.add(d);let u=this.addFace(f,a),c=this.addFace(d,s);return this.faces.delete(l),[u.toPolygon(),c.toPolygon()]}cutWithLine(t){let e=this.clone(),n=new U([t]),r={int_points1:[],int_points2:[],int_points1_sorted:[],int_points2_sorted:[]};for(let l of e.edges){let f=Nn(l,t);for(let d of f)gt(n.first,d,r.int_points1),gt(l,d,r.int_points2)}if(r.int_points1.length===0)return e;r.int_points1_sorted=Se(t,r.int_points1),r.int_points2_sorted=Ot(r.int_points2),xt(n,r.int_points1_sorted),xt(e,r.int_points2_sorted),Ue(r),r.int_points1_sorted=Se(t,r.int_points1),r.int_points2_sorted=Ot(r.int_points2),Oe(r.int_points1),Ne(r.int_points1,e);for(let l of r.int_points1_sorted)l.edge_before.bv===l.edge_after.bv&&(r.int_points2[l.id]=-1,l.id=-1);if(r.int_points1=r.int_points1.filter(l=>l.id>=0),r.int_points2=r.int_points2.filter(l=>l.id>=0),r.int_points1.length===0)return e;r.int_points1_sorted=Se(t,r.int_points1),r.int_points2_sorted=Ot(r.int_points2);let a=r.int_points1[0],s;for(let l of r.int_points1_sorted)l.edge_before.bv===Ct&&(s=new o.Edge(new o.Segment(a.pt,l.pt)),cn(r.int_points2[a.id],r.int_points2[l.id],s),e.edges.add(s),s=new o.Edge(new o.Segment(l.pt,a.pt)),cn(r.int_points2[l.id],r.int_points2[a.id],s),e.edges.add(s)),a=l;return e.recreateFaces(),e}findEdgeByPoint(t){let e;for(let n of this.faces)if(e=n.findEdgeByPoint(t),e!==void 0)break;return e}splitToIslands(){let t=this.toArray();t.sort((r,a)=>a.area()-r.area());let e=[...t[0].faces][0].orientation(),n=t.filter(r=>[...r.faces][0].orientation()===e);for(let r of t){let a=[...r.faces][0];if(a.orientation()!==e){for(let s of n)if(a.shapes.every(l=>s.contains(l))){s.addFace(a.shapes);break}}}return n}reverse(){for(let t of this.faces)t.reverse();return this}contains(t){if(t instanceof o.Point){let e=Nt(this,t);return e===Ct||e===G}else return Fn(this,t)}distanceTo(t){if(t instanceof o.Point){let[e,n]=o.Distance.point2polygon(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Circle||t instanceof o.Line||t instanceof o.Segment||t instanceof o.Arc){let[e,n]=o.Distance.shape2polygon(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Polygon){let e=[Number.POSITIVE_INFINITY,new o.Segment],n,r;for(let a of this.edges){let s=e[0];[n,r]=o.Distance.shape2planarSet(a.shape,t.edges,s),o.Utils.LT(n,s)&&(e=[n,r])}return e}}intersect(t){if(t instanceof o.Point)return this.contains(t)?[t]:[];if(t instanceof o.Line)return le(t,this);if(t instanceof o.Circle)return kn(t,this);if(t instanceof o.Segment)return De(t,this);if(t instanceof o.Arc)return je(t,this);if(t instanceof o.Polygon)return Xr(t,this)}translate(t){let e=new rt;for(let n of this.faces)e.addFace(n.shapes.map(r=>r.translate(t)));return e}rotate(t=0,e=new o.Point){let n=new rt;for(let r of this.faces)n.addFace(r.shapes.map(a=>a.rotate(t,e)));return n}transform(t=new o.Matrix){let e=new rt;for(let n of this.faces)e.addFace(n.shapes.map(r=>r.transform(t)));return e}toJSON(){return[...this.faces].map(t=>t.toJSON())}toArray(){return[...this.faces].map(t=>t.toPolygon())}svg(t={}){let{stroke:e,strokeWidth:n,fill:r,fillRule:a,fillOpacity:s,id:l,className:f}=t,d=l&&l.length>0?`id="${l}"`:"",u=f&&f.length>0?`class="${f}"`:"",c=`
<path stroke="${e||"black"}" stroke-width="${n||1}" fill="${r||"lightcyan"}" fill-rule="${a||"evenodd"}" fill-opacity="${s||1}" ${d} ${u} d="`;for(let _ of this.faces)c+=_.svg();return c+=`" >
</path>`,c}};o.Polygon=rt;var _o=(...i)=>new o.Polygon(...i);o.polygon=_o;var{Circle:Pe,Line:bn,Point:yn,Vector:Zt,Utils:Ae}=o,mt=class{constructor(t){this.circle=t}get inversion_circle(){return this.circle}static inversePoint(t,e){let n=new Zt(t.pc,e),r=t.r*t.r,a=n.dot(n);return Ae.EQ_0(a)?new yn(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY):t.pc.translate(n.multiply(r/a))}static inverseCircle(t,e){let n=t.pc.distanceTo(e.pc)[0];if(Ae.EQ(n,e.r)){let r=t.r*t.r/(2*e.r),a=new Zt(t.pc,e.pc);a=a.normalize();let s=t.pc.translate(a.multiply(r));return new bn(s,a)}else{let r=new Zt(t.pc,e.pc),a=t.r*t.r/(r.dot(r)-e.r*e.r),s=t.pc.translate(r.multiply(a)),l=Math.abs(a)*e.r;return new Pe(s,l)}}static inverseLine(t,e){let[n,r]=t.pc.distanceTo(e);if(Ae.EQ_0(n))return e.clone();{let a=t.r*t.r/(2*n),s=new Zt(t.pc,r.end);return s=s.multiply(a/n),new Pe(t.pc.translate(s),a)}}inverse(t){if(t instanceof yn)return mt.inversePoint(this.circle,t);if(t instanceof Pe)return mt.inverseCircle(this.circle,t);if(t instanceof bn)return mt.inverseLine(this.circle,t)}};o.Inversion=mt;var xo=i=>new o.Inversion(i);o.inversion=xo;var g=class{static point2point(t,e){return t.distanceTo(e)}static point2line(t,e){let n=t.projectionOn(e);return[new o.Vector(t,n).length,new o.Segment(t,n)]}static point2circle(t,e){let[n,r]=t.distanceTo(e.center);if(o.Utils.EQ_0(n))return[e.r,new o.Segment(t,e.toArc().start)];{let a=Math.abs(n-e.r),s=new o.Vector(e.pc,t).normalize().multiply(e.r),l=e.pc.translate(s);return[a,new o.Segment(t,l)]}}static point2segment(t,e){if(e.start.equalTo(e.end))return g.point2point(t,e.start);let n=new o.Vector(e.start,e.end),r=new o.Vector(e.start,t),a=new o.Vector(e.end,t),s=n.dot(r),l=-n.dot(a),f,d;if(o.Utils.GE(s,0)&&o.Utils.GE(l,0)){let u=e.tangentInStart();return f=Math.abs(u.cross(r)),d=e.start.translate(u.multiply(u.dot(r))),[f,new o.Segment(t,d)]}else return s<0?t.distanceTo(e.start):t.distanceTo(e.end)}static point2arc(t,e){let n=new o.Circle(e.pc,e.r),r=[],a,s;return[a,s]=g.point2circle(t,n),s.end.on(e)&&r.push(g.point2circle(t,n)),r.push(g.point2point(t,e.start)),r.push(g.point2point(t,e.end)),g.sort(r),r[0]}static segment2line(t,e){let n=t.intersect(e);if(n.length>0)return[0,new o.Segment(n[0],n[0])];let r=[];return r.push(g.point2line(t.start,e)),r.push(g.point2line(t.end,e)),g.sort(r),r[0]}static segment2segment(t,e){let n=Ft(t,e);if(n.length>0)return[0,new o.Segment(n[0],n[0])];let r=[],a,s;return[a,s]=g.point2segment(e.start,t),r.push([a,s.reverse()]),[a,s]=g.point2segment(e.end,t),r.push([a,s.reverse()]),r.push(g.point2segment(t.start,e)),r.push(g.point2segment(t.end,e)),g.sort(r),r[0]}static segment2circle(t,e){let n=t.intersect(e);if(n.length>0)return[0,new o.Segment(n[0],n[0])];let r=new o.Line(t.ps,t.pe),[a,s]=g.point2line(e.center,r);if(o.Utils.GE(a,e.r)&&s.end.on(t))return g.point2circle(s.end,e);{let[l,f]=g.point2circle(t.start,e),[d,u]=g.point2circle(t.end,e);return o.Utils.LT(l,d)?[l,f]:[d,u]}}static segment2arc(t,e){let n=t.intersect(e);if(n.length>0)return[0,new o.Segment(n[0],n[0])];let r=new o.Line(t.ps,t.pe),a=new o.Circle(e.pc,e.r),[s,l]=g.point2line(a.center,r);if(o.Utils.GE(s,a.r)&&l.end.on(t)){let[c,_]=g.point2circle(l.end,a);if(_.end.on(e))return[c,_]}let f=[];f.push(g.point2arc(t.start,e)),f.push(g.point2arc(t.end,e));let d,u;return[d,u]=g.point2segment(e.start,t),f.push([d,u.reverse()]),[d,u]=g.point2segment(e.end,t),f.push([d,u.reverse()]),g.sort(f),f[0]}static circle2circle(t,e){let n=t.intersect(e);if(n.length>0)return[0,new o.Segment(n[0],n[0])];if(t.center.equalTo(e.center)){let r=t.toArc(),a=e.toArc();return g.point2point(r.start,a.start)}else{let r=new o.Line(t.center,e.center),a=r.intersect(t),s=r.intersect(e),l=[];return l.push(g.point2point(a[0],s[0])),l.push(g.point2point(a[0],s[1])),l.push(g.point2point(a[1],s[0])),l.push(g.point2point(a[1],s[1])),g.sort(l),l[0]}}static circle2line(t,e){let n=t.intersect(e);if(n.length>0)return[0,new o.Segment(n[0],n[0])];let[r,a]=g.point2line(t.center,e),[s,l]=g.point2circle(a.end,t);return l=l.reverse(),[s,l]}static arc2line(t,e){let n=e.intersect(t);if(n.length>0)return[0,new o.Segment(n[0],n[0])];let r=new o.Circle(t.center,t.r),[a,s]=g.point2line(r.center,e);if(o.Utils.GE(a,r.r)){let[l,f]=g.point2circle(s.end,r);if(f.end.on(t))return[l,f]}else{let l=[];return l.push(g.point2line(t.start,e)),l.push(g.point2line(t.end,e)),g.sort(l),l[0]}}static arc2circle(t,e){let n=t.intersect(e);if(n.length>0)return[0,new o.Segment(n[0],n[0])];let r=new o.Circle(t.center,t.r),[a,s]=g.circle2circle(r,e);if(s.start.on(t))return[a,s];{let l=[];return l.push(g.point2circle(t.start,e)),l.push(g.point2circle(t.end,e)),g.sort(l),l[0]}}static arc2arc(t,e){let n=t.intersect(e);if(n.length>0)return[0,new o.Segment(n[0],n[0])];let r=new o.Circle(t.center,t.r),a=new o.Circle(e.center,e.r),[s,l]=g.circle2circle(r,a);if(l.start.on(t)&&l.end.on(e))return[s,l];{let f=[],d,u;return[d,u]=g.point2arc(t.start,e),u.end.on(e)&&f.push([d,u]),[d,u]=g.point2arc(t.end,e),u.end.on(e)&&f.push([d,u]),[d,u]=g.point2arc(e.start,t),u.end.on(t)&&f.push([d,u.reverse()]),[d,u]=g.point2arc(e.end,t),u.end.on(t)&&f.push([d,u.reverse()]),[d,u]=g.point2point(t.start,e.start),f.push([d,u]),[d,u]=g.point2point(t.start,e.end),f.push([d,u]),[d,u]=g.point2point(t.end,e.start),f.push([d,u]),[d,u]=g.point2point(t.end,e.end),f.push([d,u]),g.sort(f),f[0]}}static point2polygon(t,e){let n=[Number.POSITIVE_INFINITY,new o.Segment];for(let r of e.edges){let[a,s]=r.shape instanceof o.Segment?g.point2segment(t,r.shape):g.point2arc(t,r.shape);o.Utils.LT(a,n[0])&&(n=[a,s])}return n}static shape2polygon(t,e){let n=[Number.POSITIVE_INFINITY,new o.Segment];for(let r of e.edges){let[a,s]=t.distanceTo(r.shape);o.Utils.LT(a,n[0])&&(n=[a,s])}return n}static polygon2polygon(t,e){let n=[Number.POSITIVE_INFINITY,new o.Segment];for(let r of t.edges)for(let a of e.edges){let[s,l]=r.shape.distanceTo(a.shape);o.Utils.LT(s,n[0])&&(n=[s,l])}return n}static box2box_minmax(t,e){let n=Math.max(Math.max(t.xmin-e.xmax,0),Math.max(e.xmin-t.xmax,0)),r=Math.max(Math.max(t.ymin-e.ymax,0),Math.max(e.ymin-t.ymax,0)),a=n*n+r*r,s=t.merge(e),l=s.xmax-s.xmin,f=s.ymax-s.ymin,d=l*l+f*f;return[a,d]}static minmax_tree_process_level(t,e,n,r){let a,s;for(let u of e)[a,s]=g.box2box_minmax(t.box,u.item.key),u.item.value instanceof o.Edge?r.insert([a,s],u.item.value.shape):r.insert([a,s],u.item.value),o.Utils.LT(s,n)&&(n=s);if(e.length===0)return n;let l=e.map(u=>u.left.isNil()?void 0:u.left).filter(u=>u!==void 0),f=e.map(u=>u.right.isNil()?void 0:u.right).filter(u=>u!==void 0),d=[...l,...f].filter(u=>{let[c,_]=g.box2box_minmax(t.box,u.max);return o.Utils.LE(c,n)});return n=g.minmax_tree_process_level(t,d,n,r),n}static minmax_tree(t,e,n){let r=new bt,a=[e.index.root],s=n<Number.POSITIVE_INFINITY?n*n:Number.POSITIVE_INFINITY;return s=g.minmax_tree_process_level(t,a,s,r),r}static minmax_tree_calc_distance(t,e,n){let r,a;if(e!=null&&!e.isNil()){if([r,a]=g.minmax_tree_calc_distance(t,e.left,n),a)return[r,a];if(o.Utils.LT(r[0],Math.sqrt(e.item.key.low)))return[r,!0];let[s,l]=g.distance(t,e.item.value);return o.Utils.LT(s,r[0])&&(r=[s,l]),[r,a]=g.minmax_tree_calc_distance(t,e.right,r),[r,a]}return[n,!1]}static shape2planarSet(t,e,n=Number.POSITIVE_INFINITY){let r=[n,new o.Segment],a=!1;if(e instanceof o.PlanarSet){let s=g.minmax_tree(t,e,n);[r,a]=g.minmax_tree_calc_distance(t,s.root,r)}return r}static sort(t){t.sort((e,n)=>o.Utils.LT(e[0],n[0])?-1:o.Utils.GT(e[0],n[0])?1:0)}static distance(t,e){return t.distanceTo(e)}};o.Distance=g;o.BooleanOperations=Rr;o.Relations=oo;var m=o;var rn=hr(jn());var bo=typeof global=="object"&&global&&global.Object===Object&&global,qn=bo;var yo=typeof self=="object"&&self&&self.Object===Object&&self,vo=qn||yo||Function("return this")(),K=vo;var wo=K.Symbol,wt=wo;var zn=Object.prototype,Eo=zn.hasOwnProperty,To=zn.toString,Vt=wt?wt.toStringTag:void 0;function Io(i){var t=Eo.call(i,Vt),e=i[Vt];try{i[Vt]=void 0;var n=!0}catch{}var r=To.call(i);return n&&(t?i[Vt]=e:delete i[Vt]),r}var Yn=Io;var So=Object.prototype,Po=So.toString;function Ao(i){return Po.call(i)}var Xn=Ao;var Co="[object Null]",Oo="[object Undefined]",Qn=wt?wt.toStringTag:void 0;function No(i){return i==null?i===void 0?Oo:Co:Qn&&Qn in Object(i)?Yn(i):Xn(i)}var he=No;function ko(i){return i!=null&&typeof i=="object"}var Hn=ko;var Lo="[object Symbol]";function Ro(i){return typeof i=="symbol"||Hn(i)&&he(i)==Lo}var Jn=Ro;var Bo=/\s/;function Mo(i){for(var t=i.length;t--&&Bo.test(i.charAt(t)););return t}var Kn=Mo;var Fo=/^\s+/;function Vo(i){return i&&i.slice(0,Kn(i)+1).replace(Fo,"")}var Zn=Vo;function Uo(i){var t=typeof i;return i!=null&&(t=="object"||t=="function")}var F=Uo;var ti=0/0,$o=/^[-+]0x[0-9a-f]+$/i,Go=/^0b[01]+$/i,Wo=/^0o[0-7]+$/i,Do=parseInt;function jo(i){if(typeof i=="number")return i;if(Jn(i))return ti;if(F(i)){var t=typeof i.valueOf=="function"?i.valueOf():i;i=F(t)?t+"":t}if(typeof i!="string")return i===0?i:+i;i=Zn(i);var e=Go.test(i);return e||Wo.test(i)?Do(i.slice(2),e?2:8):$o.test(i)?ti:+i}var Ut=jo;var ei=1/0,qo=17976931348623157e292;function zo(i){if(!i)return i===0?i:0;if(i=Ut(i),i===ei||i===-ei){var t=i<0?-1:1;return t*qo}return i===i?i:0}var $t=zo;function Yo(i){var t=$t(i),e=t%1;return t===t?e?t-e:t:0}var ni=Yo;var Xo="[object AsyncFunction]",Qo="[object Function]",Ho="[object GeneratorFunction]",Jo="[object Proxy]";function Ko(i){if(!F(i))return!1;var t=he(i);return t==Qo||t==Ho||t==Xo||t==Jo}var pe=Ko;var Zo=K["__core-js_shared__"],me=Zo;var ii=function(){var i=/[^.]+$/.exec(me&&me.keys&&me.keys.IE_PROTO||"");return i?"Symbol(src)_1."+i:""}();function ts(i){return!!ii&&ii in i}var ri=ts;var es=Function.prototype,ns=es.toString;function is(i){if(i!=null){try{return ns.call(i)}catch{}try{return i+""}catch{}}return""}var oi=is;var rs=/[\\^$.*+?()[\]{}|]/g,os=/^\[object .+?Constructor\]$/,ss=Function.prototype,as=Object.prototype,ls=ss.toString,fs=as.hasOwnProperty,ds=RegExp("^"+ls.call(fs).replace(rs,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function us(i){if(!F(i)||ri(i))return!1;var t=pe(i)?ds:os;return t.test(oi(i))}var si=us;function cs(i,t){return i==null?void 0:i[t]}var ai=cs;function hs(i,t){var e=ai(i,t);return si(e)?e:void 0}var ge=hs;var ps=9007199254740991,ms=/^(?:0|[1-9]\d*)$/;function gs(i,t){var e=typeof i;return t=t??ps,!!t&&(e=="number"||e!="symbol"&&ms.test(i))&&i>-1&&i%1==0&&i<t}var li=gs;function _s(i,t){return i===t||i!==i&&t!==t}var _e=_s;var xs=9007199254740991;function bs(i){return typeof i=="number"&&i>-1&&i%1==0&&i<=xs}var fi=bs;function ys(i){return i!=null&&fi(i.length)&&!pe(i)}var di=ys;function vs(i,t,e){if(!F(e))return!1;var n=typeof t;return(n=="number"?di(e)&&li(t,e.length):n=="string"&&t in e)?_e(e[t],i):!1}var ui=vs;var ws=ge(Object,"create"),Q=ws;function Es(){this.__data__=Q?Q(null):{},this.size=0}var ci=Es;function Ts(i){var t=this.has(i)&&delete this.__data__[i];return this.size-=t?1:0,t}var hi=Ts;var Is="__lodash_hash_undefined__",Ss=Object.prototype,Ps=Ss.hasOwnProperty;function As(i){var t=this.__data__;if(Q){var e=t[i];return e===Is?void 0:e}return Ps.call(t,i)?t[i]:void 0}var pi=As;var Cs=Object.prototype,Os=Cs.hasOwnProperty;function Ns(i){var t=this.__data__;return Q?t[i]!==void 0:Os.call(t,i)}var mi=Ns;var ks="__lodash_hash_undefined__";function Ls(i,t){var e=this.__data__;return this.size+=this.has(i)?0:1,e[i]=Q&&t===void 0?ks:t,this}var gi=Ls;function Et(i){var t=-1,e=i==null?0:i.length;for(this.clear();++t<e;){var n=i[t];this.set(n[0],n[1])}}Et.prototype.clear=ci;Et.prototype.delete=hi;Et.prototype.get=pi;Et.prototype.has=mi;Et.prototype.set=gi;var qe=Et;function Rs(){this.__data__=[],this.size=0}var _i=Rs;function Bs(i,t){for(var e=i.length;e--;)if(_e(i[e][0],t))return e;return-1}var Z=Bs;var Ms=Array.prototype,Fs=Ms.splice;function Vs(i){var t=this.__data__,e=Z(t,i);if(e<0)return!1;var n=t.length-1;return e==n?t.pop():Fs.call(t,e,1),--this.size,!0}var xi=Vs;function Us(i){var t=this.__data__,e=Z(t,i);return e<0?void 0:t[e][1]}var bi=Us;function $s(i){return Z(this.__data__,i)>-1}var yi=$s;function Gs(i,t){var e=this.__data__,n=Z(e,i);return n<0?(++this.size,e.push([i,t])):e[n][1]=t,this}var vi=Gs;function Tt(i){var t=-1,e=i==null?0:i.length;for(this.clear();++t<e;){var n=i[t];this.set(n[0],n[1])}}Tt.prototype.clear=_i;Tt.prototype.delete=xi;Tt.prototype.get=bi;Tt.prototype.has=yi;Tt.prototype.set=vi;var wi=Tt;var Ws=ge(K,"Map"),Ei=Ws;function Ds(){this.size=0,this.__data__={hash:new qe,map:new(Ei||wi),string:new qe}}var Ti=Ds;function js(i){var t=typeof i;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?i!=="__proto__":i===null}var Ii=js;function qs(i,t){var e=i.__data__;return Ii(t)?e[typeof t=="string"?"string":"hash"]:e.map}var tt=qs;function zs(i){var t=tt(this,i).delete(i);return this.size-=t?1:0,t}var Si=zs;function Ys(i){return tt(this,i).get(i)}var Pi=Ys;function Xs(i){return tt(this,i).has(i)}var Ai=Xs;function Qs(i,t){var e=tt(this,i),n=e.size;return e.set(i,t),this.size+=e.size==n?0:1,this}var Ci=Qs;function It(i){var t=-1,e=i==null?0:i.length;for(this.clear();++t<e;){var n=i[t];this.set(n[0],n[1])}}It.prototype.clear=Ti;It.prototype.delete=Si;It.prototype.get=Pi;It.prototype.has=Ai;It.prototype.set=Ci;var ze=It;var Hs="Expected a function";function Ye(i,t){if(typeof i!="function"||t!=null&&typeof t!="function")throw new TypeError(Hs);var e=function(){var n=arguments,r=t?t.apply(this,n):n[0],a=e.cache;if(a.has(r))return a.get(r);var s=i.apply(this,n);return e.cache=a.set(r,s)||a,s};return e.cache=new(Ye.Cache||ze),e}Ye.Cache=ze;var Xe=Ye;var Js="Expected a function";function Ks(i,t){var e;if(typeof t!="function")throw new TypeError(Js);return i=ni(i),function(){return--i>0&&(e=t.apply(this,arguments)),i<=1&&(t=void 0),e}}var Oi=Ks;var Zs=function(){return K.Date.now()},xe=Zs;var ta="Expected a function",ea=Math.max,na=Math.min;function ia(i,t,e){var n,r,a,s,l,f,d=0,u=!1,c=!1,_=!0;if(typeof i!="function")throw new TypeError(ta);t=Ut(t)||0,F(e)&&(u=!!e.leading,c="maxWait"in e,a=c?ea(Ut(e.maxWait)||0,t):a,_="trailing"in e?!!e.trailing:_);function w(T){var O=n,A=r;return n=r=void 0,d=T,s=i.apply(A,O),s}function b(T){return d=T,l=setTimeout(x,t),u?w(T):s}function y(T){var O=T-f,A=T-d,P=t-O;return c?na(P,a-A):P}function E(T){var O=T-f,A=T-d;return f===void 0||O>=t||O<0||c&&A>=a}function x(){var T=xe();if(E(T))return v(T);l=setTimeout(x,y(T))}function v(T){return l=void 0,_&&n?w(T):(n=r=void 0,s)}function p(){l!==void 0&&clearTimeout(l),d=0,n=f=r=l=void 0}function S(){return l===void 0?s:v(xe())}function $(){var T=xe(),O=E(T);if(n=arguments,r=this,f=T,O){if(l===void 0)return b(f);if(c)return clearTimeout(l),l=setTimeout(x,t),w(f)}return l===void 0&&(l=setTimeout(x,t)),s}return $.cancel=p,$.flush=S,$}var Ni=ia;function ra(i){return Oi(2,i)}var Qe=ra;var oa=Math.floor,sa=Math.random;function aa(i,t){return i+oa(sa()*(t-i+1))}var ki=aa;var la=parseFloat,fa=Math.min,da=Math.random;function ua(i,t,e){if(e&&typeof e!="boolean"&&ui(i,t,e)&&(t=e=void 0),e===void 0&&(typeof t=="boolean"?(e=t,t=void 0):typeof i=="boolean"&&(e=i,i=void 0)),i===void 0&&t===void 0?(i=0,t=1):(i=$t(i),t===void 0?(t=i,i=0):t=$t(t)),i>t){var n=i;i=t,t=n}if(e||i%1||t%1){var r=da();return fa(i+r*(t-i+la("1e-"+((r+"").length-1))),t)}return ki(i,t)}var Gt=ua;var ca="Expected a function";function ha(i,t,e){var n=!0,r=!0;if(typeof i!="function")throw new TypeError(ca);return F(e)&&(n="leading"in e?!!e.leading:n,r="trailing"in e?!!e.trailing:r),Ni(i,t,{leading:n,maxWait:t,trailing:r})}var He=ha;var et={};dn(et,{BOUNDARY:()=>q,CCW:()=>pa,CONTAINS:()=>ya,CW:()=>ma,END_VERTEX:()=>ft,INSIDE:()=>xa,INTERLACE:()=>va,NOT_VERTEX:()=>be,ORIENTATION:()=>ga,OUTSIDE:()=>ba,OVERLAP_OPPOSITE:()=>Ea,OVERLAP_SAME:()=>wa,PIx2:()=>_a,START_VERTEX:()=>Wt});var pa=!0,ma=!1,ga={CCW:-1,CW:1,NOT_ORIENTABLE:0},_a=2*Math.PI,xa=1,ba=0,q=2,ya=3,va=4,wa=1,Ea=2,be=0,Wt=1,ft=2;var ye={};dn(ye,{DECIMALS:()=>Ta,EQ:()=>St,EQ_0:()=>Ia,GE:()=>Pa,GT:()=>Sa,LE:()=>Ca,LT:()=>Aa,getTolerance:()=>Ke,setTolerance:()=>Je});var z=1e-6;function Je(i){z=i}function Ke(){return z}var Ta=3;function Ia(i){return i<z&&i>-z}function St(i,t){return i-t<z&&i-t>-z}function Sa(i,t){return i-t>z}function Pa(i,t){return i-t>-z}function Aa(i,t){return i-t<-z}function Ca(i,t){return i-t<z}var Li=class{static get ILLEGAL_PARAMETERS(){return new ReferenceError("Illegal Parameters")}static get ZERO_DIVISION(){return new Error("Zero division")}static get UNRESOLVED_BOUNDARY_CONFLICT(){return new Error("Unresolved boundary conflict in boolean operation")}static get INFINITE_LOOP(){return new Error("Infinite loop")}},Dt=Li;var Ze={Utils:ye,Errors:Dt,Matrix:void 0,Planar_set:void 0,Point:void 0,Vector:void 0,Line:void 0,Circle:void 0,Segment:void 0,Arc:void 0,Box:void 0,Edge:void 0,Face:void 0,Ray:void 0,Ray_shooting:void 0,Multiline:void 0,Polygon:void 0,Distance:void 0,Inversion:void 0};for(let i in et)Ze[i]=et[i];Object.defineProperty(Ze,"DP_TOL",{get:function(){return Ke()},set:function(i){Je(i)}});var ve=Ze;var Ri=class{constructor(t,e){this.first=t,this.last=e||this.first}[Symbol.iterator](){let t;return{next:()=>(t=t?t.next:this.first,{value:t,done:t===void 0})}}get size(){let t=0;for(let e of this)t++;return t}toArray(t=void 0,e=void 0){let n=[],r=t||this.first,a=e||this.last,s=r;if(s===void 0)return n;do n.push(s),s=s.next;while(s!==a.next);return n}append(t){return this.isEmpty()?this.first=t:(t.prev=this.last,this.last.next=t),this.last=t,this.last.next=void 0,this.first.prev=void 0,this}insert(t,e){if(this.isEmpty())this.first=t,this.last=t;else if(e==null)t.next=this.first,this.first.prev=t,this.first=t;else{let n=e.next;e.next=t,n&&(n.prev=t),t.prev=e,t.next=n,this.last===e&&(this.last=t)}return this.last.next=void 0,this.first.prev=void 0,this}remove(t){return t===this.first&&t===this.last?(this.first=void 0,this.last=void 0):(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t===this.first&&(this.first=t.next),t===this.last&&(this.last=t.prev)),this}isEmpty(){return this.first===void 0}static testInfiniteLoop(t){let e=t,n=t;do{if(e!=t&&e===n)throw ve.Errors.INFINITE_LOOP;e=e.next,n=n.next.next}while(e!=t)}},Bi=Ri;function jt(i,t,e){let n=e.length,r=i.shape.split(t);if(r.length===0)return;let a=0;r[0]===null?a=0:r[1]===null?a=i.shape.length:a=r[0].length;let s=be;St(a,0)&&(s|=Wt),St(a,i.shape.length)&&(s|=ft);let l=s&ft&&i.next.arc_length===0?0:i.arc_length+a;e.push({id:n,pt:t,arc_length:l,edge_before:i,edge_after:void 0,face:i.face,is_vertex:s})}function we(i){i.int_points1_sorted=Mi(i.int_points1),i.int_points2_sorted=Mi(i.int_points2)}function Mi(i){let t=new Map,e=0;for(let r of i)t.has(r.face)||(t.set(r.face,e),e++);for(let r of i)r.faceId=t.get(r.face);return i.slice().sort(Oa)}function Oa(i,t){return i.faceId<t.faceId?-1:i.faceId>t.faceId?1:i.arc_length<t.arc_length?-1:i.arc_length>t.arc_length?1:0}function Fi(i){if(i.int_points1.length<2)return;let t=!1,e,n,r,a;for(let s=0;s<i.int_points1_sorted.length;s++)if(i.int_points1_sorted[s].id!==-1){e=i.int_points1_sorted[s],n=i.int_points2[e.id];for(let l=s+1;l<i.int_points1_sorted.length&&(r=i.int_points1_sorted[l],!!St(r.arc_length,e.arc_length));l++)r.id!==-1&&(a=i.int_points2[r.id],a.id!==-1&&r.edge_before===e.edge_before&&r.edge_after===e.edge_after&&a.edge_before===n.edge_before&&a.edge_after===n.edge_after&&(r.id=-1,a.id=-1,t=!0))}n=i.int_points2_sorted[0],e=i.int_points1[n.id];for(let s=1;s<i.int_points2_sorted.length;s++){let l=i.int_points2_sorted[s];if(l.id==-1)continue;if(n.id==-1||!St(l.arc_length,n.arc_length)){n=l,e=i.int_points1[n.id];continue}let f=i.int_points1[l.id];f.edge_before===e.edge_before&&f.edge_after===e.edge_after&&l.edge_before===n.edge_before&&l.edge_after===n.edge_after&&(f.id=-1,l.id=-1,t=!0)}t&&(i.int_points1=i.int_points1.filter(s=>s.id>=0),i.int_points2=i.int_points2.filter(s=>s.id>=0),i.int_points1.forEach((s,l)=>s.id=l),i.int_points2.forEach((s,l)=>s.id=l))}function tn(i){for(let t of i)t.edge_before.bvStart=void 0,t.edge_before.bvEnd=void 0,t.edge_before.bv=void 0,t.edge_before.overlap=void 0,t.edge_after.bvStart=void 0,t.edge_after.bvEnd=void 0,t.edge_after.bv=void 0,t.edge_after.overlap=void 0;for(let t of i)t.edge_before.bvEnd=q,t.edge_after.bvStart=q}function en(i,t){for(let e of i)e.edge_before.setInclusion(t),e.edge_after.setInclusion(t)}function Vi(i){let t,e,n,r=i.int_points1.length;for(let a=0;a<r;a++){let s=i.int_points1_sorted[a];s.face!==t&&(e=a,t=s.face);let l=a,f=dt(i.int_points1_sorted,a,t),d;l+f<r&&i.int_points1_sorted[l+f].face===t?d=l+f:d=e;let u=dt(i.int_points1_sorted,d,t);n=null;for(let x=d;x<d+u;x++){let v=i.int_points1_sorted[x];if(v.face===t&&i.int_points2[v.id].face===i.int_points2[s.id].face){n=v;break}}if(n===null)continue;let c=s.edge_after,_=n.edge_before;if(!(c.bv===q&&_.bv===q)||c!==_)continue;let w=i.int_points2[s.id],b=i.int_points2[n.id],y=w.edge_after,E=b.edge_before;y.bv===q&&E.bv===q&&y===E||(w=i.int_points2[n.id],b=i.int_points2[s.id],y=w.edge_after,E=b.edge_before),y.bv===q&&E.bv===q&&y===E&&c.setOverlap(y)}}function dt(i,t,e){let n,r,a=1;if(i.length==1)return 1;n=i[t];for(let s=t+1;s<i.length&&!(n.face!=e||(r=i[s],!(r.pt.equalTo(n.pt)&&r.edge_before===n.edge_before&&r.edge_after===n.edge_after)));s++)a++;return a}function nn(i,t){if(!!t){for(let e of t){let n=e.edge_before;if(e.is_vertex=be,n.shape.start&&n.shape.start.equalTo(e.pt)&&(e.is_vertex|=Wt),n.shape.end&&n.shape.end.equalTo(e.pt)&&(e.is_vertex|=ft),e.is_vertex&Wt){e.edge_before=n.prev,e.is_vertex=ft;continue}if(e.is_vertex&ft)continue;let r=i.addVertex(e.pt,n);e.edge_before=r}for(let e of t)e.edge_after=e.edge_before.next}}var{INSIDE:Y,OUTSIDE:X,BOUNDARY:L,OVERLAP_SAME:Na,OVERLAP_OPPOSITE:ka}=et,{NOT_VERTEX:Fd,START_VERTEX:Ui,END_VERTEX:$i}=et,Yi=1,Xi=2,qt=3;function Qi(i,t){let n=t.clone().reverse(),[r,a]=Ba(i,n,qt,!0);return r}function La(i,t,e,n){let r=Gi(i,e.int_points1),a=Gi(t,e.int_points2);for(Wi(r,t),Wi(a,i),tn(e.int_points1),tn(e.int_points2),en(e.int_points1,t),en(e.int_points2,i);Fa(i,t,e.int_points1,e.int_points1_sorted,e.int_points2,e););Vi(e),Di(i,n,e.int_points1_sorted,!0),Di(t,n,e.int_points2_sorted,!1),zi(i,r,n,!0),zi(t,a,n,!1)}function Ra(i,t,e,n){Va(i,t,n,e.int_points2),Ua(i,t,e),ji(i,e.int_points1),ji(t,e.int_points2),qi(i,e.int_points1,e.int_points2),qi(i,e.int_points2,e.int_points1)}function Ba(i,t,e,n){let r=i,a=t.clone(),s=Ma(r,a);return we(s),nn(r,s.int_points1_sorted),nn(a,s.int_points2_sorted),Fi(s),we(s),La(r,a,s,e),n&&Ra(r,a,s,e),[r,a]}function Ma(i,t){let e={int_points1:[],int_points2:[]};for(let n of t.edges){let r=n.box,a={x:r.xmin-5,y:r.ymin-5,width:r.xmax-r.xmin+10,height:r.ymax-r.ymin+10};for(let{edge1:s}of globalThis.edges.retrieve(a)){let l=s.shape.intersect(n.shape);for(let f of l)jt(s,f,e.int_points1),jt(n,f,e.int_points2)}}return e}function Gi(i,t){let e=[];for(let n of i.faces)t.find(r=>r.face===n)||e.push(n);return e}function Wi(i,t){for(let e of i)e.first.bv=e.first.bvStart=e.first.bvEnd=void 0,e.first.setInclusion(t)}function Fa(i,t,e,n,r,a){let s,l,f,d=n.length,u=!1;for(let c=0;c<d;c++){let _=n[c];_.face!==s&&(l=c,s=_.face);let w=c,b=dt(n,c,s),y;w+b<d&&n[w+b].face===s?y=w+b:y=l;let E=dt(n,y,s);f=null;for(let p=y;p<y+E;p++){let S=n[p];if(S.face===s&&r[S.id].face===r[_.id].face){f=S;break}}if(f===null)continue;let x=_.edge_after,v=f.edge_before;if(x.bv===L&&v.bv!=L){x.bv=v.bv;continue}if(x.bv!=L&&v.bv===L){v.bv=x.bv;continue}if(x.bv===L&&v.bv===L&&x!=v||x.bv===Y&&v.bv===X||x.bv===X&&v.bv===Y){let p=x.next;for(;p!=v;)p.bvStart=void 0,p.bvEnd=void 0,p.bv=void 0,p.setInclusion(t),p=p.next}if(x.bv===L&&v.bv===L&&x!=v){let p=x.next,S;for(;p!=v;){if(p.bv!=L){if(S===void 0)S=p.bv;else if(p.bv!=S)throw Dt.UNRESOLVED_BOUNDARY_CONFLICT}p=p.next}S!=null&&(x.bv=S,v.bv=S);continue}if(x.bv===Y&&v.bv===X||x.bv===X&&v.bv===Y){let p=x;for(;p!=v;){if(p.bvStart===x.bv&&p.bvEnd===v.bv){let[S,$]=p.shape.distanceTo(t);if(S<10*ve.DP_TOL){jt(p,$.ps,e);let T=e[e.length-1];if(T.is_vertex&Ui)T.edge_after=p,T.edge_before=p.prev,p.bvStart=L,p.bv=void 0,p.setInclusion(t);else if(T.is_vertex&$i)T.edge_after=p.next,p.bvEnd=L,p.bv=void 0,p.setInclusion(t);else{let P=t.addVertex(T.pt,p);T.edge_before=P,T.edge_after=P.next,P.setInclusion(t),P.next.bvStart=L,P.next.bvEnd=void 0,P.next.bv=void 0,P.next.setInclusion(t)}let O=t.findEdgeByPoint($.pe);jt(O,$.pe,r);let A=r[r.length-1];if(A.is_vertex&Ui)A.edge_after=O,A.edge_before=O.prev;else if(A.is_vertex&$i)A.edge_after=O.next;else{let P=r.find(Ie=>Ie.edge_after===O),C=t.addVertex(A.pt,O);A.edge_before=C,A.edge_after=C.next,P&&(P.edge_after=C),C.bvStart=void 0,C.bvEnd=L,C.bv=void 0,C.setInclusion(i),C.next.bvStart=L,C.next.bvEnd=void 0,C.next.bv=void 0,C.next.setInclusion(i)}we(a),u=!0;break}}p=p.next}if(u)break;throw Dt.UNRESOLVED_BOUNDARY_CONFLICT}}return u}function Di(i,t,e,n){if(!e)return;let r,a,s,l;for(let f=0;f<e.length;f++){if(s=e[f],s.face!==r&&(a=f,r=s.face),r.isEmpty())continue;let d=f,u=dt(e,f,r),c;d+u<e.length&&e[d+u].face===s.face?c=d+u:c=a,l=e[c];let _=c,w=dt(e,_,r),b=s.edge_after,y=l.edge_before;if(b.bv===Y&&y.bv===Y&&t===Yi||b.bv===X&&y.bv===X&&t===Xi||(b.bv===X||y.bv===X)&&t===qt&&!n||(b.bv===Y||y.bv===Y)&&t===qt&&n||b.bv===L&&y.bv===L&&b.overlap&Na&&n||b.bv===L&&y.bv===L&&b.overlap&ka){i.removeChain(r,b,y);for(let E=d;E<d+u;E++)e[E].edge_after=void 0;for(let E=_;E<_+w;E++)e[E].edge_before=void 0}f+=u-1}}function Va(i,t,e,n){for(let r of t.faces){for(let a of r)i.edges.add(a);n.find(a=>a.face===r)===void 0&&i.addFace(r.first,r.last)}}function Ua(i,t,e){if(e.int_points1.length!==0)for(let n=0;n<e.int_points1.length;n++){let r=e.int_points1[n],a=e.int_points2[n];if(r.edge_before!==void 0&&r.edge_after===void 0&&a.edge_before===void 0&&a.edge_after!==void 0&&(r.edge_before.next=a.edge_after,a.edge_after.prev=r.edge_before,r.edge_after=a.edge_after,a.edge_before=r.edge_before),a.edge_before!==void 0&&a.edge_after===void 0&&r.edge_before===void 0&&r.edge_after!==void 0&&(a.edge_before.next=r.edge_after,r.edge_after.prev=a.edge_before,a.edge_after=r.edge_after,r.edge_before=a.edge_before),r.edge_before!==void 0&&r.edge_after===void 0)for(let s of e.int_points1_sorted)s!==r&&s.edge_before===void 0&&s.edge_after!==void 0&&s.pt.equalTo(r.pt)&&(r.edge_before.next=s.edge_after,s.edge_after.prev=r.edge_before,r.edge_after=s.edge_after,s.edge_before=r.edge_before);if(a.edge_before!==void 0&&a.edge_after===void 0)for(let s of e.int_points2_sorted)s!==a&&s.edge_before===void 0&&s.edge_after!==void 0&&s.pt.equalTo(a.pt)&&(a.edge_before.next=s.edge_after,s.edge_after.prev=a.edge_before,a.edge_after=s.edge_after,s.edge_before=a.edge_before)}}function ji(i,t){for(let e of t)i.faces.delete(e.face),e.face=void 0,e.edge_before&&(e.edge_before.face=void 0),e.edge_after&&(e.edge_after.face=void 0)}function qi(i,t,e){for(let n of t){if(n.edge_before===void 0||n.edge_after===void 0||n.face||n.edge_after.face||n.edge_before.face)continue;let r=n.edge_after,a=n.edge_before;Bi.testInfiniteLoop(r);let s=i.addFace(r,a);for(let l of t)l.edge_before&&l.edge_after&&l.edge_before.face===s&&l.edge_after.face===s&&(l.face=s);for(let l of e)l.edge_before&&l.edge_after&&l.edge_before.face===s&&l.edge_after.face===s&&(l.face=s)}}function zi(i,t,e,n){for(let r of t){let a=r.first.bv;(e===Yi&&a===Y||e===qt&&a===Y&&n||e===qt&&a===X&&!n||e===Xi&&a===X)&&i.deleteFace(r)}}var on=class{#t;polygons;intersects;poly;constructor(t){this.intersects=Xe(this.#e.bind(this),l=>{let{cache:f}=this.intersects;return f.size===3e4&&f.clear(),`${l.xmin}_${l.xmax}_${l.ymin}_${l.ymax}`}),this.polygons=t;let e=[],n=[];for(let l of t)for(let f of l)e.push(f.x),n.push(f.y);let r=Math.max(...e)-Math.min(...e),a=Math.max(...n)-Math.min(...n);this.w=r,this.h=a,this.#t=new rn.default({x:0,y:0,width:r,height:a},5,16);let s=0;this.poly=new m.Polygon;for(let l of t)this.poly.addFace(l.map(f=>new m.Point(f.x,f.y)));for(let l of this.poly.edges){let f=l.box;l.shape instanceof m.Segment?this.#t.insert({x:f.xmin,y:f.ymin,width:f.xmax-f.xmin,height:f.ymax-f.ymin,seg:l.shape,edge1:l}):this.#t.insert({x:f.xmin,y:f.ymin,width:f.xmax-f.xmin,height:f.ymax-f.ymin,circle:l.shape,edge1:l})}globalThis.edges=this.#t}makeHole(t,e,n){let r=new m.Circle(new m.Point(t,e),n),a=new m.Polygon;a.addFace(r),Qi(this.poly,a);let s=this.poly.edges;this.#t=new rn.default({x:0,y:0,width:this.w,height:this.h},5,16);for(let l of s){let f=l.box;l.shape instanceof m.Segment?this.#t.insert({x:f.xmin,y:f.ymin,width:f.xmax-f.xmin,height:f.ymax-f.ymin,seg:l.shape,edge1:l}):this.#t.insert({x:f.xmin,y:f.ymin,width:f.xmax-f.xmin,height:f.ymax-f.ymin,circle:l.shape,edge1:l})}for(let l of this.poly.faces)l.edgesCached=void 0;this.intersects.cache.clear(),globalThis.edges=this.#t}#e(t){let e=[],n={x:t.xmin,y:t.ymin,width:t.xmax-t.xmin,height:t.ymax-t.ymin};for(let{seg:r,circle:a}of this.#t.retrieve(n))if(r){let s=r.intersect(t);s.length>0&&e.push({seg:r,points:s})}else{let s=a.intersect(t);s.length>0&&e.push({circle:a,points:s})}return e}};var B=class{x;y;velocity;constructor(t,e,n=0,r=0){this.x=t,this.y=e,this.velocity=new m.Vector(n,r)}beforeUpdate(t){}onEntityCollide(t){}onOutOfWorld(t){}onUnderwater(){}onGroundCollide(t,e,n){return!0}onResolve(t,e){}};var sn=new Map;function Hi(i){for(let t of h.gameEntities){sn.set(t,{x:t.x,y:t.y,velocity:t.velocity.clone()});let e=1/i;if(t.beforeUpdate(e),t.type===1){let r=new m.Vector(0,t.mass*1540);t.velocity=t.velocity.add(r.multiply(e))}t.x+=t.velocity.x*e,t.y+=t.velocity.y*e}for(let t of h.gameEntities){if(t.collideWithEntities)for(let a of h.gameEntities){if(a===t)continue;let s=new m.Box(t.x,t.y,t.x+t.width,t.y+t.height),l=new m.Box(a.x,a.y,a.x+a.width,a.y+a.height);s.intersect(l)&&t.onEntityCollide(a)}t.y<=-5e3||t.x>=5e3||t.x<=-5e3?(t.onOutOfWorld(!1),t.type===0&&h.gameEntities.delete(t)):t.y>=h.waterOffset+150&&(t.onOutOfWorld(!0),h.gameEntities.delete(t)),t.y>=h.waterOffset-t.height&&t.onUnderwater();let e=t.x-h.terrainOffsetX,n=t.y-h.terrainOffsetY,r=[];if(t.collideWithGround&&(r=h.terrain.intersects(new m.Box(e,n,e+t.width,n+t.height))),r.length>0){if(!t.onGroundCollide(e,n,r))continue;let s=sn.get(t);if(t.x=s.x,t.y=s.y,t.velocity=s.velocity,t.velocity.length<t.bounceThreshold){t.velocity=new m.Vector,t.onResolve(!0,r);continue}let l=r[0],f;l.circle?f=new m.Vector(l.points[0],l.circle.pc).normalize():f=new m.Vector(l.seg.ps,l.seg.pe).rotate90CCW().normalize();let d=f.multiply(t.velocity.dot(f)),u=t.velocity.subtract(d);t.velocity=u.multiply(t.COF).subtract(d.multiply(t.COR))}t.onResolve(!1,r)}sn.clear()}var $a=He((...i)=>{console.log(...i)},75),an=!1,ut=class extends B{type=0;width=6;height=6;COF=1;COR=1;bounceThreshold=1/0;collideWithEntities=!1;mass=1;get collideWithGround(){return this.active}i;active=!0;checkpoint=!1;halfWidth=this.width/2;halfHeight=this.height/2;beforeUpdateFired=!1;updateToMatchChar(t){let e=h.currentControlledChar.collider,n=e.pointX,r=e.pointY;t&&(n=e.initialPointX,r=e.initialPointY);let a=new m.Vector(new m.Point(n,r),new m.Point(e.x+e.width/2,e.y+e.height/2)),s=(this.i-globalThis.point_i)*10;this.x=n+s*Math.cos(a.slope)-this.halfWidth,this.y=r+s*Math.sin(a.slope)-this.halfHeight}beforeUpdate(t){let e=h.currentControlledChar.collider;this.beforeUpdateFired=!0,an=!1,e.testGavnina===!1&&(e.testGavnina=!0),this.active&&this.updateToMatchChar(!1)}onGroundCollide(t,e,n){if(an)return!1;let r=h.currentControlledChar.collider,a=new m.Point(r.pointX??r.initialPointX,r.pointY??r.initialPointY),[s]=a.distanceTo(new m.Point(r.x+r.width/2,r.y+r.height/2)),[l]=a.distanceTo(new m.Point(this.x+this.halfWidth,this.y+this.halfHeight));if(l<s){if(this.beforeUpdateFired===!1)return r.testGavnina=!1,!1;r.x=r.prevState.x,r.y=r.prevState.y,r.velocity=r.prevState.velocity,r.magnitude=r.prevState.magnitude;for(let f of h.hookSegments)f.active&&f.updateToMatchChar(!1);an=!0,this.checkpoint=!0,this.arr=[this,r.pointX,r.pointY,new m.Vector(new m.Point(r.pointX,r.pointY),new m.Point(r.x+r.width/2,r.y+r.height/2)),globalThis.point_i,r.magnitude<0?"LEFT":r.magnitude===0?"STOP":"RIGHT"];for(let f=0;f<this.i-1+1;f++)h.hookSegments[f].active=!1;r.pointX=this.x+this.halfWidth,r.pointY=this.y+this.halfHeight,globalThis.point_i=this.i}return!1}onResolve(t,e){let n=h.currentControlledChar.collider,r=h.hookSegments;if(this!==r[0])return;let a=new Array;for(let s of r)s.checkpoint&&a.push(s);a.reverse(),a=a.slice(0,1);for(let s of a){let[l,f,d,u,c,_]=s.arr,w=new m.Vector(new m.Point(f,d),new m.Point(n.x+n.width/2,n.y+n.height/2)).cross(u);if(_==="RIGHT"&&w<0||_==="LEFT"&&w>0){if($a("join"),c===0)for(let b of r)b.active=!0;else for(let b of r)b.i>c&&(b.active=!0);n.pointX=f,n.pointY=d,globalThis.point_i=c,l.checkpoint=!1;break}}}};var Ji=450,ct=class extends B{type=0;width=10;height=10;COF=1;COR=1;bounceThreshold=9e3;collideWithEntities=!1;collideWithGround=!0;mass=1;halfWidth=this.width/2;halfHeight=this.height/2;beforeUpdate(t){let e=h.currentControlledChar.collider;if(e.testGavnina===!1){let[n]=new m.Point(e.x,e.y).distanceTo(new m.Point(this.x+this.halfWidth,this.y+this.halfHeight));n>Ji&&(h.gameEntities.delete(this),zt("idle"))}}onResolve(t,e){if(e.length>0){this.collideWithGround=!1,h.hookShot=this;let n=10;globalThis.point_i=0;let r=this.x+this.halfWidth,a=this.y+this.halfHeight,s=h.currentControlledChar.collider;s.initialPointX=r,s.initialPointY=a,h.hookSegments=[];for(let l=1;l<Ji/n;l++){let f=new ut(0,0,0,0);f.i=l,f.updateToMatchChar(!0),h.gameEntities.add(f),h.hookSegments.push(f)}}}};var Yt=class extends B{type=1;width=15;height=25;COF=.3;COR=.5;bounceThreshold=75;collideWithEntities=!1;collideWithGround=!0;mass=1;angle=0;boom=Qe(()=>{setTimeout(()=>{h.holes2.push({cx:this.x,cy:this.y,r:75}),h.terrain.makeHole(this.x,this.y,75),h.gameEntities.delete(this),M("grenadeExplosion");let t=new m.Circle(new m.Point(this.x,this.y),90);for(let e of h.gameEntities)if(!(e instanceof ut||e instanceof ct)){for(let n of new m.Box(e.x,e.y,e.x+e.width,e.y+e.height).toPoints())if(t.contains(n)){let r=new m.Vector(0,-1e3);e.velocity=e.velocity.add(r);break}}},1e3)});beforeUpdate(t){let e=r(this.velocity.slope),n=40;this.angle+=this.velocity.length/n*(e>270||e<90?1:-1)*t,this.angle%=Math.PI*2;function r(a){var s=Math.PI;return a*(180/s)}}onResolve(t,e){e.length>0&&!t&&M("grenadeBounce"),t&&this.boom()}onOutOfWorld(t){t&&M("waterSplash1")}};var Xt=class extends B{type=1;width=20;height=20;COF=1;COR=1;bounceThreshold=1e3;collideWithEntities=!0;collideWithGround=!0;mass=1;beforeUpdate(t){let e=new m.Vector(-1e3,0);this.velocity=this.velocity.add(e.multiply(t))}onOutOfWorld(t){t&&M("waterSplash1")}onGroundCollide(t,e,n){return this.boom(),!1}boom(){h.holes2.push({cx:this.x,cy:this.y,r:75}),h.terrain.makeHole(this.x,this.y,75),h.gameEntities.delete(this),M("rocketExplosion")}};var Qt=class extends B{type=0;width=10;height=10;COF=1;COR=1;bounceThreshold=1e3;collideWithEntities=!0;collideWithGround=!0;mass=1;beforeUpdate(t){}onOutOfWorld(t){t&&M("waterSplash1")}onGroundCollide(t,e,n){return this.boom(),!1}boom(){h.holes2.push({cx:this.x,cy:this.y,r:30}),h.terrain.makeHole(this.x,this.y,30),h.gameEntities.delete(this),M("grenadeExplosion")}};var Ht=class extends B{type=1;width=13;height=60;COF=.7;COR=.15;bounceThreshold=1100;collideWithEntities=!1;collideWithGround=!0;mass=1;_testGavnina=!1;pointX;pointY;initialPointX;initialPointY;aVelocity=0;pull="none";prevState;set testGavnina(t){if(this._testGavnina=t,t){zt("rope"),this.type=0,this.bounceThreshold=1/0;let e=h.hookShot;this.pointX=e.x+e.halfWidth,this.pointY=e.y+e.halfHeight;let n=new m.Vector(new m.Point(this.x+this.width/2,this.y+this.height/2),new m.Point(this.pointX,this.pointY)),r=n.slope;this.aVelocity=(r>=1.5*Math.PI||r<=.5*Math.PI?this.velocity.length:-this.velocity.length)/2,this.aVelocity=n.cross(this.velocity)/300,this.aVelocity=n.normalize().cross(this.velocity)*.66,console.log(this.aVelocity),this.velocity=new m.Vector}else{this.type=1,this.bounceThreshold=1100,h.gameEntities.delete(h.hookShot);for(let e of h.hookSegments)h.gameEntities.delete(e);zt("idle")}}get testGavnina(){return this._testGavnina}beforeUpdate(t){if(this.prevState={x:this.x,y:this.y,velocity:this.velocity,magnitude:this.aVelocity},this.testGavnina===!1)return;let e=new m.Point(this.x+this.width/2,this.y+this.height/2),n=new m.Point(this.pointX,this.pointY),r=new m.Vector(e,n),a=4,s=.997,l=new m.Vector(0,1).cross(r)/r.length,f=r.length;this.aVelocity+=-1*a*l,this.aVelocity*=s;let d=r.normalize().multiply(this.aVelocity),u=d.rotate90CCW(),c=new m.Vector(0,0);if(this.pull==="W")c=d.normalize().multiply(this.aVelocity>0?200:-200);else if(this.pull==="S"){let _=h.hookSegments.at(-1),[w]=n.distanceTo(e),[b]=n.distanceTo(new m.Point(_.x+_.halfWidth,_.y+_.halfHeight));b<w||(c=d.normalize().multiply(this.aVelocity>0?-200:200))}this.velocity=u.add(d.multiply(t).add(c))}onGroundCollide(t,e,n){this.testGavnina===!0&&(this.aVelocity=this.aVelocity*-1);let r=e,a=e+this.height,s=e+this.height*.75,l;for(let f of n)for(let d of f.points)if(d.y>=s){l=!0;break}if(l===!0)for(let f of h.characters)f.collider===this&&(f.animState.anim.spriteName==="rabbitJump"||f.animState.anim.spriteName==="rabbitJumpBack")&&(f.animState=new V(N.rabbitBreath));return!0}onResolve(t){if(this.testGavnina!==!0&&h.characters.size){let e=[...h.characters][0],n=e.collider;if(n.velocity.length>90){e.animState.anim.spriteName==="rabbitGo"&&(e.animState=new V(N.rabbitBreath));return}if(globalThis.walkingMode){let l=function(){let d=150/Ee*(e.looksToLeft?-1:1),u=0;for(let c=s;c<=s*8;c+=s)if(h.terrain.intersects(new m.Box(r+d,a+c,r+d+n.width,a+c+n.height)).length!==0){u=c-s;break}if(u>0){n.y+=u,n.x+=d;return}for(let c=0;c<=s*7;c+=s)if(h.terrain.intersects(new m.Box(r+d,a-c,r+d+n.width,a-c+n.height)).length===0){n.y-=c,n.x+=d;return}},r=n.x-h.terrainOffsetX,a=n.y-h.terrainOffsetY,s=7.5/8;l()}}}onUnderwater(){this.testGavnina===!0&&(this.testGavnina=!1),this.velocity=new m.Vector,this.x=Gt(300,2900),this.y=-300}};globalThis.curWeap="bazooka";var Ee=144;function Ki(i,t){let n=0;for(let r of i)for(let a of r)a.y>n&&(n=a.y);un({terrain:new on(i),waterOffset:n-150,gameEntities:new Set,characters:new Set,weaponBoxes:new Set,holes2:[],terrainOffsetX:0,terrainOffsetY:0}),setInterval(function(){if(h.weaponBoxes.size===25)return;let a=new tr(Gt(300,2900),-300);h.gameEntities.add(a.collider),h.weaponBoxes.add(a)},3e3),setInterval(Ga,1e3/Ee)}var Zi=class extends B{type=1;width=30;height=30;COF=.7;COR=.15;bounceThreshold=100;collideWithEntities=!0;collideWithGround=!0;mass=1;onOutOfWorld(){}onEntityCollide(t){t instanceof Ht&&(h.gameEntities.delete(this),[...h.weaponBoxes].forEach(e=>{e.collider===this&&h.weaponBoxes.delete(e)}))}},tr=class{collider;creationTime;constructor(t,e){this.collider=new Zi(t,e),this.creationTime=performance.now()}},ln=class{collider;looksToLeft;name;health;team;animState;constructor(t,e,n){this.collider=t,this.looksToLeft=!1,this.name=e,this.health=530,this.team=n}get isGrounded(){return this.collider.velocity.x===0&&this.collider.velocity.y===0}startMoving(t){this.animState.anim.spriteName!=="rabbitPrepareToJump"&&this.isGrounded&&(this.looksToLeft=t,globalThis.walkingMode=!0,this.animState.anim.spriteName!=="rabbitGo"&&(this.animState=new V(N.rabbitGo)))}stopMoving(){delete globalThis.walkingMode,this.animState.anim.spriteName==="rabbitGo"&&(this.animState=new V(N.rabbitBreath))}startJumping(t){this.animState.anim.spriteName!=="rabbitPrepareToJump"&&(globalThis.walkingMode||this.isGrounded)&&(delete globalThis.walkingMode,globalThis.startJumpAnim=t,this.animState=new V(N.rabbitPrepareToJump))}};function Ga(){for(let i of h.characters)if(i.animState.anim.spriteName==="rabbitPrepareToJump"){let t=performance.now()-i.animState.startTime,e=1e3/24;if(t>=i.animState.anim.frameCount*e)if(globalThis.startJumpAnim==="FORWARD"){if(i.animState=new V(N.rabbitJump),i.collider.testGavnina)continue;i.collider.velocity=new m.Vector(i.looksToLeft?-265:265,-420)}else{if(i.animState=new V(N.rabbitJumpBack),i.collider.testGavnina)continue;i.collider.velocity=new m.Vector(i.looksToLeft?60:-60,-575)}}Hi(Ee*(globalThis.bulletTime?7:1))}function er(i,t){let e=[...h.characters][0],n=1500;t<1e3&&(n=75*Math.ceil(t/50)),curWeap==="rifle"?n=1500:curWeap==="hook"&&(n=1400);let r=(e.looksToLeft?i+90:450-i)*Math.PI/180,a=n*Math.cos(r),s=n*Math.sin(r);switch(curWeap){case"gren":h.gameEntities.add(new Yt(e.collider.x,e.collider.y,a,s)),M("grenadeAttack");break;case"bazooka":h.gameEntities.add(new Xt(e.collider.x,e.collider.y,a,s)),M("rocketAttack");break;case"rifle":M("grenadeAttack"),h.gameEntities.add(new Qt(e.collider.x,e.collider.y,a,s));break;case"hook":h.gameEntities.add(new ct(e.collider.x+e.collider.width/2,e.collider.y+e.collider.height/2,a,s)),M("grenadeAttack");break}}var Wa={Date:!0,RegExp:!0,String:!0,Number:!0};function Te(i,t,e={cyclesFix:!0},n=[]){let r=[],a=Array.isArray(i);for(let l in i){let f=i[l],d=a?+l:l;if(!(l in t)){r.push({type:"REMOVE",path:[d],oldValue:i[l]});continue}let u=t[l],c=typeof f=="object"&&typeof u=="object";if(f&&u&&c&&!Wa[Object.getPrototypeOf(f).constructor.name]&&(e.cyclesFix?!n.includes(f):!0)){let _=Te(f,u,e,e.cyclesFix?n.concat([f]):[]);r.push.apply(r,_.map(w=>(w.path.unshift(d),w)))}else f!==u&&!(c&&(isNaN(f)?f+""==u+"":+f==+u))&&r.push({path:[d],type:"CHANGE",value:u,oldValue:f})}let s=Array.isArray(t);for(let l in t)l in i||r.push({type:"CREATE",path:[s?+l:l],value:t[l]});return r}globalThis.onmessage=async i=>{let t=i.data,e=t.params,n;switch(h&&h.characters&&(n=[...h.characters][0]),t.method){case"join":{try{let s=await fetch(`./${t.params.map}.json`);if(s.ok===!1)throw new Error("");Ki(await s.json(),t.params.map)}catch(s){throw s}let r=new Ht(1570,-200);h.gameEntities.add(r);let a=new ln(r,t.params.nickname??"\u041F\u0435\u0442\u044F",Math.random()>.5?1:0);a.animState=new V(N.rabbitBreath),h.characters.add(a),h.currentControlledChar=a,globalThis.postMessage({type:"debug",data:[h.terrain.polygons]}),fn(!0),setTimeout(fn,1e3/ir);break}case"stopMoving":n.stopMoving();break;case"startMoving":n.startMoving(e.direction);break;case"startJumping":n.startJumping(e.direction);break;case"setWeapon":globalThis.curWeap=e.name;break;case"fireTest":er(e.angle,e.force);break;case"toggleBulletTime":globalThis.bulletTime=!globalThis.bulletTime;break;case"stopPull":n.collider.pull="none";break;case"startPull":n.collider.pull=e.direction;break;case"deattach":n.collider.testGavnina===!0&&(n.collider.testGavnina=!1);break;case"changeDirection":n.looksToLeft=e.direction;break;case"makeHole":return h.holes2.push({cx:e.cx,cy:e.cy,r:60}),h.terrain.makeHole(e.cx,e.cy,60),new Response(JSON.stringify({result:{data:""}}))}};var nr={},ir=64;async function fn(i=!1){let t={characters:[...h.characters].map(n=>({name:n.name,health:n.health,team:n.team,colX:n.collider.x,colY:n.collider.y,colWidth:n.collider.width,colHeight:n.collider.height,direction:n.looksToLeft,visual:n.animState})),weaponBoxes:[...h.weaponBoxes].map(n=>({colX:n.collider.x,colY:n.collider.y,colWidth:n.collider.width,colHeight:n.collider.height,creationTime:n.creationTime})),holes:[...h.holes2],meta:{terrainOffsetX:h.terrainOffsetX,terrainOffsetY:h.terrainOffsetY,waterOffset:h.waterOffset}};t.testGrenades=[];for(let n of h.gameEntities)n instanceof Yt&&t.testGrenades.push({x:n.x,y:n.y,w:n.width,h:n.height,angle:n.angle});t.testBullets=[];for(let n of h.gameEntities)n instanceof Qt&&t.testBullets.push({x:n.x,y:n.y,w:n.width,h:n.height,angle:n.velocity.slope});t.testBazookas=[];for(let n of h.gameEntities)n instanceof Xt&&t.testBazookas.push({x:n.x,y:n.y,w:n.width,h:n.height,angle:n.velocity.slope});t.testHookShot=[];for(let n of h.gameEntities)n instanceof ct&&t.testHookShot.push({x:n.x,y:n.y,w:n.width,h:n.height});t.testHookSegments=[];for(let n of h.gameEntities)if(n instanceof ut){let a=[...h.characters][0].collider;if(a.pointX===void 0)continue;let s=new m.Vector(new m.Point(a.pointX,a.pointY),new m.Point(a.x+a.width/2,a.y+a.height/2)),l=new m.Vector(new m.Point(a.pointX,a.pointY),new m.Point(n.x+n.width/2,n.y+n.height/2));(n.active===!1||l.length<s.length)&&t.testHookSegments.push({x:n.x,y:n.y,w:n.width,h:n.height})}let e=Te(nr,t,{cyclesFix:!1});nr=t,globalThis.postMessage({type:"fullSnapshot",data:t}),setTimeout(fn,1e3/ir)}function M(i){globalThis.postMessage({type:"playSound",data:i})}function zt(i){globalThis.postMessage({type:"setInputMode",data:i})}})();
/**
 * @license
 * Lodash (Custom Build) <https://lodash.com/>
 * Build: `lodash modularize exports="es" -o ./`
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
/**
 * quadtree-js
 * @version 1.2.5
 * @license MIT
 * @author Timo Hausmann
 */
