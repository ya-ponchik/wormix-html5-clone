var Ha=Object.create;var Ot=Object.defineProperty;var za=Object.getOwnPropertyDescriptor;var Ja=Object.getOwnPropertyNames;var Ya=Object.getPrototypeOf,Xa=Object.prototype.hasOwnProperty;var Qa=(r,e,t)=>e in r?Ot(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Ka=r=>Ot(r,"__esModule",{value:!0});var Za=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),ai=(r,e)=>{for(var t in e)Ot(r,t,{get:e[t],enumerable:!0})},ef=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Ja(e))!Xa.call(r,i)&&(t||i!=="default")&&Ot(r,i,{get:()=>e[i],enumerable:!(n=za(e,i))||n.enumerable});return r},tf=(r,e)=>ef(Ka(Ot(r!=null?Ha(Ya(r)):{},"default",!e&&r&&r.__esModule?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r);var Ie=(r,e,t)=>(Qa(r,typeof e!="symbol"?e+"":e,t),t);var fi=Za((Ct,Yr)=>{(function(e,t){typeof Ct=="object"&&typeof Yr=="object"?Yr.exports=t():typeof define=="function"&&define.amd?define("Centrifuge",[],t):typeof Ct=="object"?Ct.Centrifuge=t():e.Centrifuge=t()})(Ct,function(){return function(){"use strict";var r={382:function(i,o,s){Object.defineProperty(o,"__esModule",{value:!0}),o.Centrifuge=void 0;var l=v(s(187)),c=v(s(471)),h=s(147),d=s(853);function v(g){return g&&g.__esModule?g:{default:g}}function x(g){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?x=function(E){return typeof E}:x=function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},x(g)}function y(g,b){if(!(g instanceof b))throw new TypeError("Cannot call a class as a function")}function I(g,b){for(var E=0;E<b.length;E++){var m=b[E];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(g,m.key,m)}}function w(g,b,E){return b&&I(g.prototype,b),E&&I(g,E),g}function O(g,b){if(typeof b!="function"&&b!==null)throw new TypeError("Super expression must either be null or a function");g.prototype=Object.create(b&&b.prototype,{constructor:{value:g,writable:!0,configurable:!0}}),b&&C(g,b)}function C(g,b){return C=Object.setPrototypeOf||function(m,f){return m.__proto__=f,m},C(g,b)}function L(g){var b=q();return function(){var m=F(g),f;if(b){var u=F(this).constructor;f=Reflect.construct(m,arguments,u)}else f=m.apply(this,arguments);return P(this,f)}}function P(g,b){if(b&&(x(b)==="object"||typeof b=="function"))return b;if(b!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return U(g)}function U(g){if(g===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g}function q(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function F(g){return F=Object.setPrototypeOf?Object.getPrototypeOf:function(E){return E.__proto__||Object.getPrototypeOf(E)},F(g)}var j="timeout",D="connection closed",T=function(g){O(E,g);var b=L(E);function E(m,f){var u;return y(this,E),u=b.call(this),u._url=m,u._websocket=null,u._sockjs=null,u._isSockjs=!1,u._xmlhttprequest=null,u._binary=!1,u._methodType=null,u._pushType=null,u._encoder=null,u._decoder=null,u._status="disconnected",u._reconnect=!0,u._reconnecting=!1,u._transport=null,u._transportName=null,u._transportClosed=!0,u._messageId=0,u._clientID=null,u._refreshRequired=!1,u._subs={},u._serverSubs={},u._lastSeq={},u._lastGen={},u._lastOffset={},u._lastEpoch={},u._messages=[],u._isBatching=!1,u._isSubscribeBatching=!1,u._privateChannels={},u._numRefreshFailed=0,u._refreshTimeout=null,u._pingTimeout=null,u._pongTimeout=null,u._subRefreshTimeouts={},u._retries=0,u._callbacks={},u._latency=null,u._latencyStart=null,u._connectData=null,u._token=null,u._xhrID=0,u._xhrs={},u._dispatchPromise=Promise.resolve(),u._protocol="",u._config={protocol:"",debug:!1,name:"js",version:"",websocket:null,sockjs:null,xmlhttprequest:null,minRetry:1e3,maxRetry:2e4,timeout:5e3,ping:!0,pingInterval:25e3,pongWaitTimeout:5e3,privateChannelPrefix:"$",onTransportClose:null,sockjsServer:null,sockjsTimeout:null,sockjsTransports:["websocket","xdr-streaming","xhr-streaming","eventsource","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"],refreshEndpoint:"/centrifuge/refresh",refreshHeaders:{},refreshParams:{},refreshData:{},refreshAttempts:null,refreshInterval:1e3,onRefreshFailed:null,onRefresh:null,subscribeEndpoint:"/centrifuge/subscribe",subscribeHeaders:{},subscribeParams:{},subRefreshInterval:1e3,onPrivateSubscribe:null,disableWithCredentials:!1},u._configure(f),u}return w(E,[{key:"setToken",value:function(f){this._token=f}},{key:"setConnectData",value:function(f){this._connectData=f}},{key:"setRefreshHeaders",value:function(f){this._config.refreshHeaders=f}},{key:"setRefreshParams",value:function(f){this._config.refreshParams=f}},{key:"setRefreshData",value:function(f){this._config.refreshData=f}},{key:"setSubscribeHeaders",value:function(f){this._config.subscribeHeaders=f}},{key:"setSubscribeParams",value:function(f){this._config.subscribeParams=f}},{key:"_ajax",value:function(f,u,p,_,S){var R=this,B="";this._debug("sending AJAX request to",f,"with data",JSON.stringify(_));var M;this._xmlhttprequest!==null?M=new this._xmlhttprequest:M=s.g.XMLHttpRequest?new s.g.XMLHttpRequest:new s.g.ActiveXObject("Microsoft.XMLHTTP");for(var G in u)u.hasOwnProperty(G)&&(B.length>0&&(B+="&"),B+=encodeURIComponent(G)+"="+encodeURIComponent(u[G]));B.length>0&&(B="?"+B),M.open("POST",f+B,!0),"withCredentials"in M&&(M.withCredentials=!this._config.disableWithCredentials),M.setRequestHeader("X-Requested-With","XMLHttpRequest"),M.setRequestHeader("Content-Type","application/json");for(var X in p)p.hasOwnProperty(X)&&M.setRequestHeader(X,p[X]);return M.onreadystatechange=function(){if(M.readyState===4)if(M.status===200){var Q,H=!1;try{Q=JSON.parse(M.responseText),H=!0}catch{S({error:"Invalid JSON. Data was: "+M.responseText,status:200,data:null})}H&&S({data:Q,status:200})}else R._log("wrong status code in AJAX response",M.status),S({status:M.status,data:null})},setTimeout(function(){return M.send(JSON.stringify(_))},20),M}},{key:"_log",value:function(){(0,d.log)("info",arguments)}},{key:"_debug",value:function(){this._config.debug===!0&&(0,d.log)("debug",arguments)}},{key:"_websocketSupported",value:function(){return this._config.websocket!==null?!0:!(typeof WebSocket!="function"&&(typeof WebSocket>"u"?"undefined":x(WebSocket))!=="object")}},{key:"_setFormat",value:function(f){if(!this._formatOverride(f)){if(f==="protobuf")throw new Error("not implemented by JSON only Centrifuge client \u2013 use client with Protobuf");this._binary=!1,this._methodType=h.JsonMethodType,this._pushType=h.JsonPushType,this._encoder=new h.JsonEncoder,this._decoder=new h.JsonDecoder}}},{key:"_formatOverride",value:function(f){return!1}},{key:"_configure",value:function(f){if(!("Promise"in s.g))throw new Error("Promise polyfill required");if((0,d.extend)(this._config,f||{}),this._debug("centrifuge config",this._config),!this._url)throw new Error("url required");var u=(0,d.startsWith)(this._url,"ws")&&this._url.indexOf("format=protobuf")>-1;if(u||this._config.protocol==="protobuf")this._setFormat("protobuf"),this._protocol="protobuf";else{if(this._config.protocol!==""&&this._config.protocol!=="json")throw new Error("unsupported protocol "+this._config.protocol);this._setFormat("json")}if((0,d.startsWith)(this._url,"http"))if(this._debug("client will try to connect to SockJS endpoint"),this._config.sockjs!==null)this._debug("SockJS explicitly provided in options"),this._sockjs=this._config.sockjs;else{if(typeof s.g.SockJS>"u")throw new Error("SockJS not found, use ws:// in url or include SockJS");this._debug("use globally defined SockJS"),this._sockjs=s.g.SockJS}else this._debug("client will connect to websocket endpoint");this._xmlhttprequest=this._config.xmlhttprequest}},{key:"_setStatus",value:function(f){this._status!==f&&(this._debug("Status",this._status,"->",f),this._status=f)}},{key:"_isDisconnected",value:function(){return this._status==="disconnected"}},{key:"_isConnecting",value:function(){return this._status==="connecting"}},{key:"_isConnected",value:function(){return this._status==="connected"}},{key:"_nextMessageId",value:function(){return++this._messageId}},{key:"_resetRetry",value:function(){this._debug("reset retries count to 0"),this._retries=0}},{key:"_getRetryInterval",value:function(){var f=(0,d.backoff)(this._retries,this._config.minRetry,this._config.maxRetry);return this._retries+=1,f}},{key:"_abortInflightXHRs",value:function(){for(var f in this._xhrs){try{this._xhrs[f].abort()}catch(u){this._debug("error aborting xhr",u)}delete this._xhrs[f]}}},{key:"_clearConnectedState",value:function(f){this._clientID=null,this._stopPing();for(var u in this._callbacks)if(this._callbacks.hasOwnProperty(u)){var p=this._callbacks[u];clearTimeout(p.timeout);var _=p.errback;if(!_)continue;_({error:this._createErrorObject("disconnected")})}this._callbacks={};for(var S in this._subs)if(this._subs.hasOwnProperty(S)){var R=this._subs[S];f?(R._isSuccess()&&(R._triggerUnsubscribe(),R._recover=!0),R._shouldResubscribe()&&R._setSubscribing()):R._setUnsubscribed()}this._abortInflightXHRs(),this._refreshTimeout!==null&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null);for(var B in this._subRefreshTimeouts)this._subRefreshTimeouts.hasOwnProperty(B)&&this._subRefreshTimeouts[B]&&this._clearSubRefreshTimeout(B);this._subRefreshTimeouts={},this._reconnect||(this._subs={})}},{key:"_isTransportOpen",value:function(){return this._isSockjs?this._transport&&this._transport.transport&&this._transport.transport.readyState===this._transport.transport.OPEN:this._transport&&this._transport.readyState===this._transport.OPEN}},{key:"_transportSend",value:function(f){if(!f.length)return!0;if(!this._isTransportOpen()){for(var u in f){var p=u.id;if(p in this._callbacks){var _=this._callbacks[p];clearTimeout(this._callbacks[p].timeout),delete this._callbacks[p];var S=_.errback;S({error:this._createErrorObject(D,0)})}}return!1}return this._transport.send(this._encoder.encodeCommands(f)),!0}},{key:"_getSubProtocol",value:function(){return this._protocol?"centrifuge-"+this._protocol:""}},{key:"_setupTransport",value:function(){var f=this;if(this._isSockjs=!1,this._sockjs!==null){var u={transports:this._config.sockjsTransports};this._config.sockjsServer!==null&&(u.server=this._config.sockjsServer),this._config.sockjsTimeout!==null&&(u.timeout=this._config.sockjsTimeout),this._isSockjs=!0,this._transport=new this._sockjs(this._url,null,u)}else{if(!this._websocketSupported())throw this._debug("No Websocket support and no SockJS configured, can not connect"),new Error("No Websocket support and no SockJS configured, can not connect");this._config.websocket!==null?this._websocket=this._config.websocket:this._websocket=WebSocket;var p=this._getSubProtocol();p!==""?this._transport=new this._websocket(this._url,p):this._transport=new this._websocket(this._url),this._binary===!0&&(this._transport.binaryType="arraybuffer")}this._transport.onopen=function(){f._transportClosed=!1,f._isSockjs?(f._transportName="sockjs-"+f._transport.transport,f._transport.onheartbeat=function(){return f._restartPing()}):f._transportName="websocket";var _={};(f._token||f._connectData||f._config.name||f._config.version)&&(_.params={}),f._token&&(_.params.token=f._token),f._connectData&&(_.params.data=f._connectData),f._config.name&&(_.params.name=f._config.name),f._config.version&&(_.params.version=f._config.version);var S={},R=!1;for(var B in f._serverSubs)if(f._serverSubs.hasOwnProperty(B)&&f._serverSubs[B].recoverable){R=!0;var M={recover:!0};f._serverSubs[B].seq||f._serverSubs[B].gen?(f._serverSubs[B].seq&&(M.seq=f._serverSubs[B].seq),f._serverSubs[B].gen&&(M.gen=f._serverSubs[B].gen)):f._serverSubs[B].offset&&(M.offset=f._serverSubs[B].offset),f._serverSubs[B].epoch&&(M.epoch=f._serverSubs[B].epoch),S[B]=M}R&&(_.params||(_.params={}),_.params.subs=S),f._latencyStart=new Date,f._call(_).then(function(G){f._connectResponse(f._decoder.decodeCommandResult(f._methodType.CONNECT,G.result),R),G.next&&G.next()},function(G){var X=G.error;X.code===109&&(f._refreshRequired=!0),f._disconnect("connect error",!0),G.next&&G.next()})},this._transport.onerror=function(_){f._debug("transport level error",_)},this._transport.onclose=function(_){f._transportClosed=!0;var S=D,R=!0;if(_&&"reason"in _&&_.reason)try{var B=JSON.parse(_.reason);f._debug("reason is an advice object",B),S=B.reason,R=B.reconnect}catch{S=_.reason,f._debug("reason is a plain string",S)}if(f._config.onTransportClose!==null&&f._config.onTransportClose({event:_,reason:S,reconnect:R}),f._disconnect(S,R),f._reconnect===!0){f._reconnecting=!0;var M=f._getRetryInterval();f._debug("reconnect after "+M+" milliseconds"),setTimeout(function(){f._reconnect===!0&&(f._refreshRequired?f._refresh():f._connect())},M)}},this._transport.onmessage=function(_){f._dataReceived(_.data)}}},{key:"rpc",value:function(f){return this._rpc("",f)}},{key:"namedRPC",value:function(f,u){return this._rpc(f,u)}},{key:"_rpc",value:function(f,u){var p={data:u};f!==""&&(p.method=f);var _={method:this._methodType.RPC,params:p};return this._methodCall(_,function(S){return S})}},{key:"send",value:function(f){var u={method:this._methodType.SEND,params:{data:f}};if(!this.isConnected())return Promise.reject(this._createErrorObject(D,0));var p=this._transportSend([u]);return p?Promise.resolve({}):Promise.reject(this._createErrorObject(D,0))}},{key:"_getHistoryParams",value:function(f,u){var p={channel:f};return u!==void 0&&(u.since&&(p.since={offset:u.since.offset},u.since.epoch&&(p.since.epoch=u.since.epoch)),u.limit!==void 0&&(p.limit=u.limit),u.reverse===!0&&(p.reverse=!0)),p}},{key:"_methodCall",value:function(f,u){var p=this;return this.isConnected()?new Promise(function(_,S){p._call(f).then(function(R){_(u(p._decoder.decodeCommandResult(f.method,R.result))),R.next&&R.next()},function(R){S(R.error),R.next&&R.next()})}):Promise.reject(this._createErrorObject(D,0))}},{key:"publish",value:function(f,u){var p={method:this._methodType.PUBLISH,params:{channel:f,data:u}};return this._methodCall(p,function(){return{}})}},{key:"history",value:function(f,u){var p=this._getHistoryParams(f,u),_={method:this._methodType.HISTORY,params:p};return this._methodCall(_,function(S){return{publications:S.publications,epoch:S.epoch||"",offset:S.offset||0}})}},{key:"presence",value:function(f){var u={method:this._methodType.PRESENCE,params:{channel:f}};return this._methodCall(u,function(p){return{presence:p.presence}})}},{key:"presenceStats",value:function(f){var u={method:this._methodType.PRESENCE_STATS,params:{channel:f}};return this._methodCall(u,function(p){return{num_users:p.num_users,num_clients:p.num_clients}})}},{key:"_dataReceived",value:function(f){var u=this,p=this._decoder.decodeReplies(f);this._dispatchPromise=this._dispatchPromise.then(function(){var _;u._dispatchPromise=new Promise(function(S){_=S}),u._dispatchSynchronized(p,_)}),this._restartPing()}},{key:"_dispatchSynchronized",value:function(f,u){var p=this,_=Promise.resolve(),S=function(M){f.hasOwnProperty(M)&&(_=_.then(function(){return p._dispatchReply(f[M])}))};for(var R in f)S(R);_=_.then(function(){u()})}},{key:"_dispatchReply",value:function(f){var u,p=new Promise(function(S){u=S});if(f==null)return this._debug("dispatch: got undefined or null reply"),u(),p;var _=f.id;return _&&_>0?this._handleReply(f,u):this._handlePush(f.result,u),p}},{key:"_call",value:function(f){var u=this;return new Promise(function(p,_){var S=u._addMessage(f);u._registerCall(S,p,_)})}},{key:"_connect",value:function(){if(this.isConnected()){this._debug("connect called when already connected");return}this._status!=="connecting"&&(this._debug("start connecting"),this._setStatus("connecting"),this._clientID=null,this._reconnect=!0,this._setupTransport())}},{key:"_disconnect",value:function(f,u){var p=u||!1;if(p===!1&&(this._reconnect=!1),this._isDisconnected()){p||this._clearConnectedState(p);return}if(this._clearConnectedState(p),this._debug("disconnected:",f,u),this._setStatus("disconnected"),this._refreshTimeout&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null),this._reconnecting===!1){for(var _ in this._serverSubs)this._serverSubs.hasOwnProperty(_)&&this.emit("unsubscribe",{channel:_});this.emit("disconnect",{reason:f,reconnect:p})}p===!1&&(this._subs={},this._serverSubs={}),this._transportClosed||this._transport.close()}},{key:"_refreshFailed",value:function(){this._numRefreshFailed=0,this._isDisconnected()||this._disconnect("refresh failed",!1),this._config.onRefreshFailed!==null&&this._config.onRefreshFailed()}},{key:"_refresh",value:function(){var f=this;if(this._debug("refresh token"),this._config.refreshAttempts===0){this._debug("refresh attempts set to 0, do not send refresh request at all"),this._refreshFailed();return}this._refreshTimeout!==null&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null);var u=this._clientID,p=this._newXHRID(),_=function(M){if(p in f._xhrs&&delete f._xhrs[p],f._clientID===u){if(M.error||M.status!==200){if(M.error?f._debug("error refreshing connection token",M.error):f._debug("error refreshing connection token: wrong status code",M.status),f._numRefreshFailed++,f._refreshTimeout!==null&&(clearTimeout(f._refreshTimeout),f._refreshTimeout=null),f._config.refreshAttempts!==null&&f._numRefreshFailed>=f._config.refreshAttempts){f._refreshFailed();return}var G=Math.round(Math.random()*1e3*Math.max(f._numRefreshFailed,20)),X=f._config.refreshInterval+G;f._refreshTimeout=setTimeout(function(){return f._refresh()},X);return}if(f._numRefreshFailed=0,f._token=M.data.token,!f._token){f._refreshFailed();return}if(f._isDisconnected()&&f._reconnect)f._debug("token refreshed, connect from scratch"),f._connect();else{f._debug("send refreshed token");var Q={method:f._methodType.REFRESH,params:{token:f._token}};f._call(Q).then(function(H){f._refreshResponse(f._decoder.decodeCommandResult(f._methodType.REFRESH,H.result)),H.next&&H.next()},function(H){f._refreshError(H.error),H.next&&H.next()})}}};if(this._config.onRefresh!==null){var S={};this._config.onRefresh(S,_)}else{var R=this._ajax(this._config.refreshEndpoint,this._config.refreshParams,this._config.refreshHeaders,this._config.refreshData,_);this._xhrs[p]=R}}},{key:"_refreshError",value:function(f){var u=this;this._debug("refresh error",f),this._refreshTimeout&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null);var p=this._config.refreshInterval+Math.round(Math.random()*1e3);this._refreshTimeout=setTimeout(function(){return u._refresh()},p)}},{key:"_refreshResponse",value:function(f){var u=this;this._refreshTimeout&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null),f.expires&&(this._clientID=f.client,this._refreshTimeout=setTimeout(function(){return u._refresh()},this._getTTLMilliseconds(f.ttl)))}},{key:"_newXHRID",value:function(){return this._xhrID++,this._xhrID}},{key:"_subRefresh",value:function(f){var u=this;if(this._debug("refresh subscription token for channel",f),this._subRefreshTimeouts[f]!==void 0)this._clearSubRefreshTimeout(f);else return;var p=this._clientID,_=this._newXHRID(),S=function(G){if(_ in u._xhrs&&delete u._xhrs[_],!(G.error||G.status!==200||u._clientID!==p)){var X={};if(G.data.channels)for(var Q in G.data.channels){var H=G.data.channels[Q];!H.channel||(X[H.channel]=H.token)}var Ke=X[f];if(!!Ke){var $r={method:u._methodType.SUB_REFRESH,params:{channel:f,token:Ke}},Qt=u._getSub(f);Qt!==null&&u._call($r).then(function(ye){u._subRefreshResponse(f,u._decoder.decodeCommandResult(u._methodType.SUB_REFRESH,ye.result)),ye.next&&ye.next()},function(ye){u._subRefreshError(f,ye.error),ye.next&&ye.next()})}}},R={client:this._clientID,channels:[f]};if(this._config.onPrivateSubscribe!==null)this._config.onPrivateSubscribe({data:R},S);else{var B=this._ajax(this._config.subscribeEndpoint,this._config.subscribeParams,this._config.subscribeHeaders,R,S);this._xhrs[_]=B}}},{key:"_clearSubRefreshTimeout",value:function(f){this._subRefreshTimeouts[f]!==void 0&&(clearTimeout(this._subRefreshTimeouts[f]),delete this._subRefreshTimeouts[f])}},{key:"_subRefreshError",value:function(f,u){var p=this;this._debug("subscription refresh error",f,u),this._clearSubRefreshTimeout(f);var _=this._getSub(f);if(_!==null){var S=Math.round(Math.random()*1e3),R=setTimeout(function(){return p._subRefresh(f)},this._config.subRefreshInterval+S);this._subRefreshTimeouts[f]=R}}},{key:"_subRefreshResponse",value:function(f,u){var p=this;this._debug("subscription refresh success",f),this._clearSubRefreshTimeout(f);var _=this._getSub(f);if(_!==null&&u.expires===!0){var S=setTimeout(function(){return p._subRefresh(f)},this._getTTLMilliseconds(u.ttl));this._subRefreshTimeouts[f]=S}}},{key:"_subscribe",value:function(f,u){var p=this;this._debug("subscribing on",f.channel);var _=f.channel;if(_ in this._subs||(this._subs[_]=f),!this.isConnected()){f._setNew();return}f._setSubscribing(u);var S={method:this._methodType.SUBSCRIBE,params:{channel:_}};if(f._subscribeData&&(S.params.data=f._subscribeData),(0,d.startsWith)(_,this._config.privateChannelPrefix))this._isSubscribeBatching?this._privateChannels[_]=!0:(this.startSubscribeBatching(),this._subscribe(f),this.stopSubscribeBatching());else{var R=f._needRecover();if(R===!0){S.params.recover=!0;var B=this._getLastSeq(_),M=this._getLastGen(_);if(B||M)B&&(S.params.seq=B),M&&(S.params.gen=M);else{var G=this._getLastOffset(_);G&&(S.params.offset=G)}var X=this._getLastEpoch(_);X&&(S.params.epoch=X)}this._call(S).then(function(Q){p._subscribeResponse(_,R,p._decoder.decodeCommandResult(p._methodType.SUBSCRIBE,Q.result)),Q.next&&Q.next()},function(Q){p._subscribeError(_,Q.error),Q.next&&Q.next()})}}},{key:"_unsubscribe",value:function(f){delete this._subs[f.channel],delete this._lastOffset[f.channel],delete this._lastSeq[f.channel],delete this._lastGen[f.channel],this.isConnected()&&this._addMessage({method:this._methodType.UNSUBSCRIBE,params:{channel:f.channel}})}},{key:"_getTTLMilliseconds",value:function(f){return Math.min(f*1e3,2147483647)}},{key:"getSub",value:function(f){return this._getSub(f)}},{key:"_getSub",value:function(f){var u=this._subs[f];return u||null}},{key:"_isServerSub",value:function(f){return this._serverSubs[f]!==void 0}},{key:"_connectResponse",value:function(f,u){var p=this,_=this._reconnecting;if(this._reconnecting=!1,this._resetRetry(),this._refreshRequired=!1,!this.isConnected()){this._latencyStart!==null&&(this._latency=new Date().getTime()-this._latencyStart.getTime(),this._latencyStart=null),this._clientID=f.client,this._setStatus("connected"),this._refreshTimeout&&clearTimeout(this._refreshTimeout),f.expires&&(this._refreshTimeout=setTimeout(function(){return p._refresh()},this._getTTLMilliseconds(f.ttl))),this.startBatching(),this.startSubscribeBatching();for(var S in this._subs)if(this._subs.hasOwnProperty(S)){var R=this._subs[S];R._shouldResubscribe()&&this._subscribe(R,_)}this.stopSubscribeBatching(),this.stopBatching(),this._startPing();var B={client:f.client,transport:this._transportName,latency:this._latency};f.data&&(B.data=f.data),this.emit("connect",B),f.subs&&this._processServerSubs(f.subs)}}},{key:"_processServerSubs",value:function(f){for(var u in f)if(f.hasOwnProperty(u)){var p=f[u],_=this._serverSubs[u]!==void 0,S={channel:u,isResubscribe:_};S=this._expandSubscribeContext(S,p),this.emit("subscribe",S)}for(var R in f)if(f.hasOwnProperty(R)){var B=f[R];if(B.recovered){var M=B.publications;if(M&&M.length>0){M.length>1&&(!M[0].offset||M[0].offset>M[1].offset)&&(M=M.reverse());for(var G in M)M.hasOwnProperty(G)&&this._handlePublication(R,M[G])}}this._serverSubs[R]={seq:B.seq,gen:B.gen,offset:B.offset,epoch:B.epoch,recoverable:B.recoverable}}}},{key:"_stopPing",value:function(){this._pongTimeout!==null&&(clearTimeout(this._pongTimeout),this._pongTimeout=null),this._pingTimeout!==null&&(clearTimeout(this._pingTimeout),this._pingTimeout=null)}},{key:"_startPing",value:function(){var f=this;this._config.ping!==!0||this._config.pingInterval<=0||!this.isConnected()||(this._pingTimeout=setTimeout(function(){if(!f.isConnected()){f._stopPing();return}f.ping(),f._pongTimeout=setTimeout(function(){f._disconnect("no ping",!0)},f._config.pongWaitTimeout)},this._config.pingInterval))}},{key:"_restartPing",value:function(){this._stopPing(),this._startPing()}},{key:"_subscribeError",value:function(f,u){var p=this._getSub(f);if(!!p&&!!p._isSubscribing()){if(u.code===0&&u.message===j){this._disconnect("timeout",!0);return}p._setSubscribeError(u)}}},{key:"_expandSubscribeContext",value:function(f,u){var p=!1;"recovered"in u&&(p=u.recovered),f.recovered=p;var _=!1;"positioned"in u&&(_=u.positioned);var S="";"epoch"in u&&(S=u.epoch);var R=0;return"offset"in u&&(R=u.offset),_&&(f.streamPosition={offset:R,epoch:S}),u.data&&(f.data=u.data),f}},{key:"_subscribeResponse",value:function(f,u,p){var _=this,S=this._getSub(f);if(!!S&&!!S._isSubscribing()){S._setSubscribeSuccess(p);var R=p.publications;if(R&&R.length>0){R.length>=2&&!R[0].offset&&!R[1].offset&&(R=R.reverse());for(var B in R)R.hasOwnProperty(B)&&this._handlePublication(f,R[B])}if(p.recoverable&&(!u||!p.recovered)&&(this._lastSeq[f]=p.seq||0,this._lastGen[f]=p.gen||0,this._lastOffset[f]=p.offset||0),this._lastEpoch[f]=p.epoch||"",p.recoverable&&(S._recoverable=!0),p.expires===!0){var M=setTimeout(function(){return _._subRefresh(f)},this._getTTLMilliseconds(p.ttl));this._subRefreshTimeouts[f]=M}}}},{key:"_handleReply",value:function(f,u){var p=f.id,_=f.result;if(!(p in this._callbacks)){u();return}var S=this._callbacks[p];if(clearTimeout(this._callbacks[p].timeout),delete this._callbacks[p],(0,d.errorExists)(f)){var B=S.errback;if(!B){u();return}var M=f.error;B({error:M,next:u})}else{var R=S.callback;if(!R)return;R({result:_,next:u})}}},{key:"_handleJoin",value:function(f,u){var p={info:u.info},_=this._getSub(f);if(!_){this._isServerSub(f)&&(p.channel=f,this.emit("join",p));return}_.emit("join",p)}},{key:"_handleLeave",value:function(f,u){var p={info:u.info},_=this._getSub(f);if(!_){this._isServerSub(f)&&(p.channel=f,this.emit("leave",p));return}_.emit("leave",p)}},{key:"_handleUnsub",value:function(f,u){var p={},_=this._getSub(f);if(!_){this._isServerSub(f)&&(delete this._serverSubs[f],p.channel=f,this.emit("unsubscribe",p));return}_.unsubscribe(),u.resubscribe===!0&&_.subscribe()}},{key:"_handleSub",value:function(f,u){this._serverSubs[f]={seq:u.seq,gen:u.gen,offset:u.offset,epoch:u.epoch,recoverable:u.recoverable};var p={channel:f,isResubscribe:!1};p=this._expandSubscribeContext(p,u),this.emit("subscribe",p)}},{key:"_handlePublication",value:function(f,u){var p=this._getSub(f),_={data:u.data,seq:u.seq,gen:u.gen,offset:u.offset};if(u.info&&(_.info=u.info),!p){this._isServerSub(f)&&(u.seq!==void 0&&(this._serverSubs[f].seq=u.seq),u.gen!==void 0&&(this._serverSubs[f].gen=u.gen),u.offset!==void 0&&(this._serverSubs[f].offset=u.offset),_.channel=f,this.emit("publish",_));return}u.seq!==void 0&&(this._lastSeq[f]=u.seq),u.gen!==void 0&&(this._lastGen[f]=u.gen),u.offset!==void 0&&(this._lastOffset[f]=u.offset),p.emit("publish",_)}},{key:"_handleMessage",value:function(f){this.emit("message",f.data)}},{key:"_handlePush",value:function(f,u){var p=this._decoder.decodePush(f),_=0;"type"in p&&(_=p.type);var S=p.channel;if(_===this._pushType.PUBLICATION){var R=this._decoder.decodePushData(this._pushType.PUBLICATION,p.data);this._handlePublication(S,R)}else if(_===this._pushType.MESSAGE){var B=this._decoder.decodePushData(this._pushType.MESSAGE,p.data);this._handleMessage(B)}else if(_===this._pushType.JOIN){var M=this._decoder.decodePushData(this._pushType.JOIN,p.data);this._handleJoin(S,M)}else if(_===this._pushType.LEAVE){var G=this._decoder.decodePushData(this._pushType.LEAVE,p.data);this._handleLeave(S,G)}else if(_===this._pushType.UNSUBSCRIBE){var X=this._decoder.decodePushData(this._pushType.UNSUBSCRIBE,p.data);this._handleUnsub(S,X)}else if(_===this._pushType.SUBSCRIBE){var Q=this._decoder.decodePushData(this._pushType.UNSUBSCRIBE,p.data);this._handleSub(S,Q)}u()}},{key:"_flush",value:function(){var f=this._messages.slice(0);this._messages=[],this._transportSend(f)}},{key:"_ping",value:function(){var f=this,u={method:this._methodType.PING};this._call(u).then(function(p){f._pingResponse(f._decoder.decodeCommandResult(f._methodType.PING,p.result)),p.next&&p.next()},function(p){f._debug("ping error",p.error),p.next&&p.next()})}},{key:"_pingResponse",value:function(f){!this.isConnected()||(this._stopPing(),this._startPing())}},{key:"_getLastSeq",value:function(f){var u=this._lastSeq[f];return u||0}},{key:"_getLastOffset",value:function(f){var u=this._lastOffset[f];return u||0}},{key:"_getLastGen",value:function(f){var u=this._lastGen[f];return u||0}},{key:"_getLastEpoch",value:function(f){var u=this._lastEpoch[f];return u||""}},{key:"_createErrorObject",value:function(f,u){var p={message:f,code:u||0};return p}},{key:"_registerCall",value:function(f,u,p){var _=this;this._callbacks[f]={callback:u,errback:p,timeout:null},this._callbacks[f].timeout=setTimeout(function(){delete _._callbacks[f],(0,d.isFunction)(p)&&p({error:_._createErrorObject(j)})},this._config.timeout)}},{key:"_addMessage",value:function(f){var u=this._nextMessageId();return f.id=u,this._isBatching===!0?this._messages.push(f):this._transportSend([f]),u}},{key:"isConnected",value:function(){return this._isConnected()}},{key:"connect",value:function(){this._connect()}},{key:"disconnect",value:function(){this._disconnect("client",!1)}},{key:"ping",value:function(){return this._ping()}},{key:"startBatching",value:function(){this._isBatching=!0}},{key:"stopBatching",value:function(){this._isBatching=!1,this._flush()}},{key:"startSubscribeBatching",value:function(){this._isSubscribeBatching=!0}},{key:"stopSubscribeBatching",value:function(){var f=this;this._isSubscribeBatching=!1;var u=this._privateChannels;this._privateChannels={};var p=[];for(var _ in u)if(u.hasOwnProperty(_)){var S=this._getSub(_);if(!S)continue;p.push(_)}if(p.length===0){this._debug("no private channels found, no need to make request");return}var R={client:this._clientID,channels:p},B=this._clientID,M=this._newXHRID(),G=function(H){if(M in f._xhrs&&delete f._xhrs[M],f._clientID===B){if(H.error||H.status!==200){f._debug("authorization request failed");for(var Ke in p)if(p.hasOwnProperty(Ke)){var $r=p[Ke];f._subscribeError($r,f._createErrorObject("authorization request failed"))}return}var Qt={};if(H.data.channels)for(var ye in H.data.channels){var Hr=H.data.channels[ye];!Hr.channel||(Qt[Hr.channel]=Hr.token)}var ei=!1;f._isBatching||(f.startBatching(),ei=!0);for(var ti in p)if(p.hasOwnProperty(ti)){var $a=function(){var fe=p[ti],ri=Qt[fe];if(ri){var Ze={method:f._methodType.SUBSCRIBE,params:{channel:fe,token:ri}},ni=f._getSub(fe);if(ni===null)return"continue";var ii=ni._needRecover();if(ii===!0){Ze.params.recover=!0;var zr=f._getLastSeq(fe),Jr=f._getLastGen(fe);if(zr||Jr)zr&&(Ze.params.seq=zr),Jr&&(Ze.params.gen=Jr);else{var oi=f._getLastOffset(fe);oi&&(Ze.params.offset=oi)}var si=f._getLastEpoch(fe);si&&(Ze.params.epoch=si)}f._call(Ze).then(function(Ue){f._subscribeResponse(fe,ii,f._decoder.decodeCommandResult(f._methodType.SUBSCRIBE,Ue.result)),Ue.next&&Ue.next()},function(Ue){f._subscribeError(fe,Ue.error),Ue.next&&Ue.next()})}else return f._subscribeError(fe,f._createErrorObject("permission denied",103)),"continue"}();if($a==="continue")continue}ei&&f.stopBatching()}};if(this._config.onPrivateSubscribe!==null)this._config.onPrivateSubscribe({data:R},G);else{var X=this._ajax(this._config.subscribeEndpoint,this._config.subscribeParams,this._config.subscribeHeaders,R,G);this._xhrs[M]=X}}},{key:"_setSubscribeSince",value:function(f,u){this._lastOffset[f.channel]=u.offset,this._lastEpoch[f.channel]=u.epoch,f._setNeedRecover(!0)}},{key:"subscribe",value:function(f,u,p){var _=this._getSub(f);if(_!==null)return _._setEvents(u),_._isUnsubscribed()&&_.subscribe(p),_;var S=new c.default(this,f,u);return this._subs[f]=S,S.subscribe(p),S}}]),E}(l.default);o.Centrifuge=T},579:function(i,o,s){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var l=s(382),c=l.Centrifuge;o.default=c,i.exports=o.default},147:function(i,o){Object.defineProperty(o,"__esModule",{value:!0}),o.JsonPushType=o.JsonMethodType=o.JsonEncoder=o.JsonDecoder=void 0;function s(y,I){if(!(y instanceof I))throw new TypeError("Cannot call a class as a function")}function l(y,I){for(var w=0;w<I.length;w++){var O=I[w];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(y,O.key,O)}}function c(y,I,w){return I&&l(y.prototype,I),w&&l(y,w),y}var h={CONNECT:0,SUBSCRIBE:1,UNSUBSCRIBE:2,PUBLISH:3,PRESENCE:4,PRESENCE_STATS:5,HISTORY:6,PING:7,SEND:8,RPC:9,REFRESH:10,SUB_REFRESH:11};o.JsonMethodType=h;var d={PUBLICATION:0,JOIN:1,LEAVE:2,UNSUBSCRIBE:3,MESSAGE:4,SUBSCRIBE:5};o.JsonPushType=d;var v=function(){function y(){s(this,y)}return c(y,[{key:"encodeCommands",value:function(w){return w.map(function(O){return JSON.stringify(O)}).join(`
`)}}]),y}();o.JsonEncoder=v;var x=function(){function y(){s(this,y)}return c(y,[{key:"decodeReplies",value:function(w){return w.split(`
`).filter(function(O){return O!==""}).map(function(O){return JSON.parse(O)})}},{key:"decodeCommandResult",value:function(w,O){return O}},{key:"decodePush",value:function(w){return w}},{key:"decodePushData",value:function(w,O){return O}}]),y}();o.JsonDecoder=x},471:function(i,o,s){function l(b){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?l=function(m){return typeof m}:l=function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},l(b)}Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var c=d(s(187)),h=s(853);function d(b){return b&&b.__esModule?b:{default:b}}function v(b,E){if(!(b instanceof E))throw new TypeError("Cannot call a class as a function")}function x(b,E){for(var m=0;m<E.length;m++){var f=E[m];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}}function y(b,E,m){return E&&x(b.prototype,E),m&&x(b,m),b}function I(b,E){if(typeof E!="function"&&E!==null)throw new TypeError("Super expression must either be null or a function");b.prototype=Object.create(E&&E.prototype,{constructor:{value:b,writable:!0,configurable:!0}}),E&&w(b,E)}function w(b,E){return w=Object.setPrototypeOf||function(f,u){return f.__proto__=u,f},w(b,E)}function O(b){var E=P();return function(){var f=U(b),u;if(E){var p=U(this).constructor;u=Reflect.construct(f,arguments,p)}else u=f.apply(this,arguments);return C(this,u)}}function C(b,E){if(E&&(l(E)==="object"||typeof E=="function"))return E;if(E!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return L(b)}function L(b){if(b===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b}function P(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function U(b){return U=Object.setPrototypeOf?Object.getPrototypeOf:function(m){return m.__proto__||Object.getPrototypeOf(m)},U(b)}var q=0,F=1,j=2,D=3,T=4,g=function(b){I(m,b);var E=O(m);function m(f,u,p){var _;return v(this,m),_=E.call(this),_.channel=u,_._centrifuge=f,_._status=q,_._error=null,_._isResubscribe=!1,_._ready=!1,_._subscriptionPromise=null,_._noResubscribe=!1,_._recoverable=!1,_._recover=!1,_._setEvents(p),_._initializePromise(),_._promises={},_._promiseId=0,_._subscribeData=null,_.on("error",function(S){this._centrifuge._debug("subscription error",S)}),_}return y(m,[{key:"_nextPromiseId",value:function(){return++this._promiseId}},{key:"_initializePromise",value:function(){var u=this;this._ready=!1,this._subscriptionPromise=new Promise(function(p,_){u._resolve=function(S){u._ready=!0,p(S)},u._reject=function(S){u._ready=!0,_(S)}}).then(function(){},function(){})}},{key:"_setNeedRecover",value:function(u){this._recoverable=u,this._recover=u}},{key:"_needRecover",value:function(){return this._recoverable===!0&&this._recover===!0}},{key:"_setEvents",value:function(u){if(!!u){if((0,h.isFunction)(u))this.on("publish",u);else if(Object.prototype.toString.call(u)===Object.prototype.toString.call({}))for(var p=["publish","join","leave","unsubscribe","subscribe","error"],_=0,S=p.length;_<S;_++){var R=p[_];R in u&&this.on(R,u[R])}}}},{key:"_isNew",value:function(){return this._status===q}},{key:"_isUnsubscribed",value:function(){return this._status===T}},{key:"_isSubscribing",value:function(){return this._status===F}},{key:"_isReady",value:function(){return this._status===j||this._status===D}},{key:"_isSuccess",value:function(){return this._status===j}},{key:"_isError",value:function(){return this._status===D}},{key:"_setNew",value:function(){this._status=q}},{key:"_setSubscribing",value:function(u){this._isResubscribe=u||!1,this._ready===!0&&this._initializePromise(),this._status=F}},{key:"_setSubscribeSuccess",value:function(u){if(this._status!==j){this._status=j;var p=this._getSubscribeSuccessContext(u);this._recover=!1,this.emit("subscribe",p),this._resolve(p);for(var _ in this._promises)clearTimeout(this._promises[_].timeout),this._promises[_].resolve(),delete this._promises[_]}}},{key:"_setSubscribeError",value:function(u){if(this._status!==D){this._status=D,this._error=u;var p=this._getSubscribeErrorContext();this.emit("error",p),this._reject(p);for(var _ in this._promises)clearTimeout(this._promises[_].timeout),this._promises[_].reject(u),delete this._promises[_]}}},{key:"_triggerUnsubscribe",value:function(){this.emit("unsubscribe",{channel:this.channel})}},{key:"_setUnsubscribed",value:function(u){if(this._centrifuge._clearSubRefreshTimeout(this.channel),this._status!==T){var p=this._status===j;this._status=T,u===!0&&(this._recover=!1,this._noResubscribe=!0,delete this._centrifuge._lastSeq[this.channel],delete this._centrifuge._lastGen[this.channel],delete this._centrifuge._lastEpoch[this.channel]),p&&this._triggerUnsubscribe()}}},{key:"_shouldResubscribe",value:function(){return!this._noResubscribe}},{key:"_getSubscribeSuccessContext",value:function(u){var p={channel:this.channel,isResubscribe:this._isResubscribe};return u&&(p=this._centrifuge._expandSubscribeContext(p,u)),p}},{key:"_getSubscribeErrorContext",value:function(){var u=this._error;return u.channel=this.channel,u.isResubscribe=this._isResubscribe,u}},{key:"_setSubscribeData",value:function(u){this._subscribeData=u}},{key:"ready",value:function(u,p){this._ready&&(this._isSuccess()?u(this._getSubscribeSuccessContext()):p(this._getSubscribeErrorContext()))}},{key:"subscribe",value:function(u){this._status!==j&&(u&&u.since&&this._centrifuge._setSubscribeSince(this,u.since),u&&u.data&&this._setSubscribeData(u.data),this._noResubscribe=!1,this._centrifuge._subscribe(this))}},{key:"unsubscribe",value:function(){this._setUnsubscribed(!0),this._centrifuge._unsubscribe(this)}},{key:"_methodCall",value:function(){var u=this;if(this._isSuccess())return Promise.resolve();if(this._isError())return Promise.reject(this._error);var p=new Promise(function(_,S){var R=setTimeout(function(){S({code:0,message:"timeout"})},u._centrifuge._config.timeout);u._promises[u._nextPromiseId()]={timeout:R,resolve:_,reject:S}});return p}},{key:"publish",value:function(u){var p=this;return this._methodCall().then(function(){return p._centrifuge.publish(p.channel,u)})}},{key:"presence",value:function(){var u=this;return this._methodCall().then(function(){return u._centrifuge.presence(u.channel)})}},{key:"presenceStats",value:function(){var u=this;return this._methodCall().then(function(){return u._centrifuge.presenceStats(u.channel)})}},{key:"history",value:function(u){var p=this;return this._methodCall().then(function(){return p._centrifuge.history(p.channel,u)})}}]),m}(c.default);o.default=g,i.exports=o.default},853:function(i,o,s){Object.defineProperty(o,"__esModule",{value:!0}),o.backoff=d,o.errorExists=v,o.extend=x,o.isFunction=c,o.log=h,o.startsWith=l;function l(y,I){return y.lastIndexOf(I,0)===0}function c(y){return y==null?!1:typeof y=="function"}function h(y,I){if(s.g.console){var w=s.g.console[y];c(w)&&w.apply(s.g.console,I)}}function d(y,I,w){var O=.5*Math.random(),C=Math.min(w,I*Math.pow(2,y+1));return Math.floor((1-O)*C)}function v(y){return"error"in y&&y.error!==null}function x(y,I){for(var w in I)I.hasOwnProperty(w)&&(y[w]=I[w]);return y}},187:function(i){var o=typeof Reflect=="object"?Reflect:null,s=o&&typeof o.apply=="function"?o.apply:function(g,b,E){return Function.prototype.apply.call(g,b,E)},l;o&&typeof o.ownKeys=="function"?l=o.ownKeys:Object.getOwnPropertySymbols?l=function(g){return Object.getOwnPropertyNames(g).concat(Object.getOwnPropertySymbols(g))}:l=function(g){return Object.getOwnPropertyNames(g)};function c(T){console&&console.warn&&console.warn(T)}var h=Number.isNaN||function(g){return g!==g};function d(){d.init.call(this)}i.exports=d,i.exports.once=F,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._eventsCount=0,d.prototype._maxListeners=void 0;var v=10;function x(T){if(typeof T!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof T)}Object.defineProperty(d,"defaultMaxListeners",{enumerable:!0,get:function(){return v},set:function(T){if(typeof T!="number"||T<0||h(T))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+T+".");v=T}}),d.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},d.prototype.setMaxListeners=function(g){if(typeof g!="number"||g<0||h(g))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+g+".");return this._maxListeners=g,this};function y(T){return T._maxListeners===void 0?d.defaultMaxListeners:T._maxListeners}d.prototype.getMaxListeners=function(){return y(this)},d.prototype.emit=function(g){for(var b=[],E=1;E<arguments.length;E++)b.push(arguments[E]);var m=g==="error",f=this._events;if(f!==void 0)m=m&&f.error===void 0;else if(!m)return!1;if(m){var u;if(b.length>0&&(u=b[0]),u instanceof Error)throw u;var p=new Error("Unhandled error."+(u?" ("+u.message+")":""));throw p.context=u,p}var _=f[g];if(_===void 0)return!1;if(typeof _=="function")s(_,this,b);else for(var S=_.length,R=P(_,S),E=0;E<S;++E)s(R[E],this,b);return!0};function I(T,g,b,E){var m,f,u;if(x(b),f=T._events,f===void 0?(f=T._events=Object.create(null),T._eventsCount=0):(f.newListener!==void 0&&(T.emit("newListener",g,b.listener?b.listener:b),f=T._events),u=f[g]),u===void 0)u=f[g]=b,++T._eventsCount;else if(typeof u=="function"?u=f[g]=E?[b,u]:[u,b]:E?u.unshift(b):u.push(b),m=y(T),m>0&&u.length>m&&!u.warned){u.warned=!0;var p=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+String(g)+" listeners added. Use emitter.setMaxListeners() to increase limit");p.name="MaxListenersExceededWarning",p.emitter=T,p.type=g,p.count=u.length,c(p)}return T}d.prototype.addListener=function(g,b){return I(this,g,b,!1)},d.prototype.on=d.prototype.addListener,d.prototype.prependListener=function(g,b){return I(this,g,b,!0)};function w(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function O(T,g,b){var E={fired:!1,wrapFn:void 0,target:T,type:g,listener:b},m=w.bind(E);return m.listener=b,E.wrapFn=m,m}d.prototype.once=function(g,b){return x(b),this.on(g,O(this,g,b)),this},d.prototype.prependOnceListener=function(g,b){return x(b),this.prependListener(g,O(this,g,b)),this},d.prototype.removeListener=function(g,b){var E,m,f,u,p;if(x(b),m=this._events,m===void 0)return this;if(E=m[g],E===void 0)return this;if(E===b||E.listener===b)--this._eventsCount===0?this._events=Object.create(null):(delete m[g],m.removeListener&&this.emit("removeListener",g,E.listener||b));else if(typeof E!="function"){for(f=-1,u=E.length-1;u>=0;u--)if(E[u]===b||E[u].listener===b){p=E[u].listener,f=u;break}if(f<0)return this;f===0?E.shift():U(E,f),E.length===1&&(m[g]=E[0]),m.removeListener!==void 0&&this.emit("removeListener",g,p||b)}return this},d.prototype.off=d.prototype.removeListener,d.prototype.removeAllListeners=function(g){var b,E,m;if(E=this._events,E===void 0)return this;if(E.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):E[g]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete E[g]),this;if(arguments.length===0){var f=Object.keys(E),u;for(m=0;m<f.length;++m)u=f[m],u!=="removeListener"&&this.removeAllListeners(u);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(b=E[g],typeof b=="function")this.removeListener(g,b);else if(b!==void 0)for(m=b.length-1;m>=0;m--)this.removeListener(g,b[m]);return this};function C(T,g,b){var E=T._events;if(E===void 0)return[];var m=E[g];return m===void 0?[]:typeof m=="function"?b?[m.listener||m]:[m]:b?q(m):P(m,m.length)}d.prototype.listeners=function(g){return C(this,g,!0)},d.prototype.rawListeners=function(g){return C(this,g,!1)},d.listenerCount=function(T,g){return typeof T.listenerCount=="function"?T.listenerCount(g):L.call(T,g)},d.prototype.listenerCount=L;function L(T){var g=this._events;if(g!==void 0){var b=g[T];if(typeof b=="function")return 1;if(b!==void 0)return b.length}return 0}d.prototype.eventNames=function(){return this._eventsCount>0?l(this._events):[]};function P(T,g){for(var b=new Array(g),E=0;E<g;++E)b[E]=T[E];return b}function U(T,g){for(;g+1<T.length;g++)T[g]=T[g+1];T.pop()}function q(T){for(var g=new Array(T.length),b=0;b<g.length;++b)g[b]=T[b].listener||T[b];return g}function F(T,g){return new Promise(function(b,E){function m(u){T.removeListener(g,f),E(u)}function f(){typeof T.removeListener=="function"&&T.removeListener("error",m),b([].slice.call(arguments))}D(T,g,f,{once:!0}),g!=="error"&&j(T,m,{once:!0})})}function j(T,g,b){typeof T.on=="function"&&D(T,"error",g,b)}function D(T,g,b,E){if(typeof T.on=="function")E.once?T.once(g,b):T.on(g,b);else if(typeof T.addEventListener=="function")T.addEventListener(g,function m(f){E.once&&T.removeEventListener(g,m),b(f)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof T)}}},e={};function t(i){var o=e[i];if(o!==void 0)return o.exports;var s=e[i]={exports:{}};return r[i](s,s.exports,t),s.exports}(function(){t.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}()})();var n=t(579);return n}()})});var Va=tf(fi());var ui=Symbol("Comlink.proxy"),rf=Symbol("Comlink.endpoint"),nf=Symbol("Comlink.releaseProxy"),Xr=Symbol("Comlink.thrown"),ci=r=>typeof r=="object"&&r!==null||typeof r=="function",of={canHandle:r=>ci(r)&&r[ui],serialize(r){let{port1:e,port2:t}=new MessageChannel;return Zt(r,e),[t,[t]]},deserialize(r){return r.start(),Kr(r)}},sf={canHandle:r=>ci(r)&&Xr in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},hi=new Map([["proxy",of],["throw",sf]]);function Zt(r,e=self){e.addEventListener("message",function t(n){if(!n||!n.data)return;let{id:i,type:o,path:s}=Object.assign({path:[]},n.data),l=(n.data.argumentList||[]).map(De),c;try{let h=s.slice(0,-1).reduce((v,x)=>v[x],r),d=s.reduce((v,x)=>v[x],r);switch(o){case"GET":c=d;break;case"SET":h[s.slice(-1)[0]]=De(n.data.value),c=!0;break;case"APPLY":c=d.apply(h,l);break;case"CONSTRUCT":{let v=new d(...l);c=uf(v)}break;case"ENDPOINT":{let{port1:v,port2:x}=new MessageChannel;Zt(r,x),c=lf(v,[v])}break;case"RELEASE":c=void 0;break;default:return}}catch(h){c={value:h,[Xr]:0}}Promise.resolve(c).catch(h=>({value:h,[Xr]:0})).then(h=>{let[d,v]=Zr(h);e.postMessage(Object.assign(Object.assign({},d),{id:i}),v),o==="RELEASE"&&(e.removeEventListener("message",t),di(e))})}),e.start&&e.start()}function af(r){return r.constructor.name==="MessagePort"}function di(r){af(r)&&r.close()}function Kr(r,e){return Qr(r,[],e)}function Kt(r){if(r)throw new Error("Proxy has been released and is not useable")}function Qr(r,e=[],t=function(){}){let n=!1,i=new Proxy(t,{get(o,s){if(Kt(n),s===nf)return()=>et(r,{type:"RELEASE",path:e.map(l=>l.toString())}).then(()=>{di(r),n=!0});if(s==="then"){if(e.length===0)return{then:()=>i};let l=et(r,{type:"GET",path:e.map(c=>c.toString())}).then(De);return l.then.bind(l)}return Qr(r,[...e,s])},set(o,s,l){Kt(n);let[c,h]=Zr(l);return et(r,{type:"SET",path:[...e,s].map(d=>d.toString()),value:c},h).then(De)},apply(o,s,l){Kt(n);let c=e[e.length-1];if(c===rf)return et(r,{type:"ENDPOINT"}).then(De);if(c==="bind")return Qr(r,e.slice(0,-1));let[h,d]=li(l);return et(r,{type:"APPLY",path:e.map(v=>v.toString()),argumentList:h},d).then(De)},construct(o,s){Kt(n);let[l,c]=li(s);return et(r,{type:"CONSTRUCT",path:e.map(h=>h.toString()),argumentList:l},c).then(De)}});return i}function ff(r){return Array.prototype.concat.apply([],r)}function li(r){let e=r.map(Zr);return[e.map(t=>t[0]),ff(e.map(t=>t[1]))]}var pi=new WeakMap;function lf(r,e){return pi.set(r,e),r}function uf(r){return Object.assign(r,{[ui]:!0})}function Zr(r){for(let[e,t]of hi)if(t.canHandle(r)){let[n,i]=t.serialize(r);return[{type:"HANDLER",name:e,value:n},i]}return[{type:"RAW",value:r},pi.get(r)||[]]}function De(r){switch(r.type){case"HANDLER":return hi.get(r.name).deserialize(r.value);case"RAW":return r.value}}function et(r,e,t){return new Promise(n=>{let i=cf();r.addEventListener("message",function o(s){!s.data||!s.data.id||s.data.id!==i||(r.removeEventListener("message",o),n(s.data))}),r.start&&r.start(),r.postMessage(Object.assign({id:i},e),t)})}function cf(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var At=Kr(self),A;function _i(r){A=r}var hf={CCW:-1,CW:1,NOT_ORIENTABLE:0},df=2*Math.PI,Rt=1,Ii=0,le=2,pf=3,mf=4,_f=1,gf=2,dn=0,nr=1,tt=2,ir=Object.freeze({CCW:!0,CW:!1,ORIENTATION:hf,PIx2:df,INSIDE:Rt,OUTSIDE:Ii,BOUNDARY:le,CONTAINS:pf,INTERLACE:mf,OVERLAP_SAME:_f,OVERLAP_OPPOSITE:gf,NOT_VERTEX:dn,START_VERTEX:nr,END_VERTEX:tt}),he=1e-6;function Pi(r){he=r}function Oi(){return he}var bf=3;function nn(r){return r<he&&r>-he}function qe(r,e){return r-e<he&&r-e>-he}function Ci(r,e){return r-e>he}function vf(r,e){return r-e>-he}function Ai(r,e){return r-e<-he}function xf(r,e){return r-e<he}var yf=Object.freeze({setTolerance:Pi,getTolerance:Oi,DECIMALS:bf,EQ_0:nn,EQ:qe,GT:Ci,GE:vf,LT:Ai,LE:xf}),or=class{static get ILLEGAL_PARAMETERS(){return new ReferenceError("Illegal Parameters")}static get ZERO_DIVISION(){return new Error("Zero division")}static get UNRESOLVED_BOUNDARY_CONFLICT(){return new Error("Unresolved boundary conflict in boolean operation")}static get INFINITE_LOOP(){return new Error("Infinite loop")}};var a={Utils:yf,Errors:or,Matrix:void 0,Planar_set:void 0,Point:void 0,Vector:void 0,Line:void 0,Circle:void 0,Segment:void 0,Arc:void 0,Box:void 0,Edge:void 0,Face:void 0,Ray:void 0,Ray_shooting:void 0,Multiline:void 0,Polygon:void 0,Distance:void 0,Inversion:void 0};for(let r in ir)a[r]=ir[r];Object.defineProperty(a,"DP_TOL",{get:function(){return Oi()},set:function(r){Pi(r)}});var sr=class{constructor(e,t){this.first=e,this.last=t||this.first}static testInfiniteLoop(e){let t=e,n=e;do{if(t!=e&&t===n)throw a.Errors.INFINITE_LOOP;t=t.next,n=n.next.next}while(t!=e)}get size(){let e=0;for(let t of this)e++;return e}toArray(e=void 0,t=void 0){let n=[],i=e||this.first,o=t||this.last,s=i;if(s===void 0)return n;do n.push(s),s=s.next;while(s!==o.next);return n}append(e){return this.isEmpty()?this.first=e:(e.prev=this.last,this.last.next=e),this.last=e,this.last.next=void 0,this.first.prev=void 0,this}insert(e,t){if(this.isEmpty())this.first=e,this.last=e;else if(t==null)e.next=this.first,this.first.prev=e,this.first=e;else{let n=t.next;t.next=e,n&&(n.prev=e),e.prev=t,e.next=n,this.last===t&&(this.last=e)}return this.last.next=void 0,this.first.prev=void 0,this}remove(e){return e===this.first&&e===this.last?(this.first=void 0,this.last=void 0):(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e===this.first&&(this.first=e.next),e===this.last&&(this.last=e.prev)),this}isEmpty(){return this.first===void 0}[Symbol.iterator](){let e;return{next:()=>(e=e?e.next:this.first,{value:e,done:e===void 0})}}};function it(r,e,t){let n=t.length,i=r.shape.split(e);if(i.length===0)return;let o=0;i[0]===null?o=0:i[1]===null?o=r.shape.length:o=i[0].length;let s=dn;qe(o,0)&&(s|=nr),qe(o,r.shape.length)&&(s|=tt);let l=s&tt&&r.next.arc_length===0?0:r.arc_length+o;t.push({id:n,pt:e,arc_length:l,edge_before:r,edge_after:void 0,face:r.face,is_vertex:s})}function Nt(r){r.int_points1_sorted=kt(r.int_points1),r.int_points2_sorted=kt(r.int_points2)}function kt(r){let e=new Map,t=0;for(let i of r)e.has(i.face)||(e.set(i.face,t),t++);for(let i of r)i.faceId=e.get(i.face);return r.slice().sort(Tf)}function Tf(r,e){return r.faceId<e.faceId?-1:r.faceId>e.faceId?1:r.arc_length<e.arc_length?-1:r.arc_length>e.arc_length?1:0}function en(r,e){return e.slice().sort((t,n)=>r.coord(t.pt)<r.coord(n.pt)?-1:r.coord(t.pt)>r.coord(n.pt)?1:0)}function pn(r){if(r.int_points1.length<2)return;let e=!1,t,n,i,o;for(let s=0;s<r.int_points1_sorted.length;s++)if(r.int_points1_sorted[s].id!==-1){t=r.int_points1_sorted[s],n=r.int_points2[t.id];for(let l=s+1;l<r.int_points1_sorted.length&&(i=r.int_points1_sorted[l],!!qe(i.arc_length,t.arc_length));l++)i.id!==-1&&(o=r.int_points2[i.id],o.id!==-1&&i.edge_before===t.edge_before&&i.edge_after===t.edge_after&&o.edge_before===n.edge_before&&o.edge_after===n.edge_after&&(i.id=-1,o.id=-1,e=!0))}n=r.int_points2_sorted[0],t=r.int_points1[n.id];for(let s=1;s<r.int_points2_sorted.length;s++){let l=r.int_points2_sorted[s];if(l.id==-1)continue;if(n.id==-1||!qe(l.arc_length,n.arc_length)){n=l,t=r.int_points1[n.id];continue}let c=r.int_points1[l.id];c.edge_before===t.edge_before&&c.edge_after===t.edge_after&&l.edge_before===n.edge_before&&l.edge_after===n.edge_after&&(c.id=-1,l.id=-1,e=!0)}e&&(r.int_points1=r.int_points1.filter(s=>s.id>=0),r.int_points2=r.int_points2.filter(s=>s.id>=0),r.int_points1.forEach((s,l)=>s.id=l),r.int_points2.forEach((s,l)=>s.id=l))}function on(r){for(let e of r)e.edge_before.bvStart=void 0,e.edge_before.bvEnd=void 0,e.edge_before.bv=void 0,e.edge_before.overlap=void 0,e.edge_after.bvStart=void 0,e.edge_after.bvEnd=void 0,e.edge_after.bv=void 0,e.edge_after.overlap=void 0;for(let e of r)e.edge_before.bvEnd=le,e.edge_after.bvStart=le}function sn(r,e){for(let t of r)t.edge_before.setInclusion(e),t.edge_after.setInclusion(e)}function Ef(r){let e,t,n,i=r.int_points1.length;for(let o=0;o<i;o++){let s=r.int_points1_sorted[o];s.face!==e&&(t=o,e=s.face);let l=o,c=ot(r.int_points1_sorted,o,e),h;l+c<i&&r.int_points1_sorted[l+c].face===e?h=l+c:h=t;let d=ot(r.int_points1_sorted,h,e);n=null;for(let C=h;C<h+d;C++){let L=r.int_points1_sorted[C];if(L.face===e&&r.int_points2[L.id].face===r.int_points2[s.id].face){n=L;break}}if(n===null)continue;let v=s.edge_after,x=n.edge_before;if(!(v.bv===le&&x.bv===le)||v!==x)continue;let y=r.int_points2[s.id],I=r.int_points2[n.id],w=y.edge_after,O=I.edge_before;w.bv===le&&O.bv===le&&w===O||(y=r.int_points2[n.id],I=r.int_points2[s.id],w=y.edge_after,O=I.edge_before),w.bv===le&&O.bv===le&&w===O&&v.setOverlap(w)}}function ot(r,e,t){let n,i,o=1;if(r.length==1)return 1;n=r[e];for(let s=e+1;s<r.length&&!(n.face!=t||(i=r[s],!(i.pt.equalTo(n.pt)&&i.edge_before===n.edge_before&&i.edge_after===n.edge_after)));s++)o++;return o}function st(r,e){if(!!e){for(let t of e){let n=t.edge_before;if(t.is_vertex=dn,n.shape.start&&n.shape.start.equalTo(t.pt)&&(t.is_vertex|=nr),n.shape.end&&n.shape.end.equalTo(t.pt)&&(t.is_vertex|=tt),t.is_vertex&nr){t.edge_before=n.prev,t.is_vertex=tt;continue}if(t.is_vertex&tt)continue;let i=r.addVertex(t.pt,n);t.edge_before=i}for(let t of e)t.edge_after=t.edge_before.next}}function gi(r,e,t){let n=r.edge_before,i=e.edge_after;n.next=t,t.prev=n,t.next=i,i.prev=t}var{INSIDE:ue,OUTSIDE:ce,BOUNDARY:J,OVERLAP_SAME:wf,OVERLAP_OPPOSITE:Sf}=ir,{NOT_VERTEX:Wp,START_VERTEX:bi,END_VERTEX:vi}=ir,ar=1,Ft=2,We=3;function If(r,e){let[t,n]=Ut(r,e,ar,!0);return t}function an(r,e){let n=e.clone().reverse(),[i,o]=Ut(r,n,We,!0);return i}function Ri(r,e){let[t,n]=Ut(r,e,Ft,!0);return t}function ki(r,e){let[t,n]=Ut(r,e,Ft,!1),i=[];for(let s of t.faces)i=[...i,...[...s.edges].map(l=>l.shape)];let o=[];for(let s of n.faces)o=[...o,...[...s.edges].map(l=>l.shape)];return[i,o]}function fn(r,e){let[t,n]=Ut(r,e,We,!1),i=[];for(let o of t.faces)i=[...i,...[...o.edges].map(s=>s.shape)];return i}function Li(r,e){let t=r.clone(),n=e.clone(),i=Ni(t,n);Nt(i),st(t,i.int_points1_sorted),st(n,i.int_points2_sorted),pn(i),Nt(i);let o=i.int_points1_sorted.map(l=>l.pt),s=i.int_points2_sorted.map(l=>l.pt);return[o,s]}function Pf(r,e,t,n){let i=xi(r,t.int_points1),o=xi(e,t.int_points2);for(yi(i,e),yi(o,r),on(t.int_points1),on(t.int_points2),sn(t.int_points1,e),sn(t.int_points2,r);Cf(r,e,t.int_points1,t.int_points1_sorted,t.int_points2,t););Ef(t),ln(r,n,t.int_points1_sorted,!0),ln(e,n,t.int_points2_sorted,!1),Ti(r,i,n,!0),Ti(e,o,n,!1)}function Of(r,e,t,n){Af(r,e,n,t.int_points2),Rf(r,e,t),un(r,t.int_points1),un(e,t.int_points2),cn(r,t.int_points1,t.int_points2),cn(r,t.int_points2,t.int_points1)}function Ut(r,e,t,n){let i=r.clone(),o=e.clone(),s=Ni(i,o);return Nt(s),st(i,s.int_points1_sorted),st(o,s.int_points2_sorted),pn(s),Nt(s),Pf(i,o,s,t),n&&Of(i,o,s,t),[i,o]}function Ni(r,e){let t={int_points1:[],int_points2:[]};for(let n of r.edges){let i=e.edges.search(n.box);for(let o of i){let s=n.shape.intersect(o.shape);for(let l of s)it(n,l,t.int_points1),it(o,l,t.int_points2)}}return t}function xi(r,e){let t=[];for(let n of r.faces)e.find(i=>i.face===n)||t.push(n);return t}function yi(r,e){for(let t of r)t.first.bv=t.first.bvStart=t.first.bvEnd=void 0,t.first.setInclusion(e)}function Cf(r,e,t,n,i,o){let s,l,c,h=n.length,d=!1;for(let v=0;v<h;v++){let x=n[v];x.face!==s&&(l=v,s=x.face);let y=v,I=ot(n,v,s),w;y+I<h&&n[y+I].face===s?w=y+I:w=l;let O=ot(n,w,s);c=null;for(let P=w;P<w+O;P++){let U=n[P];if(U.face===s&&i[U.id].face===i[x.id].face){c=U;break}}if(c===null)continue;let C=x.edge_after,L=c.edge_before;if(C.bv===J&&L.bv!=J){C.bv=L.bv;continue}if(C.bv!=J&&L.bv===J){L.bv=C.bv;continue}if(C.bv===J&&L.bv===J&&C!=L||C.bv===ue&&L.bv===ce||C.bv===ce&&L.bv===ue){let P=C.next;for(;P!=L;)P.bvStart=void 0,P.bvEnd=void 0,P.bv=void 0,P.setInclusion(e),P=P.next}if(C.bv===J&&L.bv===J&&C!=L){let P=C.next,U;for(;P!=L;){if(P.bv!=J){if(U===void 0)U=P.bv;else if(P.bv!=U)throw or.UNRESOLVED_BOUNDARY_CONFLICT}P=P.next}U!=null&&(C.bv=U,L.bv=U);continue}if(C.bv===ue&&L.bv===ce||C.bv===ce&&L.bv===ue){let P=C;for(;P!=L;){if(P.bvStart===C.bv&&P.bvEnd===L.bv){let[U,q]=P.shape.distanceTo(e);if(U<10*a.DP_TOL){it(P,q.ps,t);let F=t[t.length-1];if(F.is_vertex&bi)F.edge_after=P,F.edge_before=P.prev,P.bvStart=J,P.bv=void 0,P.setInclusion(e);else if(F.is_vertex&vi)F.edge_after=P.next,P.bvEnd=J,P.bv=void 0,P.setInclusion(e);else{let T=e.addVertex(F.pt,P);F.edge_before=T,F.edge_after=T.next,T.setInclusion(e),T.next.bvStart=J,T.next.bvEnd=void 0,T.next.bv=void 0,T.next.setInclusion(e)}let j=e.findEdgeByPoint(q.pe);it(j,q.pe,i);let D=i[i.length-1];if(D.is_vertex&bi)D.edge_after=j,D.edge_before=j.prev;else if(D.is_vertex&vi)D.edge_after=j.next;else{let T=i.find(b=>b.edge_after===j),g=e.addVertex(D.pt,j);D.edge_before=g,D.edge_after=g.next,T&&(T.edge_after=g),g.bvStart=void 0,g.bvEnd=J,g.bv=void 0,g.setInclusion(r),g.next.bvStart=J,g.next.bvEnd=void 0,g.next.bv=void 0,g.next.setInclusion(r)}Nt(o),d=!0;break}}P=P.next}if(d)break;throw or.UNRESOLVED_BOUNDARY_CONFLICT}}return d}function ln(r,e,t,n){if(!t)return;let i,o,s,l;for(let c=0;c<t.length;c++){if(s=t[c],s.face!==i&&(o=c,i=s.face),i.isEmpty())continue;let h=c,d=ot(t,c,i),v;h+d<t.length&&t[h+d].face===s.face?v=h+d:v=o,l=t[v];let x=v,y=ot(t,x,i),I=s.edge_after,w=l.edge_before;if(I.bv===ue&&w.bv===ue&&e===ar||I.bv===ce&&w.bv===ce&&e===Ft||(I.bv===ce||w.bv===ce)&&e===We&&!n||(I.bv===ue||w.bv===ue)&&e===We&&n||I.bv===J&&w.bv===J&&I.overlap&wf&&n||I.bv===J&&w.bv===J&&I.overlap&Sf){r.removeChain(i,I,w);for(let O=h;O<h+d;O++)t[O].edge_after=void 0;for(let O=x;O<x+y;O++)t[O].edge_before=void 0}c+=d-1}}function Af(r,e,t,n){for(let i of e.faces){for(let o of i)r.edges.add(o);n.find(o=>o.face===i)===void 0&&r.addFace(i.first,i.last)}}function Rf(r,e,t){if(t.int_points1.length!==0)for(let n=0;n<t.int_points1.length;n++){let i=t.int_points1[n],o=t.int_points2[n];if(i.edge_before!==void 0&&i.edge_after===void 0&&o.edge_before===void 0&&o.edge_after!==void 0&&(i.edge_before.next=o.edge_after,o.edge_after.prev=i.edge_before,i.edge_after=o.edge_after,o.edge_before=i.edge_before),o.edge_before!==void 0&&o.edge_after===void 0&&i.edge_before===void 0&&i.edge_after!==void 0&&(o.edge_before.next=i.edge_after,i.edge_after.prev=o.edge_before,o.edge_after=i.edge_after,i.edge_before=o.edge_before),i.edge_before!==void 0&&i.edge_after===void 0)for(let s of t.int_points1_sorted)s!==i&&s.edge_before===void 0&&s.edge_after!==void 0&&s.pt.equalTo(i.pt)&&(i.edge_before.next=s.edge_after,s.edge_after.prev=i.edge_before,i.edge_after=s.edge_after,s.edge_before=i.edge_before);if(o.edge_before!==void 0&&o.edge_after===void 0)for(let s of t.int_points2_sorted)s!==o&&s.edge_before===void 0&&s.edge_after!==void 0&&s.pt.equalTo(o.pt)&&(o.edge_before.next=s.edge_after,s.edge_after.prev=o.edge_before,o.edge_after=s.edge_after,s.edge_before=o.edge_before)}}function un(r,e){for(let t of e)r.faces.delete(t.face),t.face=void 0,t.edge_before&&(t.edge_before.face=void 0),t.edge_after&&(t.edge_after.face=void 0)}function cn(r,e,t){for(let n of e){if(n.edge_before===void 0||n.edge_after===void 0||n.face||n.edge_after.face||n.edge_before.face)continue;let i=n.edge_after,o=n.edge_before;sr.testInfiniteLoop(i);let s=r.addFace(i,o);for(let l of e)l.edge_before&&l.edge_after&&l.edge_before.face===s&&l.edge_after.face===s&&(l.face=s);for(let l of t)l.edge_before&&l.edge_after&&l.edge_before.face===s&&l.edge_after.face===s&&(l.face=s)}}function Ti(r,e,t,n){for(let i of e){let o=i.first.bv;(t===ar&&o===ue||t===We&&o===ue&&n||t===We&&o===ce&&!n||t===Ft&&o===ce)&&r.deleteFace(i)}}var kf=Object.freeze({BOOLEAN_UNION:ar,BOOLEAN_INTERSECT:Ft,BOOLEAN_SUBTRACT:We,unify:If,subtract:an,intersect:Ri,innerClip:ki,outerClip:fn,calculateIntersections:Li,removeNotRelevantChains:ln,removeOldFaces:un,restoreFaces:cn}),Lf=RegExp("T.F..FFF.|T.F...F.."),Nf=RegExp("T........|.T.......|...T.....|....T...."),Mf=RegExp("FT.......|F..T.....|F...T...."),Bf=RegExp("T.F..F..."),Ff=RegExp("T.F..F...|.TF..F...|..FT.F...|..F.TF..."),He=class{constructor(){this.m=new Array(9).fill(void 0)}get I2I(){return this.m[0]}set I2I(e){this.m[0]=e}get I2B(){return this.m[1]}set I2B(e){this.m[1]=e}get I2E(){return this.m[2]}set I2E(e){this.m[2]=e}get B2I(){return this.m[3]}set B2I(e){this.m[3]=e}get B2B(){return this.m[4]}set B2B(e){this.m[4]=e}get B2E(){return this.m[5]}set B2E(e){this.m[5]=e}get E2I(){return this.m[6]}set E2I(e){this.m[6]=e}get E2B(){return this.m[7]}set E2B(e){this.m[7]=e}get E2E(){return this.m[8]}set E2E(e){this.m[8]=e}toString(){return this.m.map(e=>e instanceof Array&&e.length>0?"T":e instanceof Array&&e.length===0?"F":"*").join("")}equal(){return Lf.test(this.toString())}intersect(){return Nf.test(this.toString())}touch(){return Mf.test(this.toString())}inside(){return Bf.test(this.toString())}covered(){return Ff.test(this.toString())}};function fr(r,e){let t=[],[n,i,o]=r.standard,[s,l,c]=e.standard,h=n*l-i*s,d=o*l-i*c,v=n*c-o*s;if(!a.Utils.EQ_0(h)){let x,y;i===0?(x=o/n,y=v/h):l===0?(x=c/s,y=v/h):n===0?(x=d/h,y=o/i):s===0?(x=d/h,y=c/l):(x=d/h,y=v/h),t.push(new a.Point(x,y))}return t}function ft(r,e){let t=[],n=e.pc.projectionOn(r),i=e.pc.distanceTo(n)[0];if(a.Utils.EQ(i,e.r))t.push(n);else if(a.Utils.LT(i,e.r)){let o=Math.sqrt(e.r*e.r-i*i),s,l;s=r.norm.rotate90CCW().multiply(o),l=n.translate(s),t.push(l),s=r.norm.rotate90CW().multiply(o),l=n.translate(s),t.push(l)}return t}function Mt(r,e){let t=[];for(let n of e.toSegments()){let i=lr(n,r);for(let o of i)Ui(o,t)||t.push(o)}return t}function mn(r,e){let t=[];if(Mt(r,e.box).length===0)return t;let n=new a.Circle(e.pc,e.r),i=ft(r,n);for(let o of i)o.on(e)&&t.push(o);return t}function lr(r,e){let t=[];if(r.ps.on(e)&&t.push(r.ps),r.pe.on(e)&&!r.isZeroLength()&&t.push(r.pe),t.length>0||r.isZeroLength()||r.ps.leftTo(e)&&r.pe.leftTo(e)||!r.ps.leftTo(e)&&!r.pe.leftTo(e))return t;let n=new a.Line(r.ps,r.pe);return fr(n,e)}function Dt(r,e){let t=[];if(r.box.not_intersect(e.box))return t;if(r.isZeroLength())return r.ps.on(e)&&t.push(r.ps),t;if(e.isZeroLength())return e.ps.on(r)&&t.push(e.ps),t;let n=new a.Line(r.ps,r.pe),i=new a.Line(e.ps,e.pe);if(n.incidentTo(i))r.ps.on(e)&&t.push(r.ps),r.pe.on(e)&&t.push(r.pe),e.ps.on(r)&&!e.ps.equalTo(r.ps)&&!e.ps.equalTo(r.pe)&&t.push(e.ps),e.pe.on(r)&&!e.pe.equalTo(r.ps)&&!e.pe.equalTo(r.pe)&&t.push(e.pe);else{let o=fr(n,i);o.length>0&&o[0].on(r)&&o[0].on(e)&&t.push(o[0])}return t}function ur(r,e){let t=[];if(r.box.not_intersect(e.box))return t;if(r.isZeroLength()){let[o,s]=r.ps.distanceTo(e.pc);return a.Utils.EQ(o,e.r)&&t.push(r.ps),t}let n=new a.Line(r.ps,r.pe),i=ft(n,e);for(let o of i)o.on(r)&&t.push(o);return t}function $e(r,e){let t=[];if(r.box.not_intersect(e.box))return t;if(r.isZeroLength())return r.ps.on(e)&&t.push(r.ps),t;let n=new a.Line(r.ps,r.pe),i=new a.Circle(e.pc,e.r),o=ft(n,i);for(let s of o)s.on(r)&&s.on(e)&&t.push(s);return t}function Uf(r,e){let t=[];for(let n of e.toSegments()){let i=Dt(n,r);for(let o of i)t.push(o)}return t}function Mi(r,e){let t=[];if(r.box.not_intersect(e.box))return t;let n=new a.Vector(r.pc,e.pc),i=r.r,o=e.r;if(a.Utils.EQ_0(i)||a.Utils.EQ_0(o))return t;if(a.Utils.EQ_0(n.x)&&a.Utils.EQ_0(n.y)&&a.Utils.EQ(i,o))return t.push(r.pc.translate(-i,0)),t;let s=r.pc.distanceTo(e.pc)[0];if(a.Utils.GT(s,i+o)||a.Utils.LT(s,Math.abs(i-o)))return t;n.x/=s,n.y/=s;let l;if(a.Utils.EQ(s,i+o)||a.Utils.EQ(s,Math.abs(i-o)))return l=r.pc.translate(i*n.x,i*n.y),t.push(l),t;let c=i*i/(2*s)-o*o/(2*s)+s/2,h=r.pc.translate(c*n.x,c*n.y),d=Math.sqrt(i*i-c*c);return l=h.translate(n.rotate90CCW().multiply(d)),t.push(l),l=h.translate(n.rotate90CW().multiply(d)),t.push(l),t}function Df(r,e){let t=[];for(let n of e.toSegments()){let i=ur(n,r);for(let o of i)t.push(o)}return t}function _n(r,e){var t=[];if(r.box.not_intersect(e.box))return t;if(r.pc.equalTo(e.pc)&&a.Utils.EQ(r.r,e.r)){let s;return s=r.start,s.on(e)&&t.push(s),s=r.end,s.on(e)&&t.push(s),s=e.start,s.on(r)&&t.push(s),s=e.end,s.on(r)&&t.push(s),t}let n=new a.Circle(r.pc,r.r),i=new a.Circle(e.pc,e.r),o=n.intersect(i);for(let s of o)s.on(r)&&s.on(e)&&t.push(s);return t}function gn(r,e){let t=[];if(r.box.not_intersect(e.box))return t;if(e.pc.equalTo(r.pc)&&a.Utils.EQ(e.r,r.r))return t.push(r.start),t.push(r.end),t;let n=e,i=new a.Circle(r.pc,r.r),o=Mi(n,i);for(let s of o)s.on(r)&&t.push(s);return t}function jf(r,e){let t=[];for(let n of e.toSegments()){let i=$e(n,r);for(let o of i)t.push(o)}return t}function Gf(r,e){return r.isSegment()?Dt(r.shape,e):$e(e,r.shape)}function Vf(r,e){return r.isSegment()?$e(r.shape,e):_n(r.shape,e)}function Bi(r,e){return r.isSegment()?lr(r.shape,e):mn(e,r.shape)}function qf(r,e){return r.isSegment()?ur(r.shape,e):gn(r.shape,e)}function bn(r,e){let t=[];for(let n of e.edges)for(let i of Gf(n,r))t.push(i);return t}function vn(r,e){let t=[];for(let n of e.edges)for(let i of Vf(n,r))t.push(i);return t}function cr(r,e){let t=[];if(e.isEmpty())return t;for(let n of e.edges)for(let i of Bi(n,r))Ui(i,t)||t.push(i);return r.sortPoints(t)}function Fi(r,e){let t=[];if(e.isEmpty())return t;for(let n of e.edges)for(let i of qf(n,r))t.push(i);return t}function Wf(r,e){let t=r.shape,n=e.shape;return r.isSegment()?e.isSegment()?Dt(t,n):$e(t,n):e.isSegment()?$e(n,t):_n(t,n)}function $f(r,e){let t=[];if(e.isEmpty()||r.shape.box.not_intersect(e.box))return t;let n=e.edges.search(r.shape.box);for(let i of n)for(let o of Wf(r,i))t.push(o);return t}function Hf(r,e){let t=[];if(r.isEmpty()||e.isEmpty()||r.box.not_intersect(e.box))return t;for(let n of r.edges)for(let i of $f(n,e))t.push(i);return t}function zf(r,e){return r instanceof a.Line?cr(r,e):r instanceof a.Segment?bn(r,e):r instanceof a.Arc?vn(r,e):[]}function Ui(r,e){return e.some(t=>t.equalTo(r))}var ie=class extends sr{constructor(...e){super();if(e.length!==0&&e.length==1&&e[0]instanceof Array){let t=e[0];if(t.length==0)return;let n=t.every(i=>i instanceof a.Segment||i instanceof a.Arc||i instanceof a.Ray||i instanceof a.Line);for(let i of t){let o=new a.Edge(i);this.append(o)}}}get edges(){return[...this]}get box(){return this.edges.reduce((e,t)=>e=e.merge(t.box),new a.Box)}get vertices(){let e=this.edges.map(t=>t.start);return e.push(this.last.end),e}clone(){return new ie(this.toShapes())}addVertex(e,t){let n=t.shape.split(e);if(n[0]===null)return t.prev;if(n[1]===null)return t;let i=new a.Edge(n[0]),o=t.prev;return this.insert(i,o),t.shape=n[1],i}split(e){for(let t of e){let n=this.findEdgeByPoint(t);this.addVertex(t,n)}return this}findEdgeByPoint(e){let t;for(let n of this)if(n.shape.contains(e)){t=n;break}return t}translate(e){return new ie(this.edges.map(t=>t.shape.translate(e)))}rotate(e=0,t=new a.Point){return new ie(this.edges.map(n=>n.shape.rotate(e,t)))}transform(e=new a.Matrix){return new ie(this.edges.map(t=>t.shape.transform(e)))}toShapes(){return this.edges.map(e=>e.shape.clone())}toJSON(){return this.edges.map(e=>e.toJSON())}svg(e={}){let{stroke:t,strokeWidth:n,fill:i,fillRule:o,fillOpacity:s,id:l,className:c}=e,h=l&&l.length>0?`id="${l}"`:"",d=c&&c.length>0?`class="${c}"`:"",v=`
<path stroke="${t||"black"}" stroke-width="${n||1}" fill="${i||"none"}" fill-opacity="${s||1}" ${h} ${d} d="`;v+=`
M${this.first.start.x},${this.first.start.y}`;for(let x of this)v+=x.svg();return v+=`" >
</path>`,v}};a.Multiline=ie;var Jf=(...r)=>new a.Multiline(...r);a.multiline=Jf;function Lt(r,e){let t,n=new a.Ray(e),i=new a.Line(n.pt,n.norm),o=new a.Box(n.box.xmin-a.DP_TOL,n.box.ymin-a.DP_TOL,n.box.xmax,n.box.ymax+a.DP_TOL);if(r.box.not_intersect(o))return a.OUTSIDE;let s=r.edges.search(o);if(s.length==0)return a.OUTSIDE;for(let h of s)if(h.shape.contains(e))return a.BOUNDARY;let l=[];for(let h of s)for(let d of n.intersect(h.shape)){if(d.equalTo(e))return a.BOUNDARY;l.push({pt:d,edge:h})}l.sort((h,d)=>Ai(h.pt.x,d.pt.x)?-1:Ci(h.pt.x,d.pt.x)?1:0);let c=0;for(let h=0;h<l.length;h++){let d=l[h];if(d.pt.equalTo(d.edge.shape.start)){if(h>0&&d.pt.equalTo(l[h-1].pt)&&d.edge.prev===l[h-1].edge)continue;let v=d.edge.prev;for(;nn(v.length);)v=v.prev;let x=v.shape.tangentInEnd(),y=d.pt.translate(x),I=d.edge.shape.tangentInStart(),w=d.pt.translate(I),O=y.leftTo(i),C=w.leftTo(i);(O&&!C||!O&&C)&&c++}else if(d.pt.equalTo(d.edge.shape.end)){if(h>0&&d.pt.equalTo(l[h-1].pt)&&d.edge.next===l[h-1].edge)continue;let v=d.edge.next;for(;nn(v.length);)v=v.next;let x=v.shape.tangentInStart(),y=d.pt.translate(x),I=d.edge.shape.tangentInEnd(),w=d.pt.translate(I),O=y.leftTo(i),C=w.leftTo(i);(O&&!C||!O&&C)&&c++}else if(d.edge.shape instanceof a.Segment)c++;else{let v=d.edge.shape.box;qe(d.pt.y,v.ymin)||qe(d.pt.y,v.ymax)||c++}}return t=c%2==1?Rt:Ii,t}function Yf(r,e){return lt(r,e).equal()}function Di(r,e){return lt(r,e).intersect()}function Xf(r,e){return lt(r,e).touch()}function Qf(r,e){return!Di(r,e)}function ji(r,e){return lt(r,e).inside()}function Gi(r,e){return lt(r,e).covered()}function Kf(r,e){return ji(e,r)}function Vi(r,e){return Gi(e,r)}function lt(r,e){if(r instanceof a.Line&&e instanceof a.Line)return Zf(r,e);if(r instanceof a.Line&&e instanceof a.Circle)return el(r,e);if(r instanceof a.Line&&e instanceof a.Box)return tl(r,e);if(r instanceof a.Line&&e instanceof a.Polygon)return rl(r,e);if((r instanceof a.Segment||r instanceof a.Arc)&&e instanceof a.Polygon)return Ei(r,e);if((r instanceof a.Segment||r instanceof a.Arc)&&(e instanceof a.Circle||e instanceof a.Box))return Ei(r,new a.Polygon(e));if(r instanceof a.Polygon&&e instanceof a.Polygon)return er(r,e);if((r instanceof a.Circle||r instanceof a.Box)&&(e instanceof a.Circle||e instanceof a.Box))return er(new a.Polygon(r),new a.Polygon(e));if((r instanceof a.Circle||r instanceof a.Box)&&e instanceof a.Polygon)return er(new a.Polygon(r),e);if(r instanceof a.Polygon&&(e instanceof a.Circle||e instanceof a.Box))return er(r,new a.Polygon(e))}function Zf(r,e){let t=new He,n=fr(r,e);return n.length===0?r.contains(e.pt)&&e.contains(r.pt)?(t.I2I=[r],t.I2E=[],t.E2I=[]):(t.I2I=[],t.I2E=[r],t.E2I=[e]):(t.I2I=n,t.I2E=r.split(n),t.E2I=e.split(n)),t}function el(r,e){let t=new He,n=ft(r,e);if(n.length===0)t.I2I=[],t.I2B=[],t.I2E=[r],t.E2I=[e];else if(n.length===1)t.I2I=[],t.I2B=n,t.I2E=r.split(n),t.E2I=[e];else{let i=new ie([r]),o=r.sortPoints(n);i.split(o);let s=i.toShapes();t.I2I=[s[1]],t.I2B=o,t.I2E=[s[0],s[2]],t.E2I=new a.Polygon([e.toArc()]).cut(i)}return t}function tl(r,e){let t=new He,n=Mt(r,e);if(n.length===0)t.I2I=[],t.I2B=[],t.I2E=[r],t.E2I=[e];else if(n.length===1)t.I2I=[],t.I2B=n,t.I2E=r.split(n),t.E2I=[e];else{let i=new ie([r]),o=r.sortPoints(n);i.split(o);let s=i.toShapes();e.toSegments().some(l=>l.contains(n[0])&&l.contains(n[1]))?(t.I2I=[],t.I2B=[s[1]],t.I2E=[s[0],s[2]],t.E2I=[e]):(t.I2I=[s[1]],t.I2B=o,t.I2E=[s[0],s[2]],t.E2I=new a.Polygon(e.toSegments()).cut(i))}return t}function rl(r,e){let t=new He,n=cr(r,e),i=new ie([r]),o=n.length>0?n.slice():r.sortPoints(n);return i.split(o),[...i].forEach(s=>s.setInclusion(e)),t.I2I=[...i].filter(s=>s.bv===a.INSIDE).map(s=>s.shape),t.I2B=[...i].slice(1).map(s=>s.bv===a.BOUNDARY?s.shape:s.shape.start),t.I2E=[...i].filter(s=>s.bv===a.OUTSIDE).map(s=>s.shape),t.E2I=e.cut(i),t}function Ei(r,e){let t=new He,n=zf(r,e),i=n.length>0?n.slice():r.sortPoints(n),o=new ie([r]);o.split(i),[...o].forEach(s=>s.setInclusion(e)),t.I2I=[...o].filter(s=>s.bv===a.INSIDE).map(s=>s.shape),t.I2B=[...o].slice(1).map(s=>s.bv===a.BOUNDARY?s.shape:s.shape.start),t.I2E=[...o].filter(s=>s.bv===a.OUTSIDE).map(s=>s.shape),t.B2I=[],t.B2B=[],t.B2E=[];for(let s of[r.start,r.end])switch(Lt(e,s)){case a.INSIDE:t.B2I.push(s);break;case a.BOUNDARY:t.B2B.push(s);break;case a.OUTSIDE:t.B2E.push(s);break;default:break}return t}function er(r,e){let t=new He,[n,i]=Li(r,e),o=Ri(r,e),s=an(r,e),l=an(e,r),[c,h]=ki(r,e),d=fn(r,e),v=fn(e,r);return t.I2I=o.isEmpty()?[]:[o],t.I2B=h,t.I2E=s.isEmpty()?[]:[s],t.B2I=c,t.B2B=n,t.B2E=d,t.E2I=l.isEmpty()?[]:[l],t.E2B=v,t}var nl=Object.freeze({equal:Yf,intersect:Di,touch:Xf,disjoint:Qf,inside:ji,covered:Gi,contain:Kf,cover:Vi,relate:lt}),Pe=class{constructor(e=1,t=0,n=0,i=1,o=0,s=0){this.a=e,this.b=t,this.c=n,this.d=i,this.tx=o,this.ty=s}clone(){return new Pe(this.a,this.b,this.c,this.d,this.tx,this.ty)}transform(e){return[e[0]*this.a+e[1]*this.c+this.tx,e[0]*this.b+e[1]*this.d+this.ty]}multiply(e){return new Pe(this.a*e.a+this.c*e.b,this.b*e.a+this.d*e.b,this.a*e.c+this.c*e.d,this.b*e.c+this.d*e.d,this.a*e.tx+this.c*e.ty+this.tx,this.b*e.tx+this.d*e.ty+this.ty)}translate(...e){let t,n;if(e.length==1&&e[0]instanceof a.Vector)t=e[0].x,n=e[0].y;else if(e.length==2&&typeof e[0]=="number"&&typeof e[1]=="number")t=e[0],n=e[1];else throw a.Errors.ILLEGAL_PARAMETERS;return this.multiply(new Pe(1,0,0,1,t,n))}rotate(e){let t=Math.cos(e),n=Math.sin(e);return this.multiply(new Pe(t,n,-n,t,0,0))}scale(e,t){return this.multiply(new Pe(e,0,0,t,0,0))}equalTo(e){return!(!a.Utils.EQ(this.tx,e.tx)||!a.Utils.EQ(this.ty,e.ty)||!a.Utils.EQ(this.a,e.a)||!a.Utils.EQ(this.b,e.b)||!a.Utils.EQ(this.c,e.c)||!a.Utils.EQ(this.d,e.d))}};a.Matrix=Pe;var il=(...r)=>new a.Matrix(...r);a.matrix=il;var ol=class hn{constructor(e,t){this.low=e,this.high=t}clone(){return new hn(this.low,this.high)}get max(){return this.clone()}less_than(e){return this.low<e.low||this.low==e.low&&this.high<e.high}equal_to(e){return this.low==e.low&&this.high==e.high}intersect(e){return!this.not_intersect(e)}not_intersect(e){return this.high<e.low||e.high<this.low}merge(e){return new hn(this.low===void 0?e.low:Math.min(this.low,e.low),this.high===void 0?e.high:Math.max(this.high,e.high))}output(){return[this.low,this.high]}static comparable_max(e,t){return e.merge(t)}static comparable_less_than(e,t){return e<t}},K=0,V=1,je=class{constructor(e=void 0,t=void 0,n=null,i=null,o=null,s=V){this.left=n,this.right=i,this.parent=o,this.color=s,this.item={key:e,value:t},e&&e instanceof Array&&e.length==2&&!Number.isNaN(e[0])&&!Number.isNaN(e[1])&&(this.item.key=new ol(Math.min(e[0],e[1]),Math.max(e[0],e[1]))),this.max=this.item.key?this.item.key.max:void 0}isNil(){return this.item.key===void 0&&this.item.value===void 0&&this.left===null&&this.right===null&&this.color===V}less_than(e){if(this.item.value===this.item.key&&e.item.value===e.item.key)return this.item.key.less_than(e.item.key);{let t=this.item.value&&e.item.value&&this.item.value.less_than?this.item.value.less_than(e.item.value):this.item.value<e.item.value;return this.item.key.less_than(e.item.key)||this.item.key.equal_to(e.item.key)&&t}}equal_to(e){if(this.item.value===this.item.key&&e.item.value===e.item.key)return this.item.key.equal_to(e.item.key);{let t=this.item.value&&e.item.value&&this.item.value.equal_to?this.item.value.equal_to(e.item.value):this.item.value==e.item.value;return this.item.key.equal_to(e.item.key)&&t}}intersect(e){return this.item.key.intersect(e.item.key)}copy_data(e){this.item.key=e.item.key.clone(),this.item.value=e.item.value&&e.item.value.clone?e.item.value.clone():e.item.value}update_max(){if(this.max=this.item.key?this.item.key.max:void 0,this.right&&this.right.max){let e=this.item.key.constructor.comparable_max;this.max=e(this.max,this.right.max)}if(this.left&&this.left.max){let e=this.item.key.constructor.comparable_max;this.max=e(this.max,this.left.max)}}not_intersect_left_subtree(e){let t=this.item.key.constructor.comparable_less_than,n=this.left.max.high!==void 0?this.left.max.high:this.left.max;return t(n,e.item.key.low)}not_intersect_right_subtree(e){let t=this.item.key.constructor.comparable_less_than,n=this.right.max.low!==void 0?this.right.max.low:this.right.item.key.low;return t(e.item.key.high,n)}},at=class{constructor(){this.root=null,this.nil_node=new je}get size(){let e=0;return this.tree_walk(this.root,()=>e++),e}get keys(){let e=[];return this.tree_walk(this.root,t=>e.push(t.item.key.output?t.item.key.output():t.item.key)),e}get values(){let e=[];return this.tree_walk(this.root,t=>e.push(t.item.value)),e}get items(){let e=[];return this.tree_walk(this.root,t=>e.push({key:t.item.key.output?t.item.key.output():t.item.key,value:t.item.value})),e}isEmpty(){return this.root==null||this.root==this.nil_node}insert(e,t=e){if(e===void 0)return;let n=new je(e,t,this.nil_node,this.nil_node,null,K);return this.tree_insert(n),this.recalc_max(n),n}exist(e,t=e){let n=new je(e,t);return!!this.tree_search(this.root,n)}remove(e,t=e){let n=new je(e,t),i=this.tree_search(this.root,n);return i&&this.tree_delete(i),i}search(e,t=(n,i)=>n===i?i.output():n){let n=new je(e),i=[];return this.tree_search_interval(this.root,n,i),i.map(o=>t(o.item.value,o.item.key))}intersect_any(e){let t=new je(e);return this.tree_find_any_interval(this.root,t)}forEach(e){this.tree_walk(this.root,t=>e(t.item.key,t.item.value))}map(e){let t=new at;return this.tree_walk(this.root,n=>t.insert(n.item.key,e(n.item.value,n.item.key))),t}recalc_max(e){let t=e;for(;t.parent!=null;)t.parent.update_max(),t=t.parent}tree_insert(e){let t=this.root,n=null;if(this.root==null||this.root==this.nil_node)this.root=e;else{for(;t!=this.nil_node;)n=t,e.less_than(t)?t=t.left:t=t.right;e.parent=n,e.less_than(n)?n.left=e:n.right=e}this.insert_fixup(e)}insert_fixup(e){let t,n;for(t=e;t!=this.root&&t.parent.color==K;)t.parent==t.parent.parent.left?(n=t.parent.parent.right,n.color==K?(t.parent.color=V,n.color=V,t.parent.parent.color=K,t=t.parent.parent):(t==t.parent.right&&(t=t.parent,this.rotate_left(t)),t.parent.color=V,t.parent.parent.color=K,this.rotate_right(t.parent.parent))):(n=t.parent.parent.left,n.color==K?(t.parent.color=V,n.color=V,t.parent.parent.color=K,t=t.parent.parent):(t==t.parent.left&&(t=t.parent,this.rotate_right(t)),t.parent.color=V,t.parent.parent.color=K,this.rotate_left(t.parent.parent)));this.root.color=V}tree_delete(e){let t,n;e.left==this.nil_node||e.right==this.nil_node?t=e:t=this.tree_successor(e),t.left!=this.nil_node?n=t.left:n=t.right,n.parent=t.parent,t==this.root?this.root=n:(t==t.parent.left?t.parent.left=n:t.parent.right=n,t.parent.update_max()),this.recalc_max(n),t!=e&&(e.copy_data(t),e.update_max(),this.recalc_max(e)),t.color==V&&this.delete_fixup(n)}delete_fixup(e){let t=e,n;for(;t!=this.root&&t.parent!=null&&t.color==V;)t==t.parent.left?(n=t.parent.right,n.color==K&&(n.color=V,t.parent.color=K,this.rotate_left(t.parent),n=t.parent.right),n.left.color==V&&n.right.color==V?(n.color=K,t=t.parent):(n.right.color==V&&(n.color=K,n.left.color=V,this.rotate_right(n),n=t.parent.right),n.color=t.parent.color,t.parent.color=V,n.right.color=V,this.rotate_left(t.parent),t=this.root)):(n=t.parent.left,n.color==K&&(n.color=V,t.parent.color=K,this.rotate_right(t.parent),n=t.parent.left),n.left.color==V&&n.right.color==V?(n.color=K,t=t.parent):(n.left.color==V&&(n.color=K,n.right.color=V,this.rotate_left(n),n=t.parent.left),n.color=t.parent.color,t.parent.color=V,n.left.color=V,this.rotate_right(t.parent),t=this.root));t.color=V}tree_search(e,t){if(!(e==null||e==this.nil_node))return t.equal_to(e)?e:t.less_than(e)?this.tree_search(e.left,t):this.tree_search(e.right,t)}tree_search_interval(e,t,n){e!=null&&e!=this.nil_node&&(e.left!=this.nil_node&&!e.not_intersect_left_subtree(t)&&this.tree_search_interval(e.left,t,n),e.intersect(t)&&n.push(e),e.right!=this.nil_node&&!e.not_intersect_right_subtree(t)&&this.tree_search_interval(e.right,t,n))}tree_find_any_interval(e,t){let n=!1;return e!=null&&e!=this.nil_node&&(e.left!=this.nil_node&&!e.not_intersect_left_subtree(t)&&(n=this.tree_find_any_interval(e.left,t)),n||(n=e.intersect(t)),!n&&e.right!=this.nil_node&&!e.not_intersect_right_subtree(t)&&(n=this.tree_find_any_interval(e.right,t))),n}local_minimum(e){let t=e;for(;t.left!=null&&t.left!=this.nil_node;)t=t.left;return t}local_maximum(e){let t=e;for(;t.right!=null&&t.right!=this.nil_node;)t=t.right;return t}tree_successor(e){let t,n,i;if(e.right!=this.nil_node)t=this.local_minimum(e.right);else{for(n=e,i=e.parent;i!=null&&i.right==n;)n=i,i=i.parent;t=i}return t}rotate_left(e){let t=e.right;e.right=t.left,t.left!=this.nil_node&&(t.left.parent=e),t.parent=e.parent,e==this.root?this.root=t:e==e.parent.left?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t,e!=null&&e!=this.nil_node&&e.update_max(),t=e.parent,t!=null&&t!=this.nil_node&&t.update_max()}rotate_right(e){let t=e.left;e.left=t.right,t.right!=this.nil_node&&(t.right.parent=e),t.parent=e.parent,e==this.root?this.root=t:e==e.parent.left?e.parent.left=t:e.parent.right=t,t.right=e,e.parent=t,e!=null&&e!=this.nil_node&&e.update_max(),t=e.parent,t!=null&&t!=this.nil_node&&t.update_max()}tree_walk(e,t){e!=null&&e!=this.nil_node&&(this.tree_walk(e.left,t),t(e),this.tree_walk(e.right,t))}testRedBlackProperty(){let e=!0;return this.tree_walk(this.root,function(t){t.color==K&&(t.left.color==V&&t.right.color==V||(e=!1))}),e}testBlackHeightProperty(e){let t=0,n=0,i=0;if(e.color==V&&t++,e.left!=this.nil_node?n=this.testBlackHeightProperty(e.left):n=1,e.right!=this.nil_node?i=this.testBlackHeightProperty(e.right):i=1,n!=i)throw new Error("Red-black height property violated");return t+=n,t}},qi=class extends Set{constructor(e){super(e);this.index=new at,this.forEach(t=>this.index.insert(t))}add(e){let t=this.size;if(super.add(e),this.size>t){let n=this.index.insert(e.box,e)}return this}delete(e){let t=super.delete(e);return t&&this.index.remove(e.box,e),t}clear(){super.clear(),this.index=new at}search(e){return this.index.search(e)}hit(e){let t=new a.Box(e.x-1,e.y-1,e.x+1,e.y+1);return this.index.search(t).filter(i=>e.on(i))}svg(){return[...this].reduce((t,n)=>t+n.svg(),"")}};a.PlanarSet=qi;var hr=class{constructor(...e){if(this.x=0,this.y=0,e.length!==0){if(e.length===1&&e[0]instanceof Array&&e[0].length===2){let t=e[0];if(typeof t[0]=="number"&&typeof t[1]=="number"){this.x=t[0],this.y=t[1];return}}if(e.length===1&&e[0]instanceof Object&&e[0].name==="point"){let{x:t,y:n}=e[0];this.x=t,this.y=n;return}if(e.length===2&&typeof e[0]=="number"&&typeof e[1]=="number"){this.x=e[0],this.y=e[1];return}throw a.Errors.ILLEGAL_PARAMETERS}}get box(){return new a.Box(this.x,this.y,this.x,this.y)}clone(){return new a.Point(this.x,this.y)}get vertices(){return[this.clone()]}equalTo(e){return a.Utils.EQ(this.x,e.x)&&a.Utils.EQ(this.y,e.y)}lessThan(e){return!!(a.Utils.LT(this.y,e.y)||a.Utils.EQ(this.y,e.y)&&a.Utils.LT(this.x,e.x))}rotate(e,t={x:0,y:0}){var n=t.x+(this.x-t.x)*Math.cos(e)-(this.y-t.y)*Math.sin(e),i=t.y+(this.x-t.x)*Math.sin(e)+(this.y-t.y)*Math.cos(e);return new a.Point(n,i)}translate(...e){if(e.length==1&&(e[0]instanceof a.Vector||!isNaN(e[0].x)&&!isNaN(e[0].y)))return new a.Point(this.x+e[0].x,this.y+e[0].y);if(e.length==2&&typeof e[0]=="number"&&typeof e[1]=="number")return new a.Point(this.x+e[0],this.y+e[1]);throw a.Errors.ILLEGAL_PARAMETERS}transform(e){return new a.Point(e.transform([this.x,this.y]))}projectionOn(e){if(this.equalTo(e.pt))return this.clone();let t=new a.Vector(this,e.pt);if(a.Utils.EQ_0(t.cross(e.norm)))return e.pt.clone();let n=t.dot(e.norm),i=e.norm.multiply(n);return this.translate(i)}leftTo(e){let t=new a.Vector(e.pt,this);return a.Utils.GT(t.dot(e.norm),0)}distanceTo(e){if(e instanceof hr){let t=e.x-this.x,n=e.y-this.y;return[Math.sqrt(t*t+n*n),new a.Segment(this,e)]}if(e instanceof a.Line)return a.Distance.point2line(this,e);if(e instanceof a.Circle)return a.Distance.point2circle(this,e);if(e instanceof a.Segment)return a.Distance.point2segment(this,e);if(e instanceof a.Arc)return a.Distance.point2arc(this,e);if(e instanceof a.Polygon)return a.Distance.point2polygon(this,e);if(e instanceof a.PlanarSet)return a.Distance.shape2planarSet(this,e)}on(e){if(e instanceof a.Point)return this.equalTo(e);if(e instanceof a.Line)return e.contains(this);if(e instanceof a.Circle)return e.contains(this);if(e instanceof a.Segment)return e.contains(this);if(e instanceof a.Arc)return e.contains(this);if(e instanceof a.Polygon)return e.contains(this)}toJSON(){return Object.assign({},this,{name:"point"})}svg(e={}){let{r:t,stroke:n,strokeWidth:i,fill:o,id:s,className:l}=e,c=s&&s.length>0?`id="${s}"`:"",h=l&&l.length>0?`class="${l}"`:"";return`
<circle cx="${this.x}" cy="${this.y}" r="${t||3}" stroke="${n||"black"}" stroke-width="${i||1}" fill="${o||"red"}" ${c} ${h} />`}};a.Point=hr;var sl=(...r)=>new a.Point(...r);a.point=sl;var Wi=class{constructor(...e){if(this.x=0,this.y=0,e.length!==0){if(e.length===1&&e[0]instanceof Array&&e[0].length===2){let t=e[0];if(typeof t[0]=="number"&&typeof t[1]=="number"){this.x=t[0],this.y=t[1];return}}if(e.length===1&&e[0]instanceof Object&&e[0].name==="vector"){let{x:t,y:n}=e[0];this.x=t,this.y=n;return}if(e.length===2){let t=e[0],n=e[1];if(typeof t=="number"&&typeof n=="number"){this.x=t,this.y=n;return}if(t instanceof a.Point&&n instanceof a.Point){this.x=n.x-t.x,this.y=n.y-t.y;return}}throw a.Errors.ILLEGAL_PARAMETERS}}clone(){return new a.Vector(this.x,this.y)}get slope(){let e=Math.atan2(this.y,this.x);return e<0&&(e=2*Math.PI+e),e}get length(){return Math.sqrt(this.dot(this))}equalTo(e){return a.Utils.EQ(this.x,e.x)&&a.Utils.EQ(this.y,e.y)}multiply(e){return new a.Vector(e*this.x,e*this.y)}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}normalize(){if(!a.Utils.EQ_0(this.length))return new a.Vector(this.x/this.length,this.y/this.length);throw a.Errors.ZERO_DIVISION}rotate(e){let n=new a.Point(this.x,this.y).rotate(e);return new a.Vector(n.x,n.y)}rotate90CCW(){return new a.Vector(-this.y,this.x)}rotate90CW(){return new a.Vector(this.y,-this.x)}invert(){return new a.Vector(-this.x,-this.y)}add(e){return new a.Vector(this.x+e.x,this.y+e.y)}subtract(e){return new a.Vector(this.x-e.x,this.y-e.y)}angleTo(e){let t=this.normalize(),n=e.normalize(),i=Math.atan2(t.cross(n),t.dot(n));return i<0&&(i+=2*Math.PI),i}projectionOn(e){let t=e.normalize(),n=this.dot(t);return t.multiply(n)}toJSON(){return Object.assign({},this,{name:"vector"})}};a.Vector=Wi;var al=(...r)=>new a.Vector(...r);a.vector=al;var rt=class{constructor(...e){if(this.ps=new a.Point,this.pe=new a.Point,e.length!==0){if(e.length===1&&e[0]instanceof Array&&e[0].length===4){let t=e[0];this.ps=new a.Point(t[0],t[1]),this.pe=new a.Point(t[2],t[3]);return}if(e.length===1&&e[0]instanceof Object&&e[0].name==="segment"){let{ps:t,pe:n}=e[0];this.ps=new a.Point(t.x,t.y),this.pe=new a.Point(n.x,n.y);return}if(e.length===1&&e[0]instanceof a.Point){this.ps=e[0].clone();return}if(e.length===2&&e[0]instanceof a.Point&&e[1]instanceof a.Point){this.ps=e[0].clone(),this.pe=e[1].clone();return}if(e.length===4){this.ps=new a.Point(e[0],e[1]),this.pe=new a.Point(e[2],e[3]);return}throw a.Errors.ILLEGAL_PARAMETERS}}clone(){return new a.Segment(this.start,this.end)}get start(){return this.ps}get end(){return this.pe}get vertices(){return[this.ps.clone(),this.pe.clone()]}get length(){return this.start.distanceTo(this.end)[0]}get slope(){return new a.Vector(this.start,this.end).slope}get box(){return new a.Box(Math.min(this.start.x,this.end.x),Math.min(this.start.y,this.end.y),Math.max(this.start.x,this.end.x),Math.max(this.start.y,this.end.y))}equalTo(e){return this.ps.equalTo(e.ps)&&this.pe.equalTo(e.pe)}contains(e){return a.Utils.EQ_0(this.distanceToPoint(e))}intersect(e){if(e instanceof a.Point)return this.contains(e)?[e]:[];if(e instanceof a.Line)return lr(this,e);if(e instanceof a.Segment)return Dt(this,e);if(e instanceof a.Circle)return ur(this,e);if(e instanceof a.Box)return Uf(this,e);if(e instanceof a.Arc)return $e(this,e);if(e instanceof a.Polygon)return bn(this,e)}distanceTo(e){if(e instanceof a.Point){let[t,n]=a.Distance.point2segment(e,this);return n=n.reverse(),[t,n]}if(e instanceof a.Circle){let[t,n]=a.Distance.segment2circle(this,e);return[t,n]}if(e instanceof a.Line){let[t,n]=a.Distance.segment2line(this,e);return[t,n]}if(e instanceof a.Segment){let[t,n]=a.Distance.segment2segment(this,e);return[t,n]}if(e instanceof a.Arc){let[t,n]=a.Distance.segment2arc(this,e);return[t,n]}if(e instanceof a.Polygon){let[t,n]=a.Distance.shape2polygon(this,e);return[t,n]}if(e instanceof a.PlanarSet){let[t,n]=a.Distance.shape2planarSet(this,e);return[t,n]}}tangentInStart(){return new a.Vector(this.start,this.end).normalize()}tangentInEnd(){return new a.Vector(this.end,this.start).normalize()}reverse(){return new rt(this.end,this.start)}split(e){return this.start.equalTo(e)?[null,this.clone()]:this.end.equalTo(e)?[this.clone(),null]:[new a.Segment(this.start,e),new a.Segment(e,this.end)]}middle(){return new a.Point((this.start.x+this.end.x)/2,(this.start.y+this.end.y)/2)}pointAtLength(e){if(e>this.length||e<0)return null;if(e==0)return this.start;if(e==this.length)return this.end;let t=e/this.length;return new a.Point((this.end.x-this.start.x)*t+this.start.x,(this.end.y-this.start.y)*t+this.start.y)}distanceToPoint(e){let[t,...n]=a.Distance.point2segment(e,this);return t}definiteIntegral(e=0){let t=this.end.x-this.start.x,n=this.start.y-e,i=this.end.y-e;return t*(n+i)/2}translate(...e){return new rt(this.ps.translate(...e),this.pe.translate(...e))}rotate(e=0,t=new a.Point){let n=new a.Matrix;return n=n.translate(t.x,t.y).rotate(e).translate(-t.x,-t.y),this.transform(n)}transform(e=new a.Matrix){return new rt(this.ps.transform(e),this.pe.transform(e))}isZeroLength(){return this.ps.equalTo(this.pe)}sortPoints(e){return new a.Line(this.start,this.end).sortPoints(e)}toJSON(){return Object.assign({},this,{name:"segment"})}svg(e={}){let{stroke:t,strokeWidth:n,id:i,className:o}=e,s=i&&i.length>0?`id="${i}"`:"",l=o&&o.length>0?`class="${o}"`:"";return`
<line x1="${this.start.x}" y1="${this.start.y}" x2="${this.end.x}" y2="${this.end.y}" stroke="${t||"black"}" stroke-width="${n||1}" ${s} ${l} />`}};a.Segment=rt;var fl=(...r)=>new a.Segment(...r);a.segment=fl;var{vector:tr}=a,dr=class{constructor(...e){if(this.pt=new a.Point,this.norm=new a.Vector(0,1),e.length!=0){if(e.length==1&&e[0]instanceof Object&&e[0].name==="line"){let{pt:t,norm:n}=e[0];this.pt=new a.Point(t),this.norm=new a.Vector(n);return}if(e.length==2){let t=e[0],n=e[1];if(t instanceof a.Point&&n instanceof a.Point){this.pt=t,this.norm=dr.points2norm(t,n),this.norm.dot(tr(this.pt.x,this.pt.y))>=0&&this.norm.invert();return}if(t instanceof a.Point&&n instanceof a.Vector){if(a.Utils.EQ_0(n.x)&&a.Utils.EQ_0(n.y))throw a.Errors.ILLEGAL_PARAMETERS;this.pt=t.clone(),this.norm=n.clone(),this.norm=this.norm.normalize(),this.norm.dot(tr(this.pt.x,this.pt.y))>=0&&this.norm.invert();return}if(t instanceof a.Vector&&n instanceof a.Point){if(a.Utils.EQ_0(t.x)&&a.Utils.EQ_0(t.y))throw a.Errors.ILLEGAL_PARAMETERS;this.pt=n.clone(),this.norm=t.clone(),this.norm=this.norm.normalize(),this.norm.dot(tr(this.pt.x,this.pt.y))>=0&&this.norm.invert();return}}throw a.Errors.ILLEGAL_PARAMETERS}}clone(){return new a.Line(this.pt,this.norm)}get start(){}get end(){}get length(){return Number.POSITIVE_INFINITY}get box(){return new a.Box(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY)}get middle(){}get slope(){return new a.Vector(this.norm.y,-this.norm.x).slope}get standard(){let e=this.norm.x,t=this.norm.y,n=this.norm.dot(this.pt);return[e,t,n]}parallelTo(e){return a.Utils.EQ_0(this.norm.cross(e.norm))}incidentTo(e){return this.parallelTo(e)&&this.pt.on(e)}contains(e){if(this.pt.equalTo(e))return!0;let t=new a.Vector(this.pt,e);return a.Utils.EQ_0(this.norm.dot(t))}coord(e){return tr(e.x,e.y).cross(this.norm)}intersect(e){if(e instanceof a.Point)return this.contains(e)?[e]:[];if(e instanceof a.Line)return fr(this,e);if(e instanceof a.Circle)return ft(this,e);if(e instanceof a.Box)return Mt(this,e);if(e instanceof a.Segment)return lr(e,this);if(e instanceof a.Arc)return mn(this,e);if(e instanceof a.Polygon)return cr(this,e)}distanceTo(e){if(e instanceof a.Point){let[t,n]=a.Distance.point2line(e,this);return n=n.reverse(),[t,n]}if(e instanceof a.Circle){let[t,n]=a.Distance.circle2line(e,this);return n=n.reverse(),[t,n]}if(e instanceof a.Segment){let[t,n]=a.Distance.segment2line(e,this);return[t,n.reverse()]}if(e instanceof a.Arc){let[t,n]=a.Distance.arc2line(e,this);return[t,n.reverse()]}if(e instanceof a.Polygon){let[t,n]=a.Distance.shape2polygon(this,e);return[t,n]}}split(e){if(e instanceof a.Point)return[new a.Ray(e,this.norm.invert()),new a.Ray(e,this.norm)];{let t=new a.Multiline([this]),n=this.sortPoints(e);return t.split(n),t.toShapes()}}sortPoints(e){return e.slice().sort((t,n)=>this.coord(t)<this.coord(n)?-1:this.coord(t)>this.coord(n)?1:0)}toJSON(){return Object.assign({},this,{name:"line"})}svg(e,t={}){let n=Mt(this,e);if(n.length===0)return"";let i=n[0],o=n.length==2?n[1]:n.find(l=>!l.equalTo(i));return o===void 0&&(o=i),new a.Segment(i,o).svg(t)}static points2norm(e,t){if(e.equalTo(t))throw a.Errors.ILLEGAL_PARAMETERS;return new a.Vector(e,t).normalize().rotate90CCW()}};a.Line=dr;var ll=(...r)=>new a.Line(...r);a.line=ll;var $i=class{constructor(...e){if(this.pc=new a.Point,this.r=1,e.length==1&&e[0]instanceof Object&&e[0].name==="circle"){let{pc:t,r:n}=e[0];this.pc=new a.Point(t),this.r=n;return}else{let[t,n]=[...e];t&&t instanceof a.Point&&(this.pc=t.clone()),n!==void 0&&(this.r=n);return}throw a.Errors.ILLEGAL_PARAMETERS}clone(){return new a.Circle(this.pc.clone(),this.r)}get center(){return this.pc}get box(){return new a.Box(this.pc.x-this.r,this.pc.y-this.r,this.pc.x+this.r,this.pc.y+this.r)}contains(e){if(e instanceof a.Point)return a.Utils.LE(e.distanceTo(this.center)[0],this.r);if(e instanceof a.Segment)return a.Utils.LE(e.start.distanceTo(this.center)[0],this.r)&&a.Utils.LE(e.end.distanceTo(this.center)[0],this.r);if(e instanceof a.Arc)return this.intersect(e).length===0&&a.Utils.LE(e.start.distanceTo(this.center)[0],this.r)&&a.Utils.LE(e.end.distanceTo(this.center)[0],this.r);if(e instanceof a.Circle)return this.intersect(e).length===0&&a.Utils.LE(e.r,this.r)&&a.Utils.LE(e.center.distanceTo(this.center)[0],this.r)}toArc(e=!0){return new a.Arc(this.center,this.r,Math.PI,-Math.PI,e)}intersect(e){if(e instanceof a.Point)return this.contains(e)?[e]:[];if(e instanceof a.Line)return ft(e,this);if(e instanceof a.Segment)return ur(e,this);if(e instanceof a.Circle)return Mi(e,this);if(e instanceof a.Box)return Df(this,e);if(e instanceof a.Arc)return gn(e,this);if(e instanceof a.Polygon)return Fi(this,e)}distanceTo(e){if(e instanceof a.Point){let[t,n]=a.Distance.point2circle(e,this);return n=n.reverse(),[t,n]}if(e instanceof a.Circle){let[t,n]=a.Distance.circle2circle(this,e);return[t,n]}if(e instanceof a.Line){let[t,n]=a.Distance.circle2line(this,e);return[t,n]}if(e instanceof a.Segment){let[t,n]=a.Distance.segment2circle(e,this);return n=n.reverse(),[t,n]}if(e instanceof a.Arc){let[t,n]=a.Distance.arc2circle(e,this);return n=n.reverse(),[t,n]}if(e instanceof a.Polygon){let[t,n]=a.Distance.shape2polygon(this,e);return[t,n]}if(e instanceof a.PlanarSet){let[t,n]=a.Distance.shape2planarSet(this,e);return[t,n]}}toJSON(){return Object.assign({},this,{name:"circle"})}svg(e={}){let{stroke:t,strokeWidth:n,fill:i,fillOpacity:o,id:s,className:l}=e,c=s&&s.length>0?`id="${s}"`:"",h=l&&l.length>0?`class="${l}"`:"";return`
<circle cx="${this.pc.x}" cy="${this.pc.y}" r="${this.r}" stroke="${t||"black"}" stroke-width="${n||1}" fill="${i||"none"}" fill-opacity="${o||1}" ${c} ${h} />`}};a.Circle=$i;var ul=(...r)=>new a.Circle(...r);a.circle=ul;var Hi=class{constructor(...e){if(this.pc=new a.Point,this.r=1,this.startAngle=0,this.endAngle=2*Math.PI,this.counterClockwise=a.CCW,e.length!=0){if(e.length==1&&e[0]instanceof Object&&e[0].name==="arc"){let{pc:t,r:n,startAngle:i,endAngle:o,counterClockwise:s}=e[0];this.pc=new a.Point(t.x,t.y),this.r=n,this.startAngle=i,this.endAngle=o,this.counterClockwise=s;return}else{let[t,n,i,o,s]=[...e];t&&t instanceof a.Point&&(this.pc=t.clone()),n!==void 0&&(this.r=n),i!==void 0&&(this.startAngle=i),o!==void 0&&(this.endAngle=o),s!==void 0&&(this.counterClockwise=s);return}throw a.Errors.ILLEGAL_PARAMETERS}}clone(){return new a.Arc(this.pc.clone(),this.r,this.startAngle,this.endAngle,this.counterClockwise)}get sweep(){if(a.Utils.EQ(this.startAngle,this.endAngle))return 0;if(a.Utils.EQ(Math.abs(this.startAngle-this.endAngle),a.PIx2))return a.PIx2;let e;return this.counterClockwise?e=a.Utils.GT(this.endAngle,this.startAngle)?this.endAngle-this.startAngle:this.endAngle-this.startAngle+a.PIx2:e=a.Utils.GT(this.startAngle,this.endAngle)?this.startAngle-this.endAngle:this.startAngle-this.endAngle+a.PIx2,a.Utils.GT(e,a.PIx2)&&(e-=a.PIx2),a.Utils.LT(e,0)&&(e+=a.PIx2),e}get start(){return new a.Point(this.pc.x+this.r,this.pc.y).rotate(this.startAngle,this.pc)}get end(){return new a.Point(this.pc.x+this.r,this.pc.y).rotate(this.endAngle,this.pc)}get center(){return this.pc.clone()}get vertices(){return[this.start.clone(),this.end.clone()]}get length(){return Math.abs(this.sweep*this.r)}get box(){let t=this.breakToFunctional().reduce((n,i)=>n.merge(i.start.box),new a.Box);return t=t.merge(this.end.box),t}contains(e){if(!a.Utils.EQ(this.pc.distanceTo(e)[0],this.r))return!1;if(e.equalTo(this.start))return!0;let t=new a.Vector(this.pc,e).slope,n=new a.Arc(this.pc,this.r,this.startAngle,t,this.counterClockwise);return a.Utils.LE(n.length,this.length)}split(e){if(this.start.equalTo(e))return[null,this.clone()];if(this.end.equalTo(e))return[this.clone(),null];let t=new a.Vector(this.pc,e).slope;return[new a.Arc(this.pc,this.r,this.startAngle,t,this.counterClockwise),new a.Arc(this.pc,this.r,t,this.endAngle,this.counterClockwise)]}middle(){let e=this.counterClockwise?this.startAngle+this.sweep/2:this.startAngle-this.sweep/2;return new a.Arc(this.pc,this.r,this.startAngle,e,this.counterClockwise).end}pointAtLength(e){if(e>this.length||e<0)return null;if(e==0)return this.start;if(e==this.length)return this.end;let t=e/this.length,n=this.counterClockwise?this.startAngle+this.sweep*t:this.startAngle-this.sweep*t;return new a.Arc(this.pc,this.r,this.startAngle,n,this.counterClockwise).end}chordHeight(){return(1-Math.cos(Math.abs(this.sweep/2)))*this.r}intersect(e){if(e instanceof a.Point)return this.contains(e)?[e]:[];if(e instanceof a.Line)return mn(e,this);if(e instanceof a.Circle)return gn(this,e);if(e instanceof a.Segment)return $e(e,this);if(e instanceof a.Box)return jf(this,e);if(e instanceof a.Arc)return _n(this,e);if(e instanceof a.Polygon)return vn(this,e)}distanceTo(e){if(e instanceof a.Point){let[t,n]=a.Distance.point2arc(e,this);return n=n.reverse(),[t,n]}if(e instanceof a.Circle){let[t,n]=a.Distance.arc2circle(this,e);return[t,n]}if(e instanceof a.Line){let[t,n]=a.Distance.arc2line(this,e);return[t,n]}if(e instanceof a.Segment){let[t,n]=a.Distance.segment2arc(e,this);return n=n.reverse(),[t,n]}if(e instanceof a.Arc){let[t,n]=a.Distance.arc2arc(this,e);return[t,n]}if(e instanceof a.Polygon){let[t,n]=a.Distance.shape2polygon(this,e);return[t,n]}if(e instanceof a.PlanarSet){let[t,n]=a.Distance.shape2planarSet(this,e);return[t,n]}}breakToFunctional(){let e=[],t=[0,Math.PI/2,2*Math.PI/2,3*Math.PI/2],n=[this.pc.translate(this.r,0),this.pc.translate(0,this.r),this.pc.translate(-this.r,0),this.pc.translate(0,-this.r)],i=[];for(let o=0;o<4;o++)n[o].on(this)&&i.push(new a.Arc(this.pc,this.r,this.startAngle,t[o],this.counterClockwise));if(i.length==0)e.push(this.clone());else{i.sort((l,c)=>l.length-c.length);for(let l=0;l<i.length;l++){let c=e.length>0?e[e.length-1]:void 0,h;c?h=new a.Arc(this.pc,this.r,c.endAngle,i[l].endAngle,this.counterClockwise):h=new a.Arc(this.pc,this.r,this.startAngle,i[l].endAngle,this.counterClockwise),a.Utils.EQ_0(h.length)||e.push(h.clone())}let o=e.length>0?e[e.length-1]:void 0,s;o?s=new a.Arc(this.pc,this.r,o.endAngle,this.endAngle,this.counterClockwise):s=new a.Arc(this.pc,this.r,this.startAngle,this.endAngle,this.counterClockwise),!a.Utils.EQ_0(s.length)&&!a.Utils.EQ(s.sweep,2*Math.PI)&&e.push(s.clone())}return e}tangentInStart(){let e=new a.Vector(this.pc,this.start),t=this.counterClockwise?Math.PI/2:-Math.PI/2;return e.rotate(t).normalize()}tangentInEnd(){let e=new a.Vector(this.pc,this.end),t=this.counterClockwise?-Math.PI/2:Math.PI/2;return e.rotate(t).normalize()}reverse(){return new a.Arc(this.pc,this.r,this.endAngle,this.startAngle,!this.counterClockwise)}translate(...e){let t=this.clone();return t.pc=this.pc.translate(...e),t}rotate(e=0,t=new a.Point){let n=new a.Matrix;return n=n.translate(t.x,t.y).rotate(e).translate(-t.x,-t.y),this.transform(n)}scale(e=1,t=1){let n=new a.Matrix;return n=n.scale(e,t),this.transform(n)}transform(e=new a.Matrix){let t=this.start.transform(e),n=this.end.transform(e),i=this.pc.transform(e),o=this.counterClockwise;return e.a*e.d<0&&(o=!o),a.Arc.arcSE(i,t,n,o)}static arcSE(e,t,n,i){let{vector:o}=a,s=o(e,t).slope,l=o(e,n).slope;a.Utils.EQ(s,l)&&(l+=2*Math.PI,i=!0);let c=o(e,t).length;return new a.Arc(e,c,s,l,i)}definiteIntegral(e=0){return this.breakToFunctional().reduce((i,o)=>i+o.circularSegmentDefiniteIntegral(e),0)}circularSegmentDefiniteIntegral(e){let t=new a.Line(this.start,this.end),n=this.pc.leftTo(t),o=new a.Segment(this.start,this.end).definiteIntegral(e),s=this.circularSegmentArea();return n?o-s:o+s}circularSegmentArea(){return .5*this.r*this.r*(this.sweep-Math.sin(this.sweep))}sortPoints(e){let{vector:t}=a;return e.slice().sort((n,i)=>{let o=t(this.pc,n).slope,s=t(this.pc,i).slope;return o<s?-1:o>s?1:0})}toJSON(){return Object.assign({},this,{name:"arc"})}svg(e={}){let t=this.sweep<=Math.PI?"0":"1",n=this.counterClockwise?"1":"0",{stroke:i,strokeWidth:o,fill:s,id:l,className:c}=e,h=l&&l.length>0?`id="${l}"`:"",d=c&&c.length>0?`class="${c}"`:"";return a.Utils.EQ(this.sweep,2*Math.PI)?new a.Circle(this.pc,this.r).svg(e):`
<path d="M${this.start.x},${this.start.y}
                             A${this.r},${this.r} 0 ${t},${n} ${this.end.x},${this.end.y}"
                    stroke="${i||"black"}" stroke-width="${o||1}" fill="${s||"none"}" ${h} ${d} />`}};a.Arc=Hi;var cl=(...r)=>new a.Arc(...r);a.arc=cl;var Bt=class{constructor(e=void 0,t=void 0,n=void 0,i=void 0){this.xmin=e,this.ymin=t,this.xmax=n,this.ymax=i}clone(){return new Bt(this.xmin,this.ymin,this.xmax,this.ymax)}get low(){return new a.Point(this.xmin,this.ymin)}get high(){return new a.Point(this.xmax,this.ymax)}get max(){return this.clone()}get center(){return new a.Point((this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)}get width(){return Math.abs(this.xmax-this.xmin)}get height(){return Math.abs(this.ymax-this.ymin)}get box(){return this.clone()}not_intersect(e){return this.xmax<e.xmin||this.xmin>e.xmax||this.ymax<e.ymin||this.ymin>e.ymax}intersect(e){return!this.not_intersect(e)}merge(e){return new Bt(this.xmin===void 0?e.xmin:Math.min(this.xmin,e.xmin),this.ymin===void 0?e.ymin:Math.min(this.ymin,e.ymin),this.xmax===void 0?e.xmax:Math.max(this.xmax,e.xmax),this.ymax===void 0?e.ymax:Math.max(this.ymax,e.ymax))}less_than(e){return!!(this.low.lessThan(e.low)||this.low.equalTo(e.low)&&this.high.lessThan(e.high))}equal_to(e){return this.low.equalTo(e.low)&&this.high.equalTo(e.high)}output(){return this.clone()}static comparable_max(e,t){return e.merge(t)}static comparable_less_than(e,t){return e.lessThan(t)}set(e,t,n,i){this.xmin=e,this.ymin=t,this.xmax=n,this.ymax=i}toPoints(){return[new a.Point(this.xmin,this.ymin),new a.Point(this.xmax,this.ymin),new a.Point(this.xmax,this.ymax),new a.Point(this.xmin,this.ymax)]}toSegments(){let e=this.toPoints();return[new a.Segment(e[0],e[1]),new a.Segment(e[1],e[2]),new a.Segment(e[2],e[3]),new a.Segment(e[3],e[0])]}svg(e={}){let{stroke:t,strokeWidth:n,fill:i,id:o,className:s}=e,l=o&&o.length>0?`id="${o}"`:"",c=s&&s.length>0?`class="${s}"`:"",h=this.xmax-this.xmin,d=this.ymax-this.ymin;return`
<rect x="${this.xmin}" y="${this.ymin}" width=${h} height=${d} stroke="${t||"black"}" stroke-width="${n||1}" fill="${i||"none"}" ${l} ${c} />`}};a.Box=Bt;var hl=(...r)=>new a.Box(...r);a.box=hl;var zi=class{constructor(e){this.shape=e,this.next=void 0,this.prev=void 0,this.face=void 0,this.arc_length=0,this.bvStart=void 0,this.bvEnd=void 0,this.bv=void 0,this.overlap=void 0}get start(){return this.shape.start}get end(){return this.shape.end}get length(){return this.shape.length}get box(){return this.shape.box}isSegment(){return this.shape instanceof a.Segment}isArc(){return this.shape instanceof a.Arc}middle(){return this.shape.middle()}pointAtLength(e){return this.shape.pointAtLength(e)}contains(e){return this.shape.contains(e)}setInclusion(e){if(this.bv!==void 0)return this.bv;if(this.shape instanceof a.Line||this.shape instanceof a.Ray)return this.bv=a.OUTSIDE,this.bv;if(this.bvStart===void 0&&(this.bvStart=Lt(e,this.start)),this.bvEnd===void 0&&(this.bvEnd=Lt(e,this.end)),this.bvStart===a.OUTSIDE||this.bvEnd==a.OUTSIDE)this.bv=a.OUTSIDE;else if(this.bvStart===a.INSIDE||this.bvEnd==a.INSIDE)this.bv=a.INSIDE;else{let t=Lt(e,this.middle());this.bv=t}return this.bv}setOverlap(e){let t,n=this.shape,i=e.shape;n instanceof a.Segment&&i instanceof a.Segment?n.start.equalTo(i.start)&&n.end.equalTo(i.end)?t=a.OVERLAP_SAME:n.start.equalTo(i.end)&&n.end.equalTo(i.start)&&(t=a.OVERLAP_OPPOSITE):(n instanceof a.Arc&&i instanceof a.Arc||n instanceof a.Segment&&i instanceof a.Arc||n instanceof a.Arc&&i instanceof a.Segment)&&(n.start.equalTo(i.start)&&n.end.equalTo(i.end)&&n.middle().equalTo(i.middle())?t=a.OVERLAP_SAME:n.start.equalTo(i.end)&&n.end.equalTo(i.start)&&n.middle().equalTo(i.middle())&&(t=a.OVERLAP_OPPOSITE)),this.overlap===void 0&&(this.overlap=t),e.overlap===void 0&&(e.overlap=t)}svg(){if(this.shape instanceof a.Segment)return` L${this.shape.end.x},${this.shape.end.y}`;if(this.shape instanceof a.Arc){let e=this.shape,t,n=e.counterClockwise?"1":"0";if(a.Utils.EQ(e.sweep,2*Math.PI)){let i=e.counterClockwise?1:-1,o=new a.Arc(e.pc,e.r,e.startAngle,e.startAngle+i*Math.PI,e.counterClockwise),s=new a.Arc(e.pc,e.r,e.startAngle+i*Math.PI,e.endAngle,e.counterClockwise);return t="0",` A${o.r},${o.r} 0 ${t},${n} ${o.end.x},${o.end.y}
                    A${s.r},${s.r} 0 ${t},${n} ${s.end.x},${s.end.y}`}else return t=e.sweep<=Math.PI?"0":"1",` A${e.r},${e.r} 0 ${t},${n} ${e.end.x},${e.end.y}`}}toJSON(){return this.shape.toJSON()}};a.Edge=zi;var Ji=class extends sr{constructor(e,t){super(e,t);this.setCircularLinks()}setCircularLinks(){this.isEmpty()||(this.last.next=this.first,this.first.prev=this.last)}[Symbol.iterator](){let e;return{next:()=>{let t=e||this.first,n=this.first?e?e===this.first:!1:!0;return e=t?t.next:void 0,{value:t,done:n}}}}append(e){return super.append(e),this.setCircularLinks(),this}insert(e,t){return super.insert(e,t),this.setCircularLinks(),this}remove(e){return super.remove(e),this}},Ge=class extends Ji{constructor(e,...t){super();if(this._box=void 0,this._orientation=void 0,t.length!=0){if(t.length==1){if(t[0]instanceof Array){let n=t[0];if(n.length==0)return;if(n.every(i=>i instanceof a.Point)){let i=Ge.points2segments(n);this.shapes2face(e.edges,i)}else if(n.every(i=>i instanceof Array&&i.length===2)){let i=n.map(s=>new a.Point(s[0],s[1])),o=Ge.points2segments(i);this.shapes2face(e.edges,o)}else if(n.every(i=>i instanceof a.Segment||i instanceof a.Arc))this.shapes2face(e.edges,n);else if(n.every(i=>i.name==="segment"||i.name==="arc")){let i=[];for(let o of n){let s;o.name==="segment"?s=new a.Segment(o):s=new a.Arc(o),i.push(s)}this.shapes2face(e.edges,i)}}else if(t[0]instanceof Ge){let n=t[0];this.first=n.first,this.last=n.last;for(let i of n)e.edges.add(i)}else if(t[0]instanceof a.Circle)this.shapes2face(e.edges,[t[0].toArc(a.CCW)]);else if(t[0]instanceof a.Box){let n=t[0];this.shapes2face(e.edges,[new a.Segment(new a.Point(n.xmin,n.ymin),new a.Point(n.xmax,n.ymin)),new a.Segment(new a.Point(n.xmax,n.ymin),new a.Point(n.xmax,n.ymax)),new a.Segment(new a.Point(n.xmax,n.ymax),new a.Point(n.xmin,n.ymax)),new a.Segment(new a.Point(n.xmin,n.ymax),new a.Point(n.xmin,n.ymin))])}}t.length==2&&t[0]instanceof a.Edge&&t[1]instanceof a.Edge&&(this.first=t[0],this.last=t[1],this.last.next=this.first,this.first.prev=this.last,this.setArcLength())}}get edges(){return this.toArray()}get shapes(){return this.edges.map(e=>e.shape.clone())}get box(){if(this._box===void 0){let e=new a.Box;for(let t of this)e=e.merge(t.box);this._box=e}return this._box}get perimeter(){return this.last.arc_length+this.last.length}pointAtLength(e){if(e>this.perimeter||e<0)return null;let t=null;for(let n of this)if(e>=n.arc_length&&(n===this.last||e<n.next.arc_length)){t=n.pointAtLength(e-n.arc_length);break}return t}static points2segments(e){let t=[];for(let n=0;n<e.length;n++)e[n].equalTo(e[(n+1)%e.length])||t.push(new a.Segment(e[n],e[(n+1)%e.length]));return t}shapes2face(e,t){for(let n of t){let i=new a.Edge(n);this.append(i),e.add(i)}}append(e){return super.append(e),this.setOneEdgeArcLength(e),e.face=this,this}insert(e,t){return super.insert(e,t),this.setOneEdgeArcLength(e),e.face=this,this}remove(e){return super.remove(e),this.setArcLength(),this}reverse(){let e=[],t=this.last;do t.shape=t.shape.reverse(),e.push(t),t=t.prev;while(t!==this.last);this.first=void 0,this.last=void 0;for(let n of e)this.first===void 0?(n.prev=n,n.next=n,this.first=n,this.last=n):(n.prev=this.last,this.last.next=n,this.last=n,this.last.next=this.first,this.first.prev=this.last),this.setOneEdgeArcLength(n);this._orientation!==void 0&&(this._orientation=void 0,this._orientation=this.orientation())}setArcLength(){for(let e of this)this.setOneEdgeArcLength(e),e.face=this}setOneEdgeArcLength(e){e===this.first?e.arc_length=0:e.arc_length=e.prev.arc_length+e.prev.length}area(){return Math.abs(this.signedArea())}signedArea(){let e=0,t=this.box.ymin;for(let n of this)e+=n.shape.definiteIntegral(t);return e}orientation(){if(this._orientation===void 0){let e=this.signedArea();a.Utils.EQ_0(e)?this._orientation=a.ORIENTATION.NOT_ORIENTABLE:a.Utils.LT(e,0)?this._orientation=a.ORIENTATION.CCW:this._orientation=a.ORIENTATION.CW}return this._orientation}isSimple(e){return Ge.getSelfIntersections(this,e,!0).length==0}static getSelfIntersections(e,t,n=!1){let i=[];for(let o of e){let s=t.search(o.box);for(let l of s){if(o===l||l.face!==e||o.shape instanceof a.Segment&&l.shape instanceof a.Segment&&(o.next===l||o.prev===l))continue;let c=o.shape.intersect(l.shape);for(let h of c)if(!(h.equalTo(o.start)&&h.equalTo(l.end)&&l===o.prev)&&!(h.equalTo(o.end)&&h.equalTo(l.start)&&l===o.next)&&(i.push(h),n))break;if(i.length>0&&n)break}if(i.length>0&&n)break}return i}findEdgeByPoint(e){let t;for(let n of this)if(n.shape.contains(e)){t=n;break}return t}toPolygon(){return new a.Polygon(this.shapes)}toJSON(){return this.edges.map(e=>e.toJSON())}svg(){let e=`
M${this.first.start.x},${this.first.start.y}`;for(let t of this)e+=t.svg();return e+=" z",e}};a.Face=Ge;var pr=class{constructor(...e){if(this.pt=new a.Point,this.norm=new a.Vector(0,1),e.length!=0&&(e.length>=1&&e[0]instanceof a.Point&&(this.pt=e[0].clone()),e.length!==1)){if(e.length===2&&e[1]instanceof a.Vector){this.norm=e[1].clone();return}throw a.Errors.ILLEGAL_PARAMETERS}}clone(){return new pr(this.pt,this.norm)}get slope(){return new a.Vector(this.norm.y,-this.norm.x).slope}get box(){let e=this.slope;return new a.Box(e>Math.PI/2&&e<3*Math.PI/2?Number.NEGATIVE_INFINITY:this.pt.x,e>=0&&e<=Math.PI?this.pt.y:Number.NEGATIVE_INFINITY,e>=Math.PI/2&&e<=3*Math.PI/2?this.pt.x:Number.POSITIVE_INFINITY,e>=Math.PI&&e<=2*Math.PI||e==0?this.pt.y:Number.POSITIVE_INFINITY)}get start(){return this.pt}get end(){}get length(){return Number.POSITIVE_INFINITY}contains(e){if(this.pt.equalTo(e))return!0;let t=new a.Vector(this.pt,e);return a.Utils.EQ_0(this.norm.dot(t))&&a.Utils.GE(t.cross(this.norm),0)}split(e){return this.contains(e)?this.pt.equalTo(e)?[this]:[new a.Segment(this.pt,e),new a.Ray(e,this.norm)]:[]}intersect(e){if(e instanceof a.Segment)return this.intersectRay2Segment(this,e);if(e instanceof a.Arc)return this.intersectRay2Arc(this,e)}intersectRay2Segment(e,t){let n=[],i=new a.Line(e.start,e.norm),o=i.intersect(t);for(let s of o)e.contains(s)&&n.push(s);return o.length==2&&n.length==1&&e.start.on(i)&&n.push(e.start),n}intersectRay2Arc(e,t){let n=[],o=new a.Line(e.start,e.norm).intersect(t);for(let s of o)e.contains(s)&&n.push(s);return n}svg(e,t={}){let n=new a.Line(this.pt,this.norm),i=Mt(n,e);return i=i.filter(s=>this.contains(s)),i.length===0||i.length===2?"":new a.Segment(this.pt,i[0]).svg(t)}};a.Ray=pr;var dl=(...r)=>new a.Ray(...r);a.ray=dl;var Ve=class{constructor(){this.faces=new a.PlanarSet,this.edges=new a.PlanarSet;let e=[...arguments];if(e.length===1&&(e[0]instanceof Array&&e[0].length>0||e[0]instanceof a.Circle||e[0]instanceof a.Box)){let t=e[0];if(e[0]instanceof Array&&e[0].every(n=>n instanceof Array))if(t.every(n=>n instanceof Array&&n.length===2&&typeof n[0]=="number"&&typeof n[1]=="number"))this.faces.add(new a.Face(this,t));else for(let n of t)if(n instanceof Array&&n[0]instanceof Array&&n[0].every(i=>i instanceof Array&&i.length===2&&typeof i[0]=="number"&&typeof i[1]=="number"))for(let i of n)this.faces.add(new a.Face(this,i));else this.faces.add(new a.Face(this,n));else this.faces.add(new a.Face(this,t))}}get box(){return[...this.faces].reduce((e,t)=>e.merge(t.box),new a.Box)}get vertices(){return[...this.edges].map(e=>e.start)}clone(){let e=new Ve;for(let t of this.faces)e.addFace(t.shapes);return e}isEmpty(){return this.edges.size===0}isValid(){let e=!0;for(let t of this.faces)if(!t.isSimple(this.edges)){e=!1;break}return e}area(){let e=[...this.faces].reduce((t,n)=>t+n.signedArea(),0);return Math.abs(e)}addFace(...e){let t=new a.Face(this,...e);return this.faces.add(t),t}deleteFace(e){for(let t of e)this.edges.delete(t);return this.faces.delete(e)}recreateFaces(){this.faces.clear();for(let n of this.edges)n.face=null;let e,t=!0;for(;t;){t=!1;for(let n of this.edges)if(n.face===null){e=n,t=!0;break}if(t){let n=e;do n=n.next;while(n.next!==e);this.addFace(e,n)}}}removeChain(e,t,n){if(n.next===t){this.deleteFace(e);return}for(let i=t;i!==n.next;i=i.next)if(e.remove(i),this.edges.delete(i),e.isEmpty()){this.deleteFace(e);break}}addVertex(e,t){let n=t.shape.split(e);if(n[0]===null)return t.prev;if(n[1]===null)return t;let i=new a.Edge(n[0]),o=t.prev;return t.face.insert(i,o),this.edges.delete(t),this.edges.add(i),t.shape=n[1],this.edges.add(t),i}cut(e){let t=[this.clone()];for(let n of e){if(n.setInclusion(this)!==Rt)continue;let i=n.shape.start,o=n.shape.end,s=[];for(let l of t)if(l.findEdgeByPoint(i)===void 0)s.push(l);else{let[c,h]=l.cutFace(i,o);s.push(c,h)}t=s}return t}cutFace(e,t){let n=this.findEdgeByPoint(e),i=this.findEdgeByPoint(t);if(n.face!==i.face)return[];let o=this.addVertex(e,n);i=this.findEdgeByPoint(t);let s=this.addVertex(t,i),l=o.face,c=new a.Edge(new a.Segment(o.end,s.end)),h=new a.Edge(new a.Segment(s.end,o.end));o.next.prev=h,h.next=o.next,o.next=c,c.prev=o,s.next.prev=c,c.next=s.next,s.next=h,h.prev=s,this.edges.add(c),this.edges.add(h);let d=this.addFace(c,o),v=this.addFace(h,s);return this.faces.delete(l),[d.toPolygon(),v.toPolygon()]}cutWithLine(e){let t=this.clone(),n=new ie([e]),i={int_points1:[],int_points2:[],int_points1_sorted:[],int_points2_sorted:[]};for(let l of t.edges){let c=Bi(l,e);for(let h of c)it(n.first,h,i.int_points1),it(l,h,i.int_points2)}if(i.int_points1.length===0)return t;i.int_points1_sorted=en(e,i.int_points1),i.int_points2_sorted=kt(i.int_points2),st(n,i.int_points1_sorted),st(t,i.int_points2_sorted),pn(i),i.int_points1_sorted=en(e,i.int_points1),i.int_points2_sorted=kt(i.int_points2),on(i.int_points1),sn(i.int_points1,t);for(let l of i.int_points1_sorted)l.edge_before.bv===l.edge_after.bv&&(i.int_points2[l.id]=-1,l.id=-1);if(i.int_points1=i.int_points1.filter(l=>l.id>=0),i.int_points2=i.int_points2.filter(l=>l.id>=0),i.int_points1.length===0)return t;i.int_points1_sorted=en(e,i.int_points1),i.int_points2_sorted=kt(i.int_points2);let o=i.int_points1[0],s;for(let l of i.int_points1_sorted)l.edge_before.bv===Rt&&(s=new a.Edge(new a.Segment(o.pt,l.pt)),gi(i.int_points2[o.id],i.int_points2[l.id],s),t.edges.add(s),s=new a.Edge(new a.Segment(l.pt,o.pt)),gi(i.int_points2[l.id],i.int_points2[o.id],s),t.edges.add(s)),o=l;return t.recreateFaces(),t}findEdgeByPoint(e){let t;for(let n of this.faces)if(t=n.findEdgeByPoint(e),t!==void 0)break;return t}splitToIslands(){let e=this.toArray();e.sort((i,o)=>o.area()-i.area());let t=[...e[0].faces][0].orientation(),n=e.filter(i=>[...i.faces][0].orientation()===t);for(let i of e){let o=[...i.faces][0];if(o.orientation()!==t){for(let s of n)if(o.shapes.every(l=>s.contains(l))){s.addFace(o.shapes);break}}}return n}reverse(){for(let e of this.faces)e.reverse();return this}contains(e){if(e instanceof a.Point){let t=Lt(this,e);return t===Rt||t===le}else return Vi(this,e)}distanceTo(e){if(e instanceof a.Point){let[t,n]=a.Distance.point2polygon(e,this);return n=n.reverse(),[t,n]}if(e instanceof a.Circle||e instanceof a.Line||e instanceof a.Segment||e instanceof a.Arc){let[t,n]=a.Distance.shape2polygon(e,this);return n=n.reverse(),[t,n]}if(e instanceof a.Polygon){let t=[Number.POSITIVE_INFINITY,new a.Segment],n,i;for(let o of this.edges){let s=t[0];[n,i]=a.Distance.shape2planarSet(o.shape,e.edges,s),a.Utils.LT(n,s)&&(t=[n,i])}return t}}intersect(e){if(e instanceof a.Point)return this.contains(e)?[e]:[];if(e instanceof a.Line)return cr(e,this);if(e instanceof a.Circle)return Fi(e,this);if(e instanceof a.Segment)return bn(e,this);if(e instanceof a.Arc)return vn(e,this);if(e instanceof a.Polygon)return Hf(e,this)}translate(e){let t=new Ve;for(let n of this.faces)t.addFace(n.shapes.map(i=>i.translate(e)));return t}rotate(e=0,t=new a.Point){let n=new Ve;for(let i of this.faces)n.addFace(i.shapes.map(o=>o.rotate(e,t)));return n}transform(e=new a.Matrix){let t=new Ve;for(let n of this.faces)t.addFace(n.shapes.map(i=>i.transform(e)));return t}toJSON(){return[...this.faces].map(e=>e.toJSON())}toArray(){return[...this.faces].map(e=>e.toPolygon())}svg(e={}){let{stroke:t,strokeWidth:n,fill:i,fillRule:o,fillOpacity:s,id:l,className:c}=e,h=l&&l.length>0?`id="${l}"`:"",d=c&&c.length>0?`class="${c}"`:"",v=`
<path stroke="${t||"black"}" stroke-width="${n||1}" fill="${i||"lightcyan"}" fill-rule="${o||"evenodd"}" fill-opacity="${s||1}" ${h} ${d} d="`;for(let x of this.faces)v+=x.svg();return v+=`" >
</path>`,v}};a.Polygon=Ve;var pl=(...r)=>new a.Polygon(...r);a.polygon=pl;var{Circle:tn,Line:wi,Point:Si,Vector:rr,Utils:rn}=a,nt=class{constructor(e){this.circle=e}get inversion_circle(){return this.circle}static inversePoint(e,t){let n=new rr(e.pc,t),i=e.r*e.r,o=n.dot(n);return rn.EQ_0(o)?new Si(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY):e.pc.translate(n.multiply(i/o))}static inverseCircle(e,t){let n=e.pc.distanceTo(t.pc)[0];if(rn.EQ(n,t.r)){let i=e.r*e.r/(2*t.r),o=new rr(e.pc,t.pc);o=o.normalize();let s=e.pc.translate(o.multiply(i));return new wi(s,o)}else{let i=new rr(e.pc,t.pc),o=e.r*e.r/(i.dot(i)-t.r*t.r),s=e.pc.translate(i.multiply(o)),l=Math.abs(o)*t.r;return new tn(s,l)}}static inverseLine(e,t){let[n,i]=e.pc.distanceTo(t);if(rn.EQ_0(n))return t.clone();{let o=e.r*e.r/(2*n),s=new rr(e.pc,i.end);return s=s.multiply(o/n),new tn(e.pc.translate(s),o)}}inverse(e){if(e instanceof Si)return nt.inversePoint(this.circle,e);if(e instanceof tn)return nt.inverseCircle(this.circle,e);if(e instanceof wi)return nt.inverseLine(this.circle,e)}};a.Inversion=nt;var ml=r=>new a.Inversion(r);a.inversion=ml;var N=class{static point2point(e,t){return e.distanceTo(t)}static point2line(e,t){let n=e.projectionOn(t);return[new a.Vector(e,n).length,new a.Segment(e,n)]}static point2circle(e,t){let[n,i]=e.distanceTo(t.center);if(a.Utils.EQ_0(n))return[t.r,new a.Segment(e,t.toArc().start)];{let o=Math.abs(n-t.r),s=new a.Vector(t.pc,e).normalize().multiply(t.r),l=t.pc.translate(s);return[o,new a.Segment(e,l)]}}static point2segment(e,t){if(t.start.equalTo(t.end))return N.point2point(e,t.start);let n=new a.Vector(t.start,t.end),i=new a.Vector(t.start,e),o=new a.Vector(t.end,e),s=n.dot(i),l=-n.dot(o),c,h;if(a.Utils.GE(s,0)&&a.Utils.GE(l,0)){let d=t.tangentInStart();return c=Math.abs(d.cross(i)),h=t.start.translate(d.multiply(d.dot(i))),[c,new a.Segment(e,h)]}else return s<0?e.distanceTo(t.start):e.distanceTo(t.end)}static point2arc(e,t){let n=new a.Circle(t.pc,t.r),i=[],o,s;return[o,s]=N.point2circle(e,n),s.end.on(t)&&i.push(N.point2circle(e,n)),i.push(N.point2point(e,t.start)),i.push(N.point2point(e,t.end)),N.sort(i),i[0]}static segment2line(e,t){let n=e.intersect(t);if(n.length>0)return[0,new a.Segment(n[0],n[0])];let i=[];return i.push(N.point2line(e.start,t)),i.push(N.point2line(e.end,t)),N.sort(i),i[0]}static segment2segment(e,t){let n=Dt(e,t);if(n.length>0)return[0,new a.Segment(n[0],n[0])];let i=[],o,s;return[o,s]=N.point2segment(t.start,e),i.push([o,s.reverse()]),[o,s]=N.point2segment(t.end,e),i.push([o,s.reverse()]),i.push(N.point2segment(e.start,t)),i.push(N.point2segment(e.end,t)),N.sort(i),i[0]}static segment2circle(e,t){let n=e.intersect(t);if(n.length>0)return[0,new a.Segment(n[0],n[0])];let i=new a.Line(e.ps,e.pe),[o,s]=N.point2line(t.center,i);if(a.Utils.GE(o,t.r)&&s.end.on(e))return N.point2circle(s.end,t);{let[l,c]=N.point2circle(e.start,t),[h,d]=N.point2circle(e.end,t);return a.Utils.LT(l,h)?[l,c]:[h,d]}}static segment2arc(e,t){let n=e.intersect(t);if(n.length>0)return[0,new a.Segment(n[0],n[0])];let i=new a.Line(e.ps,e.pe),o=new a.Circle(t.pc,t.r),[s,l]=N.point2line(o.center,i);if(a.Utils.GE(s,o.r)&&l.end.on(e)){let[v,x]=N.point2circle(l.end,o);if(x.end.on(t))return[v,x]}let c=[];c.push(N.point2arc(e.start,t)),c.push(N.point2arc(e.end,t));let h,d;return[h,d]=N.point2segment(t.start,e),c.push([h,d.reverse()]),[h,d]=N.point2segment(t.end,e),c.push([h,d.reverse()]),N.sort(c),c[0]}static circle2circle(e,t){let n=e.intersect(t);if(n.length>0)return[0,new a.Segment(n[0],n[0])];if(e.center.equalTo(t.center)){let i=e.toArc(),o=t.toArc();return N.point2point(i.start,o.start)}else{let i=new a.Line(e.center,t.center),o=i.intersect(e),s=i.intersect(t),l=[];return l.push(N.point2point(o[0],s[0])),l.push(N.point2point(o[0],s[1])),l.push(N.point2point(o[1],s[0])),l.push(N.point2point(o[1],s[1])),N.sort(l),l[0]}}static circle2line(e,t){let n=e.intersect(t);if(n.length>0)return[0,new a.Segment(n[0],n[0])];let[i,o]=N.point2line(e.center,t),[s,l]=N.point2circle(o.end,e);return l=l.reverse(),[s,l]}static arc2line(e,t){let n=t.intersect(e);if(n.length>0)return[0,new a.Segment(n[0],n[0])];let i=new a.Circle(e.center,e.r),[o,s]=N.point2line(i.center,t);if(a.Utils.GE(o,i.r)){let[l,c]=N.point2circle(s.end,i);if(c.end.on(e))return[l,c]}else{let l=[];return l.push(N.point2line(e.start,t)),l.push(N.point2line(e.end,t)),N.sort(l),l[0]}}static arc2circle(e,t){let n=e.intersect(t);if(n.length>0)return[0,new a.Segment(n[0],n[0])];let i=new a.Circle(e.center,e.r),[o,s]=N.circle2circle(i,t);if(s.start.on(e))return[o,s];{let l=[];return l.push(N.point2circle(e.start,t)),l.push(N.point2circle(e.end,t)),N.sort(l),l[0]}}static arc2arc(e,t){let n=e.intersect(t);if(n.length>0)return[0,new a.Segment(n[0],n[0])];let i=new a.Circle(e.center,e.r),o=new a.Circle(t.center,t.r),[s,l]=N.circle2circle(i,o);if(l.start.on(e)&&l.end.on(t))return[s,l];{let c=[],h,d;return[h,d]=N.point2arc(e.start,t),d.end.on(t)&&c.push([h,d]),[h,d]=N.point2arc(e.end,t),d.end.on(t)&&c.push([h,d]),[h,d]=N.point2arc(t.start,e),d.end.on(e)&&c.push([h,d.reverse()]),[h,d]=N.point2arc(t.end,e),d.end.on(e)&&c.push([h,d.reverse()]),[h,d]=N.point2point(e.start,t.start),c.push([h,d]),[h,d]=N.point2point(e.start,t.end),c.push([h,d]),[h,d]=N.point2point(e.end,t.start),c.push([h,d]),[h,d]=N.point2point(e.end,t.end),c.push([h,d]),N.sort(c),c[0]}}static point2polygon(e,t){let n=[Number.POSITIVE_INFINITY,new a.Segment];for(let i of t.edges){let[o,s]=i.shape instanceof a.Segment?N.point2segment(e,i.shape):N.point2arc(e,i.shape);a.Utils.LT(o,n[0])&&(n=[o,s])}return n}static shape2polygon(e,t){let n=[Number.POSITIVE_INFINITY,new a.Segment];for(let i of t.edges){let[o,s]=e.distanceTo(i.shape);a.Utils.LT(o,n[0])&&(n=[o,s])}return n}static polygon2polygon(e,t){let n=[Number.POSITIVE_INFINITY,new a.Segment];for(let i of e.edges)for(let o of t.edges){let[s,l]=i.shape.distanceTo(o.shape);a.Utils.LT(s,n[0])&&(n=[s,l])}return n}static box2box_minmax(e,t){let n=Math.max(Math.max(e.xmin-t.xmax,0),Math.max(t.xmin-e.xmax,0)),i=Math.max(Math.max(e.ymin-t.ymax,0),Math.max(t.ymin-e.ymax,0)),o=n*n+i*i,s=e.merge(t),l=s.xmax-s.xmin,c=s.ymax-s.ymin,h=l*l+c*c;return[o,h]}static minmax_tree_process_level(e,t,n,i){let o,s;for(let d of t)[o,s]=N.box2box_minmax(e.box,d.item.key),d.item.value instanceof a.Edge?i.insert([o,s],d.item.value.shape):i.insert([o,s],d.item.value),a.Utils.LT(s,n)&&(n=s);if(t.length===0)return n;let l=t.map(d=>d.left.isNil()?void 0:d.left).filter(d=>d!==void 0),c=t.map(d=>d.right.isNil()?void 0:d.right).filter(d=>d!==void 0),h=[...l,...c].filter(d=>{let[v,x]=N.box2box_minmax(e.box,d.max);return a.Utils.LE(v,n)});return n=N.minmax_tree_process_level(e,h,n,i),n}static minmax_tree(e,t,n){let i=new at,o=[t.index.root],s=n<Number.POSITIVE_INFINITY?n*n:Number.POSITIVE_INFINITY;return s=N.minmax_tree_process_level(e,o,s,i),i}static minmax_tree_calc_distance(e,t,n){let i,o;if(t!=null&&!t.isNil()){if([i,o]=N.minmax_tree_calc_distance(e,t.left,n),o)return[i,o];if(a.Utils.LT(i[0],Math.sqrt(t.item.key.low)))return[i,!0];let[s,l]=N.distance(e,t.item.value);return a.Utils.LT(s,i[0])&&(i=[s,l]),[i,o]=N.minmax_tree_calc_distance(e,t.right,i),[i,o]}return[n,!1]}static shape2planarSet(e,t,n=Number.POSITIVE_INFINITY){let i=[n,new a.Segment],o=!1;if(t instanceof a.PlanarSet){let s=N.minmax_tree(e,t,n);[i,o]=N.minmax_tree_calc_distance(e,s.root,i)}return i}static sort(e){e.sort((t,n)=>a.Utils.LT(t[0],n[0])?-1:a.Utils.GT(t[0],n[0])?1:0)}static distance(e,t){return e.distanceTo(t)}};a.Distance=N;a.BooleanOperations=kf;a.Relations=nl;var k=a;var Yi=()=>({events:{},emit(r,...e){(this.events[r]||[]).forEach(t=>t(...e))},on(r,e){return(this.events[r]=this.events[r]||[]).push(e),()=>this.events[r]=(this.events[r]||[]).filter(t=>t!==e)}});var _l=typeof global=="object"&&global&&global.Object===Object&&global,mr=_l;var gl=typeof self=="object"&&self&&self.Object===Object&&self,bl=mr||gl||Function("return this")(),z=bl;var vl=z.Symbol,ee=vl;var Xi=Object.prototype,xl=Xi.hasOwnProperty,yl=Xi.toString,jt=ee?ee.toStringTag:void 0;function Tl(r){var e=xl.call(r,jt),t=r[jt];try{r[jt]=void 0;var n=!0}catch{}var i=yl.call(r);return n&&(e?r[jt]=t:delete r[jt]),i}var Qi=Tl;var El=Object.prototype,wl=El.toString;function Sl(r){return wl.call(r)}var Ki=Sl;var Il="[object Null]",Pl="[object Undefined]",Zi=ee?ee.toStringTag:void 0;function Ol(r){return r==null?r===void 0?Pl:Il:Zi&&Zi in Object(r)?Qi(r):Ki(r)}var se=Ol;function Cl(r){return r!=null&&typeof r=="object"}var ae=Cl;var Al="[object Symbol]";function Rl(r){return typeof r=="symbol"||ae(r)&&se(r)==Al}var de=Rl;function kl(r,e){for(var t=-1,n=r==null?0:r.length,i=Array(n);++t<n;)i[t]=e(r[t],t,r);return i}var _r=kl;var Ll=Array.isArray,$=Ll;var Nl=1/0,eo=ee?ee.prototype:void 0,to=eo?eo.toString:void 0;function ro(r){if(typeof r=="string")return r;if($(r))return _r(r,ro)+"";if(de(r))return to?to.call(r):"";var e=r+"";return e=="0"&&1/r==-Nl?"-0":e}var no=ro;var Ml=/\s/;function Bl(r){for(var e=r.length;e--&&Ml.test(r.charAt(e)););return e}var io=Bl;var Fl=/^\s+/;function Ul(r){return r&&r.slice(0,io(r)+1).replace(Fl,"")}var oo=Ul;function Dl(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}var te=Dl;var so=0/0,jl=/^[-+]0x[0-9a-f]+$/i,Gl=/^0b[01]+$/i,Vl=/^0o[0-7]+$/i,ql=parseInt;function Wl(r){if(typeof r=="number")return r;if(de(r))return so;if(te(r)){var e=typeof r.valueOf=="function"?r.valueOf():r;r=te(e)?e+"":e}if(typeof r!="string")return r===0?r:+r;r=oo(r);var t=Gl.test(r);return t||Vl.test(r)?ql(r.slice(2),t?2:8):jl.test(r)?so:+r}var Te=Wl;var ao=1/0,$l=17976931348623157e292;function Hl(r){if(!r)return r===0?r:0;if(r=Te(r),r===ao||r===-ao){var e=r<0?-1:1;return e*$l}return r===r?r:0}var Gt=Hl;function zl(r){var e=Gt(r),t=e%1;return e===e?t?e-t:e:0}var gr=zl;function Jl(r){return r}var fo=Jl;var Yl="[object AsyncFunction]",Xl="[object Function]",Ql="[object GeneratorFunction]",Kl="[object Proxy]";function Zl(r){if(!te(r))return!1;var e=se(r);return e==Xl||e==Ql||e==Yl||e==Kl}var br=Zl;var eu=z["__core-js_shared__"],vr=eu;var lo=function(){var r=/[^.]+$/.exec(vr&&vr.keys&&vr.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function tu(r){return!!lo&&lo in r}var uo=tu;var ru=Function.prototype,nu=ru.toString;function iu(r){if(r!=null){try{return nu.call(r)}catch{}try{return r+""}catch{}}return""}var Ee=iu;var ou=/[\\^$.*+?()[\]{}|]/g,su=/^\[object .+?Constructor\]$/,au=Function.prototype,fu=Object.prototype,lu=au.toString,uu=fu.hasOwnProperty,cu=RegExp("^"+lu.call(uu).replace(ou,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function hu(r){if(!te(r)||uo(r))return!1;var e=br(r)?cu:su;return e.test(Ee(r))}var co=hu;function du(r,e){return r==null?void 0:r[e]}var ho=du;function pu(r,e){var t=ho(r,e);return co(t)?t:void 0}var oe=pu;var mu=oe(z,"WeakMap"),xr=mu;function _u(r,e,t,n){for(var i=r.length,o=t+(n?1:-1);n?o--:++o<i;)if(e(r[o],o,r))return o;return-1}var po=_u;var gu=9007199254740991,bu=/^(?:0|[1-9]\d*)$/;function vu(r,e){var t=typeof r;return e=e??gu,!!e&&(t=="number"||t!="symbol"&&bu.test(r))&&r>-1&&r%1==0&&r<e}var ut=vu;function xu(r,e){return r===e||r!==r&&e!==e}var ct=xu;var yu=9007199254740991;function Tu(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=yu}var ht=Tu;function Eu(r){return r!=null&&ht(r.length)&&!br(r)}var pe=Eu;function wu(r,e,t){if(!te(t))return!1;var n=typeof e;return(n=="number"?pe(t)&&ut(e,t.length):n=="string"&&e in t)?ct(t[e],r):!1}var yr=wu;var Su=Object.prototype;function Iu(r){var e=r&&r.constructor,t=typeof e=="function"&&e.prototype||Su;return r===t}var mo=Iu;function Pu(r,e){for(var t=-1,n=Array(r);++t<r;)n[t]=e(t);return n}var _o=Pu;var Ou="[object Arguments]";function Cu(r){return ae(r)&&se(r)==Ou}var xn=Cu;var go=Object.prototype,Au=go.hasOwnProperty,Ru=go.propertyIsEnumerable,ku=xn(function(){return arguments}())?xn:function(r){return ae(r)&&Au.call(r,"callee")&&!Ru.call(r,"callee")},dt=ku;function Lu(){return!1}var bo=Lu;var yo=typeof exports=="object"&&exports&&!exports.nodeType&&exports,vo=yo&&typeof module=="object"&&module&&!module.nodeType&&module,Nu=vo&&vo.exports===yo,xo=Nu?z.Buffer:void 0,Mu=xo?xo.isBuffer:void 0,Bu=Mu||bo,Vt=Bu;var Fu="[object Arguments]",Uu="[object Array]",Du="[object Boolean]",ju="[object Date]",Gu="[object Error]",Vu="[object Function]",qu="[object Map]",Wu="[object Number]",$u="[object Object]",Hu="[object RegExp]",zu="[object Set]",Ju="[object String]",Yu="[object WeakMap]",Xu="[object ArrayBuffer]",Qu="[object DataView]",Ku="[object Float32Array]",Zu="[object Float64Array]",ec="[object Int8Array]",tc="[object Int16Array]",rc="[object Int32Array]",nc="[object Uint8Array]",ic="[object Uint8ClampedArray]",oc="[object Uint16Array]",sc="[object Uint32Array]",W={};W[Ku]=W[Zu]=W[ec]=W[tc]=W[rc]=W[nc]=W[ic]=W[oc]=W[sc]=!0;W[Fu]=W[Uu]=W[Xu]=W[Du]=W[Qu]=W[ju]=W[Gu]=W[Vu]=W[qu]=W[Wu]=W[$u]=W[Hu]=W[zu]=W[Ju]=W[Yu]=!1;function ac(r){return ae(r)&&ht(r.length)&&!!W[se(r)]}var To=ac;function fc(r){return function(e){return r(e)}}var Eo=fc;var wo=typeof exports=="object"&&exports&&!exports.nodeType&&exports,qt=wo&&typeof module=="object"&&module&&!module.nodeType&&module,lc=qt&&qt.exports===wo,yn=lc&&mr.process,uc=function(){try{var r=qt&&qt.require&&qt.require("util").types;return r||yn&&yn.binding&&yn.binding("util")}catch{}}(),Tn=uc;var So=Tn&&Tn.isTypedArray,cc=So?Eo(So):To,Tr=cc;var hc=Object.prototype,dc=hc.hasOwnProperty;function pc(r,e){var t=$(r),n=!t&&dt(r),i=!t&&!n&&Vt(r),o=!t&&!n&&!i&&Tr(r),s=t||n||i||o,l=s?_o(r.length,String):[],c=l.length;for(var h in r)(e||dc.call(r,h))&&!(s&&(h=="length"||i&&(h=="offset"||h=="parent")||o&&(h=="buffer"||h=="byteLength"||h=="byteOffset")||ut(h,c)))&&l.push(h);return l}var Io=pc;function mc(r,e){return function(t){return r(e(t))}}var Po=mc;var _c=Po(Object.keys,Object),Oo=_c;var gc=Object.prototype,bc=gc.hasOwnProperty;function vc(r){if(!mo(r))return Oo(r);var e=[];for(var t in Object(r))bc.call(r,t)&&t!="constructor"&&e.push(t);return e}var Co=vc;function xc(r){return pe(r)?Io(r):Co(r)}var Oe=xc;var yc=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Tc=/^\w*$/;function Ec(r,e){if($(r))return!1;var t=typeof r;return t=="number"||t=="symbol"||t=="boolean"||r==null||de(r)?!0:Tc.test(r)||!yc.test(r)||e!=null&&r in Object(e)}var pt=Ec;var wc=oe(Object,"create"),we=wc;function Sc(){this.__data__=we?we(null):{},this.size=0}var Ao=Sc;function Ic(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e}var Ro=Ic;var Pc="__lodash_hash_undefined__",Oc=Object.prototype,Cc=Oc.hasOwnProperty;function Ac(r){var e=this.__data__;if(we){var t=e[r];return t===Pc?void 0:t}return Cc.call(e,r)?e[r]:void 0}var ko=Ac;var Rc=Object.prototype,kc=Rc.hasOwnProperty;function Lc(r){var e=this.__data__;return we?e[r]!==void 0:kc.call(e,r)}var Lo=Lc;var Nc="__lodash_hash_undefined__";function Mc(r,e){var t=this.__data__;return this.size+=this.has(r)?0:1,t[r]=we&&e===void 0?Nc:e,this}var No=Mc;function mt(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}mt.prototype.clear=Ao;mt.prototype.delete=Ro;mt.prototype.get=ko;mt.prototype.has=Lo;mt.prototype.set=No;var En=mt;function Bc(){this.__data__=[],this.size=0}var Mo=Bc;function Fc(r,e){for(var t=r.length;t--;)if(ct(r[t][0],e))return t;return-1}var Ce=Fc;var Uc=Array.prototype,Dc=Uc.splice;function jc(r){var e=this.__data__,t=Ce(e,r);if(t<0)return!1;var n=e.length-1;return t==n?e.pop():Dc.call(e,t,1),--this.size,!0}var Bo=jc;function Gc(r){var e=this.__data__,t=Ce(e,r);return t<0?void 0:e[t][1]}var Fo=Gc;function Vc(r){return Ce(this.__data__,r)>-1}var Uo=Vc;function qc(r,e){var t=this.__data__,n=Ce(t,r);return n<0?(++this.size,t.push([r,e])):t[n][1]=e,this}var Do=qc;function _t(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}_t.prototype.clear=Mo;_t.prototype.delete=Bo;_t.prototype.get=Fo;_t.prototype.has=Uo;_t.prototype.set=Do;var Ae=_t;var Wc=oe(z,"Map"),Re=Wc;function $c(){this.size=0,this.__data__={hash:new En,map:new(Re||Ae),string:new En}}var jo=$c;function Hc(r){var e=typeof r;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?r!=="__proto__":r===null}var Go=Hc;function zc(r,e){var t=r.__data__;return Go(e)?t[typeof e=="string"?"string":"hash"]:t.map}var ke=zc;function Jc(r){var e=ke(this,r).delete(r);return this.size-=e?1:0,e}var Vo=Jc;function Yc(r){return ke(this,r).get(r)}var qo=Yc;function Xc(r){return ke(this,r).has(r)}var Wo=Xc;function Qc(r,e){var t=ke(this,r),n=t.size;return t.set(r,e),this.size+=t.size==n?0:1,this}var $o=Qc;function gt(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}gt.prototype.clear=jo;gt.prototype.delete=Vo;gt.prototype.get=qo;gt.prototype.has=Wo;gt.prototype.set=$o;var ze=gt;var Kc="Expected a function";function wn(r,e){if(typeof r!="function"||e!=null&&typeof e!="function")throw new TypeError(Kc);var t=function(){var n=arguments,i=e?e.apply(this,n):n[0],o=t.cache;if(o.has(i))return o.get(i);var s=r.apply(this,n);return t.cache=o.set(i,s)||o,s};return t.cache=new(wn.Cache||ze),t}wn.Cache=ze;var Wt=wn;var Zc=500;function eh(r){var e=Wt(r,function(n){return t.size===Zc&&t.clear(),n}),t=e.cache;return e}var Ho=eh;var th=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,rh=/\\(\\)?/g,nh=Ho(function(r){var e=[];return r.charCodeAt(0)===46&&e.push(""),r.replace(th,function(t,n,i,o){e.push(i?o.replace(rh,"$1"):n||t)}),e}),zo=nh;function ih(r){return r==null?"":no(r)}var Jo=ih;function oh(r,e){return $(r)?r:pt(r,e)?[r]:zo(Jo(r))}var Er=oh;var sh=1/0;function ah(r){if(typeof r=="string"||de(r))return r;var e=r+"";return e=="0"&&1/r==-sh?"-0":e}var Le=ah;function fh(r,e){e=Er(e,r);for(var t=0,n=e.length;r!=null&&t<n;)r=r[Le(e[t++])];return t&&t==n?r:void 0}var wr=fh;function lh(r,e,t){var n=r==null?void 0:wr(r,e);return n===void 0?t:n}var Yo=lh;function uh(r,e){for(var t=-1,n=e.length,i=r.length;++t<n;)r[i+t]=e[t];return r}var Sr=uh;var Xo=ee?ee.isConcatSpreadable:void 0;function ch(r){return $(r)||dt(r)||!!(Xo&&r&&r[Xo])}var Qo=ch;function Ko(r,e,t,n,i){var o=-1,s=r.length;for(t||(t=Qo),i||(i=[]);++o<s;){var l=r[o];e>0&&t(l)?e>1?Ko(l,e-1,t,n,i):Sr(i,l):n||(i[i.length]=l)}return i}var Zo=Ko;var hh="Expected a function";function dh(r,e){var t;if(typeof e!="function")throw new TypeError(hh);return r=gr(r),function(){return--r>0&&(t=e.apply(this,arguments)),r<=1&&(e=void 0),t}}var es=dh;function ph(r,e,t){return r===r&&(t!==void 0&&(r=r<=t?r:t),e!==void 0&&(r=r>=e?r:e)),r}var ts=ph;function mh(r,e,t){return t===void 0&&(t=e,e=void 0),t!==void 0&&(t=Te(t),t=t===t?t:0),e!==void 0&&(e=Te(e),e=e===e?e:0),ts(Te(r),e,t)}var Sn=mh;function _h(){this.__data__=new Ae,this.size=0}var rs=_h;function gh(r){var e=this.__data__,t=e.delete(r);return this.size=e.size,t}var ns=gh;function bh(r){return this.__data__.get(r)}var is=bh;function vh(r){return this.__data__.has(r)}var os=vh;var xh=200;function yh(r,e){var t=this.__data__;if(t instanceof Ae){var n=t.__data__;if(!Re||n.length<xh-1)return n.push([r,e]),this.size=++t.size,this;t=this.__data__=new ze(n)}return t.set(r,e),this.size=t.size,this}var ss=yh;function bt(r){var e=this.__data__=new Ae(r);this.size=e.size}bt.prototype.clear=rs;bt.prototype.delete=ns;bt.prototype.get=is;bt.prototype.has=os;bt.prototype.set=ss;var vt=bt;function Th(r,e){for(var t=-1,n=r==null?0:r.length,i=0,o=[];++t<n;){var s=r[t];e(s,t,r)&&(o[i++]=s)}return o}var as=Th;function Eh(){return[]}var fs=Eh;var wh=Object.prototype,Sh=wh.propertyIsEnumerable,ls=Object.getOwnPropertySymbols,Ih=ls?function(r){return r==null?[]:(r=Object(r),as(ls(r),function(e){return Sh.call(r,e)}))}:fs,us=Ih;function Ph(r,e,t){var n=e(r);return $(r)?n:Sr(n,t(r))}var cs=Ph;function Oh(r){return cs(r,Oe,us)}var In=Oh;var Ch=oe(z,"DataView"),Ir=Ch;var Ah=oe(z,"Promise"),Pr=Ah;var Rh=oe(z,"Set"),Or=Rh;var hs="[object Map]",kh="[object Object]",ds="[object Promise]",ps="[object Set]",ms="[object WeakMap]",_s="[object DataView]",Lh=Ee(Ir),Nh=Ee(Re),Mh=Ee(Pr),Bh=Ee(Or),Fh=Ee(xr),Je=se;(Ir&&Je(new Ir(new ArrayBuffer(1)))!=_s||Re&&Je(new Re)!=hs||Pr&&Je(Pr.resolve())!=ds||Or&&Je(new Or)!=ps||xr&&Je(new xr)!=ms)&&(Je=function(r){var e=se(r),t=e==kh?r.constructor:void 0,n=t?Ee(t):"";if(n)switch(n){case Lh:return _s;case Nh:return hs;case Mh:return ds;case Bh:return ps;case Fh:return ms}return e});var Pn=Je;var Uh=z.Uint8Array,On=Uh;var Dh="__lodash_hash_undefined__";function jh(r){return this.__data__.set(r,Dh),this}var gs=jh;function Gh(r){return this.__data__.has(r)}var bs=Gh;function Cr(r){var e=-1,t=r==null?0:r.length;for(this.__data__=new ze;++e<t;)this.add(r[e])}Cr.prototype.add=Cr.prototype.push=gs;Cr.prototype.has=bs;var vs=Cr;function Vh(r,e){for(var t=-1,n=r==null?0:r.length;++t<n;)if(e(r[t],t,r))return!0;return!1}var Ar=Vh;function qh(r,e){return r.has(e)}var xs=qh;var Wh=1,$h=2;function Hh(r,e,t,n,i,o){var s=t&Wh,l=r.length,c=e.length;if(l!=c&&!(s&&c>l))return!1;var h=o.get(r),d=o.get(e);if(h&&d)return h==e&&d==r;var v=-1,x=!0,y=t&$h?new vs:void 0;for(o.set(r,e),o.set(e,r);++v<l;){var I=r[v],w=e[v];if(n)var O=s?n(w,I,v,e,r,o):n(I,w,v,r,e,o);if(O!==void 0){if(O)continue;x=!1;break}if(y){if(!Ar(e,function(C,L){if(!xs(y,L)&&(I===C||i(I,C,t,n,o)))return y.push(L)})){x=!1;break}}else if(!(I===w||i(I,w,t,n,o))){x=!1;break}}return o.delete(r),o.delete(e),x}var Rr=Hh;function zh(r){var e=-1,t=Array(r.size);return r.forEach(function(n,i){t[++e]=[i,n]}),t}var ys=zh;function Jh(r){var e=-1,t=Array(r.size);return r.forEach(function(n){t[++e]=n}),t}var Ts=Jh;var Yh=1,Xh=2,Qh="[object Boolean]",Kh="[object Date]",Zh="[object Error]",ed="[object Map]",td="[object Number]",rd="[object RegExp]",nd="[object Set]",id="[object String]",od="[object Symbol]",sd="[object ArrayBuffer]",ad="[object DataView]",Es=ee?ee.prototype:void 0,Cn=Es?Es.valueOf:void 0;function fd(r,e,t,n,i,o,s){switch(t){case ad:if(r.byteLength!=e.byteLength||r.byteOffset!=e.byteOffset)return!1;r=r.buffer,e=e.buffer;case sd:return!(r.byteLength!=e.byteLength||!o(new On(r),new On(e)));case Qh:case Kh:case td:return ct(+r,+e);case Zh:return r.name==e.name&&r.message==e.message;case rd:case id:return r==e+"";case ed:var l=ys;case nd:var c=n&Yh;if(l||(l=Ts),r.size!=e.size&&!c)return!1;var h=s.get(r);if(h)return h==e;n|=Xh,s.set(r,e);var d=Rr(l(r),l(e),n,i,o,s);return s.delete(r),d;case od:if(Cn)return Cn.call(r)==Cn.call(e)}return!1}var ws=fd;var ld=1,ud=Object.prototype,cd=ud.hasOwnProperty;function hd(r,e,t,n,i,o){var s=t&ld,l=In(r),c=l.length,h=In(e),d=h.length;if(c!=d&&!s)return!1;for(var v=c;v--;){var x=l[v];if(!(s?x in e:cd.call(e,x)))return!1}var y=o.get(r),I=o.get(e);if(y&&I)return y==e&&I==r;var w=!0;o.set(r,e),o.set(e,r);for(var O=s;++v<c;){x=l[v];var C=r[x],L=e[x];if(n)var P=s?n(L,C,x,e,r,o):n(C,L,x,r,e,o);if(!(P===void 0?C===L||i(C,L,t,n,o):P)){w=!1;break}O||(O=x=="constructor")}if(w&&!O){var U=r.constructor,q=e.constructor;U!=q&&"constructor"in r&&"constructor"in e&&!(typeof U=="function"&&U instanceof U&&typeof q=="function"&&q instanceof q)&&(w=!1)}return o.delete(r),o.delete(e),w}var Ss=hd;var dd=1,Is="[object Arguments]",Ps="[object Array]",kr="[object Object]",pd=Object.prototype,Os=pd.hasOwnProperty;function md(r,e,t,n,i,o){var s=$(r),l=$(e),c=s?Ps:Pn(r),h=l?Ps:Pn(e);c=c==Is?kr:c,h=h==Is?kr:h;var d=c==kr,v=h==kr,x=c==h;if(x&&Vt(r)){if(!Vt(e))return!1;s=!0,d=!1}if(x&&!d)return o||(o=new vt),s||Tr(r)?Rr(r,e,t,n,i,o):ws(r,e,c,t,n,i,o);if(!(t&dd)){var y=d&&Os.call(r,"__wrapped__"),I=v&&Os.call(e,"__wrapped__");if(y||I){var w=y?r.value():r,O=I?e.value():e;return o||(o=new vt),i(w,O,t,n,o)}}return x?(o||(o=new vt),Ss(r,e,t,n,i,o)):!1}var Cs=md;function As(r,e,t,n,i){return r===e?!0:r==null||e==null||!ae(r)&&!ae(e)?r!==r&&e!==e:Cs(r,e,t,n,As,i)}var Lr=As;var _d=1,gd=2;function bd(r,e,t,n){var i=t.length,o=i,s=!n;if(r==null)return!o;for(r=Object(r);i--;){var l=t[i];if(s&&l[2]?l[1]!==r[l[0]]:!(l[0]in r))return!1}for(;++i<o;){l=t[i];var c=l[0],h=r[c],d=l[1];if(s&&l[2]){if(h===void 0&&!(c in r))return!1}else{var v=new vt;if(n)var x=n(h,d,c,r,e,v);if(!(x===void 0?Lr(d,h,_d|gd,n,v):x))return!1}}return!0}var Rs=bd;function vd(r){return r===r&&!te(r)}var Nr=vd;function xd(r){for(var e=Oe(r),t=e.length;t--;){var n=e[t],i=r[n];e[t]=[n,i,Nr(i)]}return e}var ks=xd;function yd(r,e){return function(t){return t==null?!1:t[r]===e&&(e!==void 0||r in Object(t))}}var Mr=yd;function Td(r){var e=ks(r);return e.length==1&&e[0][2]?Mr(e[0][0],e[0][1]):function(t){return t===r||Rs(t,r,e)}}var Ls=Td;function Ed(r,e){return r!=null&&e in Object(r)}var Ns=Ed;function wd(r,e,t){e=Er(e,r);for(var n=-1,i=e.length,o=!1;++n<i;){var s=Le(e[n]);if(!(o=r!=null&&t(r,s)))break;r=r[s]}return o||++n!=i?o:(i=r==null?0:r.length,!!i&&ht(i)&&ut(s,i)&&($(r)||dt(r)))}var Ms=wd;function Sd(r,e){return r!=null&&Ms(r,e,Ns)}var Bs=Sd;var Id=1,Pd=2;function Od(r,e){return pt(r)&&Nr(e)?Mr(Le(r),e):function(t){var n=Yo(t,r);return n===void 0&&n===e?Bs(t,r):Lr(e,n,Id|Pd)}}var Fs=Od;function Cd(r){return function(e){return e==null?void 0:e[r]}}var Us=Cd;function Ad(r){return function(e){return wr(e,r)}}var Ds=Ad;function Rd(r){return pt(r)?Us(Le(r)):Ds(r)}var js=Rd;function kd(r){return typeof r=="function"?r:r==null?fo:typeof r=="object"?$(r)?Fs(r[0],r[1]):Ls(r):js(r)}var me=kd;function Ld(r){return function(e,t,n){for(var i=-1,o=Object(e),s=n(e),l=s.length;l--;){var c=s[r?l:++i];if(t(o[c],c,o)===!1)break}return e}}var Gs=Ld;var Nd=Gs(),Vs=Nd;function Md(r,e){return r&&Vs(r,e,Oe)}var qs=Md;function Bd(r,e){return function(t,n){if(t==null)return t;if(!pe(t))return r(t,n);for(var i=t.length,o=e?i:-1,s=Object(t);(e?o--:++o<i)&&n(s[o],o,s)!==!1;);return t}}var Ws=Bd;var Fd=Ws(qs),Br=Fd;var Ud=function(){return z.Date.now()},Fr=Ud;var Dd="Expected a function",jd=Math.max,Gd=Math.min;function Vd(r,e,t){var n,i,o,s,l,c,h=0,d=!1,v=!1,x=!0;if(typeof r!="function")throw new TypeError(Dd);e=Te(e)||0,te(t)&&(d=!!t.leading,v="maxWait"in t,o=v?jd(Te(t.maxWait)||0,e):o,x="trailing"in t?!!t.trailing:x);function y(F){var j=n,D=i;return n=i=void 0,h=F,s=r.apply(D,j),s}function I(F){return h=F,l=setTimeout(C,e),d?y(F):s}function w(F){var j=F-c,D=F-h,T=e-j;return v?Gd(T,o-D):T}function O(F){var j=F-c,D=F-h;return c===void 0||j>=e||j<0||v&&D>=o}function C(){var F=Fr();if(O(F))return L(F);l=setTimeout(C,w(F))}function L(F){return l=void 0,x&&n?y(F):(n=i=void 0,s)}function P(){l!==void 0&&clearTimeout(l),h=0,n=c=i=l=void 0}function U(){return l===void 0?s:L(Fr())}function q(){var F=Fr(),j=O(F);if(n=arguments,i=this,c=F,j){if(l===void 0)return I(c);if(v)return clearTimeout(l),l=setTimeout(C,e),y(c)}return l===void 0&&(l=setTimeout(C,e)),s}return q.cancel=P,q.flush=U,q}var $s=Vd;function qd(r){return function(e,t,n){var i=Object(e);if(!pe(e)){var o=me(t,3);e=Oe(e),t=function(l){return o(i[l],l,i)}}var s=r(e,t,n);return s>-1?i[o?e[s]:s]:void 0}}var Hs=qd;var Wd=Math.max;function $d(r,e,t){var n=r==null?0:r.length;if(!n)return-1;var i=t==null?0:gr(t);return i<0&&(i=Wd(n+i,0)),po(r,me(e,3),i)}var zs=$d;var Hd=Hs(zs),$t=Hd;function zd(r,e){var t=-1,n=pe(r)?Array(r.length):[];return Br(r,function(i,o,s){n[++t]=e(i,o,s)}),n}var Js=zd;function Jd(r,e){var t=$(r)?_r:Js;return t(r,me(e,3))}var Ys=Jd;function Yd(r,e){return Zo(Ys(r,e),1)}var An=Yd;function Xd(r,e){return r<e}var Xs=Xd;function Qd(r,e,t){for(var n=-1,i=r.length;++n<i;){var o=r[n],s=e(o);if(s!=null&&(l===void 0?s===s&&!de(s):t(s,l)))var l=s,c=o}return c}var Qs=Qd;function Kd(r,e){return r&&r.length?Qs(r,me(e,2),Xs):void 0}var Rn=Kd;function Zd(r){return es(2,r)}var kn=Zd;var ep=Math.floor,tp=Math.random;function rp(r,e){return r+ep(tp()*(e-r+1))}var Ks=rp;var np=parseFloat,ip=Math.min,op=Math.random;function sp(r,e,t){if(t&&typeof t!="boolean"&&yr(r,e,t)&&(e=t=void 0),t===void 0&&(typeof e=="boolean"?(t=e,e=void 0):typeof r=="boolean"&&(t=r,r=void 0)),r===void 0&&e===void 0?(r=0,e=1):(r=Gt(r),e===void 0?(e=r,r=0):e=Gt(e)),r>e){var n=r;r=e,e=n}if(t||r%1||e%1){var i=op();return ip(r+i*(e-r+np("1e-"+((i+"").length-1))),e)}return Ks(r,e)}var Ht=sp;function ap(r,e){var t;return Br(r,function(n,i,o){return t=e(n,i,o),!t}),!!t}var Zs=ap;function fp(r,e,t){var n=$(r)?Ar:Zs;return t&&yr(r,e,t)&&(e=void 0),n(r,me(e,3))}var Ln=fp;var lp="Expected a function";function up(r,e,t){var n=!0,i=!0;if(typeof r!="function")throw new TypeError(lp);return te(t)&&(n="leading"in t?!!t.leading:n,i="trailing"in t?!!t.trailing:i),$s(r,e,{leading:n,maxWait:e,trailing:i})}var Nn=up;var re=class{x;y;velocity;constructor(e,t,n=0,i=0){this.x=e,this.y=t,this.velocity=new k.Vector(n,i)}beforeUpdate(e){}onEntityCollide(e){}onOutOfWorld(e){}onUnderwater(){}onGroundCollide(e,t,n){return!0}onResolve(e,t){}};var Mn=new Map;function ea(r){for(let e of A.gameEntities){Mn.set(e,{x:e.x,y:e.y,velocity:e.velocity.clone()});let t=1/r;if(e.beforeUpdate(t),e.type===1){let i=new k.Vector(0,e.mass*1540);e.velocity=e.velocity.add(i.multiply(t))}e.x+=e.velocity.x*t,e.y+=e.velocity.y*t}for(let e of A.gameEntities){if(e.collideWithEntities)for(let o of A.gameEntities){if(o===e)continue;let s=new k.Box(e.x,e.y,e.x+e.width,e.y+e.height),l=new k.Box(o.x,o.y,o.x+o.width,o.y+o.height);s.intersect(l)&&e.onEntityCollide(o)}e.y<=-5e3||e.x>=5e3||e.x<=-5e3?(e.onOutOfWorld(!1),e.type===0&&A.gameEntities.delete(e)):e.y>=A.waterOffset+150&&(e.onOutOfWorld(!0),A.gameEntities.delete(e)),e.y>=A.waterOffset-e.height&&e.onUnderwater();let t=e.x,n=e.y,i=e.collideWithGround?A.terrain.intersects(new k.Box(t,n,t+e.width,n+e.height)):[];if(i.length>0){if(!e.onGroundCollide(t,n,i))continue;let s=Mn.get(e);if(e.x=s.x,e.y=s.y,e.velocity=s.velocity,e.velocity.length<e.bounceThreshold){e.velocity=new k.Vector,e.onResolve(!0,i);continue}let l=i[0],c;l.shape instanceof k.Arc?c=new k.Vector(l.points[0],l.shape.pc).normalize():c=new k.Vector(l.shape.ps,l.shape.pe).rotate90CCW().normalize();let h=c.multiply(e.velocity.dot(c)),d=e.velocity.subtract(h);e.velocity=d.multiply(e.COF).subtract(h.multiply(e.COR))}e.onResolve(!1,i)}Mn.clear()}var Ne={};ai(Ne,{BOUNDARY:()=>_e,CCW:()=>cp,CONTAINS:()=>gp,CW:()=>hp,END_VERTEX:()=>Ye,INSIDE:()=>mp,INTERLACE:()=>bp,NOT_VERTEX:()=>Ur,ORIENTATION:()=>dp,OUTSIDE:()=>_p,OVERLAP_OPPOSITE:()=>xp,OVERLAP_SAME:()=>vp,PIx2:()=>pp,START_VERTEX:()=>zt});var cp=!0,hp=!1,dp={CCW:-1,CW:1,NOT_ORIENTABLE:0},pp=2*Math.PI,mp=1,_p=0,_e=2,gp=3,bp=4,vp=1,xp=2,Ur=0,zt=1,Ye=2;var Dr={};ai(Dr,{DECIMALS:()=>yp,EQ:()=>xt,EQ_0:()=>Tp,GE:()=>wp,GT:()=>Ep,LE:()=>Ip,LT:()=>Sp,getTolerance:()=>Fn,setTolerance:()=>Bn});var ge=1e-6;function Bn(r){ge=r}function Fn(){return ge}var yp=3;function Tp(r){return r<ge&&r>-ge}function xt(r,e){return r-e<ge&&r-e>-ge}function Ep(r,e){return r-e>ge}function wp(r,e){return r-e>-ge}function Sp(r,e){return r-e<-ge}function Ip(r,e){return r-e<ge}var ta=class{static get ILLEGAL_PARAMETERS(){return new ReferenceError("Illegal Parameters")}static get ZERO_DIVISION(){return new Error("Zero division")}static get UNRESOLVED_BOUNDARY_CONFLICT(){return new Error("Unresolved boundary conflict in boolean operation")}static get INFINITE_LOOP(){return new Error("Infinite loop")}},Jt=ta;var Un={Utils:Dr,Errors:Jt,Matrix:void 0,Planar_set:void 0,Point:void 0,Vector:void 0,Line:void 0,Circle:void 0,Segment:void 0,Arc:void 0,Box:void 0,Edge:void 0,Face:void 0,Ray:void 0,Ray_shooting:void 0,Multiline:void 0,Polygon:void 0,Distance:void 0,Inversion:void 0};for(let r in Ne)Un[r]=Ne[r];Object.defineProperty(Un,"DP_TOL",{get:function(){return Fn()},set:function(r){Bn(r)}});var jr=Un;var ra=class{constructor(e,t){this.first=e,this.last=t||this.first}[Symbol.iterator](){let e;return{next:()=>(e=e?e.next:this.first,{value:e,done:e===void 0})}}get size(){let e=0;for(let t of this)e++;return e}toArray(e=void 0,t=void 0){let n=[],i=e||this.first,o=t||this.last,s=i;if(s===void 0)return n;do n.push(s),s=s.next;while(s!==o.next);return n}append(e){return this.isEmpty()?this.first=e:(e.prev=this.last,this.last.next=e),this.last=e,this.last.next=void 0,this.first.prev=void 0,this}insert(e,t){if(this.isEmpty())this.first=e,this.last=e;else if(t==null)e.next=this.first,this.first.prev=e,this.first=e;else{let n=t.next;t.next=e,n&&(n.prev=e),e.prev=t,e.next=n,this.last===t&&(this.last=e)}return this.last.next=void 0,this.first.prev=void 0,this}remove(e){return e===this.first&&e===this.last?(this.first=void 0,this.last=void 0):(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e===this.first&&(this.first=e.next),e===this.last&&(this.last=e.prev)),this}isEmpty(){return this.first===void 0}static testInfiniteLoop(e){let t=e,n=e;do{if(t!=e&&t===n)throw jr.Errors.INFINITE_LOOP;t=t.next,n=n.next.next}while(t!=e)}},na=ra;function Yt(r,e,t){let n=t.length,i=r.shape.split(e);if(i.length===0)return;let o=0;i[0]===null?o=0:i[1]===null?o=r.shape.length:o=i[0].length;let s=Ur;xt(o,0)&&(s|=zt),xt(o,r.shape.length)&&(s|=Ye);let l=s&Ye&&r.next.arc_length===0?0:r.arc_length+o;t.push({id:n,pt:e,arc_length:l,edge_before:r,edge_after:void 0,face:r.face,is_vertex:s})}function Gr(r){r.int_points1_sorted=ia(r.int_points1),r.int_points2_sorted=ia(r.int_points2)}function ia(r){let e=new Map,t=0;for(let i of r)e.has(i.face)||(e.set(i.face,t),t++);for(let i of r)i.faceId=e.get(i.face);return r.slice().sort(Pp)}function Pp(r,e){return r.faceId<e.faceId?-1:r.faceId>e.faceId?1:r.arc_length<e.arc_length?-1:r.arc_length>e.arc_length?1:0}function oa(r){if(r.int_points1.length<2)return;let e=!1,t,n,i,o;for(let s=0;s<r.int_points1_sorted.length;s++)if(r.int_points1_sorted[s].id!==-1){t=r.int_points1_sorted[s],n=r.int_points2[t.id];for(let l=s+1;l<r.int_points1_sorted.length&&(i=r.int_points1_sorted[l],!!xt(i.arc_length,t.arc_length));l++)i.id!==-1&&(o=r.int_points2[i.id],o.id!==-1&&i.edge_before===t.edge_before&&i.edge_after===t.edge_after&&o.edge_before===n.edge_before&&o.edge_after===n.edge_after&&(i.id=-1,o.id=-1,e=!0))}n=r.int_points2_sorted[0],t=r.int_points1[n.id];for(let s=1;s<r.int_points2_sorted.length;s++){let l=r.int_points2_sorted[s];if(l.id==-1)continue;if(n.id==-1||!xt(l.arc_length,n.arc_length)){n=l,t=r.int_points1[n.id];continue}let c=r.int_points1[l.id];c.edge_before===t.edge_before&&c.edge_after===t.edge_after&&l.edge_before===n.edge_before&&l.edge_after===n.edge_after&&(c.id=-1,l.id=-1,e=!0)}e&&(r.int_points1=r.int_points1.filter(s=>s.id>=0),r.int_points2=r.int_points2.filter(s=>s.id>=0),r.int_points1.forEach((s,l)=>s.id=l),r.int_points2.forEach((s,l)=>s.id=l))}function Dn(r){for(let e of r)e.edge_before.bvStart=void 0,e.edge_before.bvEnd=void 0,e.edge_before.bv=void 0,e.edge_before.overlap=void 0,e.edge_after.bvStart=void 0,e.edge_after.bvEnd=void 0,e.edge_after.bv=void 0,e.edge_after.overlap=void 0;for(let e of r)e.edge_before.bvEnd=_e,e.edge_after.bvStart=_e}function jn(r,e){for(let t of r)t.edge_before.setInclusion(e),t.edge_after.setInclusion(e)}function sa(r){let e,t,n,i=r.int_points1.length;for(let o=0;o<i;o++){let s=r.int_points1_sorted[o];s.face!==e&&(t=o,e=s.face);let l=o,c=Xe(r.int_points1_sorted,o,e),h;l+c<i&&r.int_points1_sorted[l+c].face===e?h=l+c:h=t;let d=Xe(r.int_points1_sorted,h,e);n=null;for(let C=h;C<h+d;C++){let L=r.int_points1_sorted[C];if(L.face===e&&r.int_points2[L.id].face===r.int_points2[s.id].face){n=L;break}}if(n===null)continue;let v=s.edge_after,x=n.edge_before;if(!(v.bv===_e&&x.bv===_e)||v!==x)continue;let y=r.int_points2[s.id],I=r.int_points2[n.id],w=y.edge_after,O=I.edge_before;w.bv===_e&&O.bv===_e&&w===O||(y=r.int_points2[n.id],I=r.int_points2[s.id],w=y.edge_after,O=I.edge_before),w.bv===_e&&O.bv===_e&&w===O&&v.setOverlap(w)}}function Xe(r,e,t){let n,i,o=1;if(r.length==1)return 1;n=r[e];for(let s=e+1;s<r.length&&!(n.face!=t||(i=r[s],!(i.pt.equalTo(n.pt)&&i.edge_before===n.edge_before&&i.edge_after===n.edge_after)));s++)o++;return o}function Gn(r,e){if(!!e){for(let t of e){let n=t.edge_before;if(t.is_vertex=Ur,n.shape.start&&n.shape.start.equalTo(t.pt)&&(t.is_vertex|=zt),n.shape.end&&n.shape.end.equalTo(t.pt)&&(t.is_vertex|=Ye),t.is_vertex&zt){t.edge_before=n.prev,t.is_vertex=Ye;continue}if(t.is_vertex&Ye)continue;let i=r.addVertex(t.pt,n);t.edge_before=i}for(let t of e)t.edge_after=t.edge_before.next}}var{INSIDE:be,OUTSIDE:ve,BOUNDARY:Y,OVERLAP_SAME:Op,OVERLAP_OPPOSITE:Cp}=Ne,{NOT_VERTEX:LT,START_VERTEX:aa,END_VERTEX:fa}=Ne,Vn=1,ma=2,Xt=3;function _a(r,e){let[t,n]=ba(r,e,Vn,!0);return t}function ga(r,e){let n=e.clone().reverse(),[i,o]=ba(r,n,Xt,!0);return i}function Ap(r,e,t,n){let i=la(r,t.int_points1),o=la(e,t.int_points2);for(ua(i,e),ua(o,r),Dn(t.int_points1),Dn(t.int_points2),jn(t.int_points1,e),jn(t.int_points2,r);Lp(r,e,t.int_points1,t.int_points1_sorted,t.int_points2,t););sa(t),ca(r,n,t.int_points1_sorted,!0),ca(e,n,t.int_points2_sorted,!1),pa(r,i,n,!0),pa(e,o,n,!1)}function Rp(r,e,t,n){Np(r,e,n,t.int_points2),Mp(r,e,t),ha(r,t.int_points1),ha(e,t.int_points2),da(r,t.int_points1,t.int_points2),da(r,t.int_points2,t.int_points1)}function ba(r,e,t,n){let i=r,o=e.clone(),s=kp(i,o);return Gr(s),Gn(i,s.int_points1_sorted),Gn(o,s.int_points2_sorted),oa(s),Gr(s),Ap(i,o,s,t),n&&Rp(i,o,s,t),[i,o]}function kp(r,e){let t={int_points1:[],int_points2:[]};for(let n of e.edges){let i=r.edges.search(n.box);for(let o of i){let s=n.shape.intersect(o.shape);for(let l of s)Yt(n,l,t.int_points2),Yt(o,l,t.int_points1)}}return t}function la(r,e){let t=[];for(let n of r.faces)e.find(i=>i.face===n)||t.push(n);return t}function ua(r,e){for(let t of r)t.first.bv=t.first.bvStart=t.first.bvEnd=void 0,t.first.setInclusion(e)}function Lp(r,e,t,n,i,o){let s,l,c,h=n.length,d=!1;for(let v=0;v<h;v++){let x=n[v];x.face!==s&&(l=v,s=x.face);let y=v,I=Xe(n,v,s),w;y+I<h&&n[y+I].face===s?w=y+I:w=l;let O=Xe(n,w,s);c=null;for(let P=w;P<w+O;P++){let U=n[P];if(U.face===s&&i[U.id].face===i[x.id].face){c=U;break}}if(c===null)continue;let C=x.edge_after,L=c.edge_before;if(C.bv===Y&&L.bv!=Y){C.bv=L.bv;continue}if(C.bv!=Y&&L.bv===Y){L.bv=C.bv;continue}if(C.bv===Y&&L.bv===Y&&C!=L||C.bv===be&&L.bv===ve||C.bv===ve&&L.bv===be){let P=C.next;for(;P!=L;)P.bvStart=void 0,P.bvEnd=void 0,P.bv=void 0,P.setInclusion(e),P=P.next}if(C.bv===Y&&L.bv===Y&&C!=L){let P=C.next,U;for(;P!=L;){if(P.bv!=Y){if(U===void 0)U=P.bv;else if(P.bv!=U)throw Jt.UNRESOLVED_BOUNDARY_CONFLICT}P=P.next}U!=null&&(C.bv=U,L.bv=U);continue}if(C.bv===be&&L.bv===ve||C.bv===ve&&L.bv===be){let P=C;for(;P!=L;){if(P.bvStart===C.bv&&P.bvEnd===L.bv){let[U,q]=P.shape.distanceTo(e);if(U<10*jr.DP_TOL){Yt(P,q.ps,t);let F=t[t.length-1];if(F.is_vertex&aa)F.edge_after=P,F.edge_before=P.prev,P.bvStart=Y,P.bv=void 0,P.setInclusion(e);else if(F.is_vertex&fa)F.edge_after=P.next,P.bvEnd=Y,P.bv=void 0,P.setInclusion(e);else{let T=e.addVertex(F.pt,P);F.edge_before=T,F.edge_after=T.next,T.setInclusion(e),T.next.bvStart=Y,T.next.bvEnd=void 0,T.next.bv=void 0,T.next.setInclusion(e)}let j=e.findEdgeByPoint(q.pe);Yt(j,q.pe,i);let D=i[i.length-1];if(D.is_vertex&aa)D.edge_after=j,D.edge_before=j.prev;else if(D.is_vertex&fa)D.edge_after=j.next;else{let T=i.find(b=>b.edge_after===j),g=e.addVertex(D.pt,j);D.edge_before=g,D.edge_after=g.next,T&&(T.edge_after=g),g.bvStart=void 0,g.bvEnd=Y,g.bv=void 0,g.setInclusion(r),g.next.bvStart=Y,g.next.bvEnd=void 0,g.next.bv=void 0,g.next.setInclusion(r)}Gr(o),d=!0;break}}P=P.next}if(d)break;throw Jt.UNRESOLVED_BOUNDARY_CONFLICT}}return d}function ca(r,e,t,n){if(!t)return;let i,o,s,l;for(let c=0;c<t.length;c++){if(s=t[c],s.face!==i&&(o=c,i=s.face),i.isEmpty())continue;let h=c,d=Xe(t,c,i),v;h+d<t.length&&t[h+d].face===s.face?v=h+d:v=o,l=t[v];let x=v,y=Xe(t,x,i),I=s.edge_after,w=l.edge_before;if(I.bv===be&&w.bv===be&&e===Vn||I.bv===ve&&w.bv===ve&&e===ma||(I.bv===ve||w.bv===ve)&&e===Xt&&!n||(I.bv===be||w.bv===be)&&e===Xt&&n||I.bv===Y&&w.bv===Y&&I.overlap&Op&&n||I.bv===Y&&w.bv===Y&&I.overlap&Cp){r.removeChain(i,I,w);for(let O=h;O<h+d;O++)t[O].edge_after=void 0;for(let O=x;O<x+y;O++)t[O].edge_before=void 0}c+=d-1}}function Np(r,e,t,n){for(let i of e.faces){for(let o of i)r.edges.add(o);n.find(o=>o.face===i)===void 0&&r.addFace(i.first,i.last)}}function Mp(r,e,t){if(t.int_points1.length!==0)for(let n=0;n<t.int_points1.length;n++){let i=t.int_points1[n],o=t.int_points2[n];if(i.edge_before!==void 0&&i.edge_after===void 0&&o.edge_before===void 0&&o.edge_after!==void 0&&(i.edge_before.next=o.edge_after,o.edge_after.prev=i.edge_before,i.edge_after=o.edge_after,o.edge_before=i.edge_before),o.edge_before!==void 0&&o.edge_after===void 0&&i.edge_before===void 0&&i.edge_after!==void 0&&(o.edge_before.next=i.edge_after,i.edge_after.prev=o.edge_before,o.edge_after=i.edge_after,i.edge_before=o.edge_before),i.edge_before!==void 0&&i.edge_after===void 0)for(let s of t.int_points1_sorted)s!==i&&s.edge_before===void 0&&s.edge_after!==void 0&&s.pt.equalTo(i.pt)&&(i.edge_before.next=s.edge_after,s.edge_after.prev=i.edge_before,i.edge_after=s.edge_after,s.edge_before=i.edge_before);if(o.edge_before!==void 0&&o.edge_after===void 0)for(let s of t.int_points2_sorted)s!==o&&s.edge_before===void 0&&s.edge_after!==void 0&&s.pt.equalTo(o.pt)&&(o.edge_before.next=s.edge_after,s.edge_after.prev=o.edge_before,o.edge_after=s.edge_after,s.edge_before=o.edge_before)}}function ha(r,e){for(let t of e)r.faces.delete(t.face),t.face=void 0,t.edge_before&&(t.edge_before.face=void 0),t.edge_after&&(t.edge_after.face=void 0)}function da(r,e,t){for(let n of e){if(n.edge_before===void 0||n.edge_after===void 0||n.face||n.edge_after.face||n.edge_before.face)continue;let i=n.edge_after,o=n.edge_before;na.testInfiniteLoop(i);let s=r.addFace(i,o);for(let l of e)l.edge_before&&l.edge_after&&l.edge_before.face===s&&l.edge_after.face===s&&(l.face=s);for(let l of t)l.edge_before&&l.edge_after&&l.edge_before.face===s&&l.edge_after.face===s&&(l.face=s)}}function pa(r,e,t,n){for(let i of e){let o=i.first.bv;(t===Vn&&o===be||t===Xt&&o===be&&n||t===Xt&&o===ve&&!n||t===ma&&o===ve)&&r.deleteFace(i)}}var qn=class{multipolygon=new k.Polygon;constructor(e){let t=Wt(this.intersects,n=>{let{cache:i}=t;return i.size===3e4&&i.clear?.(),`${n.xmin}_${n.xmax}_${n.ymin}_${n.ymax}`});this.intersects=t;for(let n of e)this.multipolygon.addFace(n.map(i=>new k.Point(i.x,i.y)))}makeHole(e,t,n){ga(this.multipolygon,new k.Polygon(new k.Circle(new k.Point(e,t),n))),this.intersects.cache.clear()}draw(e,t,n){_a(this.multipolygon,new k.Polygon(new k.Circle(new k.Point(e,t),n))),this.intersects.cache.clear()}intersects(e){let t=new Array;for(let{shape:n}of this.multipolygon.edges.search(e)){let i=n.intersect(e);i.length>0&&t.push({shape:n,points:i})}return t}intersectsShapeSome(e){for(let t of this.multipolygon.edges.search(e.box))if(t.shape.intersect(e).length>0)return!0;return!1}intersectsSeg(e){for(let{shape:t}of this.multipolygon.edges.search(e.box))if(t.intersect(e).length>0)return!0;return!1}intersectsSeg2(e){let t=new Array;for(let{shape:n}of this.multipolygon.edges.search(e.box)){let i=n.intersect(e);i.length>0&&t.push(...i)}return t}};function va(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n,i,o=t.call(r),s=[];try{for(;(e===void 0||e-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(l){i={error:l}}finally{try{n&&!n.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return s}var yt;(function(r){r[r.NotStarted=0]="NotStarted",r[r.Running=1]="Running",r[r.Stopped=2]="Stopped"})(yt||(yt={}));var wa={type:"xstate.init"};function Wn(r){return r===void 0?[]:[].concat(r)}function xa(r,e){return typeof(r=typeof r=="string"&&e&&e[r]?e[r]:r)=="string"?{type:r}:typeof r=="function"?{type:r.name,exec:r}:r}function Vr(r){return function(e){return r===e}}function Sa(r){return typeof r=="string"?{type:r}:r}function ya(r,e){return{value:r,context:e,actions:[],changed:!1,matches:Vr(r)}}function Ta(r,e,t){var n=e,i=!1;return[r.filter(function(o){if(o.type==="xstate.assign"){i=!0;var s=Object.assign({},n);return typeof o.assignment=="function"?s=o.assignment(n,t):Object.keys(o.assignment).forEach(function(l){s[l]=typeof o.assignment[l]=="function"?o.assignment[l](n,t):o.assignment[l]}),n=s,!1}return!0}),n,i]}function Ia(r,e){e===void 0&&(e={});var t=va(Ta(Wn(r.states[r.initial].entry).map(function(s){return xa(s,e.actions)}),r.context,wa),2),n=t[0],i=t[1],o={config:r,_options:e,initialState:{value:r.initial,actions:n,context:i,matches:Vr(r.initial)},transition:function(s,l){var c,h,d=typeof s=="string"?{value:s,context:r.context}:s,v=d.value,x=d.context,y=Sa(l),I=r.states[v];if(I.on){var w=Wn(I.on[y.type]);try{for(var O=function(_){var S=typeof Symbol=="function"&&Symbol.iterator,R=S&&_[S],B=0;if(R)return R.call(_);if(_&&typeof _.length=="number")return{next:function(){return _&&B>=_.length&&(_=void 0),{value:_&&_[B++],done:!_}}};throw new TypeError(S?"Object is not iterable.":"Symbol.iterator is not defined.")}(w),C=O.next();!C.done;C=O.next()){var L=C.value;if(L===void 0)return ya(v,x);var P=typeof L=="string"?{target:L}:L,U=P.target,q=P.actions,F=q===void 0?[]:q,j=P.cond,D=j===void 0?function(){return!0}:j,T=U===void 0,g=U??v,b=r.states[g];if(D(x,y)){var E=va(Ta((T?Wn(F):[].concat(I.exit,F,b.entry).filter(function(_){return _})).map(function(_){return xa(_,o._options.actions)}),x,y),3),m=E[0],f=E[1],u=E[2],p=U??v;return{value:p,context:f,actions:m,changed:U!==v||m.length>0||u,matches:Vr(p)}}}}catch(_){c={error:_}}finally{try{C&&!C.done&&(h=O.return)&&h.call(O)}finally{if(c)throw c.error}}}return ya(v,x)}};return o}var Ea=function(r,e){return r.actions.forEach(function(t){var n=t.exec;return n&&n(r.context,e)})};function Pa(r){var e=r.initialState,t=yt.NotStarted,n=new Set,i={_machine:r,send:function(o){t===yt.Running&&(e=r.transition(e,o),Ea(e,Sa(o)),n.forEach(function(s){return s(e)}))},subscribe:function(o){return n.add(o),o(e),{unsubscribe:function(){return n.delete(o)}}},start:function(o){if(o){var s=typeof o=="object"?o:{context:r.config.context,value:o};e={value:s.value,actions:[],context:s.context,matches:Vr(s.value)}}else e=r.initialState;return t=yt.Running,Ea(e,wa),i},stop:function(){return t=yt.Stopped,n.clear(),i},get state(){return e},get status(){return t}};return i}var Z=class{};Ie(Z,"weaponBox",{spriteName:"weaponBox",frameCount:16}),Ie(Z,"rabbitBreath",{spriteName:"rabbitBreath",frameCount:60}),Ie(Z,"bubbles",{spriteName:"bubbles",frameCount:68}),Ie(Z,"rabbitGo",{spriteName:"rabbitGo",frameCount:24}),Ie(Z,"rabbitPrepareToJump",{spriteName:"rabbitPrepareToJump",frameCount:9}),Ie(Z,"rabbitJumpBack",{spriteName:"rabbitJumpBack",frameCount:30}),Ie(Z,"rabbitJump",{spriteName:"rabbitJump",frameCount:9});var xe=class{anim;startTime;constructor(e){this.anim=e,this.startTime=performance.now()}},Oa=1e3/24;var $n=class{collider;looksToLeft;name;health;team;animState=new xe(Z.rabbitBreath);startJumpAnim;handTool="bazooka";angle=90;aim="none";moves="none";stateMachine;characterService;get statNew(){return this.characterService.state.value}constructor(e,t,n){this.collider=e,this.looksToLeft=!1,this.name=t,this.health=530,this.team=n;let i={target:"moves",actions:(y,I)=>{this.animState=new xe(Z.rabbitGo)}},o={target:"falls",actions:()=>{this.startJumpAnim==="FORWARD"?this.animState=new xe(Z.rabbitJump):this.animState=new xe(Z.rabbitJumpBack)}},s={target:"onRope",actions:()=>{this.animState=new xe(Z.rabbitBreath)}},l={target:"idle",actions:()=>{this.animState=new xe(Z.rabbitBreath)}},c={target:"damage",actions:()=>{this.animState=new xe(Z.rabbitBreath)}},h={target:"preparationForJump",actions:(y,I)=>{this.animState=new xe(Z.rabbitPrepareToJump);let w=this.animState.anim.frameCount*Oa,C=Math.ceil(w/(1e3/Me))+globalThis.tickCounter,L=Hn.on("tick",P=>{if(this.statNew!=="preparationForJump"&&(console.log("unbind"),L()),P===C){if(L(),this.collider.testGavnina)return;this.characterService.send("STOP_JUMP"),this.jump()}})}},d={target:"moves",actions:(y,I)=>{this.jump()}},v=Ia({id:"character",initial:"idle",states:{idle:{on:{START_MOVING:i,START_JUMP:h,TELEPORT:o,GRAB_ONTO_HOOK:s,DAMAGE:c}},moves:{on:{STOP_MOVING:l,START_JUMP:h,GRAB_ONTO_HOOK:s,DAMAGE:c,TELEPORT:o}},preparationForJump:{on:{TELEPORT:o,GRAB_ONTO_HOOK:s,DAMAGE:c,STOP_JUMP:l}},falls:{on:{GROUND:l,GRAB_ONTO_HOOK:s,DAMAGE:c}},onRope:{on:{DEATTACH_ROPE:o}},damage:{on:{GROUND:l}}}});this.stateMachine=v;let x=Pa(this.stateMachine);x.subscribe(y=>{y.changed!==!1&&console.log(y)}),x.start(),this.characterService=x,globalThis.test3=x,globalThis.test4=this.stateMachine}get isGrounded(){return this.collider.velocity.x===0&&this.collider.velocity.y===0}jump(){console.log("jump"),this.startJumpAnim==="FORWARD"?this.collider.velocity=new k.Vector(this.looksToLeft?-265:265,-420):this.collider.velocity=new k.Vector(this.looksToLeft?60:-60,-575)}};var zn=450,Jn=10,Be=class extends re{type=0;width=10;height=10;COF=1;COR=1;bounceThreshold=9e3;collideWithEntities=!1;collideWithGround=!1;mass=1;pinPoint=null;initialPosition;charCol;center(){return new k.Point(this.x+this.width/2,this.y+this.height/2)}constructor(e,t){let n=A.currentControlledChar.collider,i=n.center();super(i.x-5,i.y-5,e,t);this.charCol=n,A.hookShot=this;let o=this.velocity.normalize().multiply(zn),s=A.terrain.multipolygon.intersect(new k.Segment(i,new k.Point(i.x+o.x,i.y+o.y)));s.length>0&&(this.pinPoint=Rn(s,l=>l.distanceTo(i)[0]),this.initialPosition=i)}beforeUpdate(e){let t=this.charCol,n=this.center();if(t.testGavnina===!1){let i=t.center(),[o]=i.distanceTo(n);if(o>zn){A.gameEntities.delete(this),Tt("idle");return}if(this.pinPoint===null)return;let s=1/e,l=this.velocity.length/s,c=this.velocity.normalize().multiply(l),h=new k.Point(n.x+c.x,n.y+c.y),[d]=this.initialPosition.distanceTo(h),[v]=this.initialPosition.distanceTo(this.pinPoint);if(d>=v){this.velocity=new k.Vector,this.x=this.pinPoint.x-this.width/2,this.y=this.pinPoint.y-this.height/2,this.pinPoint=null;let x=this.center(),y=t.center(),I=new k.Vector(y,x);if(A.terrain.intersectsSeg2(new k.Segment(y,new k.Point(y.x+I.x,y.y+I.y))).filter(O=>O.equalTo(x)===!1).length>0){A.gameEntities.delete(this),Tt("idle");return}t.initialPointX=x.x,t.initialPointY=x.y,globalThis.point_i=0,A.hookSegments.length=0;for(let O=1;O<zn/Jn;O++){let C=new Qe(0,0);C.i=O,C.updateToMatchChar(!0),A.gameEntities.add(C),A.hookSegments.push(C)}t.testGavnina=!0}}}onOutOfWorld(e){let t=this.charCol;t.testGavnina=!1}};var sE=Nn((...r)=>{console.log(...r)},75),Yn=!1,Qe=class extends re{type=0;width=6;height=6;COF=1;COR=1;bounceThreshold=1/0;collideWithEntities=!1;mass=1;get collideWithGround(){return!1}i;active=!0;checkpoint=!1;halfWidth=this.width/2;halfHeight=this.height/2;arr;updateToMatchChar(e){let t=A.hookShot.charCol,n=t.pointX,i=t.pointY;e&&(n=t.initialPointX,i=t.initialPointY);let o=t.center(),s=(this.i-globalThis.point_i)*10,l=new k.Vector(new k.Point(n,i),o).normalize().multiply(s);this.x=n+l.x-this.halfWidth,this.y=i+l.y-this.halfHeight}beforeUpdate(e){let t=A.hookShot.charCol;Yn=!1,t.testGavnina===!1,this.active&&this.updateToMatchChar(!1)}onResolve(e){let t=A.hookShot.charCol;if(this.active&&Yn===!1&&this.isVisible()){let o=new k.Point(this.x+this.halfWidth,this.y+this.halfHeight),s=new k.Point(t.pointX??t.initialPointX,t.pointY??t.initialPointY),l=new k.Vector(o,s),c=Jn,h=l.normalize().multiply(c/2),d=h.rotate(Math.PI);A.terrain.intersectsSeg(new k.Segment(new k.Point(o.x+h.x,o.y+h.y),new k.Point(o.x+d.x,o.y+d.y)))&&this.handleCollision()}let n=A.hookSegments;if(this!==n[0])return;let i=new Array;for(let o of n)o.checkpoint&&i.push(o);i.reverse(),i=i.slice(0,1);for(let o of i){let[s,l,c,h,d,v]=o.arr,x=new k.Vector(new k.Point(l,c),new k.Point(t.x+t.width/2,t.y+t.height/2)).cross(h);if(v==="RIGHT"&&x<0||v==="LEFT"&&x>0){if(d===0)for(let y of n)y.active=!0;else for(let y of n)y.i>d&&(y.active=!0);t.pointX=l,t.pointY=c,globalThis.point_i=d,s.checkpoint=!1;break}}}isVisible(){let e=A.hookShot.charCol,t=new k.Point(e.pointX??e.initialPointX,e.pointY??e.initialPointY),[n]=t.distanceTo(new k.Point(e.x+e.width/2,e.y+e.height/2)),[i]=t.distanceTo(new k.Point(this.x+this.halfWidth,this.y+this.halfHeight));return i<n}handleCollision(){let e=A.hookShot.charCol;e.x=e.prevState.x,e.y=e.prevState.y,e.velocity=e.prevState.velocity,e.aVelocity=e.prevState.aVelocity;for(let t of A.hookSegments)t.active&&t.updateToMatchChar(!1);Yn=!0,this.checkpoint=!0,this.arr=[this,e.pointX,e.pointY,new k.Vector(new k.Point(e.pointX,e.pointY),new k.Point(e.x+e.width/2,e.y+e.height/2)),globalThis.point_i,e.aVelocity<0?"LEFT":e.aVelocity===0?"STOP":"RIGHT"];for(let t=0;t<this.i-1+1;t++)A.hookSegments[t].active=!1;return e.pointX=this.x+this.halfWidth,e.pointY=this.y+this.halfHeight,globalThis.point_i=this.i,!1}};var wt=class extends re{type=1;width=15;height=25;COF=.3;COR=.5;bounceThreshold=75;collideWithEntities=!1;collideWithGround=!0;mass=1;angle=0;boom=kn(()=>{setTimeout(()=>{Fe(this.x,this.y,75),A.gameEntities.delete(this),ne("grenadeExplosion");let e=new k.Circle(new k.Point(this.x,this.y),90);for(let t of A.gameEntities)if(!(t instanceof Qe||t instanceof Be)){for(let n of new k.Box(t.x,t.y,t.x+t.width,t.y+t.height).toPoints())if(e.contains(n)){let i=new k.Vector(0,-1e3);t.velocity=t.velocity.add(i);break}}},1e3)});beforeUpdate(e){let t=i(this.velocity.slope),n=40;this.angle+=this.velocity.length/n*(t>270||t<90?1:-1)*e,this.angle%=Math.PI*2;function i(o){var s=Math.PI;return o*(180/s)}}onResolve(e,t){t.length>0&&!e&&ne("grenadeBounce"),e&&this.boom()}onOutOfWorld(e){e&&ne("waterSplash1")}};var St=class extends re{type=1;width=20;height=20;COF=1;COR=1;bounceThreshold=1e3;collideWithEntities=!0;collideWithGround=!0;mass=1;beforeUpdate(e){let t=new k.Vector(-1e3,0);this.velocity=this.velocity.add(t.multiply(e))}onOutOfWorld(e){e&&ne("waterSplash1")}onGroundCollide(e,t){return this.boom(),!1}boom(){Fe(this.x,this.y,75),A.gameEntities.delete(this),ne("rocketExplosion")}};var It=class extends re{type=0;width=10;height=10;COF=1;COR=1;bounceThreshold=1e3;collideWithEntities=!0;collideWithGround=!0;mass=1;beforeUpdate(e){}onOutOfWorld(e){e&&ne("waterSplash1")}onGroundCollide(e,t){return this.boom(),!1}boom(){Fe(this.x,this.y,30),A.gameEntities.delete(this),ne("grenadeExplosion")}};var qr=class extends re{type=1;width=13;height=60;COF=.7;COR=.15;bounceThreshold=1100;collideWithEntities=!1;collideWithGround=!0;mass=1;_testGavnina=!1;pointX;pointY;initialPointX;initialPointY;aVelocity=0;pull="none";prevState;center(){return new k.Point(this.x+this.width/2,this.y+this.height/2)}set testGavnina(e){if(this._testGavnina=e,e){Tt("rope"),$t([...A.characters],s=>s.collider===this).characterService.send("GRAB_ONTO_HOOK"),this.type=0,this.bounceThreshold=1/0;let n=A.hookShot;this.pointX=n.x+n.width/2,this.pointY=n.y+n.height/2;let i=new k.Vector(new k.Point(this.x+this.width/2,this.y+this.height/2),new k.Point(this.pointX,this.pointY)),o=i.slope;this.aVelocity=(o>=1.5*Math.PI||o<=.5*Math.PI?this.velocity.length:-this.velocity.length)/2,this.aVelocity=i.cross(this.velocity)/300,this.aVelocity=i.normalize().cross(this.velocity)*.66,this.velocity=new k.Vector}else{this.type=1,this.bounceThreshold=1100,A.gameEntities.delete(A.hookShot);for(let n of A.hookSegments)A.gameEntities.delete(n);Tt("idle");let t=$t([...A.characters],n=>n.collider===this);t.startJumpAnim="FORWARD",t.characterService.send("DEATTACH_ROPE")}}get testGavnina(){return this._testGavnina}beforeUpdate(e){if(this.prevState={x:this.x,y:this.y,velocity:this.velocity,aVelocity:this.aVelocity},this.testGavnina===!1)return;let t=this.center(),n=new k.Point(this.pointX,this.pointY),i=new k.Vector(t,n),o=4,s=.997,l=new k.Vector(0,1).cross(i)/i.length;this.aVelocity+=-1*o*l,this.aVelocity*=s;let c=i.normalize().multiply(this.aVelocity),h=c.rotate90CCW(),d=new k.Vector(0,0);if(this.pull==="W")d=i.normalize().multiply(200);else if(this.pull==="S"){let v=A.hookSegments.at(-1),[x]=n.distanceTo(t),[y]=n.distanceTo(new k.Point(v.x+v.halfWidth,v.y+v.halfHeight));y<x||(d=i.normalize().multiply(-200))}this.velocity=h.add(c.multiply(e).add(d))}onGroundCollide(e,t,n){return this.testGavnina&&(this.aVelocity*=-1),!0}onResolve(e,t){let n=$t([...A.characters],o=>o.collider===this),i=n.collider;if(e===!1&&t.length>0){n.startJumpAnim="FORWARD";return}if(e&&Ln(An(t,o=>o.points),o=>o.y>=i.y+this.height*.75)&&n.characterService.send("GROUND"),n.moves!=="none"&&n.isGrounded&&(n.looksToLeft=n.moves==="left",n.characterService.send("START_MOVING")),i.velocity.length>90){n.startJumpAnim="FORWARD",n.characterService.send("TELEPORT");return}n.statNew==="moves"&&Ca(i,150*(n.looksToLeft?-1:1))}onUnderwater(){this.testGavnina===!0&&(this.testGavnina=!1),this.velocity=new k.Vector,this.x=Ht(300,3100),this.y=-300}};var Me=144,Aa=0,Xn=0,Hn=Yi();function Ra(r){let e=0;for(let l of r)for(let c of l)c.y>e&&(e=c.y);_i({terrain:new qn(r),waterOffset:e-150,gameEntities:new Set,characters:new Set,weaponBoxes:new Set,holes:[],terrainOffsetX:0,terrainOffsetY:0,hookSegments:[]}),setInterval(function(){if(A.weaponBoxes.size===25)return;let c=new La(Ht(300,2900),-300);A.gameEntities.add(c.collider),A.weaponBoxes.add(c)},3e3);function t(){let l=performance.now();l-Aa>1e3&&(globalThis.freq2=Xn,Xn=0,Aa=l),Xn++,Bp()}let n=1e3/Me,i=performance.now(),o=0;setInterval(s,2);function s(){let l=performance.now(),c=l-i;for(i=l,o+=c;o>=n;)t(),o-=n}}var ka=class extends re{type=1;width=30;height=30;COF=.7;COR=.15;bounceThreshold=100;collideWithEntities=!0;collideWithGround=!0;mass=1;onOutOfWorld(){}onEntityCollide(e){e instanceof qr&&(A.gameEntities.delete(this),[...A.weaponBoxes].forEach(t=>{t.collider===this&&A.weaponBoxes.delete(t)}))}},La=class{collider;creationTime;constructor(e,t){this.collider=new ka(e,t),this.creationTime=performance.now()}};globalThis.tickCounter=0;globalThis.stopGameLoop=!1;globalThis.restore=!1;async function Bp(){if(globalThis.stopGameLoop)return;let r=A.currentControlledChar;if(r!==void 0&&r.aim!=="none"){let e=1/Me;r.aim==="up"?r.angle+=130*e:r.angle-=130*e,r.angle=Sn(r.angle,0,180)}ea(Me*(globalThis.bulletTime?7:1)),globalThis.tickCounter++,Hn.emit("tick",globalThis.tickCounter),globalThis.callback2!==void 0&&await globalThis.callback2()}function Na(r){let e=A.currentControlledChar,t=1500;r<1e3&&(t=75*Math.ceil(r/50));let n=e.handTool;n==="rifle"?t=1500:n==="hook"&&(t=1400);let i=e.angle,o=(e.looksToLeft?i+90:450-i)*Math.PI/180,s=t*Math.cos(o),l=t*Math.sin(o);switch(n){case"gren":A.gameEntities.add(new wt(e.collider.x,e.collider.y,s,l)),ne("grenadeAttack");break;case"bazooka":A.gameEntities.add(new St(e.collider.x,e.collider.y,s,l)),ne("rocketAttack");break;case"rifle":ne("grenadeAttack"),A.gameEntities.add(new It(e.collider.x,e.collider.y,s,l));break;case"hook":A.gameEntities.add(new Be(s,l)),ne("grenadeAttack");break}}function Ca(r,e){let n=e/Me,i=0,o=r.x+n;for(let s=.9375;s<=.9375*8;s+=.9375){let l=r.y+s;if(A.terrain.intersectsShapeSome(new k.Box(o,l,o+r.width,l+r.height))){i=s-.9375;break}}if(i>0){r.y+=i,r.x+=n;return}for(let s=0;s<=.9375*7;s+=.9375){let l=r.y-s;if(A.terrain.intersectsShapeSome(new k.Box(o,l,o+r.width,l+r.height))===!1){r.y-=s,r.x+=n;return}}}function Fe(r,e,t){A.holes.push({cx:r,cy:e,r:t}),A.terrain.makeHole(r,e,t)}function Qn(r,e,t,n){let i=new qr(r,e),o=new $n(i,t??"\u041A\u043E\u043B\u044F",n);return A.gameEntities.add(i),A.characters.add(o),o}var Wr=class extends Error{constructor(e){super(e!=null?`Timed out after waiting for ${e} ms`:"Timed out"),Object.setPrototypeOf(this,Wr.prototype)}},Ma=(r,e)=>new Promise((t,n)=>{try{r.schedule(t,e)}catch(i){n(i)}}),Ba={schedule:(r,e)=>{let t,n=i=>{i!=null&&clearTimeout(i),t=void 0};return t=setTimeout(()=>{n(t),r()},e),{cancel:()=>n(t)}}};var Fp=Number.POSITIVE_INFINITY,Fa=(r,e,t)=>{var n,i;let o=(n=typeof e=="number"?e:e==null?void 0:e.timeout)!==null&&n!==void 0?n:5e3,s=(i=typeof e=="number"?t:e==null?void 0:e.intervalBetweenAttempts)!==null&&i!==void 0?i:50,l=!1,c=()=>new Promise((d,v)=>{let x=()=>{l||new Promise((y,I)=>{try{y(r())}catch(w){I(w)}}).then(y=>{y?d(y):Ma(Ba,s).then(x).catch(v)}).catch(v)};x()}),h=o!==Fp?()=>Ma(Ba,o).then(()=>{throw l=!0,new Wr(o)}):void 0;return h!=null?Promise.race([c(),h()]):c()};var Pt=[];function Ua(r){if(Pt.push({req:r.req,tick:r.tick,id:r.id}),globalThis.eventQueue=Pt,r.id!==Pt.length-1){globalThis.stopGameLoop=!0,console.error("VERY BAD OUT OF ORDER");return}globalThis.callback2===void 0&&Up()}function Up(){globalThis.callback2=async()=>{globalThis.tickCounter=Pt[0].tick,globalThis.callback2=async()=>{let r=0;for(let{req:e,tick:t}of Pt){if(globalThis.tickCounter===t){if(e.method.startsWith("start")&&e.method!=="startJumping"){let i=()=>Dp([e.method,e.method.replace("start","stop")],r+1);if(i()===!1){globalThis.stopGameLoop=!0;try{await Fa(i)}catch(o){throw o}}}let n=A.currentControlledChar;Kn(e,e.params,n,n.collider)}r++}globalThis.stopGameLoop=!1},globalThis.callback2()}}function Dp(r,e){for(let{req:t}of Pt.slice(e))if(r.includes(t.method))return!0;return!1}var Da=0;function ja(){let r={characters:[...A.characters].map(t=>[t.name,t.health,t.team,t.collider.x,t.collider.y,t.collider.width,t.collider.height,t.looksToLeft,t.animState,t.handTool,t.angle]),weaponBoxes:[...A.weaponBoxes].map(t=>[t.collider.x,t.collider.y,t.collider.width,t.collider.height,t.creationTime]),hookSegments:[],ammo:[],meta:{waterOffset:A.waterOffset,currentControlledCharIdx:[...A.characters].indexOf(A.currentControlledChar),currentControlledCharState:(A.currentControlledChar?.statNew??"not exists").toUpperCase(),test1:globalThis.stopGameLoop,rate:Me,freq2:globalThis.freq2}};for(let t of A.gameEntities){let n;switch(t.constructor){case wt:n="GrenadeCollider";break;case It:n="RifleAmmoCollider";break;case St:n="BazookaAmmoCollider";break;case Be:n="GrapplingHookShotCollider";break}switch(t.constructor){case wt:case It:case St:case Be:r.ammo.push([n,t.x,t.y,t.width,t.height,t.angle??t.velocity.slope??null])}t instanceof Qe&&(t.active===!1||t.isVisible())&&r.hookSegments.push([t.x,t.y,t.width,t.height])}let e=A.holes.slice(Da);return Da=A.holes.length,{snapshot:r,newHoles:e}}var qa=!1;var Wa,Se,Zn={connectedToWS:!1,userId:"",startGame(r){Ra(r)},startOffline(){let r=Qn(1570,41.88753858024709,"dfgsfdggfs",1);A.currentControlledChar=r;let e=Qn(1370,118.23398919753112,"\u041F\u0435\u0442\u044F",0)},update(){globalThis.test?.()},collectRenderData(){return ja()},makeHole(r,e){Fe(r,e,60)},draw(r,e){A.terrain.draw(r,e,20)},handleChar(r,e={}){let t={method:r,params:e},n=A.currentControlledChar;n!==void 0&&(qa&&Wa===!1||Kn(t,t.params,n,n.collider))},changeChar(){let r=A.currentControlledChar;if(r===void 0)return;let e=r.collider;e.testGavnina&&(e.testGavnina=!1);let t=[...A.characters],i=(t.indexOf(r)+1)%t.length;A.currentControlledChar=t[i]},async makeRPC(r,e){return(await Se.namedRPC(r,e)).data},toggleBulletTime(){globalThis.bulletTime=!globalThis.bulletTime}};Zt(Zn);var Ga,jp=0;function Kn(r,e,t,n){let i=JSON.stringify(r);if(!(i===Ga&&r.method!=="startJumping")&&!(r.method==="startJumping"&&!(t.statNew==="moves"||t.statNew==="idle")))switch(Ga=i,globalThis.record!==void 0&&globalThis.record.addEvent(r),qa&&Wa&&(async()=>{try{let o=await Se.namedRPC("input",{req:r,tick:globalThis.tickCounter,challengeId:globalThis.challengeId,command:"test",id:jp++})}catch(o){console.error(o)}})(),r.method){case"startMoving":(t.collider.testGavnina||!(t.statNew==="preparationForJump"||t.statNew==="falls"))&&(t.looksToLeft=e.direction),t.collider.testGavnina===!1&&(t.moves=e.direction?"left":"right");break;case"stopMoving":t.moves="none",t.characterService.send("STOP_MOVING");break;case"startJumping":t.startJumpAnim=e.direction,t.characterService.send("START_JUMP");break;case"setWeapon":t.handTool=e.name;break;case"fireTest":Na(e.force);break;case"startPull":if(n.testGavnina){n.pull=e.direction;break}t.aim=e.direction==="W"?"up":"down";break;case"stopPull":n.pull="none",t.aim="none";break;case"deattach":n.testGavnina&&(n.testGavnina=!1);break}}async function Gp(){let r;try{let e=await fetch("http://localhost:3000/connect");if(e.ok===!1)throw new Error;let{token:t,id:n}=await e.json();r=t,Zn.userId=n}catch(e){throw e}Se=new Va.default("ws://localhost:8000/connection/websocket"),Se.setToken(r),Se.on("connect",async e=>{console.log("connected",e),Zn.connectedToWS=!0}),Se.on("disconnect",e=>{console.log("disconnected",e)}),Se.on("subscribe",async e=>{}),Se.on("publish",e=>{console.log(e);let{data:t}=e;switch(t.command){case"showChallenge":At.showBattleRequest(t);break;case"prepareScene":At.prepareScene();break;case"startMapLoad":break;case"startBattle":break;case"test":Ua(t);break}}),Se.connect()}Gp();async function ne(r){await At.playSound(r)}async function Tt(r){await At.setInputMode(r)}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/**
 * @license
 * Lodash (Custom Build) <https://lodash.com/>
 * Build: `lodash modularize exports="es" -o ./`
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
