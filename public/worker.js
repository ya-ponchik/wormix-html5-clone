var Wa=Object.create;var Ct=Object.defineProperty;var $a=Object.getOwnPropertyDescriptor;var Ha=Object.getOwnPropertyNames;var za=Object.getPrototypeOf,Ja=Object.prototype.hasOwnProperty;var Ya=(r,e,t)=>e in r?Ct(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Xa=r=>Ct(r,"__esModule",{value:!0});var Qa=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),oi=(r,e)=>{for(var t in e)Ct(r,t,{get:e[t],enumerable:!0})},Ka=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Ha(e))!Ja.call(r,i)&&(t||i!=="default")&&Ct(r,i,{get:()=>e[i],enumerable:!(n=$a(e,i))||n.enumerable});return r},Za=(r,e)=>Ka(Xa(Ct(r!=null?Wa(za(r)):{},"default",!e&&r&&r.__esModule?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r);var Ie=(r,e,t)=>(Ya(r,typeof e!="symbol"?e+"":e,t),t);var si=Qa((At,Qr)=>{(function(e,t){typeof At=="object"&&typeof Qr=="object"?Qr.exports=t():typeof define=="function"&&define.amd?define("Centrifuge",[],t):typeof At=="object"?At.Centrifuge=t():e.Centrifuge=t()})(At,function(){return function(){"use strict";var r={382:function(i,o,s){Object.defineProperty(o,"__esModule",{value:!0}),o.Centrifuge=void 0;var l=b(s(187)),c=b(s(471)),d=s(147),h=s(853);function b(g){return g&&g.__esModule?g:{default:g}}function x(g){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?x=function(T){return typeof T}:x=function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},x(g)}function E(g,v){if(!(g instanceof v))throw new TypeError("Cannot call a class as a function")}function I(g,v){for(var T=0;T<v.length;T++){var m=v[T];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(g,m.key,m)}}function S(g,v,T){return v&&I(g.prototype,v),T&&I(g,T),g}function P(g,v){if(typeof v!="function"&&v!==null)throw new TypeError("Super expression must either be null or a function");g.prototype=Object.create(v&&v.prototype,{constructor:{value:g,writable:!0,configurable:!0}}),v&&A(g,v)}function A(g,v){return A=Object.setPrototypeOf||function(m,f){return m.__proto__=f,m},A(g,v)}function L(g){var v=q();return function(){var m=F(g),f;if(v){var u=F(this).constructor;f=Reflect.construct(m,arguments,u)}else f=m.apply(this,arguments);return O(this,f)}}function O(g,v){if(v&&(x(v)==="object"||typeof v=="function"))return v;if(v!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return U(g)}function U(g){if(g===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g}function q(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function F(g){return F=Object.setPrototypeOf?Object.getPrototypeOf:function(T){return T.__proto__||Object.getPrototypeOf(T)},F(g)}var G="timeout",D="connection closed",y=function(g){P(T,g);var v=L(T);function T(m,f){var u;return E(this,T),u=v.call(this),u._url=m,u._websocket=null,u._sockjs=null,u._isSockjs=!1,u._xmlhttprequest=null,u._binary=!1,u._methodType=null,u._pushType=null,u._encoder=null,u._decoder=null,u._status="disconnected",u._reconnect=!0,u._reconnecting=!1,u._transport=null,u._transportName=null,u._transportClosed=!0,u._messageId=0,u._clientID=null,u._refreshRequired=!1,u._subs={},u._serverSubs={},u._lastSeq={},u._lastGen={},u._lastOffset={},u._lastEpoch={},u._messages=[],u._isBatching=!1,u._isSubscribeBatching=!1,u._privateChannels={},u._numRefreshFailed=0,u._refreshTimeout=null,u._pingTimeout=null,u._pongTimeout=null,u._subRefreshTimeouts={},u._retries=0,u._callbacks={},u._latency=null,u._latencyStart=null,u._connectData=null,u._token=null,u._xhrID=0,u._xhrs={},u._dispatchPromise=Promise.resolve(),u._protocol="",u._config={protocol:"",debug:!1,name:"js",version:"",websocket:null,sockjs:null,xmlhttprequest:null,minRetry:1e3,maxRetry:2e4,timeout:5e3,ping:!0,pingInterval:25e3,pongWaitTimeout:5e3,privateChannelPrefix:"$",onTransportClose:null,sockjsServer:null,sockjsTimeout:null,sockjsTransports:["websocket","xdr-streaming","xhr-streaming","eventsource","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"],refreshEndpoint:"/centrifuge/refresh",refreshHeaders:{},refreshParams:{},refreshData:{},refreshAttempts:null,refreshInterval:1e3,onRefreshFailed:null,onRefresh:null,subscribeEndpoint:"/centrifuge/subscribe",subscribeHeaders:{},subscribeParams:{},subRefreshInterval:1e3,onPrivateSubscribe:null,disableWithCredentials:!1},u._configure(f),u}return S(T,[{key:"setToken",value:function(f){this._token=f}},{key:"setConnectData",value:function(f){this._connectData=f}},{key:"setRefreshHeaders",value:function(f){this._config.refreshHeaders=f}},{key:"setRefreshParams",value:function(f){this._config.refreshParams=f}},{key:"setRefreshData",value:function(f){this._config.refreshData=f}},{key:"setSubscribeHeaders",value:function(f){this._config.subscribeHeaders=f}},{key:"setSubscribeParams",value:function(f){this._config.subscribeParams=f}},{key:"_ajax",value:function(f,u,p,_,w){var R=this,B="";this._debug("sending AJAX request to",f,"with data",JSON.stringify(_));var M;this._xmlhttprequest!==null?M=new this._xmlhttprequest:M=s.g.XMLHttpRequest?new s.g.XMLHttpRequest:new s.g.ActiveXObject("Microsoft.XMLHTTP");for(var j in u)u.hasOwnProperty(j)&&(B.length>0&&(B+="&"),B+=encodeURIComponent(j)+"="+encodeURIComponent(u[j]));B.length>0&&(B="?"+B),M.open("POST",f+B,!0),"withCredentials"in M&&(M.withCredentials=!this._config.disableWithCredentials),M.setRequestHeader("X-Requested-With","XMLHttpRequest"),M.setRequestHeader("Content-Type","application/json");for(var X in p)p.hasOwnProperty(X)&&M.setRequestHeader(X,p[X]);return M.onreadystatechange=function(){if(M.readyState===4)if(M.status===200){var Q,H=!1;try{Q=JSON.parse(M.responseText),H=!0}catch{w({error:"Invalid JSON. Data was: "+M.responseText,status:200,data:null})}H&&w({data:Q,status:200})}else R._log("wrong status code in AJAX response",M.status),w({status:M.status,data:null})},setTimeout(function(){return M.send(JSON.stringify(_))},20),M}},{key:"_log",value:function(){(0,h.log)("info",arguments)}},{key:"_debug",value:function(){this._config.debug===!0&&(0,h.log)("debug",arguments)}},{key:"_websocketSupported",value:function(){return this._config.websocket!==null?!0:!(typeof WebSocket!="function"&&(typeof WebSocket>"u"?"undefined":x(WebSocket))!=="object")}},{key:"_setFormat",value:function(f){if(!this._formatOverride(f)){if(f==="protobuf")throw new Error("not implemented by JSON only Centrifuge client \u2013 use client with Protobuf");this._binary=!1,this._methodType=d.JsonMethodType,this._pushType=d.JsonPushType,this._encoder=new d.JsonEncoder,this._decoder=new d.JsonDecoder}}},{key:"_formatOverride",value:function(f){return!1}},{key:"_configure",value:function(f){if(!("Promise"in s.g))throw new Error("Promise polyfill required");if((0,h.extend)(this._config,f||{}),this._debug("centrifuge config",this._config),!this._url)throw new Error("url required");var u=(0,h.startsWith)(this._url,"ws")&&this._url.indexOf("format=protobuf")>-1;if(u||this._config.protocol==="protobuf")this._setFormat("protobuf"),this._protocol="protobuf";else{if(this._config.protocol!==""&&this._config.protocol!=="json")throw new Error("unsupported protocol "+this._config.protocol);this._setFormat("json")}if((0,h.startsWith)(this._url,"http"))if(this._debug("client will try to connect to SockJS endpoint"),this._config.sockjs!==null)this._debug("SockJS explicitly provided in options"),this._sockjs=this._config.sockjs;else{if(typeof s.g.SockJS>"u")throw new Error("SockJS not found, use ws:// in url or include SockJS");this._debug("use globally defined SockJS"),this._sockjs=s.g.SockJS}else this._debug("client will connect to websocket endpoint");this._xmlhttprequest=this._config.xmlhttprequest}},{key:"_setStatus",value:function(f){this._status!==f&&(this._debug("Status",this._status,"->",f),this._status=f)}},{key:"_isDisconnected",value:function(){return this._status==="disconnected"}},{key:"_isConnecting",value:function(){return this._status==="connecting"}},{key:"_isConnected",value:function(){return this._status==="connected"}},{key:"_nextMessageId",value:function(){return++this._messageId}},{key:"_resetRetry",value:function(){this._debug("reset retries count to 0"),this._retries=0}},{key:"_getRetryInterval",value:function(){var f=(0,h.backoff)(this._retries,this._config.minRetry,this._config.maxRetry);return this._retries+=1,f}},{key:"_abortInflightXHRs",value:function(){for(var f in this._xhrs){try{this._xhrs[f].abort()}catch(u){this._debug("error aborting xhr",u)}delete this._xhrs[f]}}},{key:"_clearConnectedState",value:function(f){this._clientID=null,this._stopPing();for(var u in this._callbacks)if(this._callbacks.hasOwnProperty(u)){var p=this._callbacks[u];clearTimeout(p.timeout);var _=p.errback;if(!_)continue;_({error:this._createErrorObject("disconnected")})}this._callbacks={};for(var w in this._subs)if(this._subs.hasOwnProperty(w)){var R=this._subs[w];f?(R._isSuccess()&&(R._triggerUnsubscribe(),R._recover=!0),R._shouldResubscribe()&&R._setSubscribing()):R._setUnsubscribed()}this._abortInflightXHRs(),this._refreshTimeout!==null&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null);for(var B in this._subRefreshTimeouts)this._subRefreshTimeouts.hasOwnProperty(B)&&this._subRefreshTimeouts[B]&&this._clearSubRefreshTimeout(B);this._subRefreshTimeouts={},this._reconnect||(this._subs={})}},{key:"_isTransportOpen",value:function(){return this._isSockjs?this._transport&&this._transport.transport&&this._transport.transport.readyState===this._transport.transport.OPEN:this._transport&&this._transport.readyState===this._transport.OPEN}},{key:"_transportSend",value:function(f){if(!f.length)return!0;if(!this._isTransportOpen()){for(var u in f){var p=u.id;if(p in this._callbacks){var _=this._callbacks[p];clearTimeout(this._callbacks[p].timeout),delete this._callbacks[p];var w=_.errback;w({error:this._createErrorObject(D,0)})}}return!1}return this._transport.send(this._encoder.encodeCommands(f)),!0}},{key:"_getSubProtocol",value:function(){return this._protocol?"centrifuge-"+this._protocol:""}},{key:"_setupTransport",value:function(){var f=this;if(this._isSockjs=!1,this._sockjs!==null){var u={transports:this._config.sockjsTransports};this._config.sockjsServer!==null&&(u.server=this._config.sockjsServer),this._config.sockjsTimeout!==null&&(u.timeout=this._config.sockjsTimeout),this._isSockjs=!0,this._transport=new this._sockjs(this._url,null,u)}else{if(!this._websocketSupported())throw this._debug("No Websocket support and no SockJS configured, can not connect"),new Error("No Websocket support and no SockJS configured, can not connect");this._config.websocket!==null?this._websocket=this._config.websocket:this._websocket=WebSocket;var p=this._getSubProtocol();p!==""?this._transport=new this._websocket(this._url,p):this._transport=new this._websocket(this._url),this._binary===!0&&(this._transport.binaryType="arraybuffer")}this._transport.onopen=function(){f._transportClosed=!1,f._isSockjs?(f._transportName="sockjs-"+f._transport.transport,f._transport.onheartbeat=function(){return f._restartPing()}):f._transportName="websocket";var _={};(f._token||f._connectData||f._config.name||f._config.version)&&(_.params={}),f._token&&(_.params.token=f._token),f._connectData&&(_.params.data=f._connectData),f._config.name&&(_.params.name=f._config.name),f._config.version&&(_.params.version=f._config.version);var w={},R=!1;for(var B in f._serverSubs)if(f._serverSubs.hasOwnProperty(B)&&f._serverSubs[B].recoverable){R=!0;var M={recover:!0};f._serverSubs[B].seq||f._serverSubs[B].gen?(f._serverSubs[B].seq&&(M.seq=f._serverSubs[B].seq),f._serverSubs[B].gen&&(M.gen=f._serverSubs[B].gen)):f._serverSubs[B].offset&&(M.offset=f._serverSubs[B].offset),f._serverSubs[B].epoch&&(M.epoch=f._serverSubs[B].epoch),w[B]=M}R&&(_.params||(_.params={}),_.params.subs=w),f._latencyStart=new Date,f._call(_).then(function(j){f._connectResponse(f._decoder.decodeCommandResult(f._methodType.CONNECT,j.result),R),j.next&&j.next()},function(j){var X=j.error;X.code===109&&(f._refreshRequired=!0),f._disconnect("connect error",!0),j.next&&j.next()})},this._transport.onerror=function(_){f._debug("transport level error",_)},this._transport.onclose=function(_){f._transportClosed=!0;var w=D,R=!0;if(_&&"reason"in _&&_.reason)try{var B=JSON.parse(_.reason);f._debug("reason is an advice object",B),w=B.reason,R=B.reconnect}catch{w=_.reason,f._debug("reason is a plain string",w)}if(f._config.onTransportClose!==null&&f._config.onTransportClose({event:_,reason:w,reconnect:R}),f._disconnect(w,R),f._reconnect===!0){f._reconnecting=!0;var M=f._getRetryInterval();f._debug("reconnect after "+M+" milliseconds"),setTimeout(function(){f._reconnect===!0&&(f._refreshRequired?f._refresh():f._connect())},M)}},this._transport.onmessage=function(_){f._dataReceived(_.data)}}},{key:"rpc",value:function(f){return this._rpc("",f)}},{key:"namedRPC",value:function(f,u){return this._rpc(f,u)}},{key:"_rpc",value:function(f,u){var p={data:u};f!==""&&(p.method=f);var _={method:this._methodType.RPC,params:p};return this._methodCall(_,function(w){return w})}},{key:"send",value:function(f){var u={method:this._methodType.SEND,params:{data:f}};if(!this.isConnected())return Promise.reject(this._createErrorObject(D,0));var p=this._transportSend([u]);return p?Promise.resolve({}):Promise.reject(this._createErrorObject(D,0))}},{key:"_getHistoryParams",value:function(f,u){var p={channel:f};return u!==void 0&&(u.since&&(p.since={offset:u.since.offset},u.since.epoch&&(p.since.epoch=u.since.epoch)),u.limit!==void 0&&(p.limit=u.limit),u.reverse===!0&&(p.reverse=!0)),p}},{key:"_methodCall",value:function(f,u){var p=this;return this.isConnected()?new Promise(function(_,w){p._call(f).then(function(R){_(u(p._decoder.decodeCommandResult(f.method,R.result))),R.next&&R.next()},function(R){w(R.error),R.next&&R.next()})}):Promise.reject(this._createErrorObject(D,0))}},{key:"publish",value:function(f,u){var p={method:this._methodType.PUBLISH,params:{channel:f,data:u}};return this._methodCall(p,function(){return{}})}},{key:"history",value:function(f,u){var p=this._getHistoryParams(f,u),_={method:this._methodType.HISTORY,params:p};return this._methodCall(_,function(w){return{publications:w.publications,epoch:w.epoch||"",offset:w.offset||0}})}},{key:"presence",value:function(f){var u={method:this._methodType.PRESENCE,params:{channel:f}};return this._methodCall(u,function(p){return{presence:p.presence}})}},{key:"presenceStats",value:function(f){var u={method:this._methodType.PRESENCE_STATS,params:{channel:f}};return this._methodCall(u,function(p){return{num_users:p.num_users,num_clients:p.num_clients}})}},{key:"_dataReceived",value:function(f){var u=this,p=this._decoder.decodeReplies(f);this._dispatchPromise=this._dispatchPromise.then(function(){var _;u._dispatchPromise=new Promise(function(w){_=w}),u._dispatchSynchronized(p,_)}),this._restartPing()}},{key:"_dispatchSynchronized",value:function(f,u){var p=this,_=Promise.resolve(),w=function(M){f.hasOwnProperty(M)&&(_=_.then(function(){return p._dispatchReply(f[M])}))};for(var R in f)w(R);_=_.then(function(){u()})}},{key:"_dispatchReply",value:function(f){var u,p=new Promise(function(w){u=w});if(f==null)return this._debug("dispatch: got undefined or null reply"),u(),p;var _=f.id;return _&&_>0?this._handleReply(f,u):this._handlePush(f.result,u),p}},{key:"_call",value:function(f){var u=this;return new Promise(function(p,_){var w=u._addMessage(f);u._registerCall(w,p,_)})}},{key:"_connect",value:function(){if(this.isConnected()){this._debug("connect called when already connected");return}this._status!=="connecting"&&(this._debug("start connecting"),this._setStatus("connecting"),this._clientID=null,this._reconnect=!0,this._setupTransport())}},{key:"_disconnect",value:function(f,u){var p=u||!1;if(p===!1&&(this._reconnect=!1),this._isDisconnected()){p||this._clearConnectedState(p);return}if(this._clearConnectedState(p),this._debug("disconnected:",f,u),this._setStatus("disconnected"),this._refreshTimeout&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null),this._reconnecting===!1){for(var _ in this._serverSubs)this._serverSubs.hasOwnProperty(_)&&this.emit("unsubscribe",{channel:_});this.emit("disconnect",{reason:f,reconnect:p})}p===!1&&(this._subs={},this._serverSubs={}),this._transportClosed||this._transport.close()}},{key:"_refreshFailed",value:function(){this._numRefreshFailed=0,this._isDisconnected()||this._disconnect("refresh failed",!1),this._config.onRefreshFailed!==null&&this._config.onRefreshFailed()}},{key:"_refresh",value:function(){var f=this;if(this._debug("refresh token"),this._config.refreshAttempts===0){this._debug("refresh attempts set to 0, do not send refresh request at all"),this._refreshFailed();return}this._refreshTimeout!==null&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null);var u=this._clientID,p=this._newXHRID(),_=function(M){if(p in f._xhrs&&delete f._xhrs[p],f._clientID===u){if(M.error||M.status!==200){if(M.error?f._debug("error refreshing connection token",M.error):f._debug("error refreshing connection token: wrong status code",M.status),f._numRefreshFailed++,f._refreshTimeout!==null&&(clearTimeout(f._refreshTimeout),f._refreshTimeout=null),f._config.refreshAttempts!==null&&f._numRefreshFailed>=f._config.refreshAttempts){f._refreshFailed();return}var j=Math.round(Math.random()*1e3*Math.max(f._numRefreshFailed,20)),X=f._config.refreshInterval+j;f._refreshTimeout=setTimeout(function(){return f._refresh()},X);return}if(f._numRefreshFailed=0,f._token=M.data.token,!f._token){f._refreshFailed();return}if(f._isDisconnected()&&f._reconnect)f._debug("token refreshed, connect from scratch"),f._connect();else{f._debug("send refreshed token");var Q={method:f._methodType.REFRESH,params:{token:f._token}};f._call(Q).then(function(H){f._refreshResponse(f._decoder.decodeCommandResult(f._methodType.REFRESH,H.result)),H.next&&H.next()},function(H){f._refreshError(H.error),H.next&&H.next()})}}};if(this._config.onRefresh!==null){var w={};this._config.onRefresh(w,_)}else{var R=this._ajax(this._config.refreshEndpoint,this._config.refreshParams,this._config.refreshHeaders,this._config.refreshData,_);this._xhrs[p]=R}}},{key:"_refreshError",value:function(f){var u=this;this._debug("refresh error",f),this._refreshTimeout&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null);var p=this._config.refreshInterval+Math.round(Math.random()*1e3);this._refreshTimeout=setTimeout(function(){return u._refresh()},p)}},{key:"_refreshResponse",value:function(f){var u=this;this._refreshTimeout&&(clearTimeout(this._refreshTimeout),this._refreshTimeout=null),f.expires&&(this._clientID=f.client,this._refreshTimeout=setTimeout(function(){return u._refresh()},this._getTTLMilliseconds(f.ttl)))}},{key:"_newXHRID",value:function(){return this._xhrID++,this._xhrID}},{key:"_subRefresh",value:function(f){var u=this;if(this._debug("refresh subscription token for channel",f),this._subRefreshTimeouts[f]!==void 0)this._clearSubRefreshTimeout(f);else return;var p=this._clientID,_=this._newXHRID(),w=function(j){if(_ in u._xhrs&&delete u._xhrs[_],!(j.error||j.status!==200||u._clientID!==p)){var X={};if(j.data.channels)for(var Q in j.data.channels){var H=j.data.channels[Q];!H.channel||(X[H.channel]=H.token)}var Ke=X[f];if(!!Ke){var zr={method:u._methodType.SUB_REFRESH,params:{channel:f,token:Ke}},Kt=u._getSub(f);Kt!==null&&u._call(zr).then(function(xe){u._subRefreshResponse(f,u._decoder.decodeCommandResult(u._methodType.SUB_REFRESH,xe.result)),xe.next&&xe.next()},function(xe){u._subRefreshError(f,xe.error),xe.next&&xe.next()})}}},R={client:this._clientID,channels:[f]};if(this._config.onPrivateSubscribe!==null)this._config.onPrivateSubscribe({data:R},w);else{var B=this._ajax(this._config.subscribeEndpoint,this._config.subscribeParams,this._config.subscribeHeaders,R,w);this._xhrs[_]=B}}},{key:"_clearSubRefreshTimeout",value:function(f){this._subRefreshTimeouts[f]!==void 0&&(clearTimeout(this._subRefreshTimeouts[f]),delete this._subRefreshTimeouts[f])}},{key:"_subRefreshError",value:function(f,u){var p=this;this._debug("subscription refresh error",f,u),this._clearSubRefreshTimeout(f);var _=this._getSub(f);if(_!==null){var w=Math.round(Math.random()*1e3),R=setTimeout(function(){return p._subRefresh(f)},this._config.subRefreshInterval+w);this._subRefreshTimeouts[f]=R}}},{key:"_subRefreshResponse",value:function(f,u){var p=this;this._debug("subscription refresh success",f),this._clearSubRefreshTimeout(f);var _=this._getSub(f);if(_!==null&&u.expires===!0){var w=setTimeout(function(){return p._subRefresh(f)},this._getTTLMilliseconds(u.ttl));this._subRefreshTimeouts[f]=w}}},{key:"_subscribe",value:function(f,u){var p=this;this._debug("subscribing on",f.channel);var _=f.channel;if(_ in this._subs||(this._subs[_]=f),!this.isConnected()){f._setNew();return}f._setSubscribing(u);var w={method:this._methodType.SUBSCRIBE,params:{channel:_}};if(f._subscribeData&&(w.params.data=f._subscribeData),(0,h.startsWith)(_,this._config.privateChannelPrefix))this._isSubscribeBatching?this._privateChannels[_]=!0:(this.startSubscribeBatching(),this._subscribe(f),this.stopSubscribeBatching());else{var R=f._needRecover();if(R===!0){w.params.recover=!0;var B=this._getLastSeq(_),M=this._getLastGen(_);if(B||M)B&&(w.params.seq=B),M&&(w.params.gen=M);else{var j=this._getLastOffset(_);j&&(w.params.offset=j)}var X=this._getLastEpoch(_);X&&(w.params.epoch=X)}this._call(w).then(function(Q){p._subscribeResponse(_,R,p._decoder.decodeCommandResult(p._methodType.SUBSCRIBE,Q.result)),Q.next&&Q.next()},function(Q){p._subscribeError(_,Q.error),Q.next&&Q.next()})}}},{key:"_unsubscribe",value:function(f){delete this._subs[f.channel],delete this._lastOffset[f.channel],delete this._lastSeq[f.channel],delete this._lastGen[f.channel],this.isConnected()&&this._addMessage({method:this._methodType.UNSUBSCRIBE,params:{channel:f.channel}})}},{key:"_getTTLMilliseconds",value:function(f){return Math.min(f*1e3,2147483647)}},{key:"getSub",value:function(f){return this._getSub(f)}},{key:"_getSub",value:function(f){var u=this._subs[f];return u||null}},{key:"_isServerSub",value:function(f){return this._serverSubs[f]!==void 0}},{key:"_connectResponse",value:function(f,u){var p=this,_=this._reconnecting;if(this._reconnecting=!1,this._resetRetry(),this._refreshRequired=!1,!this.isConnected()){this._latencyStart!==null&&(this._latency=new Date().getTime()-this._latencyStart.getTime(),this._latencyStart=null),this._clientID=f.client,this._setStatus("connected"),this._refreshTimeout&&clearTimeout(this._refreshTimeout),f.expires&&(this._refreshTimeout=setTimeout(function(){return p._refresh()},this._getTTLMilliseconds(f.ttl))),this.startBatching(),this.startSubscribeBatching();for(var w in this._subs)if(this._subs.hasOwnProperty(w)){var R=this._subs[w];R._shouldResubscribe()&&this._subscribe(R,_)}this.stopSubscribeBatching(),this.stopBatching(),this._startPing();var B={client:f.client,transport:this._transportName,latency:this._latency};f.data&&(B.data=f.data),this.emit("connect",B),f.subs&&this._processServerSubs(f.subs)}}},{key:"_processServerSubs",value:function(f){for(var u in f)if(f.hasOwnProperty(u)){var p=f[u],_=this._serverSubs[u]!==void 0,w={channel:u,isResubscribe:_};w=this._expandSubscribeContext(w,p),this.emit("subscribe",w)}for(var R in f)if(f.hasOwnProperty(R)){var B=f[R];if(B.recovered){var M=B.publications;if(M&&M.length>0){M.length>1&&(!M[0].offset||M[0].offset>M[1].offset)&&(M=M.reverse());for(var j in M)M.hasOwnProperty(j)&&this._handlePublication(R,M[j])}}this._serverSubs[R]={seq:B.seq,gen:B.gen,offset:B.offset,epoch:B.epoch,recoverable:B.recoverable}}}},{key:"_stopPing",value:function(){this._pongTimeout!==null&&(clearTimeout(this._pongTimeout),this._pongTimeout=null),this._pingTimeout!==null&&(clearTimeout(this._pingTimeout),this._pingTimeout=null)}},{key:"_startPing",value:function(){var f=this;this._config.ping!==!0||this._config.pingInterval<=0||!this.isConnected()||(this._pingTimeout=setTimeout(function(){if(!f.isConnected()){f._stopPing();return}f.ping(),f._pongTimeout=setTimeout(function(){f._disconnect("no ping",!0)},f._config.pongWaitTimeout)},this._config.pingInterval))}},{key:"_restartPing",value:function(){this._stopPing(),this._startPing()}},{key:"_subscribeError",value:function(f,u){var p=this._getSub(f);if(!!p&&!!p._isSubscribing()){if(u.code===0&&u.message===G){this._disconnect("timeout",!0);return}p._setSubscribeError(u)}}},{key:"_expandSubscribeContext",value:function(f,u){var p=!1;"recovered"in u&&(p=u.recovered),f.recovered=p;var _=!1;"positioned"in u&&(_=u.positioned);var w="";"epoch"in u&&(w=u.epoch);var R=0;return"offset"in u&&(R=u.offset),_&&(f.streamPosition={offset:R,epoch:w}),u.data&&(f.data=u.data),f}},{key:"_subscribeResponse",value:function(f,u,p){var _=this,w=this._getSub(f);if(!!w&&!!w._isSubscribing()){w._setSubscribeSuccess(p);var R=p.publications;if(R&&R.length>0){R.length>=2&&!R[0].offset&&!R[1].offset&&(R=R.reverse());for(var B in R)R.hasOwnProperty(B)&&this._handlePublication(f,R[B])}if(p.recoverable&&(!u||!p.recovered)&&(this._lastSeq[f]=p.seq||0,this._lastGen[f]=p.gen||0,this._lastOffset[f]=p.offset||0),this._lastEpoch[f]=p.epoch||"",p.recoverable&&(w._recoverable=!0),p.expires===!0){var M=setTimeout(function(){return _._subRefresh(f)},this._getTTLMilliseconds(p.ttl));this._subRefreshTimeouts[f]=M}}}},{key:"_handleReply",value:function(f,u){var p=f.id,_=f.result;if(!(p in this._callbacks)){u();return}var w=this._callbacks[p];if(clearTimeout(this._callbacks[p].timeout),delete this._callbacks[p],(0,h.errorExists)(f)){var B=w.errback;if(!B){u();return}var M=f.error;B({error:M,next:u})}else{var R=w.callback;if(!R)return;R({result:_,next:u})}}},{key:"_handleJoin",value:function(f,u){var p={info:u.info},_=this._getSub(f);if(!_){this._isServerSub(f)&&(p.channel=f,this.emit("join",p));return}_.emit("join",p)}},{key:"_handleLeave",value:function(f,u){var p={info:u.info},_=this._getSub(f);if(!_){this._isServerSub(f)&&(p.channel=f,this.emit("leave",p));return}_.emit("leave",p)}},{key:"_handleUnsub",value:function(f,u){var p={},_=this._getSub(f);if(!_){this._isServerSub(f)&&(delete this._serverSubs[f],p.channel=f,this.emit("unsubscribe",p));return}_.unsubscribe(),u.resubscribe===!0&&_.subscribe()}},{key:"_handleSub",value:function(f,u){this._serverSubs[f]={seq:u.seq,gen:u.gen,offset:u.offset,epoch:u.epoch,recoverable:u.recoverable};var p={channel:f,isResubscribe:!1};p=this._expandSubscribeContext(p,u),this.emit("subscribe",p)}},{key:"_handlePublication",value:function(f,u){var p=this._getSub(f),_={data:u.data,seq:u.seq,gen:u.gen,offset:u.offset};if(u.info&&(_.info=u.info),!p){this._isServerSub(f)&&(u.seq!==void 0&&(this._serverSubs[f].seq=u.seq),u.gen!==void 0&&(this._serverSubs[f].gen=u.gen),u.offset!==void 0&&(this._serverSubs[f].offset=u.offset),_.channel=f,this.emit("publish",_));return}u.seq!==void 0&&(this._lastSeq[f]=u.seq),u.gen!==void 0&&(this._lastGen[f]=u.gen),u.offset!==void 0&&(this._lastOffset[f]=u.offset),p.emit("publish",_)}},{key:"_handleMessage",value:function(f){this.emit("message",f.data)}},{key:"_handlePush",value:function(f,u){var p=this._decoder.decodePush(f),_=0;"type"in p&&(_=p.type);var w=p.channel;if(_===this._pushType.PUBLICATION){var R=this._decoder.decodePushData(this._pushType.PUBLICATION,p.data);this._handlePublication(w,R)}else if(_===this._pushType.MESSAGE){var B=this._decoder.decodePushData(this._pushType.MESSAGE,p.data);this._handleMessage(B)}else if(_===this._pushType.JOIN){var M=this._decoder.decodePushData(this._pushType.JOIN,p.data);this._handleJoin(w,M)}else if(_===this._pushType.LEAVE){var j=this._decoder.decodePushData(this._pushType.LEAVE,p.data);this._handleLeave(w,j)}else if(_===this._pushType.UNSUBSCRIBE){var X=this._decoder.decodePushData(this._pushType.UNSUBSCRIBE,p.data);this._handleUnsub(w,X)}else if(_===this._pushType.SUBSCRIBE){var Q=this._decoder.decodePushData(this._pushType.UNSUBSCRIBE,p.data);this._handleSub(w,Q)}u()}},{key:"_flush",value:function(){var f=this._messages.slice(0);this._messages=[],this._transportSend(f)}},{key:"_ping",value:function(){var f=this,u={method:this._methodType.PING};this._call(u).then(function(p){f._pingResponse(f._decoder.decodeCommandResult(f._methodType.PING,p.result)),p.next&&p.next()},function(p){f._debug("ping error",p.error),p.next&&p.next()})}},{key:"_pingResponse",value:function(f){!this.isConnected()||(this._stopPing(),this._startPing())}},{key:"_getLastSeq",value:function(f){var u=this._lastSeq[f];return u||0}},{key:"_getLastOffset",value:function(f){var u=this._lastOffset[f];return u||0}},{key:"_getLastGen",value:function(f){var u=this._lastGen[f];return u||0}},{key:"_getLastEpoch",value:function(f){var u=this._lastEpoch[f];return u||""}},{key:"_createErrorObject",value:function(f,u){var p={message:f,code:u||0};return p}},{key:"_registerCall",value:function(f,u,p){var _=this;this._callbacks[f]={callback:u,errback:p,timeout:null},this._callbacks[f].timeout=setTimeout(function(){delete _._callbacks[f],(0,h.isFunction)(p)&&p({error:_._createErrorObject(G)})},this._config.timeout)}},{key:"_addMessage",value:function(f){var u=this._nextMessageId();return f.id=u,this._isBatching===!0?this._messages.push(f):this._transportSend([f]),u}},{key:"isConnected",value:function(){return this._isConnected()}},{key:"connect",value:function(){this._connect()}},{key:"disconnect",value:function(){this._disconnect("client",!1)}},{key:"ping",value:function(){return this._ping()}},{key:"startBatching",value:function(){this._isBatching=!0}},{key:"stopBatching",value:function(){this._isBatching=!1,this._flush()}},{key:"startSubscribeBatching",value:function(){this._isSubscribeBatching=!0}},{key:"stopSubscribeBatching",value:function(){var f=this;this._isSubscribeBatching=!1;var u=this._privateChannels;this._privateChannels={};var p=[];for(var _ in u)if(u.hasOwnProperty(_)){var w=this._getSub(_);if(!w)continue;p.push(_)}if(p.length===0){this._debug("no private channels found, no need to make request");return}var R={client:this._clientID,channels:p},B=this._clientID,M=this._newXHRID(),j=function(H){if(M in f._xhrs&&delete f._xhrs[M],f._clientID===B){if(H.error||H.status!==200){f._debug("authorization request failed");for(var Ke in p)if(p.hasOwnProperty(Ke)){var zr=p[Ke];f._subscribeError(zr,f._createErrorObject("authorization request failed"))}return}var Kt={};if(H.data.channels)for(var xe in H.data.channels){var Jr=H.data.channels[xe];!Jr.channel||(Kt[Jr.channel]=Jr.token)}var Kn=!1;f._isBatching||(f.startBatching(),Kn=!0);for(var Zn in p)if(p.hasOwnProperty(Zn)){var qa=function(){var fe=p[Zn],ei=Kt[fe];if(ei){var Ze={method:f._methodType.SUBSCRIBE,params:{channel:fe,token:ei}},ti=f._getSub(fe);if(ti===null)return"continue";var ri=ti._needRecover();if(ri===!0){Ze.params.recover=!0;var Yr=f._getLastSeq(fe),Xr=f._getLastGen(fe);if(Yr||Xr)Yr&&(Ze.params.seq=Yr),Xr&&(Ze.params.gen=Xr);else{var ni=f._getLastOffset(fe);ni&&(Ze.params.offset=ni)}var ii=f._getLastEpoch(fe);ii&&(Ze.params.epoch=ii)}f._call(Ze).then(function(Ue){f._subscribeResponse(fe,ri,f._decoder.decodeCommandResult(f._methodType.SUBSCRIBE,Ue.result)),Ue.next&&Ue.next()},function(Ue){f._subscribeError(fe,Ue.error),Ue.next&&Ue.next()})}else return f._subscribeError(fe,f._createErrorObject("permission denied",103)),"continue"}();if(qa==="continue")continue}Kn&&f.stopBatching()}};if(this._config.onPrivateSubscribe!==null)this._config.onPrivateSubscribe({data:R},j);else{var X=this._ajax(this._config.subscribeEndpoint,this._config.subscribeParams,this._config.subscribeHeaders,R,j);this._xhrs[M]=X}}},{key:"_setSubscribeSince",value:function(f,u){this._lastOffset[f.channel]=u.offset,this._lastEpoch[f.channel]=u.epoch,f._setNeedRecover(!0)}},{key:"subscribe",value:function(f,u,p){var _=this._getSub(f);if(_!==null)return _._setEvents(u),_._isUnsubscribed()&&_.subscribe(p),_;var w=new c.default(this,f,u);return this._subs[f]=w,w.subscribe(p),w}}]),T}(l.default);o.Centrifuge=y},579:function(i,o,s){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var l=s(382),c=l.Centrifuge;o.default=c,i.exports=o.default},147:function(i,o){Object.defineProperty(o,"__esModule",{value:!0}),o.JsonPushType=o.JsonMethodType=o.JsonEncoder=o.JsonDecoder=void 0;function s(E,I){if(!(E instanceof I))throw new TypeError("Cannot call a class as a function")}function l(E,I){for(var S=0;S<I.length;S++){var P=I[S];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(E,P.key,P)}}function c(E,I,S){return I&&l(E.prototype,I),S&&l(E,S),E}var d={CONNECT:0,SUBSCRIBE:1,UNSUBSCRIBE:2,PUBLISH:3,PRESENCE:4,PRESENCE_STATS:5,HISTORY:6,PING:7,SEND:8,RPC:9,REFRESH:10,SUB_REFRESH:11};o.JsonMethodType=d;var h={PUBLICATION:0,JOIN:1,LEAVE:2,UNSUBSCRIBE:3,MESSAGE:4,SUBSCRIBE:5};o.JsonPushType=h;var b=function(){function E(){s(this,E)}return c(E,[{key:"encodeCommands",value:function(S){return S.map(function(P){return JSON.stringify(P)}).join(`
`)}}]),E}();o.JsonEncoder=b;var x=function(){function E(){s(this,E)}return c(E,[{key:"decodeReplies",value:function(S){return S.split(`
`).filter(function(P){return P!==""}).map(function(P){return JSON.parse(P)})}},{key:"decodeCommandResult",value:function(S,P){return P}},{key:"decodePush",value:function(S){return S}},{key:"decodePushData",value:function(S,P){return P}}]),E}();o.JsonDecoder=x},471:function(i,o,s){function l(v){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?l=function(m){return typeof m}:l=function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},l(v)}Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var c=h(s(187)),d=s(853);function h(v){return v&&v.__esModule?v:{default:v}}function b(v,T){if(!(v instanceof T))throw new TypeError("Cannot call a class as a function")}function x(v,T){for(var m=0;m<T.length;m++){var f=T[m];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(v,f.key,f)}}function E(v,T,m){return T&&x(v.prototype,T),m&&x(v,m),v}function I(v,T){if(typeof T!="function"&&T!==null)throw new TypeError("Super expression must either be null or a function");v.prototype=Object.create(T&&T.prototype,{constructor:{value:v,writable:!0,configurable:!0}}),T&&S(v,T)}function S(v,T){return S=Object.setPrototypeOf||function(f,u){return f.__proto__=u,f},S(v,T)}function P(v){var T=O();return function(){var f=U(v),u;if(T){var p=U(this).constructor;u=Reflect.construct(f,arguments,p)}else u=f.apply(this,arguments);return A(this,u)}}function A(v,T){if(T&&(l(T)==="object"||typeof T=="function"))return T;if(T!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return L(v)}function L(v){if(v===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return v}function O(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function U(v){return U=Object.setPrototypeOf?Object.getPrototypeOf:function(m){return m.__proto__||Object.getPrototypeOf(m)},U(v)}var q=0,F=1,G=2,D=3,y=4,g=function(v){I(m,v);var T=P(m);function m(f,u,p){var _;return b(this,m),_=T.call(this),_.channel=u,_._centrifuge=f,_._status=q,_._error=null,_._isResubscribe=!1,_._ready=!1,_._subscriptionPromise=null,_._noResubscribe=!1,_._recoverable=!1,_._recover=!1,_._setEvents(p),_._initializePromise(),_._promises={},_._promiseId=0,_._subscribeData=null,_.on("error",function(w){this._centrifuge._debug("subscription error",w)}),_}return E(m,[{key:"_nextPromiseId",value:function(){return++this._promiseId}},{key:"_initializePromise",value:function(){var u=this;this._ready=!1,this._subscriptionPromise=new Promise(function(p,_){u._resolve=function(w){u._ready=!0,p(w)},u._reject=function(w){u._ready=!0,_(w)}}).then(function(){},function(){})}},{key:"_setNeedRecover",value:function(u){this._recoverable=u,this._recover=u}},{key:"_needRecover",value:function(){return this._recoverable===!0&&this._recover===!0}},{key:"_setEvents",value:function(u){if(!!u){if((0,d.isFunction)(u))this.on("publish",u);else if(Object.prototype.toString.call(u)===Object.prototype.toString.call({}))for(var p=["publish","join","leave","unsubscribe","subscribe","error"],_=0,w=p.length;_<w;_++){var R=p[_];R in u&&this.on(R,u[R])}}}},{key:"_isNew",value:function(){return this._status===q}},{key:"_isUnsubscribed",value:function(){return this._status===y}},{key:"_isSubscribing",value:function(){return this._status===F}},{key:"_isReady",value:function(){return this._status===G||this._status===D}},{key:"_isSuccess",value:function(){return this._status===G}},{key:"_isError",value:function(){return this._status===D}},{key:"_setNew",value:function(){this._status=q}},{key:"_setSubscribing",value:function(u){this._isResubscribe=u||!1,this._ready===!0&&this._initializePromise(),this._status=F}},{key:"_setSubscribeSuccess",value:function(u){if(this._status!==G){this._status=G;var p=this._getSubscribeSuccessContext(u);this._recover=!1,this.emit("subscribe",p),this._resolve(p);for(var _ in this._promises)clearTimeout(this._promises[_].timeout),this._promises[_].resolve(),delete this._promises[_]}}},{key:"_setSubscribeError",value:function(u){if(this._status!==D){this._status=D,this._error=u;var p=this._getSubscribeErrorContext();this.emit("error",p),this._reject(p);for(var _ in this._promises)clearTimeout(this._promises[_].timeout),this._promises[_].reject(u),delete this._promises[_]}}},{key:"_triggerUnsubscribe",value:function(){this.emit("unsubscribe",{channel:this.channel})}},{key:"_setUnsubscribed",value:function(u){if(this._centrifuge._clearSubRefreshTimeout(this.channel),this._status!==y){var p=this._status===G;this._status=y,u===!0&&(this._recover=!1,this._noResubscribe=!0,delete this._centrifuge._lastSeq[this.channel],delete this._centrifuge._lastGen[this.channel],delete this._centrifuge._lastEpoch[this.channel]),p&&this._triggerUnsubscribe()}}},{key:"_shouldResubscribe",value:function(){return!this._noResubscribe}},{key:"_getSubscribeSuccessContext",value:function(u){var p={channel:this.channel,isResubscribe:this._isResubscribe};return u&&(p=this._centrifuge._expandSubscribeContext(p,u)),p}},{key:"_getSubscribeErrorContext",value:function(){var u=this._error;return u.channel=this.channel,u.isResubscribe=this._isResubscribe,u}},{key:"_setSubscribeData",value:function(u){this._subscribeData=u}},{key:"ready",value:function(u,p){this._ready&&(this._isSuccess()?u(this._getSubscribeSuccessContext()):p(this._getSubscribeErrorContext()))}},{key:"subscribe",value:function(u){this._status!==G&&(u&&u.since&&this._centrifuge._setSubscribeSince(this,u.since),u&&u.data&&this._setSubscribeData(u.data),this._noResubscribe=!1,this._centrifuge._subscribe(this))}},{key:"unsubscribe",value:function(){this._setUnsubscribed(!0),this._centrifuge._unsubscribe(this)}},{key:"_methodCall",value:function(){var u=this;if(this._isSuccess())return Promise.resolve();if(this._isError())return Promise.reject(this._error);var p=new Promise(function(_,w){var R=setTimeout(function(){w({code:0,message:"timeout"})},u._centrifuge._config.timeout);u._promises[u._nextPromiseId()]={timeout:R,resolve:_,reject:w}});return p}},{key:"publish",value:function(u){var p=this;return this._methodCall().then(function(){return p._centrifuge.publish(p.channel,u)})}},{key:"presence",value:function(){var u=this;return this._methodCall().then(function(){return u._centrifuge.presence(u.channel)})}},{key:"presenceStats",value:function(){var u=this;return this._methodCall().then(function(){return u._centrifuge.presenceStats(u.channel)})}},{key:"history",value:function(u){var p=this;return this._methodCall().then(function(){return p._centrifuge.history(p.channel,u)})}}]),m}(c.default);o.default=g,i.exports=o.default},853:function(i,o,s){Object.defineProperty(o,"__esModule",{value:!0}),o.backoff=h,o.errorExists=b,o.extend=x,o.isFunction=c,o.log=d,o.startsWith=l;function l(E,I){return E.lastIndexOf(I,0)===0}function c(E){return E==null?!1:typeof E=="function"}function d(E,I){if(s.g.console){var S=s.g.console[E];c(S)&&S.apply(s.g.console,I)}}function h(E,I,S){var P=.5*Math.random(),A=Math.min(S,I*Math.pow(2,E+1));return Math.floor((1-P)*A)}function b(E){return"error"in E&&E.error!==null}function x(E,I){for(var S in I)I.hasOwnProperty(S)&&(E[S]=I[S]);return E}},187:function(i){var o=typeof Reflect=="object"?Reflect:null,s=o&&typeof o.apply=="function"?o.apply:function(g,v,T){return Function.prototype.apply.call(g,v,T)},l;o&&typeof o.ownKeys=="function"?l=o.ownKeys:Object.getOwnPropertySymbols?l=function(g){return Object.getOwnPropertyNames(g).concat(Object.getOwnPropertySymbols(g))}:l=function(g){return Object.getOwnPropertyNames(g)};function c(y){console&&console.warn&&console.warn(y)}var d=Number.isNaN||function(g){return g!==g};function h(){h.init.call(this)}i.exports=h,i.exports.once=F,h.EventEmitter=h,h.prototype._events=void 0,h.prototype._eventsCount=0,h.prototype._maxListeners=void 0;var b=10;function x(y){if(typeof y!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof y)}Object.defineProperty(h,"defaultMaxListeners",{enumerable:!0,get:function(){return b},set:function(y){if(typeof y!="number"||y<0||d(y))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+y+".");b=y}}),h.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},h.prototype.setMaxListeners=function(g){if(typeof g!="number"||g<0||d(g))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+g+".");return this._maxListeners=g,this};function E(y){return y._maxListeners===void 0?h.defaultMaxListeners:y._maxListeners}h.prototype.getMaxListeners=function(){return E(this)},h.prototype.emit=function(g){for(var v=[],T=1;T<arguments.length;T++)v.push(arguments[T]);var m=g==="error",f=this._events;if(f!==void 0)m=m&&f.error===void 0;else if(!m)return!1;if(m){var u;if(v.length>0&&(u=v[0]),u instanceof Error)throw u;var p=new Error("Unhandled error."+(u?" ("+u.message+")":""));throw p.context=u,p}var _=f[g];if(_===void 0)return!1;if(typeof _=="function")s(_,this,v);else for(var w=_.length,R=O(_,w),T=0;T<w;++T)s(R[T],this,v);return!0};function I(y,g,v,T){var m,f,u;if(x(v),f=y._events,f===void 0?(f=y._events=Object.create(null),y._eventsCount=0):(f.newListener!==void 0&&(y.emit("newListener",g,v.listener?v.listener:v),f=y._events),u=f[g]),u===void 0)u=f[g]=v,++y._eventsCount;else if(typeof u=="function"?u=f[g]=T?[v,u]:[u,v]:T?u.unshift(v):u.push(v),m=E(y),m>0&&u.length>m&&!u.warned){u.warned=!0;var p=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+String(g)+" listeners added. Use emitter.setMaxListeners() to increase limit");p.name="MaxListenersExceededWarning",p.emitter=y,p.type=g,p.count=u.length,c(p)}return y}h.prototype.addListener=function(g,v){return I(this,g,v,!1)},h.prototype.on=h.prototype.addListener,h.prototype.prependListener=function(g,v){return I(this,g,v,!0)};function S(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function P(y,g,v){var T={fired:!1,wrapFn:void 0,target:y,type:g,listener:v},m=S.bind(T);return m.listener=v,T.wrapFn=m,m}h.prototype.once=function(g,v){return x(v),this.on(g,P(this,g,v)),this},h.prototype.prependOnceListener=function(g,v){return x(v),this.prependListener(g,P(this,g,v)),this},h.prototype.removeListener=function(g,v){var T,m,f,u,p;if(x(v),m=this._events,m===void 0)return this;if(T=m[g],T===void 0)return this;if(T===v||T.listener===v)--this._eventsCount===0?this._events=Object.create(null):(delete m[g],m.removeListener&&this.emit("removeListener",g,T.listener||v));else if(typeof T!="function"){for(f=-1,u=T.length-1;u>=0;u--)if(T[u]===v||T[u].listener===v){p=T[u].listener,f=u;break}if(f<0)return this;f===0?T.shift():U(T,f),T.length===1&&(m[g]=T[0]),m.removeListener!==void 0&&this.emit("removeListener",g,p||v)}return this},h.prototype.off=h.prototype.removeListener,h.prototype.removeAllListeners=function(g){var v,T,m;if(T=this._events,T===void 0)return this;if(T.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):T[g]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete T[g]),this;if(arguments.length===0){var f=Object.keys(T),u;for(m=0;m<f.length;++m)u=f[m],u!=="removeListener"&&this.removeAllListeners(u);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(v=T[g],typeof v=="function")this.removeListener(g,v);else if(v!==void 0)for(m=v.length-1;m>=0;m--)this.removeListener(g,v[m]);return this};function A(y,g,v){var T=y._events;if(T===void 0)return[];var m=T[g];return m===void 0?[]:typeof m=="function"?v?[m.listener||m]:[m]:v?q(m):O(m,m.length)}h.prototype.listeners=function(g){return A(this,g,!0)},h.prototype.rawListeners=function(g){return A(this,g,!1)},h.listenerCount=function(y,g){return typeof y.listenerCount=="function"?y.listenerCount(g):L.call(y,g)},h.prototype.listenerCount=L;function L(y){var g=this._events;if(g!==void 0){var v=g[y];if(typeof v=="function")return 1;if(v!==void 0)return v.length}return 0}h.prototype.eventNames=function(){return this._eventsCount>0?l(this._events):[]};function O(y,g){for(var v=new Array(g),T=0;T<g;++T)v[T]=y[T];return v}function U(y,g){for(;g+1<y.length;g++)y[g]=y[g+1];y.pop()}function q(y){for(var g=new Array(y.length),v=0;v<g.length;++v)g[v]=y[v].listener||y[v];return g}function F(y,g){return new Promise(function(v,T){function m(u){y.removeListener(g,f),T(u)}function f(){typeof y.removeListener=="function"&&y.removeListener("error",m),v([].slice.call(arguments))}D(y,g,f,{once:!0}),g!=="error"&&G(y,m,{once:!0})})}function G(y,g,v){typeof y.on=="function"&&D(y,"error",g,v)}function D(y,g,v,T){if(typeof y.on=="function")T.once?y.once(g,v):y.on(g,v);else if(typeof y.addEventListener=="function")y.addEventListener(g,function m(f){T.once&&y.removeEventListener(g,m),v(f)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof y)}}},e={};function t(i){var o=e[i];if(o!==void 0)return o.exports;var s=e[i]={exports:{}};return r[i](s,s.exports,t),s.exports}(function(){t.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}()})();var n=t(579);return n}()})});var Ga=Za(si());var fi=Symbol("Comlink.proxy"),ef=Symbol("Comlink.endpoint"),tf=Symbol("Comlink.releaseProxy"),Kr=Symbol("Comlink.thrown"),li=r=>typeof r=="object"&&r!==null||typeof r=="function",rf={canHandle:r=>li(r)&&r[fi],serialize(r){let{port1:e,port2:t}=new MessageChannel;return er(r,e),[t,[t]]},deserialize(r){return r.start(),en(r)}},nf={canHandle:r=>li(r)&&Kr in r,serialize({value:r}){let e;return r instanceof Error?e={isError:!0,value:{message:r.message,name:r.name,stack:r.stack}}:e={isError:!1,value:r},[e,[]]},deserialize(r){throw r.isError?Object.assign(new Error(r.value.message),r.value):r.value}},ui=new Map([["proxy",rf],["throw",nf]]);function er(r,e=self){e.addEventListener("message",function t(n){if(!n||!n.data)return;let{id:i,type:o,path:s}=Object.assign({path:[]},n.data),l=(n.data.argumentList||[]).map(De),c;try{let d=s.slice(0,-1).reduce((b,x)=>b[x],r),h=s.reduce((b,x)=>b[x],r);switch(o){case"GET":c=h;break;case"SET":d[s.slice(-1)[0]]=De(n.data.value),c=!0;break;case"APPLY":c=h.apply(d,l);break;case"CONSTRUCT":{let b=new h(...l);c=ff(b)}break;case"ENDPOINT":{let{port1:b,port2:x}=new MessageChannel;er(r,x),c=af(b,[b])}break;case"RELEASE":c=void 0;break;default:return}}catch(d){c={value:d,[Kr]:0}}Promise.resolve(c).catch(d=>({value:d,[Kr]:0})).then(d=>{let[h,b]=tn(d);e.postMessage(Object.assign(Object.assign({},h),{id:i}),b),o==="RELEASE"&&(e.removeEventListener("message",t),ci(e))})}),e.start&&e.start()}function of(r){return r.constructor.name==="MessagePort"}function ci(r){of(r)&&r.close()}function en(r,e){return Zr(r,[],e)}function Zt(r){if(r)throw new Error("Proxy has been released and is not useable")}function Zr(r,e=[],t=function(){}){let n=!1,i=new Proxy(t,{get(o,s){if(Zt(n),s===tf)return()=>et(r,{type:"RELEASE",path:e.map(l=>l.toString())}).then(()=>{ci(r),n=!0});if(s==="then"){if(e.length===0)return{then:()=>i};let l=et(r,{type:"GET",path:e.map(c=>c.toString())}).then(De);return l.then.bind(l)}return Zr(r,[...e,s])},set(o,s,l){Zt(n);let[c,d]=tn(l);return et(r,{type:"SET",path:[...e,s].map(h=>h.toString()),value:c},d).then(De)},apply(o,s,l){Zt(n);let c=e[e.length-1];if(c===ef)return et(r,{type:"ENDPOINT"}).then(De);if(c==="bind")return Zr(r,e.slice(0,-1));let[d,h]=ai(l);return et(r,{type:"APPLY",path:e.map(b=>b.toString()),argumentList:d},h).then(De)},construct(o,s){Zt(n);let[l,c]=ai(s);return et(r,{type:"CONSTRUCT",path:e.map(d=>d.toString()),argumentList:l},c).then(De)}});return i}function sf(r){return Array.prototype.concat.apply([],r)}function ai(r){let e=r.map(tn);return[e.map(t=>t[0]),sf(e.map(t=>t[1]))]}var hi=new WeakMap;function af(r,e){return hi.set(r,e),r}function ff(r){return Object.assign(r,{[fi]:!0})}function tn(r){for(let[e,t]of ui)if(t.canHandle(r)){let[n,i]=t.serialize(r);return[{type:"HANDLER",name:e,value:n},i]}return[{type:"RAW",value:r},hi.get(r)||[]]}function De(r){switch(r.type){case"HANDLER":return ui.get(r.name).deserialize(r.value);case"RAW":return r.value}}function et(r,e,t){return new Promise(n=>{let i=lf();r.addEventListener("message",function o(s){!s.data||!s.data.id||s.data.id!==i||(r.removeEventListener("message",o),n(s.data))}),r.start&&r.start(),r.postMessage(Object.assign({id:i},e),t)})}function lf(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var Rt=en(self),C;function pi(r){C=r}var uf={CCW:-1,CW:1,NOT_ORIENTABLE:0},cf=2*Math.PI,kt=1,wi=0,le=2,hf=3,df=4,pf=1,mf=2,mn=0,ir=1,tt=2,or=Object.freeze({CCW:!0,CW:!1,ORIENTATION:uf,PIx2:cf,INSIDE:kt,OUTSIDE:wi,BOUNDARY:le,CONTAINS:hf,INTERLACE:df,OVERLAP_SAME:pf,OVERLAP_OPPOSITE:mf,NOT_VERTEX:mn,START_VERTEX:ir,END_VERTEX:tt}),he=1e-6;function Si(r){he=r}function Ii(){return he}var _f=3;function sn(r){return r<he&&r>-he}function qe(r,e){return r-e<he&&r-e>-he}function Pi(r,e){return r-e>he}function gf(r,e){return r-e>-he}function Oi(r,e){return r-e<-he}function bf(r,e){return r-e<he}var vf=Object.freeze({setTolerance:Si,getTolerance:Ii,DECIMALS:_f,EQ_0:sn,EQ:qe,GT:Pi,GE:gf,LT:Oi,LE:bf}),sr=class{static get ILLEGAL_PARAMETERS(){return new ReferenceError("Illegal Parameters")}static get ZERO_DIVISION(){return new Error("Zero division")}static get UNRESOLVED_BOUNDARY_CONFLICT(){return new Error("Unresolved boundary conflict in boolean operation")}static get INFINITE_LOOP(){return new Error("Infinite loop")}};var a={Utils:vf,Errors:sr,Matrix:void 0,Planar_set:void 0,Point:void 0,Vector:void 0,Line:void 0,Circle:void 0,Segment:void 0,Arc:void 0,Box:void 0,Edge:void 0,Face:void 0,Ray:void 0,Ray_shooting:void 0,Multiline:void 0,Polygon:void 0,Distance:void 0,Inversion:void 0};for(let r in or)a[r]=or[r];Object.defineProperty(a,"DP_TOL",{get:function(){return Ii()},set:function(r){Si(r)}});var ar=class{constructor(e,t){this.first=e,this.last=t||this.first}static testInfiniteLoop(e){let t=e,n=e;do{if(t!=e&&t===n)throw a.Errors.INFINITE_LOOP;t=t.next,n=n.next.next}while(t!=e)}get size(){let e=0;for(let t of this)e++;return e}toArray(e=void 0,t=void 0){let n=[],i=e||this.first,o=t||this.last,s=i;if(s===void 0)return n;do n.push(s),s=s.next;while(s!==o.next);return n}append(e){return this.isEmpty()?this.first=e:(e.prev=this.last,this.last.next=e),this.last=e,this.last.next=void 0,this.first.prev=void 0,this}insert(e,t){if(this.isEmpty())this.first=e,this.last=e;else if(t==null)e.next=this.first,this.first.prev=e,this.first=e;else{let n=t.next;t.next=e,n&&(n.prev=e),e.prev=t,e.next=n,this.last===t&&(this.last=e)}return this.last.next=void 0,this.first.prev=void 0,this}remove(e){return e===this.first&&e===this.last?(this.first=void 0,this.last=void 0):(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e===this.first&&(this.first=e.next),e===this.last&&(this.last=e.prev)),this}isEmpty(){return this.first===void 0}[Symbol.iterator](){let e;return{next:()=>(e=e?e.next:this.first,{value:e,done:e===void 0})}}};function it(r,e,t){let n=t.length,i=r.shape.split(e);if(i.length===0)return;let o=0;i[0]===null?o=0:i[1]===null?o=r.shape.length:o=i[0].length;let s=mn;qe(o,0)&&(s|=ir),qe(o,r.shape.length)&&(s|=tt);let l=s&tt&&r.next.arc_length===0?0:r.arc_length+o;t.push({id:n,pt:e,arc_length:l,edge_before:r,edge_after:void 0,face:r.face,is_vertex:s})}function Mt(r){r.int_points1_sorted=Lt(r.int_points1),r.int_points2_sorted=Lt(r.int_points2)}function Lt(r){let e=new Map,t=0;for(let i of r)e.has(i.face)||(e.set(i.face,t),t++);for(let i of r)i.faceId=e.get(i.face);return r.slice().sort(xf)}function xf(r,e){return r.faceId<e.faceId?-1:r.faceId>e.faceId?1:r.arc_length<e.arc_length?-1:r.arc_length>e.arc_length?1:0}function rn(r,e){return e.slice().sort((t,n)=>r.coord(t.pt)<r.coord(n.pt)?-1:r.coord(t.pt)>r.coord(n.pt)?1:0)}function _n(r){if(r.int_points1.length<2)return;let e=!1,t,n,i,o;for(let s=0;s<r.int_points1_sorted.length;s++)if(r.int_points1_sorted[s].id!==-1){t=r.int_points1_sorted[s],n=r.int_points2[t.id];for(let l=s+1;l<r.int_points1_sorted.length&&(i=r.int_points1_sorted[l],!!qe(i.arc_length,t.arc_length));l++)i.id!==-1&&(o=r.int_points2[i.id],o.id!==-1&&i.edge_before===t.edge_before&&i.edge_after===t.edge_after&&o.edge_before===n.edge_before&&o.edge_after===n.edge_after&&(i.id=-1,o.id=-1,e=!0))}n=r.int_points2_sorted[0],t=r.int_points1[n.id];for(let s=1;s<r.int_points2_sorted.length;s++){let l=r.int_points2_sorted[s];if(l.id==-1)continue;if(n.id==-1||!qe(l.arc_length,n.arc_length)){n=l,t=r.int_points1[n.id];continue}let c=r.int_points1[l.id];c.edge_before===t.edge_before&&c.edge_after===t.edge_after&&l.edge_before===n.edge_before&&l.edge_after===n.edge_after&&(c.id=-1,l.id=-1,e=!0)}e&&(r.int_points1=r.int_points1.filter(s=>s.id>=0),r.int_points2=r.int_points2.filter(s=>s.id>=0),r.int_points1.forEach((s,l)=>s.id=l),r.int_points2.forEach((s,l)=>s.id=l))}function an(r){for(let e of r)e.edge_before.bvStart=void 0,e.edge_before.bvEnd=void 0,e.edge_before.bv=void 0,e.edge_before.overlap=void 0,e.edge_after.bvStart=void 0,e.edge_after.bvEnd=void 0,e.edge_after.bv=void 0,e.edge_after.overlap=void 0;for(let e of r)e.edge_before.bvEnd=le,e.edge_after.bvStart=le}function fn(r,e){for(let t of r)t.edge_before.setInclusion(e),t.edge_after.setInclusion(e)}function yf(r){let e,t,n,i=r.int_points1.length;for(let o=0;o<i;o++){let s=r.int_points1_sorted[o];s.face!==e&&(t=o,e=s.face);let l=o,c=ot(r.int_points1_sorted,o,e),d;l+c<i&&r.int_points1_sorted[l+c].face===e?d=l+c:d=t;let h=ot(r.int_points1_sorted,d,e);n=null;for(let A=d;A<d+h;A++){let L=r.int_points1_sorted[A];if(L.face===e&&r.int_points2[L.id].face===r.int_points2[s.id].face){n=L;break}}if(n===null)continue;let b=s.edge_after,x=n.edge_before;if(!(b.bv===le&&x.bv===le)||b!==x)continue;let E=r.int_points2[s.id],I=r.int_points2[n.id],S=E.edge_after,P=I.edge_before;S.bv===le&&P.bv===le&&S===P||(E=r.int_points2[n.id],I=r.int_points2[s.id],S=E.edge_after,P=I.edge_before),S.bv===le&&P.bv===le&&S===P&&b.setOverlap(S)}}function ot(r,e,t){let n,i,o=1;if(r.length==1)return 1;n=r[e];for(let s=e+1;s<r.length&&!(n.face!=t||(i=r[s],!(i.pt.equalTo(n.pt)&&i.edge_before===n.edge_before&&i.edge_after===n.edge_after)));s++)o++;return o}function st(r,e){if(!!e){for(let t of e){let n=t.edge_before;if(t.is_vertex=mn,n.shape.start&&n.shape.start.equalTo(t.pt)&&(t.is_vertex|=ir),n.shape.end&&n.shape.end.equalTo(t.pt)&&(t.is_vertex|=tt),t.is_vertex&ir){t.edge_before=n.prev,t.is_vertex=tt;continue}if(t.is_vertex&tt)continue;let i=r.addVertex(t.pt,n);t.edge_before=i}for(let t of e)t.edge_after=t.edge_before.next}}function mi(r,e,t){let n=r.edge_before,i=e.edge_after;n.next=t,t.prev=n,t.next=i,i.prev=t}var{INSIDE:ue,OUTSIDE:ce,BOUNDARY:J,OVERLAP_SAME:Tf,OVERLAP_OPPOSITE:Ef}=or,{NOT_VERTEX:$p,START_VERTEX:_i,END_VERTEX:gi}=or,fr=1,Ut=2,We=3;function wf(r,e){let[t,n]=Dt(r,e,fr,!0);return t}function ln(r,e){let n=e.clone().reverse(),[i,o]=Dt(r,n,We,!0);return i}function Ci(r,e){let[t,n]=Dt(r,e,Ut,!0);return t}function Ai(r,e){let[t,n]=Dt(r,e,Ut,!1),i=[];for(let s of t.faces)i=[...i,...[...s.edges].map(l=>l.shape)];let o=[];for(let s of n.faces)o=[...o,...[...s.edges].map(l=>l.shape)];return[i,o]}function un(r,e){let[t,n]=Dt(r,e,We,!1),i=[];for(let o of t.faces)i=[...i,...[...o.edges].map(s=>s.shape)];return i}function Ri(r,e){let t=r.clone(),n=e.clone(),i=ki(t,n);Mt(i),st(t,i.int_points1_sorted),st(n,i.int_points2_sorted),_n(i),Mt(i);let o=i.int_points1_sorted.map(l=>l.pt),s=i.int_points2_sorted.map(l=>l.pt);return[o,s]}function Sf(r,e,t,n){let i=bi(r,t.int_points1),o=bi(e,t.int_points2);for(vi(i,e),vi(o,r),an(t.int_points1),an(t.int_points2),fn(t.int_points1,e),fn(t.int_points2,r);Pf(r,e,t.int_points1,t.int_points1_sorted,t.int_points2,t););yf(t),cn(r,n,t.int_points1_sorted,!0),cn(e,n,t.int_points2_sorted,!1),xi(r,i,n,!0),xi(e,o,n,!1)}function If(r,e,t,n){Of(r,e,n,t.int_points2),Cf(r,e,t),hn(r,t.int_points1),hn(e,t.int_points2),dn(r,t.int_points1,t.int_points2),dn(r,t.int_points2,t.int_points1)}function Dt(r,e,t,n){let i=r.clone(),o=e.clone(),s=ki(i,o);return Mt(s),st(i,s.int_points1_sorted),st(o,s.int_points2_sorted),_n(s),Mt(s),Sf(i,o,s,t),n&&If(i,o,s,t),[i,o]}function ki(r,e){let t={int_points1:[],int_points2:[]};for(let n of r.edges){let i=e.edges.search(n.box);for(let o of i){let s=n.shape.intersect(o.shape);for(let l of s)it(n,l,t.int_points1),it(o,l,t.int_points2)}}return t}function bi(r,e){let t=[];for(let n of r.faces)e.find(i=>i.face===n)||t.push(n);return t}function vi(r,e){for(let t of r)t.first.bv=t.first.bvStart=t.first.bvEnd=void 0,t.first.setInclusion(e)}function Pf(r,e,t,n,i,o){let s,l,c,d=n.length,h=!1;for(let b=0;b<d;b++){let x=n[b];x.face!==s&&(l=b,s=x.face);let E=b,I=ot(n,b,s),S;E+I<d&&n[E+I].face===s?S=E+I:S=l;let P=ot(n,S,s);c=null;for(let O=S;O<S+P;O++){let U=n[O];if(U.face===s&&i[U.id].face===i[x.id].face){c=U;break}}if(c===null)continue;let A=x.edge_after,L=c.edge_before;if(A.bv===J&&L.bv!=J){A.bv=L.bv;continue}if(A.bv!=J&&L.bv===J){L.bv=A.bv;continue}if(A.bv===J&&L.bv===J&&A!=L||A.bv===ue&&L.bv===ce||A.bv===ce&&L.bv===ue){let O=A.next;for(;O!=L;)O.bvStart=void 0,O.bvEnd=void 0,O.bv=void 0,O.setInclusion(e),O=O.next}if(A.bv===J&&L.bv===J&&A!=L){let O=A.next,U;for(;O!=L;){if(O.bv!=J){if(U===void 0)U=O.bv;else if(O.bv!=U)throw sr.UNRESOLVED_BOUNDARY_CONFLICT}O=O.next}U!=null&&(A.bv=U,L.bv=U);continue}if(A.bv===ue&&L.bv===ce||A.bv===ce&&L.bv===ue){let O=A;for(;O!=L;){if(O.bvStart===A.bv&&O.bvEnd===L.bv){let[U,q]=O.shape.distanceTo(e);if(U<10*a.DP_TOL){it(O,q.ps,t);let F=t[t.length-1];if(F.is_vertex&_i)F.edge_after=O,F.edge_before=O.prev,O.bvStart=J,O.bv=void 0,O.setInclusion(e);else if(F.is_vertex&gi)F.edge_after=O.next,O.bvEnd=J,O.bv=void 0,O.setInclusion(e);else{let y=e.addVertex(F.pt,O);F.edge_before=y,F.edge_after=y.next,y.setInclusion(e),y.next.bvStart=J,y.next.bvEnd=void 0,y.next.bv=void 0,y.next.setInclusion(e)}let G=e.findEdgeByPoint(q.pe);it(G,q.pe,i);let D=i[i.length-1];if(D.is_vertex&_i)D.edge_after=G,D.edge_before=G.prev;else if(D.is_vertex&gi)D.edge_after=G.next;else{let y=i.find(v=>v.edge_after===G),g=e.addVertex(D.pt,G);D.edge_before=g,D.edge_after=g.next,y&&(y.edge_after=g),g.bvStart=void 0,g.bvEnd=J,g.bv=void 0,g.setInclusion(r),g.next.bvStart=J,g.next.bvEnd=void 0,g.next.bv=void 0,g.next.setInclusion(r)}Mt(o),h=!0;break}}O=O.next}if(h)break;throw sr.UNRESOLVED_BOUNDARY_CONFLICT}}return h}function cn(r,e,t,n){if(!t)return;let i,o,s,l;for(let c=0;c<t.length;c++){if(s=t[c],s.face!==i&&(o=c,i=s.face),i.isEmpty())continue;let d=c,h=ot(t,c,i),b;d+h<t.length&&t[d+h].face===s.face?b=d+h:b=o,l=t[b];let x=b,E=ot(t,x,i),I=s.edge_after,S=l.edge_before;if(I.bv===ue&&S.bv===ue&&e===fr||I.bv===ce&&S.bv===ce&&e===Ut||(I.bv===ce||S.bv===ce)&&e===We&&!n||(I.bv===ue||S.bv===ue)&&e===We&&n||I.bv===J&&S.bv===J&&I.overlap&Tf&&n||I.bv===J&&S.bv===J&&I.overlap&Ef){r.removeChain(i,I,S);for(let P=d;P<d+h;P++)t[P].edge_after=void 0;for(let P=x;P<x+E;P++)t[P].edge_before=void 0}c+=h-1}}function Of(r,e,t,n){for(let i of e.faces){for(let o of i)r.edges.add(o);n.find(o=>o.face===i)===void 0&&r.addFace(i.first,i.last)}}function Cf(r,e,t){if(t.int_points1.length!==0)for(let n=0;n<t.int_points1.length;n++){let i=t.int_points1[n],o=t.int_points2[n];if(i.edge_before!==void 0&&i.edge_after===void 0&&o.edge_before===void 0&&o.edge_after!==void 0&&(i.edge_before.next=o.edge_after,o.edge_after.prev=i.edge_before,i.edge_after=o.edge_after,o.edge_before=i.edge_before),o.edge_before!==void 0&&o.edge_after===void 0&&i.edge_before===void 0&&i.edge_after!==void 0&&(o.edge_before.next=i.edge_after,i.edge_after.prev=o.edge_before,o.edge_after=i.edge_after,i.edge_before=o.edge_before),i.edge_before!==void 0&&i.edge_after===void 0)for(let s of t.int_points1_sorted)s!==i&&s.edge_before===void 0&&s.edge_after!==void 0&&s.pt.equalTo(i.pt)&&(i.edge_before.next=s.edge_after,s.edge_after.prev=i.edge_before,i.edge_after=s.edge_after,s.edge_before=i.edge_before);if(o.edge_before!==void 0&&o.edge_after===void 0)for(let s of t.int_points2_sorted)s!==o&&s.edge_before===void 0&&s.edge_after!==void 0&&s.pt.equalTo(o.pt)&&(o.edge_before.next=s.edge_after,s.edge_after.prev=o.edge_before,o.edge_after=s.edge_after,s.edge_before=o.edge_before)}}function hn(r,e){for(let t of e)r.faces.delete(t.face),t.face=void 0,t.edge_before&&(t.edge_before.face=void 0),t.edge_after&&(t.edge_after.face=void 0)}function dn(r,e,t){for(let n of e){if(n.edge_before===void 0||n.edge_after===void 0||n.face||n.edge_after.face||n.edge_before.face)continue;let i=n.edge_after,o=n.edge_before;ar.testInfiniteLoop(i);let s=r.addFace(i,o);for(let l of e)l.edge_before&&l.edge_after&&l.edge_before.face===s&&l.edge_after.face===s&&(l.face=s);for(let l of t)l.edge_before&&l.edge_after&&l.edge_before.face===s&&l.edge_after.face===s&&(l.face=s)}}function xi(r,e,t,n){for(let i of e){let o=i.first.bv;(t===fr&&o===ue||t===We&&o===ue&&n||t===We&&o===ce&&!n||t===Ut&&o===ce)&&r.deleteFace(i)}}var Af=Object.freeze({BOOLEAN_UNION:fr,BOOLEAN_INTERSECT:Ut,BOOLEAN_SUBTRACT:We,unify:wf,subtract:ln,intersect:Ci,innerClip:Ai,outerClip:un,calculateIntersections:Ri,removeNotRelevantChains:cn,removeOldFaces:hn,restoreFaces:dn}),Rf=RegExp("T.F..FFF.|T.F...F.."),kf=RegExp("T........|.T.......|...T.....|....T...."),Lf=RegExp("FT.......|F..T.....|F...T...."),Nf=RegExp("T.F..F..."),Mf=RegExp("T.F..F...|.TF..F...|..FT.F...|..F.TF..."),He=class{constructor(){this.m=new Array(9).fill(void 0)}get I2I(){return this.m[0]}set I2I(e){this.m[0]=e}get I2B(){return this.m[1]}set I2B(e){this.m[1]=e}get I2E(){return this.m[2]}set I2E(e){this.m[2]=e}get B2I(){return this.m[3]}set B2I(e){this.m[3]=e}get B2B(){return this.m[4]}set B2B(e){this.m[4]=e}get B2E(){return this.m[5]}set B2E(e){this.m[5]=e}get E2I(){return this.m[6]}set E2I(e){this.m[6]=e}get E2B(){return this.m[7]}set E2B(e){this.m[7]=e}get E2E(){return this.m[8]}set E2E(e){this.m[8]=e}toString(){return this.m.map(e=>e instanceof Array&&e.length>0?"T":e instanceof Array&&e.length===0?"F":"*").join("")}equal(){return Rf.test(this.toString())}intersect(){return kf.test(this.toString())}touch(){return Lf.test(this.toString())}inside(){return Nf.test(this.toString())}covered(){return Mf.test(this.toString())}};function lr(r,e){let t=[],[n,i,o]=r.standard,[s,l,c]=e.standard,d=n*l-i*s,h=o*l-i*c,b=n*c-o*s;if(!a.Utils.EQ_0(d)){let x,E;i===0?(x=o/n,E=b/d):l===0?(x=c/s,E=b/d):n===0?(x=h/d,E=o/i):s===0?(x=h/d,E=c/l):(x=h/d,E=b/d),t.push(new a.Point(x,E))}return t}function ft(r,e){let t=[],n=e.pc.projectionOn(r),i=e.pc.distanceTo(n)[0];if(a.Utils.EQ(i,e.r))t.push(n);else if(a.Utils.LT(i,e.r)){let o=Math.sqrt(e.r*e.r-i*i),s,l;s=r.norm.rotate90CCW().multiply(o),l=n.translate(s),t.push(l),s=r.norm.rotate90CW().multiply(o),l=n.translate(s),t.push(l)}return t}function Bt(r,e){let t=[];for(let n of e.toSegments()){let i=ur(n,r);for(let o of i)Bi(o,t)||t.push(o)}return t}function gn(r,e){let t=[];if(Bt(r,e.box).length===0)return t;let n=new a.Circle(e.pc,e.r),i=ft(r,n);for(let o of i)o.on(e)&&t.push(o);return t}function ur(r,e){let t=[];if(r.ps.on(e)&&t.push(r.ps),r.pe.on(e)&&!r.isZeroLength()&&t.push(r.pe),t.length>0||r.isZeroLength()||r.ps.leftTo(e)&&r.pe.leftTo(e)||!r.ps.leftTo(e)&&!r.pe.leftTo(e))return t;let n=new a.Line(r.ps,r.pe);return lr(n,e)}function Gt(r,e){let t=[];if(r.box.not_intersect(e.box))return t;if(r.isZeroLength())return r.ps.on(e)&&t.push(r.ps),t;if(e.isZeroLength())return e.ps.on(r)&&t.push(e.ps),t;let n=new a.Line(r.ps,r.pe),i=new a.Line(e.ps,e.pe);if(n.incidentTo(i))r.ps.on(e)&&t.push(r.ps),r.pe.on(e)&&t.push(r.pe),e.ps.on(r)&&!e.ps.equalTo(r.ps)&&!e.ps.equalTo(r.pe)&&t.push(e.ps),e.pe.on(r)&&!e.pe.equalTo(r.ps)&&!e.pe.equalTo(r.pe)&&t.push(e.pe);else{let o=lr(n,i);o.length>0&&o[0].on(r)&&o[0].on(e)&&t.push(o[0])}return t}function cr(r,e){let t=[];if(r.box.not_intersect(e.box))return t;if(r.isZeroLength()){let[o,s]=r.ps.distanceTo(e.pc);return a.Utils.EQ(o,e.r)&&t.push(r.ps),t}let n=new a.Line(r.ps,r.pe),i=ft(n,e);for(let o of i)o.on(r)&&t.push(o);return t}function $e(r,e){let t=[];if(r.box.not_intersect(e.box))return t;if(r.isZeroLength())return r.ps.on(e)&&t.push(r.ps),t;let n=new a.Line(r.ps,r.pe),i=new a.Circle(e.pc,e.r),o=ft(n,i);for(let s of o)s.on(r)&&s.on(e)&&t.push(s);return t}function Bf(r,e){let t=[];for(let n of e.toSegments()){let i=Gt(n,r);for(let o of i)t.push(o)}return t}function Li(r,e){let t=[];if(r.box.not_intersect(e.box))return t;let n=new a.Vector(r.pc,e.pc),i=r.r,o=e.r;if(a.Utils.EQ_0(i)||a.Utils.EQ_0(o))return t;if(a.Utils.EQ_0(n.x)&&a.Utils.EQ_0(n.y)&&a.Utils.EQ(i,o))return t.push(r.pc.translate(-i,0)),t;let s=r.pc.distanceTo(e.pc)[0];if(a.Utils.GT(s,i+o)||a.Utils.LT(s,Math.abs(i-o)))return t;n.x/=s,n.y/=s;let l;if(a.Utils.EQ(s,i+o)||a.Utils.EQ(s,Math.abs(i-o)))return l=r.pc.translate(i*n.x,i*n.y),t.push(l),t;let c=i*i/(2*s)-o*o/(2*s)+s/2,d=r.pc.translate(c*n.x,c*n.y),h=Math.sqrt(i*i-c*c);return l=d.translate(n.rotate90CCW().multiply(h)),t.push(l),l=d.translate(n.rotate90CW().multiply(h)),t.push(l),t}function Ff(r,e){let t=[];for(let n of e.toSegments()){let i=cr(n,r);for(let o of i)t.push(o)}return t}function bn(r,e){var t=[];if(r.box.not_intersect(e.box))return t;if(r.pc.equalTo(e.pc)&&a.Utils.EQ(r.r,e.r)){let s;return s=r.start,s.on(e)&&t.push(s),s=r.end,s.on(e)&&t.push(s),s=e.start,s.on(r)&&t.push(s),s=e.end,s.on(r)&&t.push(s),t}let n=new a.Circle(r.pc,r.r),i=new a.Circle(e.pc,e.r),o=n.intersect(i);for(let s of o)s.on(r)&&s.on(e)&&t.push(s);return t}function vn(r,e){let t=[];if(r.box.not_intersect(e.box))return t;if(e.pc.equalTo(r.pc)&&a.Utils.EQ(e.r,r.r))return t.push(r.start),t.push(r.end),t;let n=e,i=new a.Circle(r.pc,r.r),o=Li(n,i);for(let s of o)s.on(r)&&t.push(s);return t}function Uf(r,e){let t=[];for(let n of e.toSegments()){let i=$e(n,r);for(let o of i)t.push(o)}return t}function Df(r,e){return r.isSegment()?Gt(r.shape,e):$e(e,r.shape)}function Gf(r,e){return r.isSegment()?$e(r.shape,e):bn(r.shape,e)}function Ni(r,e){return r.isSegment()?ur(r.shape,e):gn(e,r.shape)}function jf(r,e){return r.isSegment()?cr(r.shape,e):vn(r.shape,e)}function xn(r,e){let t=[];for(let n of e.edges)for(let i of Df(n,r))t.push(i);return t}function yn(r,e){let t=[];for(let n of e.edges)for(let i of Gf(n,r))t.push(i);return t}function hr(r,e){let t=[];if(e.isEmpty())return t;for(let n of e.edges)for(let i of Ni(n,r))Bi(i,t)||t.push(i);return r.sortPoints(t)}function Mi(r,e){let t=[];if(e.isEmpty())return t;for(let n of e.edges)for(let i of jf(n,r))t.push(i);return t}function Vf(r,e){let t=r.shape,n=e.shape;return r.isSegment()?e.isSegment()?Gt(t,n):$e(t,n):e.isSegment()?$e(n,t):bn(t,n)}function qf(r,e){let t=[];if(e.isEmpty()||r.shape.box.not_intersect(e.box))return t;let n=e.edges.search(r.shape.box);for(let i of n)for(let o of Vf(r,i))t.push(o);return t}function Wf(r,e){let t=[];if(r.isEmpty()||e.isEmpty()||r.box.not_intersect(e.box))return t;for(let n of r.edges)for(let i of qf(n,e))t.push(i);return t}function $f(r,e){return r instanceof a.Line?hr(r,e):r instanceof a.Segment?xn(r,e):r instanceof a.Arc?yn(r,e):[]}function Bi(r,e){return e.some(t=>t.equalTo(r))}var ie=class extends ar{constructor(...e){super();if(e.length!==0&&e.length==1&&e[0]instanceof Array){let t=e[0];if(t.length==0)return;let n=t.every(i=>i instanceof a.Segment||i instanceof a.Arc||i instanceof a.Ray||i instanceof a.Line);for(let i of t){let o=new a.Edge(i);this.append(o)}}}get edges(){return[...this]}get box(){return this.edges.reduce((e,t)=>e=e.merge(t.box),new a.Box)}get vertices(){let e=this.edges.map(t=>t.start);return e.push(this.last.end),e}clone(){return new ie(this.toShapes())}addVertex(e,t){let n=t.shape.split(e);if(n[0]===null)return t.prev;if(n[1]===null)return t;let i=new a.Edge(n[0]),o=t.prev;return this.insert(i,o),t.shape=n[1],i}split(e){for(let t of e){let n=this.findEdgeByPoint(t);this.addVertex(t,n)}return this}findEdgeByPoint(e){let t;for(let n of this)if(n.shape.contains(e)){t=n;break}return t}translate(e){return new ie(this.edges.map(t=>t.shape.translate(e)))}rotate(e=0,t=new a.Point){return new ie(this.edges.map(n=>n.shape.rotate(e,t)))}transform(e=new a.Matrix){return new ie(this.edges.map(t=>t.shape.transform(e)))}toShapes(){return this.edges.map(e=>e.shape.clone())}toJSON(){return this.edges.map(e=>e.toJSON())}svg(e={}){let{stroke:t,strokeWidth:n,fill:i,fillRule:o,fillOpacity:s,id:l,className:c}=e,d=l&&l.length>0?`id="${l}"`:"",h=c&&c.length>0?`class="${c}"`:"",b=`
<path stroke="${t||"black"}" stroke-width="${n||1}" fill="${i||"none"}" fill-opacity="${s||1}" ${d} ${h} d="`;b+=`
M${this.first.start.x},${this.first.start.y}`;for(let x of this)b+=x.svg();return b+=`" >
</path>`,b}};a.Multiline=ie;var Hf=(...r)=>new a.Multiline(...r);a.multiline=Hf;function Nt(r,e){let t,n=new a.Ray(e),i=new a.Line(n.pt,n.norm),o=new a.Box(n.box.xmin-a.DP_TOL,n.box.ymin-a.DP_TOL,n.box.xmax,n.box.ymax+a.DP_TOL);if(r.box.not_intersect(o))return a.OUTSIDE;let s=r.edges.search(o);if(s.length==0)return a.OUTSIDE;for(let d of s)if(d.shape.contains(e))return a.BOUNDARY;let l=[];for(let d of s)for(let h of n.intersect(d.shape)){if(h.equalTo(e))return a.BOUNDARY;l.push({pt:h,edge:d})}l.sort((d,h)=>Oi(d.pt.x,h.pt.x)?-1:Pi(d.pt.x,h.pt.x)?1:0);let c=0;for(let d=0;d<l.length;d++){let h=l[d];if(h.pt.equalTo(h.edge.shape.start)){if(d>0&&h.pt.equalTo(l[d-1].pt)&&h.edge.prev===l[d-1].edge)continue;let b=h.edge.prev;for(;sn(b.length);)b=b.prev;let x=b.shape.tangentInEnd(),E=h.pt.translate(x),I=h.edge.shape.tangentInStart(),S=h.pt.translate(I),P=E.leftTo(i),A=S.leftTo(i);(P&&!A||!P&&A)&&c++}else if(h.pt.equalTo(h.edge.shape.end)){if(d>0&&h.pt.equalTo(l[d-1].pt)&&h.edge.next===l[d-1].edge)continue;let b=h.edge.next;for(;sn(b.length);)b=b.next;let x=b.shape.tangentInStart(),E=h.pt.translate(x),I=h.edge.shape.tangentInEnd(),S=h.pt.translate(I),P=E.leftTo(i),A=S.leftTo(i);(P&&!A||!P&&A)&&c++}else if(h.edge.shape instanceof a.Segment)c++;else{let b=h.edge.shape.box;qe(h.pt.y,b.ymin)||qe(h.pt.y,b.ymax)||c++}}return t=c%2==1?kt:wi,t}function zf(r,e){return lt(r,e).equal()}function Fi(r,e){return lt(r,e).intersect()}function Jf(r,e){return lt(r,e).touch()}function Yf(r,e){return!Fi(r,e)}function Ui(r,e){return lt(r,e).inside()}function Di(r,e){return lt(r,e).covered()}function Xf(r,e){return Ui(e,r)}function Gi(r,e){return Di(e,r)}function lt(r,e){if(r instanceof a.Line&&e instanceof a.Line)return Qf(r,e);if(r instanceof a.Line&&e instanceof a.Circle)return Kf(r,e);if(r instanceof a.Line&&e instanceof a.Box)return Zf(r,e);if(r instanceof a.Line&&e instanceof a.Polygon)return el(r,e);if((r instanceof a.Segment||r instanceof a.Arc)&&e instanceof a.Polygon)return yi(r,e);if((r instanceof a.Segment||r instanceof a.Arc)&&(e instanceof a.Circle||e instanceof a.Box))return yi(r,new a.Polygon(e));if(r instanceof a.Polygon&&e instanceof a.Polygon)return tr(r,e);if((r instanceof a.Circle||r instanceof a.Box)&&(e instanceof a.Circle||e instanceof a.Box))return tr(new a.Polygon(r),new a.Polygon(e));if((r instanceof a.Circle||r instanceof a.Box)&&e instanceof a.Polygon)return tr(new a.Polygon(r),e);if(r instanceof a.Polygon&&(e instanceof a.Circle||e instanceof a.Box))return tr(r,new a.Polygon(e))}function Qf(r,e){let t=new He,n=lr(r,e);return n.length===0?r.contains(e.pt)&&e.contains(r.pt)?(t.I2I=[r],t.I2E=[],t.E2I=[]):(t.I2I=[],t.I2E=[r],t.E2I=[e]):(t.I2I=n,t.I2E=r.split(n),t.E2I=e.split(n)),t}function Kf(r,e){let t=new He,n=ft(r,e);if(n.length===0)t.I2I=[],t.I2B=[],t.I2E=[r],t.E2I=[e];else if(n.length===1)t.I2I=[],t.I2B=n,t.I2E=r.split(n),t.E2I=[e];else{let i=new ie([r]),o=r.sortPoints(n);i.split(o);let s=i.toShapes();t.I2I=[s[1]],t.I2B=o,t.I2E=[s[0],s[2]],t.E2I=new a.Polygon([e.toArc()]).cut(i)}return t}function Zf(r,e){let t=new He,n=Bt(r,e);if(n.length===0)t.I2I=[],t.I2B=[],t.I2E=[r],t.E2I=[e];else if(n.length===1)t.I2I=[],t.I2B=n,t.I2E=r.split(n),t.E2I=[e];else{let i=new ie([r]),o=r.sortPoints(n);i.split(o);let s=i.toShapes();e.toSegments().some(l=>l.contains(n[0])&&l.contains(n[1]))?(t.I2I=[],t.I2B=[s[1]],t.I2E=[s[0],s[2]],t.E2I=[e]):(t.I2I=[s[1]],t.I2B=o,t.I2E=[s[0],s[2]],t.E2I=new a.Polygon(e.toSegments()).cut(i))}return t}function el(r,e){let t=new He,n=hr(r,e),i=new ie([r]),o=n.length>0?n.slice():r.sortPoints(n);return i.split(o),[...i].forEach(s=>s.setInclusion(e)),t.I2I=[...i].filter(s=>s.bv===a.INSIDE).map(s=>s.shape),t.I2B=[...i].slice(1).map(s=>s.bv===a.BOUNDARY?s.shape:s.shape.start),t.I2E=[...i].filter(s=>s.bv===a.OUTSIDE).map(s=>s.shape),t.E2I=e.cut(i),t}function yi(r,e){let t=new He,n=$f(r,e),i=n.length>0?n.slice():r.sortPoints(n),o=new ie([r]);o.split(i),[...o].forEach(s=>s.setInclusion(e)),t.I2I=[...o].filter(s=>s.bv===a.INSIDE).map(s=>s.shape),t.I2B=[...o].slice(1).map(s=>s.bv===a.BOUNDARY?s.shape:s.shape.start),t.I2E=[...o].filter(s=>s.bv===a.OUTSIDE).map(s=>s.shape),t.B2I=[],t.B2B=[],t.B2E=[];for(let s of[r.start,r.end])switch(Nt(e,s)){case a.INSIDE:t.B2I.push(s);break;case a.BOUNDARY:t.B2B.push(s);break;case a.OUTSIDE:t.B2E.push(s);break;default:break}return t}function tr(r,e){let t=new He,[n,i]=Ri(r,e),o=Ci(r,e),s=ln(r,e),l=ln(e,r),[c,d]=Ai(r,e),h=un(r,e),b=un(e,r);return t.I2I=o.isEmpty()?[]:[o],t.I2B=d,t.I2E=s.isEmpty()?[]:[s],t.B2I=c,t.B2B=n,t.B2E=h,t.E2I=l.isEmpty()?[]:[l],t.E2B=b,t}var tl=Object.freeze({equal:zf,intersect:Fi,touch:Jf,disjoint:Yf,inside:Ui,covered:Di,contain:Xf,cover:Gi,relate:lt}),Pe=class{constructor(e=1,t=0,n=0,i=1,o=0,s=0){this.a=e,this.b=t,this.c=n,this.d=i,this.tx=o,this.ty=s}clone(){return new Pe(this.a,this.b,this.c,this.d,this.tx,this.ty)}transform(e){return[e[0]*this.a+e[1]*this.c+this.tx,e[0]*this.b+e[1]*this.d+this.ty]}multiply(e){return new Pe(this.a*e.a+this.c*e.b,this.b*e.a+this.d*e.b,this.a*e.c+this.c*e.d,this.b*e.c+this.d*e.d,this.a*e.tx+this.c*e.ty+this.tx,this.b*e.tx+this.d*e.ty+this.ty)}translate(...e){let t,n;if(e.length==1&&e[0]instanceof a.Vector)t=e[0].x,n=e[0].y;else if(e.length==2&&typeof e[0]=="number"&&typeof e[1]=="number")t=e[0],n=e[1];else throw a.Errors.ILLEGAL_PARAMETERS;return this.multiply(new Pe(1,0,0,1,t,n))}rotate(e){let t=Math.cos(e),n=Math.sin(e);return this.multiply(new Pe(t,n,-n,t,0,0))}scale(e,t){return this.multiply(new Pe(e,0,0,t,0,0))}equalTo(e){return!(!a.Utils.EQ(this.tx,e.tx)||!a.Utils.EQ(this.ty,e.ty)||!a.Utils.EQ(this.a,e.a)||!a.Utils.EQ(this.b,e.b)||!a.Utils.EQ(this.c,e.c)||!a.Utils.EQ(this.d,e.d))}};a.Matrix=Pe;var rl=(...r)=>new a.Matrix(...r);a.matrix=rl;var nl=class pn{constructor(e,t){this.low=e,this.high=t}clone(){return new pn(this.low,this.high)}get max(){return this.clone()}less_than(e){return this.low<e.low||this.low==e.low&&this.high<e.high}equal_to(e){return this.low==e.low&&this.high==e.high}intersect(e){return!this.not_intersect(e)}not_intersect(e){return this.high<e.low||e.high<this.low}merge(e){return new pn(this.low===void 0?e.low:Math.min(this.low,e.low),this.high===void 0?e.high:Math.max(this.high,e.high))}output(){return[this.low,this.high]}static comparable_max(e,t){return e.merge(t)}static comparable_less_than(e,t){return e<t}},K=0,V=1,Ge=class{constructor(e=void 0,t=void 0,n=null,i=null,o=null,s=V){this.left=n,this.right=i,this.parent=o,this.color=s,this.item={key:e,value:t},e&&e instanceof Array&&e.length==2&&!Number.isNaN(e[0])&&!Number.isNaN(e[1])&&(this.item.key=new nl(Math.min(e[0],e[1]),Math.max(e[0],e[1]))),this.max=this.item.key?this.item.key.max:void 0}isNil(){return this.item.key===void 0&&this.item.value===void 0&&this.left===null&&this.right===null&&this.color===V}less_than(e){if(this.item.value===this.item.key&&e.item.value===e.item.key)return this.item.key.less_than(e.item.key);{let t=this.item.value&&e.item.value&&this.item.value.less_than?this.item.value.less_than(e.item.value):this.item.value<e.item.value;return this.item.key.less_than(e.item.key)||this.item.key.equal_to(e.item.key)&&t}}equal_to(e){if(this.item.value===this.item.key&&e.item.value===e.item.key)return this.item.key.equal_to(e.item.key);{let t=this.item.value&&e.item.value&&this.item.value.equal_to?this.item.value.equal_to(e.item.value):this.item.value==e.item.value;return this.item.key.equal_to(e.item.key)&&t}}intersect(e){return this.item.key.intersect(e.item.key)}copy_data(e){this.item.key=e.item.key.clone(),this.item.value=e.item.value&&e.item.value.clone?e.item.value.clone():e.item.value}update_max(){if(this.max=this.item.key?this.item.key.max:void 0,this.right&&this.right.max){let e=this.item.key.constructor.comparable_max;this.max=e(this.max,this.right.max)}if(this.left&&this.left.max){let e=this.item.key.constructor.comparable_max;this.max=e(this.max,this.left.max)}}not_intersect_left_subtree(e){let t=this.item.key.constructor.comparable_less_than,n=this.left.max.high!==void 0?this.left.max.high:this.left.max;return t(n,e.item.key.low)}not_intersect_right_subtree(e){let t=this.item.key.constructor.comparable_less_than,n=this.right.max.low!==void 0?this.right.max.low:this.right.item.key.low;return t(e.item.key.high,n)}},at=class{constructor(){this.root=null,this.nil_node=new Ge}get size(){let e=0;return this.tree_walk(this.root,()=>e++),e}get keys(){let e=[];return this.tree_walk(this.root,t=>e.push(t.item.key.output?t.item.key.output():t.item.key)),e}get values(){let e=[];return this.tree_walk(this.root,t=>e.push(t.item.value)),e}get items(){let e=[];return this.tree_walk(this.root,t=>e.push({key:t.item.key.output?t.item.key.output():t.item.key,value:t.item.value})),e}isEmpty(){return this.root==null||this.root==this.nil_node}insert(e,t=e){if(e===void 0)return;let n=new Ge(e,t,this.nil_node,this.nil_node,null,K);return this.tree_insert(n),this.recalc_max(n),n}exist(e,t=e){let n=new Ge(e,t);return!!this.tree_search(this.root,n)}remove(e,t=e){let n=new Ge(e,t),i=this.tree_search(this.root,n);return i&&this.tree_delete(i),i}search(e,t=(n,i)=>n===i?i.output():n){let n=new Ge(e),i=[];return this.tree_search_interval(this.root,n,i),i.map(o=>t(o.item.value,o.item.key))}intersect_any(e){let t=new Ge(e);return this.tree_find_any_interval(this.root,t)}forEach(e){this.tree_walk(this.root,t=>e(t.item.key,t.item.value))}map(e){let t=new at;return this.tree_walk(this.root,n=>t.insert(n.item.key,e(n.item.value,n.item.key))),t}recalc_max(e){let t=e;for(;t.parent!=null;)t.parent.update_max(),t=t.parent}tree_insert(e){let t=this.root,n=null;if(this.root==null||this.root==this.nil_node)this.root=e;else{for(;t!=this.nil_node;)n=t,e.less_than(t)?t=t.left:t=t.right;e.parent=n,e.less_than(n)?n.left=e:n.right=e}this.insert_fixup(e)}insert_fixup(e){let t,n;for(t=e;t!=this.root&&t.parent.color==K;)t.parent==t.parent.parent.left?(n=t.parent.parent.right,n.color==K?(t.parent.color=V,n.color=V,t.parent.parent.color=K,t=t.parent.parent):(t==t.parent.right&&(t=t.parent,this.rotate_left(t)),t.parent.color=V,t.parent.parent.color=K,this.rotate_right(t.parent.parent))):(n=t.parent.parent.left,n.color==K?(t.parent.color=V,n.color=V,t.parent.parent.color=K,t=t.parent.parent):(t==t.parent.left&&(t=t.parent,this.rotate_right(t)),t.parent.color=V,t.parent.parent.color=K,this.rotate_left(t.parent.parent)));this.root.color=V}tree_delete(e){let t,n;e.left==this.nil_node||e.right==this.nil_node?t=e:t=this.tree_successor(e),t.left!=this.nil_node?n=t.left:n=t.right,n.parent=t.parent,t==this.root?this.root=n:(t==t.parent.left?t.parent.left=n:t.parent.right=n,t.parent.update_max()),this.recalc_max(n),t!=e&&(e.copy_data(t),e.update_max(),this.recalc_max(e)),t.color==V&&this.delete_fixup(n)}delete_fixup(e){let t=e,n;for(;t!=this.root&&t.parent!=null&&t.color==V;)t==t.parent.left?(n=t.parent.right,n.color==K&&(n.color=V,t.parent.color=K,this.rotate_left(t.parent),n=t.parent.right),n.left.color==V&&n.right.color==V?(n.color=K,t=t.parent):(n.right.color==V&&(n.color=K,n.left.color=V,this.rotate_right(n),n=t.parent.right),n.color=t.parent.color,t.parent.color=V,n.right.color=V,this.rotate_left(t.parent),t=this.root)):(n=t.parent.left,n.color==K&&(n.color=V,t.parent.color=K,this.rotate_right(t.parent),n=t.parent.left),n.left.color==V&&n.right.color==V?(n.color=K,t=t.parent):(n.left.color==V&&(n.color=K,n.right.color=V,this.rotate_left(n),n=t.parent.left),n.color=t.parent.color,t.parent.color=V,n.left.color=V,this.rotate_right(t.parent),t=this.root));t.color=V}tree_search(e,t){if(!(e==null||e==this.nil_node))return t.equal_to(e)?e:t.less_than(e)?this.tree_search(e.left,t):this.tree_search(e.right,t)}tree_search_interval(e,t,n){e!=null&&e!=this.nil_node&&(e.left!=this.nil_node&&!e.not_intersect_left_subtree(t)&&this.tree_search_interval(e.left,t,n),e.intersect(t)&&n.push(e),e.right!=this.nil_node&&!e.not_intersect_right_subtree(t)&&this.tree_search_interval(e.right,t,n))}tree_find_any_interval(e,t){let n=!1;return e!=null&&e!=this.nil_node&&(e.left!=this.nil_node&&!e.not_intersect_left_subtree(t)&&(n=this.tree_find_any_interval(e.left,t)),n||(n=e.intersect(t)),!n&&e.right!=this.nil_node&&!e.not_intersect_right_subtree(t)&&(n=this.tree_find_any_interval(e.right,t))),n}local_minimum(e){let t=e;for(;t.left!=null&&t.left!=this.nil_node;)t=t.left;return t}local_maximum(e){let t=e;for(;t.right!=null&&t.right!=this.nil_node;)t=t.right;return t}tree_successor(e){let t,n,i;if(e.right!=this.nil_node)t=this.local_minimum(e.right);else{for(n=e,i=e.parent;i!=null&&i.right==n;)n=i,i=i.parent;t=i}return t}rotate_left(e){let t=e.right;e.right=t.left,t.left!=this.nil_node&&(t.left.parent=e),t.parent=e.parent,e==this.root?this.root=t:e==e.parent.left?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t,e!=null&&e!=this.nil_node&&e.update_max(),t=e.parent,t!=null&&t!=this.nil_node&&t.update_max()}rotate_right(e){let t=e.left;e.left=t.right,t.right!=this.nil_node&&(t.right.parent=e),t.parent=e.parent,e==this.root?this.root=t:e==e.parent.left?e.parent.left=t:e.parent.right=t,t.right=e,e.parent=t,e!=null&&e!=this.nil_node&&e.update_max(),t=e.parent,t!=null&&t!=this.nil_node&&t.update_max()}tree_walk(e,t){e!=null&&e!=this.nil_node&&(this.tree_walk(e.left,t),t(e),this.tree_walk(e.right,t))}testRedBlackProperty(){let e=!0;return this.tree_walk(this.root,function(t){t.color==K&&(t.left.color==V&&t.right.color==V||(e=!1))}),e}testBlackHeightProperty(e){let t=0,n=0,i=0;if(e.color==V&&t++,e.left!=this.nil_node?n=this.testBlackHeightProperty(e.left):n=1,e.right!=this.nil_node?i=this.testBlackHeightProperty(e.right):i=1,n!=i)throw new Error("Red-black height property violated");return t+=n,t}},ji=class extends Set{constructor(e){super(e);this.index=new at,this.forEach(t=>this.index.insert(t))}add(e){let t=this.size;if(super.add(e),this.size>t){let n=this.index.insert(e.box,e)}return this}delete(e){let t=super.delete(e);return t&&this.index.remove(e.box,e),t}clear(){super.clear(),this.index=new at}search(e){return this.index.search(e)}hit(e){let t=new a.Box(e.x-1,e.y-1,e.x+1,e.y+1);return this.index.search(t).filter(i=>e.on(i))}svg(){return[...this].reduce((t,n)=>t+n.svg(),"")}};a.PlanarSet=ji;var dr=class{constructor(...e){if(this.x=0,this.y=0,e.length!==0){if(e.length===1&&e[0]instanceof Array&&e[0].length===2){let t=e[0];if(typeof t[0]=="number"&&typeof t[1]=="number"){this.x=t[0],this.y=t[1];return}}if(e.length===1&&e[0]instanceof Object&&e[0].name==="point"){let{x:t,y:n}=e[0];this.x=t,this.y=n;return}if(e.length===2&&typeof e[0]=="number"&&typeof e[1]=="number"){this.x=e[0],this.y=e[1];return}throw a.Errors.ILLEGAL_PARAMETERS}}get box(){return new a.Box(this.x,this.y,this.x,this.y)}clone(){return new a.Point(this.x,this.y)}get vertices(){return[this.clone()]}equalTo(e){return a.Utils.EQ(this.x,e.x)&&a.Utils.EQ(this.y,e.y)}lessThan(e){return!!(a.Utils.LT(this.y,e.y)||a.Utils.EQ(this.y,e.y)&&a.Utils.LT(this.x,e.x))}rotate(e,t={x:0,y:0}){var n=t.x+(this.x-t.x)*Math.cos(e)-(this.y-t.y)*Math.sin(e),i=t.y+(this.x-t.x)*Math.sin(e)+(this.y-t.y)*Math.cos(e);return new a.Point(n,i)}translate(...e){if(e.length==1&&(e[0]instanceof a.Vector||!isNaN(e[0].x)&&!isNaN(e[0].y)))return new a.Point(this.x+e[0].x,this.y+e[0].y);if(e.length==2&&typeof e[0]=="number"&&typeof e[1]=="number")return new a.Point(this.x+e[0],this.y+e[1]);throw a.Errors.ILLEGAL_PARAMETERS}transform(e){return new a.Point(e.transform([this.x,this.y]))}projectionOn(e){if(this.equalTo(e.pt))return this.clone();let t=new a.Vector(this,e.pt);if(a.Utils.EQ_0(t.cross(e.norm)))return e.pt.clone();let n=t.dot(e.norm),i=e.norm.multiply(n);return this.translate(i)}leftTo(e){let t=new a.Vector(e.pt,this);return a.Utils.GT(t.dot(e.norm),0)}distanceTo(e){if(e instanceof dr){let t=e.x-this.x,n=e.y-this.y;return[Math.sqrt(t*t+n*n),new a.Segment(this,e)]}if(e instanceof a.Line)return a.Distance.point2line(this,e);if(e instanceof a.Circle)return a.Distance.point2circle(this,e);if(e instanceof a.Segment)return a.Distance.point2segment(this,e);if(e instanceof a.Arc)return a.Distance.point2arc(this,e);if(e instanceof a.Polygon)return a.Distance.point2polygon(this,e);if(e instanceof a.PlanarSet)return a.Distance.shape2planarSet(this,e)}on(e){if(e instanceof a.Point)return this.equalTo(e);if(e instanceof a.Line)return e.contains(this);if(e instanceof a.Circle)return e.contains(this);if(e instanceof a.Segment)return e.contains(this);if(e instanceof a.Arc)return e.contains(this);if(e instanceof a.Polygon)return e.contains(this)}toJSON(){return Object.assign({},this,{name:"point"})}svg(e={}){let{r:t,stroke:n,strokeWidth:i,fill:o,id:s,className:l}=e,c=s&&s.length>0?`id="${s}"`:"",d=l&&l.length>0?`class="${l}"`:"";return`
<circle cx="${this.x}" cy="${this.y}" r="${t||3}" stroke="${n||"black"}" stroke-width="${i||1}" fill="${o||"red"}" ${c} ${d} />`}};a.Point=dr;var il=(...r)=>new a.Point(...r);a.point=il;var Vi=class{constructor(...e){if(this.x=0,this.y=0,e.length!==0){if(e.length===1&&e[0]instanceof Array&&e[0].length===2){let t=e[0];if(typeof t[0]=="number"&&typeof t[1]=="number"){this.x=t[0],this.y=t[1];return}}if(e.length===1&&e[0]instanceof Object&&e[0].name==="vector"){let{x:t,y:n}=e[0];this.x=t,this.y=n;return}if(e.length===2){let t=e[0],n=e[1];if(typeof t=="number"&&typeof n=="number"){this.x=t,this.y=n;return}if(t instanceof a.Point&&n instanceof a.Point){this.x=n.x-t.x,this.y=n.y-t.y;return}}throw a.Errors.ILLEGAL_PARAMETERS}}clone(){return new a.Vector(this.x,this.y)}get slope(){let e=Math.atan2(this.y,this.x);return e<0&&(e=2*Math.PI+e),e}get length(){return Math.sqrt(this.dot(this))}equalTo(e){return a.Utils.EQ(this.x,e.x)&&a.Utils.EQ(this.y,e.y)}multiply(e){return new a.Vector(e*this.x,e*this.y)}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}normalize(){if(!a.Utils.EQ_0(this.length))return new a.Vector(this.x/this.length,this.y/this.length);throw a.Errors.ZERO_DIVISION}rotate(e){let n=new a.Point(this.x,this.y).rotate(e);return new a.Vector(n.x,n.y)}rotate90CCW(){return new a.Vector(-this.y,this.x)}rotate90CW(){return new a.Vector(this.y,-this.x)}invert(){return new a.Vector(-this.x,-this.y)}add(e){return new a.Vector(this.x+e.x,this.y+e.y)}subtract(e){return new a.Vector(this.x-e.x,this.y-e.y)}angleTo(e){let t=this.normalize(),n=e.normalize(),i=Math.atan2(t.cross(n),t.dot(n));return i<0&&(i+=2*Math.PI),i}projectionOn(e){let t=e.normalize(),n=this.dot(t);return t.multiply(n)}toJSON(){return Object.assign({},this,{name:"vector"})}};a.Vector=Vi;var ol=(...r)=>new a.Vector(...r);a.vector=ol;var rt=class{constructor(...e){if(this.ps=new a.Point,this.pe=new a.Point,e.length!==0){if(e.length===1&&e[0]instanceof Array&&e[0].length===4){let t=e[0];this.ps=new a.Point(t[0],t[1]),this.pe=new a.Point(t[2],t[3]);return}if(e.length===1&&e[0]instanceof Object&&e[0].name==="segment"){let{ps:t,pe:n}=e[0];this.ps=new a.Point(t.x,t.y),this.pe=new a.Point(n.x,n.y);return}if(e.length===1&&e[0]instanceof a.Point){this.ps=e[0].clone();return}if(e.length===2&&e[0]instanceof a.Point&&e[1]instanceof a.Point){this.ps=e[0].clone(),this.pe=e[1].clone();return}if(e.length===4){this.ps=new a.Point(e[0],e[1]),this.pe=new a.Point(e[2],e[3]);return}throw a.Errors.ILLEGAL_PARAMETERS}}clone(){return new a.Segment(this.start,this.end)}get start(){return this.ps}get end(){return this.pe}get vertices(){return[this.ps.clone(),this.pe.clone()]}get length(){return this.start.distanceTo(this.end)[0]}get slope(){return new a.Vector(this.start,this.end).slope}get box(){return new a.Box(Math.min(this.start.x,this.end.x),Math.min(this.start.y,this.end.y),Math.max(this.start.x,this.end.x),Math.max(this.start.y,this.end.y))}equalTo(e){return this.ps.equalTo(e.ps)&&this.pe.equalTo(e.pe)}contains(e){return a.Utils.EQ_0(this.distanceToPoint(e))}intersect(e){if(e instanceof a.Point)return this.contains(e)?[e]:[];if(e instanceof a.Line)return ur(this,e);if(e instanceof a.Segment)return Gt(this,e);if(e instanceof a.Circle)return cr(this,e);if(e instanceof a.Box)return Bf(this,e);if(e instanceof a.Arc)return $e(this,e);if(e instanceof a.Polygon)return xn(this,e)}distanceTo(e){if(e instanceof a.Point){let[t,n]=a.Distance.point2segment(e,this);return n=n.reverse(),[t,n]}if(e instanceof a.Circle){let[t,n]=a.Distance.segment2circle(this,e);return[t,n]}if(e instanceof a.Line){let[t,n]=a.Distance.segment2line(this,e);return[t,n]}if(e instanceof a.Segment){let[t,n]=a.Distance.segment2segment(this,e);return[t,n]}if(e instanceof a.Arc){let[t,n]=a.Distance.segment2arc(this,e);return[t,n]}if(e instanceof a.Polygon){let[t,n]=a.Distance.shape2polygon(this,e);return[t,n]}if(e instanceof a.PlanarSet){let[t,n]=a.Distance.shape2planarSet(this,e);return[t,n]}}tangentInStart(){return new a.Vector(this.start,this.end).normalize()}tangentInEnd(){return new a.Vector(this.end,this.start).normalize()}reverse(){return new rt(this.end,this.start)}split(e){return this.start.equalTo(e)?[null,this.clone()]:this.end.equalTo(e)?[this.clone(),null]:[new a.Segment(this.start,e),new a.Segment(e,this.end)]}middle(){return new a.Point((this.start.x+this.end.x)/2,(this.start.y+this.end.y)/2)}pointAtLength(e){if(e>this.length||e<0)return null;if(e==0)return this.start;if(e==this.length)return this.end;let t=e/this.length;return new a.Point((this.end.x-this.start.x)*t+this.start.x,(this.end.y-this.start.y)*t+this.start.y)}distanceToPoint(e){let[t,...n]=a.Distance.point2segment(e,this);return t}definiteIntegral(e=0){let t=this.end.x-this.start.x,n=this.start.y-e,i=this.end.y-e;return t*(n+i)/2}translate(...e){return new rt(this.ps.translate(...e),this.pe.translate(...e))}rotate(e=0,t=new a.Point){let n=new a.Matrix;return n=n.translate(t.x,t.y).rotate(e).translate(-t.x,-t.y),this.transform(n)}transform(e=new a.Matrix){return new rt(this.ps.transform(e),this.pe.transform(e))}isZeroLength(){return this.ps.equalTo(this.pe)}sortPoints(e){return new a.Line(this.start,this.end).sortPoints(e)}toJSON(){return Object.assign({},this,{name:"segment"})}svg(e={}){let{stroke:t,strokeWidth:n,id:i,className:o}=e,s=i&&i.length>0?`id="${i}"`:"",l=o&&o.length>0?`class="${o}"`:"";return`
<line x1="${this.start.x}" y1="${this.start.y}" x2="${this.end.x}" y2="${this.end.y}" stroke="${t||"black"}" stroke-width="${n||1}" ${s} ${l} />`}};a.Segment=rt;var sl=(...r)=>new a.Segment(...r);a.segment=sl;var{vector:rr}=a,pr=class{constructor(...e){if(this.pt=new a.Point,this.norm=new a.Vector(0,1),e.length!=0){if(e.length==1&&e[0]instanceof Object&&e[0].name==="line"){let{pt:t,norm:n}=e[0];this.pt=new a.Point(t),this.norm=new a.Vector(n);return}if(e.length==2){let t=e[0],n=e[1];if(t instanceof a.Point&&n instanceof a.Point){this.pt=t,this.norm=pr.points2norm(t,n),this.norm.dot(rr(this.pt.x,this.pt.y))>=0&&this.norm.invert();return}if(t instanceof a.Point&&n instanceof a.Vector){if(a.Utils.EQ_0(n.x)&&a.Utils.EQ_0(n.y))throw a.Errors.ILLEGAL_PARAMETERS;this.pt=t.clone(),this.norm=n.clone(),this.norm=this.norm.normalize(),this.norm.dot(rr(this.pt.x,this.pt.y))>=0&&this.norm.invert();return}if(t instanceof a.Vector&&n instanceof a.Point){if(a.Utils.EQ_0(t.x)&&a.Utils.EQ_0(t.y))throw a.Errors.ILLEGAL_PARAMETERS;this.pt=n.clone(),this.norm=t.clone(),this.norm=this.norm.normalize(),this.norm.dot(rr(this.pt.x,this.pt.y))>=0&&this.norm.invert();return}}throw a.Errors.ILLEGAL_PARAMETERS}}clone(){return new a.Line(this.pt,this.norm)}get start(){}get end(){}get length(){return Number.POSITIVE_INFINITY}get box(){return new a.Box(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY)}get middle(){}get slope(){return new a.Vector(this.norm.y,-this.norm.x).slope}get standard(){let e=this.norm.x,t=this.norm.y,n=this.norm.dot(this.pt);return[e,t,n]}parallelTo(e){return a.Utils.EQ_0(this.norm.cross(e.norm))}incidentTo(e){return this.parallelTo(e)&&this.pt.on(e)}contains(e){if(this.pt.equalTo(e))return!0;let t=new a.Vector(this.pt,e);return a.Utils.EQ_0(this.norm.dot(t))}coord(e){return rr(e.x,e.y).cross(this.norm)}intersect(e){if(e instanceof a.Point)return this.contains(e)?[e]:[];if(e instanceof a.Line)return lr(this,e);if(e instanceof a.Circle)return ft(this,e);if(e instanceof a.Box)return Bt(this,e);if(e instanceof a.Segment)return ur(e,this);if(e instanceof a.Arc)return gn(this,e);if(e instanceof a.Polygon)return hr(this,e)}distanceTo(e){if(e instanceof a.Point){let[t,n]=a.Distance.point2line(e,this);return n=n.reverse(),[t,n]}if(e instanceof a.Circle){let[t,n]=a.Distance.circle2line(e,this);return n=n.reverse(),[t,n]}if(e instanceof a.Segment){let[t,n]=a.Distance.segment2line(e,this);return[t,n.reverse()]}if(e instanceof a.Arc){let[t,n]=a.Distance.arc2line(e,this);return[t,n.reverse()]}if(e instanceof a.Polygon){let[t,n]=a.Distance.shape2polygon(this,e);return[t,n]}}split(e){if(e instanceof a.Point)return[new a.Ray(e,this.norm.invert()),new a.Ray(e,this.norm)];{let t=new a.Multiline([this]),n=this.sortPoints(e);return t.split(n),t.toShapes()}}sortPoints(e){return e.slice().sort((t,n)=>this.coord(t)<this.coord(n)?-1:this.coord(t)>this.coord(n)?1:0)}toJSON(){return Object.assign({},this,{name:"line"})}svg(e,t={}){let n=Bt(this,e);if(n.length===0)return"";let i=n[0],o=n.length==2?n[1]:n.find(l=>!l.equalTo(i));return o===void 0&&(o=i),new a.Segment(i,o).svg(t)}static points2norm(e,t){if(e.equalTo(t))throw a.Errors.ILLEGAL_PARAMETERS;return new a.Vector(e,t).normalize().rotate90CCW()}};a.Line=pr;var al=(...r)=>new a.Line(...r);a.line=al;var qi=class{constructor(...e){if(this.pc=new a.Point,this.r=1,e.length==1&&e[0]instanceof Object&&e[0].name==="circle"){let{pc:t,r:n}=e[0];this.pc=new a.Point(t),this.r=n;return}else{let[t,n]=[...e];t&&t instanceof a.Point&&(this.pc=t.clone()),n!==void 0&&(this.r=n);return}throw a.Errors.ILLEGAL_PARAMETERS}clone(){return new a.Circle(this.pc.clone(),this.r)}get center(){return this.pc}get box(){return new a.Box(this.pc.x-this.r,this.pc.y-this.r,this.pc.x+this.r,this.pc.y+this.r)}contains(e){if(e instanceof a.Point)return a.Utils.LE(e.distanceTo(this.center)[0],this.r);if(e instanceof a.Segment)return a.Utils.LE(e.start.distanceTo(this.center)[0],this.r)&&a.Utils.LE(e.end.distanceTo(this.center)[0],this.r);if(e instanceof a.Arc)return this.intersect(e).length===0&&a.Utils.LE(e.start.distanceTo(this.center)[0],this.r)&&a.Utils.LE(e.end.distanceTo(this.center)[0],this.r);if(e instanceof a.Circle)return this.intersect(e).length===0&&a.Utils.LE(e.r,this.r)&&a.Utils.LE(e.center.distanceTo(this.center)[0],this.r)}toArc(e=!0){return new a.Arc(this.center,this.r,Math.PI,-Math.PI,e)}intersect(e){if(e instanceof a.Point)return this.contains(e)?[e]:[];if(e instanceof a.Line)return ft(e,this);if(e instanceof a.Segment)return cr(e,this);if(e instanceof a.Circle)return Li(e,this);if(e instanceof a.Box)return Ff(this,e);if(e instanceof a.Arc)return vn(e,this);if(e instanceof a.Polygon)return Mi(this,e)}distanceTo(e){if(e instanceof a.Point){let[t,n]=a.Distance.point2circle(e,this);return n=n.reverse(),[t,n]}if(e instanceof a.Circle){let[t,n]=a.Distance.circle2circle(this,e);return[t,n]}if(e instanceof a.Line){let[t,n]=a.Distance.circle2line(this,e);return[t,n]}if(e instanceof a.Segment){let[t,n]=a.Distance.segment2circle(e,this);return n=n.reverse(),[t,n]}if(e instanceof a.Arc){let[t,n]=a.Distance.arc2circle(e,this);return n=n.reverse(),[t,n]}if(e instanceof a.Polygon){let[t,n]=a.Distance.shape2polygon(this,e);return[t,n]}if(e instanceof a.PlanarSet){let[t,n]=a.Distance.shape2planarSet(this,e);return[t,n]}}toJSON(){return Object.assign({},this,{name:"circle"})}svg(e={}){let{stroke:t,strokeWidth:n,fill:i,fillOpacity:o,id:s,className:l}=e,c=s&&s.length>0?`id="${s}"`:"",d=l&&l.length>0?`class="${l}"`:"";return`
<circle cx="${this.pc.x}" cy="${this.pc.y}" r="${this.r}" stroke="${t||"black"}" stroke-width="${n||1}" fill="${i||"none"}" fill-opacity="${o||1}" ${c} ${d} />`}};a.Circle=qi;var fl=(...r)=>new a.Circle(...r);a.circle=fl;var Wi=class{constructor(...e){if(this.pc=new a.Point,this.r=1,this.startAngle=0,this.endAngle=2*Math.PI,this.counterClockwise=a.CCW,e.length!=0){if(e.length==1&&e[0]instanceof Object&&e[0].name==="arc"){let{pc:t,r:n,startAngle:i,endAngle:o,counterClockwise:s}=e[0];this.pc=new a.Point(t.x,t.y),this.r=n,this.startAngle=i,this.endAngle=o,this.counterClockwise=s;return}else{let[t,n,i,o,s]=[...e];t&&t instanceof a.Point&&(this.pc=t.clone()),n!==void 0&&(this.r=n),i!==void 0&&(this.startAngle=i),o!==void 0&&(this.endAngle=o),s!==void 0&&(this.counterClockwise=s);return}throw a.Errors.ILLEGAL_PARAMETERS}}clone(){return new a.Arc(this.pc.clone(),this.r,this.startAngle,this.endAngle,this.counterClockwise)}get sweep(){if(a.Utils.EQ(this.startAngle,this.endAngle))return 0;if(a.Utils.EQ(Math.abs(this.startAngle-this.endAngle),a.PIx2))return a.PIx2;let e;return this.counterClockwise?e=a.Utils.GT(this.endAngle,this.startAngle)?this.endAngle-this.startAngle:this.endAngle-this.startAngle+a.PIx2:e=a.Utils.GT(this.startAngle,this.endAngle)?this.startAngle-this.endAngle:this.startAngle-this.endAngle+a.PIx2,a.Utils.GT(e,a.PIx2)&&(e-=a.PIx2),a.Utils.LT(e,0)&&(e+=a.PIx2),e}get start(){return new a.Point(this.pc.x+this.r,this.pc.y).rotate(this.startAngle,this.pc)}get end(){return new a.Point(this.pc.x+this.r,this.pc.y).rotate(this.endAngle,this.pc)}get center(){return this.pc.clone()}get vertices(){return[this.start.clone(),this.end.clone()]}get length(){return Math.abs(this.sweep*this.r)}get box(){let t=this.breakToFunctional().reduce((n,i)=>n.merge(i.start.box),new a.Box);return t=t.merge(this.end.box),t}contains(e){if(!a.Utils.EQ(this.pc.distanceTo(e)[0],this.r))return!1;if(e.equalTo(this.start))return!0;let t=new a.Vector(this.pc,e).slope,n=new a.Arc(this.pc,this.r,this.startAngle,t,this.counterClockwise);return a.Utils.LE(n.length,this.length)}split(e){if(this.start.equalTo(e))return[null,this.clone()];if(this.end.equalTo(e))return[this.clone(),null];let t=new a.Vector(this.pc,e).slope;return[new a.Arc(this.pc,this.r,this.startAngle,t,this.counterClockwise),new a.Arc(this.pc,this.r,t,this.endAngle,this.counterClockwise)]}middle(){let e=this.counterClockwise?this.startAngle+this.sweep/2:this.startAngle-this.sweep/2;return new a.Arc(this.pc,this.r,this.startAngle,e,this.counterClockwise).end}pointAtLength(e){if(e>this.length||e<0)return null;if(e==0)return this.start;if(e==this.length)return this.end;let t=e/this.length,n=this.counterClockwise?this.startAngle+this.sweep*t:this.startAngle-this.sweep*t;return new a.Arc(this.pc,this.r,this.startAngle,n,this.counterClockwise).end}chordHeight(){return(1-Math.cos(Math.abs(this.sweep/2)))*this.r}intersect(e){if(e instanceof a.Point)return this.contains(e)?[e]:[];if(e instanceof a.Line)return gn(e,this);if(e instanceof a.Circle)return vn(this,e);if(e instanceof a.Segment)return $e(e,this);if(e instanceof a.Box)return Uf(this,e);if(e instanceof a.Arc)return bn(this,e);if(e instanceof a.Polygon)return yn(this,e)}distanceTo(e){if(e instanceof a.Point){let[t,n]=a.Distance.point2arc(e,this);return n=n.reverse(),[t,n]}if(e instanceof a.Circle){let[t,n]=a.Distance.arc2circle(this,e);return[t,n]}if(e instanceof a.Line){let[t,n]=a.Distance.arc2line(this,e);return[t,n]}if(e instanceof a.Segment){let[t,n]=a.Distance.segment2arc(e,this);return n=n.reverse(),[t,n]}if(e instanceof a.Arc){let[t,n]=a.Distance.arc2arc(this,e);return[t,n]}if(e instanceof a.Polygon){let[t,n]=a.Distance.shape2polygon(this,e);return[t,n]}if(e instanceof a.PlanarSet){let[t,n]=a.Distance.shape2planarSet(this,e);return[t,n]}}breakToFunctional(){let e=[],t=[0,Math.PI/2,2*Math.PI/2,3*Math.PI/2],n=[this.pc.translate(this.r,0),this.pc.translate(0,this.r),this.pc.translate(-this.r,0),this.pc.translate(0,-this.r)],i=[];for(let o=0;o<4;o++)n[o].on(this)&&i.push(new a.Arc(this.pc,this.r,this.startAngle,t[o],this.counterClockwise));if(i.length==0)e.push(this.clone());else{i.sort((l,c)=>l.length-c.length);for(let l=0;l<i.length;l++){let c=e.length>0?e[e.length-1]:void 0,d;c?d=new a.Arc(this.pc,this.r,c.endAngle,i[l].endAngle,this.counterClockwise):d=new a.Arc(this.pc,this.r,this.startAngle,i[l].endAngle,this.counterClockwise),a.Utils.EQ_0(d.length)||e.push(d.clone())}let o=e.length>0?e[e.length-1]:void 0,s;o?s=new a.Arc(this.pc,this.r,o.endAngle,this.endAngle,this.counterClockwise):s=new a.Arc(this.pc,this.r,this.startAngle,this.endAngle,this.counterClockwise),!a.Utils.EQ_0(s.length)&&!a.Utils.EQ(s.sweep,2*Math.PI)&&e.push(s.clone())}return e}tangentInStart(){let e=new a.Vector(this.pc,this.start),t=this.counterClockwise?Math.PI/2:-Math.PI/2;return e.rotate(t).normalize()}tangentInEnd(){let e=new a.Vector(this.pc,this.end),t=this.counterClockwise?-Math.PI/2:Math.PI/2;return e.rotate(t).normalize()}reverse(){return new a.Arc(this.pc,this.r,this.endAngle,this.startAngle,!this.counterClockwise)}translate(...e){let t=this.clone();return t.pc=this.pc.translate(...e),t}rotate(e=0,t=new a.Point){let n=new a.Matrix;return n=n.translate(t.x,t.y).rotate(e).translate(-t.x,-t.y),this.transform(n)}scale(e=1,t=1){let n=new a.Matrix;return n=n.scale(e,t),this.transform(n)}transform(e=new a.Matrix){let t=this.start.transform(e),n=this.end.transform(e),i=this.pc.transform(e),o=this.counterClockwise;return e.a*e.d<0&&(o=!o),a.Arc.arcSE(i,t,n,o)}static arcSE(e,t,n,i){let{vector:o}=a,s=o(e,t).slope,l=o(e,n).slope;a.Utils.EQ(s,l)&&(l+=2*Math.PI,i=!0);let c=o(e,t).length;return new a.Arc(e,c,s,l,i)}definiteIntegral(e=0){return this.breakToFunctional().reduce((i,o)=>i+o.circularSegmentDefiniteIntegral(e),0)}circularSegmentDefiniteIntegral(e){let t=new a.Line(this.start,this.end),n=this.pc.leftTo(t),o=new a.Segment(this.start,this.end).definiteIntegral(e),s=this.circularSegmentArea();return n?o-s:o+s}circularSegmentArea(){return .5*this.r*this.r*(this.sweep-Math.sin(this.sweep))}sortPoints(e){let{vector:t}=a;return e.slice().sort((n,i)=>{let o=t(this.pc,n).slope,s=t(this.pc,i).slope;return o<s?-1:o>s?1:0})}toJSON(){return Object.assign({},this,{name:"arc"})}svg(e={}){let t=this.sweep<=Math.PI?"0":"1",n=this.counterClockwise?"1":"0",{stroke:i,strokeWidth:o,fill:s,id:l,className:c}=e,d=l&&l.length>0?`id="${l}"`:"",h=c&&c.length>0?`class="${c}"`:"";return a.Utils.EQ(this.sweep,2*Math.PI)?new a.Circle(this.pc,this.r).svg(e):`
<path d="M${this.start.x},${this.start.y}
                             A${this.r},${this.r} 0 ${t},${n} ${this.end.x},${this.end.y}"
                    stroke="${i||"black"}" stroke-width="${o||1}" fill="${s||"none"}" ${d} ${h} />`}};a.Arc=Wi;var ll=(...r)=>new a.Arc(...r);a.arc=ll;var Ft=class{constructor(e=void 0,t=void 0,n=void 0,i=void 0){this.xmin=e,this.ymin=t,this.xmax=n,this.ymax=i}clone(){return new Ft(this.xmin,this.ymin,this.xmax,this.ymax)}get low(){return new a.Point(this.xmin,this.ymin)}get high(){return new a.Point(this.xmax,this.ymax)}get max(){return this.clone()}get center(){return new a.Point((this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)}get width(){return Math.abs(this.xmax-this.xmin)}get height(){return Math.abs(this.ymax-this.ymin)}get box(){return this.clone()}not_intersect(e){return this.xmax<e.xmin||this.xmin>e.xmax||this.ymax<e.ymin||this.ymin>e.ymax}intersect(e){return!this.not_intersect(e)}merge(e){return new Ft(this.xmin===void 0?e.xmin:Math.min(this.xmin,e.xmin),this.ymin===void 0?e.ymin:Math.min(this.ymin,e.ymin),this.xmax===void 0?e.xmax:Math.max(this.xmax,e.xmax),this.ymax===void 0?e.ymax:Math.max(this.ymax,e.ymax))}less_than(e){return!!(this.low.lessThan(e.low)||this.low.equalTo(e.low)&&this.high.lessThan(e.high))}equal_to(e){return this.low.equalTo(e.low)&&this.high.equalTo(e.high)}output(){return this.clone()}static comparable_max(e,t){return e.merge(t)}static comparable_less_than(e,t){return e.lessThan(t)}set(e,t,n,i){this.xmin=e,this.ymin=t,this.xmax=n,this.ymax=i}toPoints(){return[new a.Point(this.xmin,this.ymin),new a.Point(this.xmax,this.ymin),new a.Point(this.xmax,this.ymax),new a.Point(this.xmin,this.ymax)]}toSegments(){let e=this.toPoints();return[new a.Segment(e[0],e[1]),new a.Segment(e[1],e[2]),new a.Segment(e[2],e[3]),new a.Segment(e[3],e[0])]}svg(e={}){let{stroke:t,strokeWidth:n,fill:i,id:o,className:s}=e,l=o&&o.length>0?`id="${o}"`:"",c=s&&s.length>0?`class="${s}"`:"",d=this.xmax-this.xmin,h=this.ymax-this.ymin;return`
<rect x="${this.xmin}" y="${this.ymin}" width=${d} height=${h} stroke="${t||"black"}" stroke-width="${n||1}" fill="${i||"none"}" ${l} ${c} />`}};a.Box=Ft;var ul=(...r)=>new a.Box(...r);a.box=ul;var $i=class{constructor(e){this.shape=e,this.next=void 0,this.prev=void 0,this.face=void 0,this.arc_length=0,this.bvStart=void 0,this.bvEnd=void 0,this.bv=void 0,this.overlap=void 0}get start(){return this.shape.start}get end(){return this.shape.end}get length(){return this.shape.length}get box(){return this.shape.box}isSegment(){return this.shape instanceof a.Segment}isArc(){return this.shape instanceof a.Arc}middle(){return this.shape.middle()}pointAtLength(e){return this.shape.pointAtLength(e)}contains(e){return this.shape.contains(e)}setInclusion(e){if(this.bv!==void 0)return this.bv;if(this.shape instanceof a.Line||this.shape instanceof a.Ray)return this.bv=a.OUTSIDE,this.bv;if(this.bvStart===void 0&&(this.bvStart=Nt(e,this.start)),this.bvEnd===void 0&&(this.bvEnd=Nt(e,this.end)),this.bvStart===a.OUTSIDE||this.bvEnd==a.OUTSIDE)this.bv=a.OUTSIDE;else if(this.bvStart===a.INSIDE||this.bvEnd==a.INSIDE)this.bv=a.INSIDE;else{let t=Nt(e,this.middle());this.bv=t}return this.bv}setOverlap(e){let t,n=this.shape,i=e.shape;n instanceof a.Segment&&i instanceof a.Segment?n.start.equalTo(i.start)&&n.end.equalTo(i.end)?t=a.OVERLAP_SAME:n.start.equalTo(i.end)&&n.end.equalTo(i.start)&&(t=a.OVERLAP_OPPOSITE):(n instanceof a.Arc&&i instanceof a.Arc||n instanceof a.Segment&&i instanceof a.Arc||n instanceof a.Arc&&i instanceof a.Segment)&&(n.start.equalTo(i.start)&&n.end.equalTo(i.end)&&n.middle().equalTo(i.middle())?t=a.OVERLAP_SAME:n.start.equalTo(i.end)&&n.end.equalTo(i.start)&&n.middle().equalTo(i.middle())&&(t=a.OVERLAP_OPPOSITE)),this.overlap===void 0&&(this.overlap=t),e.overlap===void 0&&(e.overlap=t)}svg(){if(this.shape instanceof a.Segment)return` L${this.shape.end.x},${this.shape.end.y}`;if(this.shape instanceof a.Arc){let e=this.shape,t,n=e.counterClockwise?"1":"0";if(a.Utils.EQ(e.sweep,2*Math.PI)){let i=e.counterClockwise?1:-1,o=new a.Arc(e.pc,e.r,e.startAngle,e.startAngle+i*Math.PI,e.counterClockwise),s=new a.Arc(e.pc,e.r,e.startAngle+i*Math.PI,e.endAngle,e.counterClockwise);return t="0",` A${o.r},${o.r} 0 ${t},${n} ${o.end.x},${o.end.y}
                    A${s.r},${s.r} 0 ${t},${n} ${s.end.x},${s.end.y}`}else return t=e.sweep<=Math.PI?"0":"1",` A${e.r},${e.r} 0 ${t},${n} ${e.end.x},${e.end.y}`}}toJSON(){return this.shape.toJSON()}};a.Edge=$i;var Hi=class extends ar{constructor(e,t){super(e,t);this.setCircularLinks()}setCircularLinks(){this.isEmpty()||(this.last.next=this.first,this.first.prev=this.last)}[Symbol.iterator](){let e;return{next:()=>{let t=e||this.first,n=this.first?e?e===this.first:!1:!0;return e=t?t.next:void 0,{value:t,done:n}}}}append(e){return super.append(e),this.setCircularLinks(),this}insert(e,t){return super.insert(e,t),this.setCircularLinks(),this}remove(e){return super.remove(e),this}},je=class extends Hi{constructor(e,...t){super();if(this._box=void 0,this._orientation=void 0,t.length!=0){if(t.length==1){if(t[0]instanceof Array){let n=t[0];if(n.length==0)return;if(n.every(i=>i instanceof a.Point)){let i=je.points2segments(n);this.shapes2face(e.edges,i)}else if(n.every(i=>i instanceof Array&&i.length===2)){let i=n.map(s=>new a.Point(s[0],s[1])),o=je.points2segments(i);this.shapes2face(e.edges,o)}else if(n.every(i=>i instanceof a.Segment||i instanceof a.Arc))this.shapes2face(e.edges,n);else if(n.every(i=>i.name==="segment"||i.name==="arc")){let i=[];for(let o of n){let s;o.name==="segment"?s=new a.Segment(o):s=new a.Arc(o),i.push(s)}this.shapes2face(e.edges,i)}}else if(t[0]instanceof je){let n=t[0];this.first=n.first,this.last=n.last;for(let i of n)e.edges.add(i)}else if(t[0]instanceof a.Circle)this.shapes2face(e.edges,[t[0].toArc(a.CCW)]);else if(t[0]instanceof a.Box){let n=t[0];this.shapes2face(e.edges,[new a.Segment(new a.Point(n.xmin,n.ymin),new a.Point(n.xmax,n.ymin)),new a.Segment(new a.Point(n.xmax,n.ymin),new a.Point(n.xmax,n.ymax)),new a.Segment(new a.Point(n.xmax,n.ymax),new a.Point(n.xmin,n.ymax)),new a.Segment(new a.Point(n.xmin,n.ymax),new a.Point(n.xmin,n.ymin))])}}t.length==2&&t[0]instanceof a.Edge&&t[1]instanceof a.Edge&&(this.first=t[0],this.last=t[1],this.last.next=this.first,this.first.prev=this.last,this.setArcLength())}}get edges(){return this.toArray()}get shapes(){return this.edges.map(e=>e.shape.clone())}get box(){if(this._box===void 0){let e=new a.Box;for(let t of this)e=e.merge(t.box);this._box=e}return this._box}get perimeter(){return this.last.arc_length+this.last.length}pointAtLength(e){if(e>this.perimeter||e<0)return null;let t=null;for(let n of this)if(e>=n.arc_length&&(n===this.last||e<n.next.arc_length)){t=n.pointAtLength(e-n.arc_length);break}return t}static points2segments(e){let t=[];for(let n=0;n<e.length;n++)e[n].equalTo(e[(n+1)%e.length])||t.push(new a.Segment(e[n],e[(n+1)%e.length]));return t}shapes2face(e,t){for(let n of t){let i=new a.Edge(n);this.append(i),e.add(i)}}append(e){return super.append(e),this.setOneEdgeArcLength(e),e.face=this,this}insert(e,t){return super.insert(e,t),this.setOneEdgeArcLength(e),e.face=this,this}remove(e){return super.remove(e),this.setArcLength(),this}reverse(){let e=[],t=this.last;do t.shape=t.shape.reverse(),e.push(t),t=t.prev;while(t!==this.last);this.first=void 0,this.last=void 0;for(let n of e)this.first===void 0?(n.prev=n,n.next=n,this.first=n,this.last=n):(n.prev=this.last,this.last.next=n,this.last=n,this.last.next=this.first,this.first.prev=this.last),this.setOneEdgeArcLength(n);this._orientation!==void 0&&(this._orientation=void 0,this._orientation=this.orientation())}setArcLength(){for(let e of this)this.setOneEdgeArcLength(e),e.face=this}setOneEdgeArcLength(e){e===this.first?e.arc_length=0:e.arc_length=e.prev.arc_length+e.prev.length}area(){return Math.abs(this.signedArea())}signedArea(){let e=0,t=this.box.ymin;for(let n of this)e+=n.shape.definiteIntegral(t);return e}orientation(){if(this._orientation===void 0){let e=this.signedArea();a.Utils.EQ_0(e)?this._orientation=a.ORIENTATION.NOT_ORIENTABLE:a.Utils.LT(e,0)?this._orientation=a.ORIENTATION.CCW:this._orientation=a.ORIENTATION.CW}return this._orientation}isSimple(e){return je.getSelfIntersections(this,e,!0).length==0}static getSelfIntersections(e,t,n=!1){let i=[];for(let o of e){let s=t.search(o.box);for(let l of s){if(o===l||l.face!==e||o.shape instanceof a.Segment&&l.shape instanceof a.Segment&&(o.next===l||o.prev===l))continue;let c=o.shape.intersect(l.shape);for(let d of c)if(!(d.equalTo(o.start)&&d.equalTo(l.end)&&l===o.prev)&&!(d.equalTo(o.end)&&d.equalTo(l.start)&&l===o.next)&&(i.push(d),n))break;if(i.length>0&&n)break}if(i.length>0&&n)break}return i}findEdgeByPoint(e){let t;for(let n of this)if(n.shape.contains(e)){t=n;break}return t}toPolygon(){return new a.Polygon(this.shapes)}toJSON(){return this.edges.map(e=>e.toJSON())}svg(){let e=`
M${this.first.start.x},${this.first.start.y}`;for(let t of this)e+=t.svg();return e+=" z",e}};a.Face=je;var mr=class{constructor(...e){if(this.pt=new a.Point,this.norm=new a.Vector(0,1),e.length!=0&&(e.length>=1&&e[0]instanceof a.Point&&(this.pt=e[0].clone()),e.length!==1)){if(e.length===2&&e[1]instanceof a.Vector){this.norm=e[1].clone();return}throw a.Errors.ILLEGAL_PARAMETERS}}clone(){return new mr(this.pt,this.norm)}get slope(){return new a.Vector(this.norm.y,-this.norm.x).slope}get box(){let e=this.slope;return new a.Box(e>Math.PI/2&&e<3*Math.PI/2?Number.NEGATIVE_INFINITY:this.pt.x,e>=0&&e<=Math.PI?this.pt.y:Number.NEGATIVE_INFINITY,e>=Math.PI/2&&e<=3*Math.PI/2?this.pt.x:Number.POSITIVE_INFINITY,e>=Math.PI&&e<=2*Math.PI||e==0?this.pt.y:Number.POSITIVE_INFINITY)}get start(){return this.pt}get end(){}get length(){return Number.POSITIVE_INFINITY}contains(e){if(this.pt.equalTo(e))return!0;let t=new a.Vector(this.pt,e);return a.Utils.EQ_0(this.norm.dot(t))&&a.Utils.GE(t.cross(this.norm),0)}split(e){return this.contains(e)?this.pt.equalTo(e)?[this]:[new a.Segment(this.pt,e),new a.Ray(e,this.norm)]:[]}intersect(e){if(e instanceof a.Segment)return this.intersectRay2Segment(this,e);if(e instanceof a.Arc)return this.intersectRay2Arc(this,e)}intersectRay2Segment(e,t){let n=[],i=new a.Line(e.start,e.norm),o=i.intersect(t);for(let s of o)e.contains(s)&&n.push(s);return o.length==2&&n.length==1&&e.start.on(i)&&n.push(e.start),n}intersectRay2Arc(e,t){let n=[],o=new a.Line(e.start,e.norm).intersect(t);for(let s of o)e.contains(s)&&n.push(s);return n}svg(e,t={}){let n=new a.Line(this.pt,this.norm),i=Bt(n,e);return i=i.filter(s=>this.contains(s)),i.length===0||i.length===2?"":new a.Segment(this.pt,i[0]).svg(t)}};a.Ray=mr;var cl=(...r)=>new a.Ray(...r);a.ray=cl;var Ve=class{constructor(){this.faces=new a.PlanarSet,this.edges=new a.PlanarSet;let e=[...arguments];if(e.length===1&&(e[0]instanceof Array&&e[0].length>0||e[0]instanceof a.Circle||e[0]instanceof a.Box)){let t=e[0];if(e[0]instanceof Array&&e[0].every(n=>n instanceof Array))if(t.every(n=>n instanceof Array&&n.length===2&&typeof n[0]=="number"&&typeof n[1]=="number"))this.faces.add(new a.Face(this,t));else for(let n of t)if(n instanceof Array&&n[0]instanceof Array&&n[0].every(i=>i instanceof Array&&i.length===2&&typeof i[0]=="number"&&typeof i[1]=="number"))for(let i of n)this.faces.add(new a.Face(this,i));else this.faces.add(new a.Face(this,n));else this.faces.add(new a.Face(this,t))}}get box(){return[...this.faces].reduce((e,t)=>e.merge(t.box),new a.Box)}get vertices(){return[...this.edges].map(e=>e.start)}clone(){let e=new Ve;for(let t of this.faces)e.addFace(t.shapes);return e}isEmpty(){return this.edges.size===0}isValid(){let e=!0;for(let t of this.faces)if(!t.isSimple(this.edges)){e=!1;break}return e}area(){let e=[...this.faces].reduce((t,n)=>t+n.signedArea(),0);return Math.abs(e)}addFace(...e){let t=new a.Face(this,...e);return this.faces.add(t),t}deleteFace(e){for(let t of e)this.edges.delete(t);return this.faces.delete(e)}recreateFaces(){this.faces.clear();for(let n of this.edges)n.face=null;let e,t=!0;for(;t;){t=!1;for(let n of this.edges)if(n.face===null){e=n,t=!0;break}if(t){let n=e;do n=n.next;while(n.next!==e);this.addFace(e,n)}}}removeChain(e,t,n){if(n.next===t){this.deleteFace(e);return}for(let i=t;i!==n.next;i=i.next)if(e.remove(i),this.edges.delete(i),e.isEmpty()){this.deleteFace(e);break}}addVertex(e,t){let n=t.shape.split(e);if(n[0]===null)return t.prev;if(n[1]===null)return t;let i=new a.Edge(n[0]),o=t.prev;return t.face.insert(i,o),this.edges.delete(t),this.edges.add(i),t.shape=n[1],this.edges.add(t),i}cut(e){let t=[this.clone()];for(let n of e){if(n.setInclusion(this)!==kt)continue;let i=n.shape.start,o=n.shape.end,s=[];for(let l of t)if(l.findEdgeByPoint(i)===void 0)s.push(l);else{let[c,d]=l.cutFace(i,o);s.push(c,d)}t=s}return t}cutFace(e,t){let n=this.findEdgeByPoint(e),i=this.findEdgeByPoint(t);if(n.face!==i.face)return[];let o=this.addVertex(e,n);i=this.findEdgeByPoint(t);let s=this.addVertex(t,i),l=o.face,c=new a.Edge(new a.Segment(o.end,s.end)),d=new a.Edge(new a.Segment(s.end,o.end));o.next.prev=d,d.next=o.next,o.next=c,c.prev=o,s.next.prev=c,c.next=s.next,s.next=d,d.prev=s,this.edges.add(c),this.edges.add(d);let h=this.addFace(c,o),b=this.addFace(d,s);return this.faces.delete(l),[h.toPolygon(),b.toPolygon()]}cutWithLine(e){let t=this.clone(),n=new ie([e]),i={int_points1:[],int_points2:[],int_points1_sorted:[],int_points2_sorted:[]};for(let l of t.edges){let c=Ni(l,e);for(let d of c)it(n.first,d,i.int_points1),it(l,d,i.int_points2)}if(i.int_points1.length===0)return t;i.int_points1_sorted=rn(e,i.int_points1),i.int_points2_sorted=Lt(i.int_points2),st(n,i.int_points1_sorted),st(t,i.int_points2_sorted),_n(i),i.int_points1_sorted=rn(e,i.int_points1),i.int_points2_sorted=Lt(i.int_points2),an(i.int_points1),fn(i.int_points1,t);for(let l of i.int_points1_sorted)l.edge_before.bv===l.edge_after.bv&&(i.int_points2[l.id]=-1,l.id=-1);if(i.int_points1=i.int_points1.filter(l=>l.id>=0),i.int_points2=i.int_points2.filter(l=>l.id>=0),i.int_points1.length===0)return t;i.int_points1_sorted=rn(e,i.int_points1),i.int_points2_sorted=Lt(i.int_points2);let o=i.int_points1[0],s;for(let l of i.int_points1_sorted)l.edge_before.bv===kt&&(s=new a.Edge(new a.Segment(o.pt,l.pt)),mi(i.int_points2[o.id],i.int_points2[l.id],s),t.edges.add(s),s=new a.Edge(new a.Segment(l.pt,o.pt)),mi(i.int_points2[l.id],i.int_points2[o.id],s),t.edges.add(s)),o=l;return t.recreateFaces(),t}findEdgeByPoint(e){let t;for(let n of this.faces)if(t=n.findEdgeByPoint(e),t!==void 0)break;return t}splitToIslands(){let e=this.toArray();e.sort((i,o)=>o.area()-i.area());let t=[...e[0].faces][0].orientation(),n=e.filter(i=>[...i.faces][0].orientation()===t);for(let i of e){let o=[...i.faces][0];if(o.orientation()!==t){for(let s of n)if(o.shapes.every(l=>s.contains(l))){s.addFace(o.shapes);break}}}return n}reverse(){for(let e of this.faces)e.reverse();return this}contains(e){if(e instanceof a.Point){let t=Nt(this,e);return t===kt||t===le}else return Gi(this,e)}distanceTo(e){if(e instanceof a.Point){let[t,n]=a.Distance.point2polygon(e,this);return n=n.reverse(),[t,n]}if(e instanceof a.Circle||e instanceof a.Line||e instanceof a.Segment||e instanceof a.Arc){let[t,n]=a.Distance.shape2polygon(e,this);return n=n.reverse(),[t,n]}if(e instanceof a.Polygon){let t=[Number.POSITIVE_INFINITY,new a.Segment],n,i;for(let o of this.edges){let s=t[0];[n,i]=a.Distance.shape2planarSet(o.shape,e.edges,s),a.Utils.LT(n,s)&&(t=[n,i])}return t}}intersect(e){if(e instanceof a.Point)return this.contains(e)?[e]:[];if(e instanceof a.Line)return hr(e,this);if(e instanceof a.Circle)return Mi(e,this);if(e instanceof a.Segment)return xn(e,this);if(e instanceof a.Arc)return yn(e,this);if(e instanceof a.Polygon)return Wf(e,this)}translate(e){let t=new Ve;for(let n of this.faces)t.addFace(n.shapes.map(i=>i.translate(e)));return t}rotate(e=0,t=new a.Point){let n=new Ve;for(let i of this.faces)n.addFace(i.shapes.map(o=>o.rotate(e,t)));return n}transform(e=new a.Matrix){let t=new Ve;for(let n of this.faces)t.addFace(n.shapes.map(i=>i.transform(e)));return t}toJSON(){return[...this.faces].map(e=>e.toJSON())}toArray(){return[...this.faces].map(e=>e.toPolygon())}svg(e={}){let{stroke:t,strokeWidth:n,fill:i,fillRule:o,fillOpacity:s,id:l,className:c}=e,d=l&&l.length>0?`id="${l}"`:"",h=c&&c.length>0?`class="${c}"`:"",b=`
<path stroke="${t||"black"}" stroke-width="${n||1}" fill="${i||"lightcyan"}" fill-rule="${o||"evenodd"}" fill-opacity="${s||1}" ${d} ${h} d="`;for(let x of this.faces)b+=x.svg();return b+=`" >
</path>`,b}};a.Polygon=Ve;var hl=(...r)=>new a.Polygon(...r);a.polygon=hl;var{Circle:nn,Line:Ti,Point:Ei,Vector:nr,Utils:on}=a,nt=class{constructor(e){this.circle=e}get inversion_circle(){return this.circle}static inversePoint(e,t){let n=new nr(e.pc,t),i=e.r*e.r,o=n.dot(n);return on.EQ_0(o)?new Ei(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY):e.pc.translate(n.multiply(i/o))}static inverseCircle(e,t){let n=e.pc.distanceTo(t.pc)[0];if(on.EQ(n,t.r)){let i=e.r*e.r/(2*t.r),o=new nr(e.pc,t.pc);o=o.normalize();let s=e.pc.translate(o.multiply(i));return new Ti(s,o)}else{let i=new nr(e.pc,t.pc),o=e.r*e.r/(i.dot(i)-t.r*t.r),s=e.pc.translate(i.multiply(o)),l=Math.abs(o)*t.r;return new nn(s,l)}}static inverseLine(e,t){let[n,i]=e.pc.distanceTo(t);if(on.EQ_0(n))return t.clone();{let o=e.r*e.r/(2*n),s=new nr(e.pc,i.end);return s=s.multiply(o/n),new nn(e.pc.translate(s),o)}}inverse(e){if(e instanceof Ei)return nt.inversePoint(this.circle,e);if(e instanceof nn)return nt.inverseCircle(this.circle,e);if(e instanceof Ti)return nt.inverseLine(this.circle,e)}};a.Inversion=nt;var dl=r=>new a.Inversion(r);a.inversion=dl;var N=class{static point2point(e,t){return e.distanceTo(t)}static point2line(e,t){let n=e.projectionOn(t);return[new a.Vector(e,n).length,new a.Segment(e,n)]}static point2circle(e,t){let[n,i]=e.distanceTo(t.center);if(a.Utils.EQ_0(n))return[t.r,new a.Segment(e,t.toArc().start)];{let o=Math.abs(n-t.r),s=new a.Vector(t.pc,e).normalize().multiply(t.r),l=t.pc.translate(s);return[o,new a.Segment(e,l)]}}static point2segment(e,t){if(t.start.equalTo(t.end))return N.point2point(e,t.start);let n=new a.Vector(t.start,t.end),i=new a.Vector(t.start,e),o=new a.Vector(t.end,e),s=n.dot(i),l=-n.dot(o),c,d;if(a.Utils.GE(s,0)&&a.Utils.GE(l,0)){let h=t.tangentInStart();return c=Math.abs(h.cross(i)),d=t.start.translate(h.multiply(h.dot(i))),[c,new a.Segment(e,d)]}else return s<0?e.distanceTo(t.start):e.distanceTo(t.end)}static point2arc(e,t){let n=new a.Circle(t.pc,t.r),i=[],o,s;return[o,s]=N.point2circle(e,n),s.end.on(t)&&i.push(N.point2circle(e,n)),i.push(N.point2point(e,t.start)),i.push(N.point2point(e,t.end)),N.sort(i),i[0]}static segment2line(e,t){let n=e.intersect(t);if(n.length>0)return[0,new a.Segment(n[0],n[0])];let i=[];return i.push(N.point2line(e.start,t)),i.push(N.point2line(e.end,t)),N.sort(i),i[0]}static segment2segment(e,t){let n=Gt(e,t);if(n.length>0)return[0,new a.Segment(n[0],n[0])];let i=[],o,s;return[o,s]=N.point2segment(t.start,e),i.push([o,s.reverse()]),[o,s]=N.point2segment(t.end,e),i.push([o,s.reverse()]),i.push(N.point2segment(e.start,t)),i.push(N.point2segment(e.end,t)),N.sort(i),i[0]}static segment2circle(e,t){let n=e.intersect(t);if(n.length>0)return[0,new a.Segment(n[0],n[0])];let i=new a.Line(e.ps,e.pe),[o,s]=N.point2line(t.center,i);if(a.Utils.GE(o,t.r)&&s.end.on(e))return N.point2circle(s.end,t);{let[l,c]=N.point2circle(e.start,t),[d,h]=N.point2circle(e.end,t);return a.Utils.LT(l,d)?[l,c]:[d,h]}}static segment2arc(e,t){let n=e.intersect(t);if(n.length>0)return[0,new a.Segment(n[0],n[0])];let i=new a.Line(e.ps,e.pe),o=new a.Circle(t.pc,t.r),[s,l]=N.point2line(o.center,i);if(a.Utils.GE(s,o.r)&&l.end.on(e)){let[b,x]=N.point2circle(l.end,o);if(x.end.on(t))return[b,x]}let c=[];c.push(N.point2arc(e.start,t)),c.push(N.point2arc(e.end,t));let d,h;return[d,h]=N.point2segment(t.start,e),c.push([d,h.reverse()]),[d,h]=N.point2segment(t.end,e),c.push([d,h.reverse()]),N.sort(c),c[0]}static circle2circle(e,t){let n=e.intersect(t);if(n.length>0)return[0,new a.Segment(n[0],n[0])];if(e.center.equalTo(t.center)){let i=e.toArc(),o=t.toArc();return N.point2point(i.start,o.start)}else{let i=new a.Line(e.center,t.center),o=i.intersect(e),s=i.intersect(t),l=[];return l.push(N.point2point(o[0],s[0])),l.push(N.point2point(o[0],s[1])),l.push(N.point2point(o[1],s[0])),l.push(N.point2point(o[1],s[1])),N.sort(l),l[0]}}static circle2line(e,t){let n=e.intersect(t);if(n.length>0)return[0,new a.Segment(n[0],n[0])];let[i,o]=N.point2line(e.center,t),[s,l]=N.point2circle(o.end,e);return l=l.reverse(),[s,l]}static arc2line(e,t){let n=t.intersect(e);if(n.length>0)return[0,new a.Segment(n[0],n[0])];let i=new a.Circle(e.center,e.r),[o,s]=N.point2line(i.center,t);if(a.Utils.GE(o,i.r)){let[l,c]=N.point2circle(s.end,i);if(c.end.on(e))return[l,c]}else{let l=[];return l.push(N.point2line(e.start,t)),l.push(N.point2line(e.end,t)),N.sort(l),l[0]}}static arc2circle(e,t){let n=e.intersect(t);if(n.length>0)return[0,new a.Segment(n[0],n[0])];let i=new a.Circle(e.center,e.r),[o,s]=N.circle2circle(i,t);if(s.start.on(e))return[o,s];{let l=[];return l.push(N.point2circle(e.start,t)),l.push(N.point2circle(e.end,t)),N.sort(l),l[0]}}static arc2arc(e,t){let n=e.intersect(t);if(n.length>0)return[0,new a.Segment(n[0],n[0])];let i=new a.Circle(e.center,e.r),o=new a.Circle(t.center,t.r),[s,l]=N.circle2circle(i,o);if(l.start.on(e)&&l.end.on(t))return[s,l];{let c=[],d,h;return[d,h]=N.point2arc(e.start,t),h.end.on(t)&&c.push([d,h]),[d,h]=N.point2arc(e.end,t),h.end.on(t)&&c.push([d,h]),[d,h]=N.point2arc(t.start,e),h.end.on(e)&&c.push([d,h.reverse()]),[d,h]=N.point2arc(t.end,e),h.end.on(e)&&c.push([d,h.reverse()]),[d,h]=N.point2point(e.start,t.start),c.push([d,h]),[d,h]=N.point2point(e.start,t.end),c.push([d,h]),[d,h]=N.point2point(e.end,t.start),c.push([d,h]),[d,h]=N.point2point(e.end,t.end),c.push([d,h]),N.sort(c),c[0]}}static point2polygon(e,t){let n=[Number.POSITIVE_INFINITY,new a.Segment];for(let i of t.edges){let[o,s]=i.shape instanceof a.Segment?N.point2segment(e,i.shape):N.point2arc(e,i.shape);a.Utils.LT(o,n[0])&&(n=[o,s])}return n}static shape2polygon(e,t){let n=[Number.POSITIVE_INFINITY,new a.Segment];for(let i of t.edges){let[o,s]=e.distanceTo(i.shape);a.Utils.LT(o,n[0])&&(n=[o,s])}return n}static polygon2polygon(e,t){let n=[Number.POSITIVE_INFINITY,new a.Segment];for(let i of e.edges)for(let o of t.edges){let[s,l]=i.shape.distanceTo(o.shape);a.Utils.LT(s,n[0])&&(n=[s,l])}return n}static box2box_minmax(e,t){let n=Math.max(Math.max(e.xmin-t.xmax,0),Math.max(t.xmin-e.xmax,0)),i=Math.max(Math.max(e.ymin-t.ymax,0),Math.max(t.ymin-e.ymax,0)),o=n*n+i*i,s=e.merge(t),l=s.xmax-s.xmin,c=s.ymax-s.ymin,d=l*l+c*c;return[o,d]}static minmax_tree_process_level(e,t,n,i){let o,s;for(let h of t)[o,s]=N.box2box_minmax(e.box,h.item.key),h.item.value instanceof a.Edge?i.insert([o,s],h.item.value.shape):i.insert([o,s],h.item.value),a.Utils.LT(s,n)&&(n=s);if(t.length===0)return n;let l=t.map(h=>h.left.isNil()?void 0:h.left).filter(h=>h!==void 0),c=t.map(h=>h.right.isNil()?void 0:h.right).filter(h=>h!==void 0),d=[...l,...c].filter(h=>{let[b,x]=N.box2box_minmax(e.box,h.max);return a.Utils.LE(b,n)});return n=N.minmax_tree_process_level(e,d,n,i),n}static minmax_tree(e,t,n){let i=new at,o=[t.index.root],s=n<Number.POSITIVE_INFINITY?n*n:Number.POSITIVE_INFINITY;return s=N.minmax_tree_process_level(e,o,s,i),i}static minmax_tree_calc_distance(e,t,n){let i,o;if(t!=null&&!t.isNil()){if([i,o]=N.minmax_tree_calc_distance(e,t.left,n),o)return[i,o];if(a.Utils.LT(i[0],Math.sqrt(t.item.key.low)))return[i,!0];let[s,l]=N.distance(e,t.item.value);return a.Utils.LT(s,i[0])&&(i=[s,l]),[i,o]=N.minmax_tree_calc_distance(e,t.right,i),[i,o]}return[n,!1]}static shape2planarSet(e,t,n=Number.POSITIVE_INFINITY){let i=[n,new a.Segment],o=!1;if(t instanceof a.PlanarSet){let s=N.minmax_tree(e,t,n);[i,o]=N.minmax_tree_calc_distance(e,s.root,i)}return i}static sort(e){e.sort((t,n)=>a.Utils.LT(t[0],n[0])?-1:a.Utils.GT(t[0],n[0])?1:0)}static distance(e,t){return e.distanceTo(t)}};a.Distance=N;a.BooleanOperations=Af;a.Relations=tl;var k=a;var Z=class{};Ie(Z,"weaponBox",{spriteName:"weaponBox",frameCount:16}),Ie(Z,"rabbitBreath",{spriteName:"rabbitBreath",frameCount:60}),Ie(Z,"bubbles",{spriteName:"bubbles",frameCount:68}),Ie(Z,"rabbitGo",{spriteName:"rabbitGo",frameCount:24}),Ie(Z,"rabbitPrepareToJump",{spriteName:"rabbitPrepareToJump",frameCount:9}),Ie(Z,"rabbitJumpBack",{spriteName:"rabbitJumpBack",frameCount:30}),Ie(Z,"rabbitJump",{spriteName:"rabbitJump",frameCount:9});var ye=class{anim;startTime;constructor(e){this.anim=e,this.startTime=performance.now()}};var pl=typeof global=="object"&&global&&global.Object===Object&&global,_r=pl;var ml=typeof self=="object"&&self&&self.Object===Object&&self,_l=_r||ml||Function("return this")(),z=_l;var gl=z.Symbol,ee=gl;var zi=Object.prototype,bl=zi.hasOwnProperty,vl=zi.toString,jt=ee?ee.toStringTag:void 0;function xl(r){var e=bl.call(r,jt),t=r[jt];try{r[jt]=void 0;var n=!0}catch{}var i=vl.call(r);return n&&(e?r[jt]=t:delete r[jt]),i}var Ji=xl;var yl=Object.prototype,Tl=yl.toString;function El(r){return Tl.call(r)}var Yi=El;var wl="[object Null]",Sl="[object Undefined]",Xi=ee?ee.toStringTag:void 0;function Il(r){return r==null?r===void 0?Sl:wl:Xi&&Xi in Object(r)?Ji(r):Yi(r)}var se=Il;function Pl(r){return r!=null&&typeof r=="object"}var ae=Pl;var Ol="[object Symbol]";function Cl(r){return typeof r=="symbol"||ae(r)&&se(r)==Ol}var de=Cl;function Al(r,e){for(var t=-1,n=r==null?0:r.length,i=Array(n);++t<n;)i[t]=e(r[t],t,r);return i}var gr=Al;var Rl=Array.isArray,$=Rl;var kl=1/0,Qi=ee?ee.prototype:void 0,Ki=Qi?Qi.toString:void 0;function Zi(r){if(typeof r=="string")return r;if($(r))return gr(r,Zi)+"";if(de(r))return Ki?Ki.call(r):"";var e=r+"";return e=="0"&&1/r==-kl?"-0":e}var eo=Zi;var Ll=/\s/;function Nl(r){for(var e=r.length;e--&&Ll.test(r.charAt(e)););return e}var to=Nl;var Ml=/^\s+/;function Bl(r){return r&&r.slice(0,to(r)+1).replace(Ml,"")}var ro=Bl;function Fl(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}var te=Fl;var no=0/0,Ul=/^[-+]0x[0-9a-f]+$/i,Dl=/^0b[01]+$/i,Gl=/^0o[0-7]+$/i,jl=parseInt;function Vl(r){if(typeof r=="number")return r;if(de(r))return no;if(te(r)){var e=typeof r.valueOf=="function"?r.valueOf():r;r=te(e)?e+"":e}if(typeof r!="string")return r===0?r:+r;r=ro(r);var t=Dl.test(r);return t||Gl.test(r)?jl(r.slice(2),t?2:8):Ul.test(r)?no:+r}var Te=Vl;var io=1/0,ql=17976931348623157e292;function Wl(r){if(!r)return r===0?r:0;if(r=Te(r),r===io||r===-io){var e=r<0?-1:1;return e*ql}return r===r?r:0}var Vt=Wl;function $l(r){var e=Vt(r),t=e%1;return e===e?t?e-t:e:0}var br=$l;function Hl(r){return r}var oo=Hl;var zl="[object AsyncFunction]",Jl="[object Function]",Yl="[object GeneratorFunction]",Xl="[object Proxy]";function Ql(r){if(!te(r))return!1;var e=se(r);return e==Jl||e==Yl||e==zl||e==Xl}var vr=Ql;var Kl=z["__core-js_shared__"],xr=Kl;var so=function(){var r=/[^.]+$/.exec(xr&&xr.keys&&xr.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function Zl(r){return!!so&&so in r}var ao=Zl;var eu=Function.prototype,tu=eu.toString;function ru(r){if(r!=null){try{return tu.call(r)}catch{}try{return r+""}catch{}}return""}var Ee=ru;var nu=/[\\^$.*+?()[\]{}|]/g,iu=/^\[object .+?Constructor\]$/,ou=Function.prototype,su=Object.prototype,au=ou.toString,fu=su.hasOwnProperty,lu=RegExp("^"+au.call(fu).replace(nu,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function uu(r){if(!te(r)||ao(r))return!1;var e=vr(r)?lu:iu;return e.test(Ee(r))}var fo=uu;function cu(r,e){return r==null?void 0:r[e]}var lo=cu;function hu(r,e){var t=lo(r,e);return fo(t)?t:void 0}var oe=hu;var du=oe(z,"WeakMap"),yr=du;function pu(r,e,t,n){for(var i=r.length,o=t+(n?1:-1);n?o--:++o<i;)if(e(r[o],o,r))return o;return-1}var uo=pu;var mu=9007199254740991,_u=/^(?:0|[1-9]\d*)$/;function gu(r,e){var t=typeof r;return e=e??mu,!!e&&(t=="number"||t!="symbol"&&_u.test(r))&&r>-1&&r%1==0&&r<e}var ut=gu;function bu(r,e){return r===e||r!==r&&e!==e}var ct=bu;var vu=9007199254740991;function xu(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=vu}var ht=xu;function yu(r){return r!=null&&ht(r.length)&&!vr(r)}var pe=yu;function Tu(r,e,t){if(!te(t))return!1;var n=typeof e;return(n=="number"?pe(t)&&ut(e,t.length):n=="string"&&e in t)?ct(t[e],r):!1}var Tr=Tu;var Eu=Object.prototype;function wu(r){var e=r&&r.constructor,t=typeof e=="function"&&e.prototype||Eu;return r===t}var co=wu;function Su(r,e){for(var t=-1,n=Array(r);++t<r;)n[t]=e(t);return n}var ho=Su;var Iu="[object Arguments]";function Pu(r){return ae(r)&&se(r)==Iu}var Tn=Pu;var po=Object.prototype,Ou=po.hasOwnProperty,Cu=po.propertyIsEnumerable,Au=Tn(function(){return arguments}())?Tn:function(r){return ae(r)&&Ou.call(r,"callee")&&!Cu.call(r,"callee")},dt=Au;function Ru(){return!1}var mo=Ru;var bo=typeof exports=="object"&&exports&&!exports.nodeType&&exports,_o=bo&&typeof module=="object"&&module&&!module.nodeType&&module,ku=_o&&_o.exports===bo,go=ku?z.Buffer:void 0,Lu=go?go.isBuffer:void 0,Nu=Lu||mo,qt=Nu;var Mu="[object Arguments]",Bu="[object Array]",Fu="[object Boolean]",Uu="[object Date]",Du="[object Error]",Gu="[object Function]",ju="[object Map]",Vu="[object Number]",qu="[object Object]",Wu="[object RegExp]",$u="[object Set]",Hu="[object String]",zu="[object WeakMap]",Ju="[object ArrayBuffer]",Yu="[object DataView]",Xu="[object Float32Array]",Qu="[object Float64Array]",Ku="[object Int8Array]",Zu="[object Int16Array]",ec="[object Int32Array]",tc="[object Uint8Array]",rc="[object Uint8ClampedArray]",nc="[object Uint16Array]",ic="[object Uint32Array]",W={};W[Xu]=W[Qu]=W[Ku]=W[Zu]=W[ec]=W[tc]=W[rc]=W[nc]=W[ic]=!0;W[Mu]=W[Bu]=W[Ju]=W[Fu]=W[Yu]=W[Uu]=W[Du]=W[Gu]=W[ju]=W[Vu]=W[qu]=W[Wu]=W[$u]=W[Hu]=W[zu]=!1;function oc(r){return ae(r)&&ht(r.length)&&!!W[se(r)]}var vo=oc;function sc(r){return function(e){return r(e)}}var xo=sc;var yo=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Wt=yo&&typeof module=="object"&&module&&!module.nodeType&&module,ac=Wt&&Wt.exports===yo,En=ac&&_r.process,fc=function(){try{var r=Wt&&Wt.require&&Wt.require("util").types;return r||En&&En.binding&&En.binding("util")}catch{}}(),wn=fc;var To=wn&&wn.isTypedArray,lc=To?xo(To):vo,Er=lc;var uc=Object.prototype,cc=uc.hasOwnProperty;function hc(r,e){var t=$(r),n=!t&&dt(r),i=!t&&!n&&qt(r),o=!t&&!n&&!i&&Er(r),s=t||n||i||o,l=s?ho(r.length,String):[],c=l.length;for(var d in r)(e||cc.call(r,d))&&!(s&&(d=="length"||i&&(d=="offset"||d=="parent")||o&&(d=="buffer"||d=="byteLength"||d=="byteOffset")||ut(d,c)))&&l.push(d);return l}var Eo=hc;function dc(r,e){return function(t){return r(e(t))}}var wo=dc;var pc=wo(Object.keys,Object),So=pc;var mc=Object.prototype,_c=mc.hasOwnProperty;function gc(r){if(!co(r))return So(r);var e=[];for(var t in Object(r))_c.call(r,t)&&t!="constructor"&&e.push(t);return e}var Io=gc;function bc(r){return pe(r)?Eo(r):Io(r)}var Oe=bc;var vc=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,xc=/^\w*$/;function yc(r,e){if($(r))return!1;var t=typeof r;return t=="number"||t=="symbol"||t=="boolean"||r==null||de(r)?!0:xc.test(r)||!vc.test(r)||e!=null&&r in Object(e)}var pt=yc;var Tc=oe(Object,"create"),we=Tc;function Ec(){this.__data__=we?we(null):{},this.size=0}var Po=Ec;function wc(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e}var Oo=wc;var Sc="__lodash_hash_undefined__",Ic=Object.prototype,Pc=Ic.hasOwnProperty;function Oc(r){var e=this.__data__;if(we){var t=e[r];return t===Sc?void 0:t}return Pc.call(e,r)?e[r]:void 0}var Co=Oc;var Cc=Object.prototype,Ac=Cc.hasOwnProperty;function Rc(r){var e=this.__data__;return we?e[r]!==void 0:Ac.call(e,r)}var Ao=Rc;var kc="__lodash_hash_undefined__";function Lc(r,e){var t=this.__data__;return this.size+=this.has(r)?0:1,t[r]=we&&e===void 0?kc:e,this}var Ro=Lc;function mt(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}mt.prototype.clear=Po;mt.prototype.delete=Oo;mt.prototype.get=Co;mt.prototype.has=Ao;mt.prototype.set=Ro;var Sn=mt;function Nc(){this.__data__=[],this.size=0}var ko=Nc;function Mc(r,e){for(var t=r.length;t--;)if(ct(r[t][0],e))return t;return-1}var Ce=Mc;var Bc=Array.prototype,Fc=Bc.splice;function Uc(r){var e=this.__data__,t=Ce(e,r);if(t<0)return!1;var n=e.length-1;return t==n?e.pop():Fc.call(e,t,1),--this.size,!0}var Lo=Uc;function Dc(r){var e=this.__data__,t=Ce(e,r);return t<0?void 0:e[t][1]}var No=Dc;function Gc(r){return Ce(this.__data__,r)>-1}var Mo=Gc;function jc(r,e){var t=this.__data__,n=Ce(t,r);return n<0?(++this.size,t.push([r,e])):t[n][1]=e,this}var Bo=jc;function _t(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}_t.prototype.clear=ko;_t.prototype.delete=Lo;_t.prototype.get=No;_t.prototype.has=Mo;_t.prototype.set=Bo;var Ae=_t;var Vc=oe(z,"Map"),Re=Vc;function qc(){this.size=0,this.__data__={hash:new Sn,map:new(Re||Ae),string:new Sn}}var Fo=qc;function Wc(r){var e=typeof r;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?r!=="__proto__":r===null}var Uo=Wc;function $c(r,e){var t=r.__data__;return Uo(e)?t[typeof e=="string"?"string":"hash"]:t.map}var ke=$c;function Hc(r){var e=ke(this,r).delete(r);return this.size-=e?1:0,e}var Do=Hc;function zc(r){return ke(this,r).get(r)}var Go=zc;function Jc(r){return ke(this,r).has(r)}var jo=Jc;function Yc(r,e){var t=ke(this,r),n=t.size;return t.set(r,e),this.size+=t.size==n?0:1,this}var Vo=Yc;function gt(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}gt.prototype.clear=Fo;gt.prototype.delete=Do;gt.prototype.get=Go;gt.prototype.has=jo;gt.prototype.set=Vo;var ze=gt;var Xc="Expected a function";function In(r,e){if(typeof r!="function"||e!=null&&typeof e!="function")throw new TypeError(Xc);var t=function(){var n=arguments,i=e?e.apply(this,n):n[0],o=t.cache;if(o.has(i))return o.get(i);var s=r.apply(this,n);return t.cache=o.set(i,s)||o,s};return t.cache=new(In.Cache||ze),t}In.Cache=ze;var $t=In;var Qc=500;function Kc(r){var e=$t(r,function(n){return t.size===Qc&&t.clear(),n}),t=e.cache;return e}var qo=Kc;var Zc=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,eh=/\\(\\)?/g,th=qo(function(r){var e=[];return r.charCodeAt(0)===46&&e.push(""),r.replace(Zc,function(t,n,i,o){e.push(i?o.replace(eh,"$1"):n||t)}),e}),Wo=th;function rh(r){return r==null?"":eo(r)}var $o=rh;function nh(r,e){return $(r)?r:pt(r,e)?[r]:Wo($o(r))}var wr=nh;var ih=1/0;function oh(r){if(typeof r=="string"||de(r))return r;var e=r+"";return e=="0"&&1/r==-ih?"-0":e}var Le=oh;function sh(r,e){e=wr(e,r);for(var t=0,n=e.length;r!=null&&t<n;)r=r[Le(e[t++])];return t&&t==n?r:void 0}var Sr=sh;function ah(r,e,t){var n=r==null?void 0:Sr(r,e);return n===void 0?t:n}var Ho=ah;function fh(r,e){for(var t=-1,n=e.length,i=r.length;++t<n;)r[i+t]=e[t];return r}var Ir=fh;var zo=ee?ee.isConcatSpreadable:void 0;function lh(r){return $(r)||dt(r)||!!(zo&&r&&r[zo])}var Jo=lh;function Yo(r,e,t,n,i){var o=-1,s=r.length;for(t||(t=Jo),i||(i=[]);++o<s;){var l=r[o];e>0&&t(l)?e>1?Yo(l,e-1,t,n,i):Ir(i,l):n||(i[i.length]=l)}return i}var Xo=Yo;var uh="Expected a function";function ch(r,e){var t;if(typeof e!="function")throw new TypeError(uh);return r=br(r),function(){return--r>0&&(t=e.apply(this,arguments)),r<=1&&(e=void 0),t}}var Qo=ch;function hh(r,e,t){return r===r&&(t!==void 0&&(r=r<=t?r:t),e!==void 0&&(r=r>=e?r:e)),r}var Ko=hh;function dh(r,e,t){return t===void 0&&(t=e,e=void 0),t!==void 0&&(t=Te(t),t=t===t?t:0),e!==void 0&&(e=Te(e),e=e===e?e:0),Ko(Te(r),e,t)}var Pn=dh;function ph(){this.__data__=new Ae,this.size=0}var Zo=ph;function mh(r){var e=this.__data__,t=e.delete(r);return this.size=e.size,t}var es=mh;function _h(r){return this.__data__.get(r)}var ts=_h;function gh(r){return this.__data__.has(r)}var rs=gh;var bh=200;function vh(r,e){var t=this.__data__;if(t instanceof Ae){var n=t.__data__;if(!Re||n.length<bh-1)return n.push([r,e]),this.size=++t.size,this;t=this.__data__=new ze(n)}return t.set(r,e),this.size=t.size,this}var ns=vh;function bt(r){var e=this.__data__=new Ae(r);this.size=e.size}bt.prototype.clear=Zo;bt.prototype.delete=es;bt.prototype.get=ts;bt.prototype.has=rs;bt.prototype.set=ns;var vt=bt;function xh(r,e){for(var t=-1,n=r==null?0:r.length,i=0,o=[];++t<n;){var s=r[t];e(s,t,r)&&(o[i++]=s)}return o}var is=xh;function yh(){return[]}var os=yh;var Th=Object.prototype,Eh=Th.propertyIsEnumerable,ss=Object.getOwnPropertySymbols,wh=ss?function(r){return r==null?[]:(r=Object(r),is(ss(r),function(e){return Eh.call(r,e)}))}:os,as=wh;function Sh(r,e,t){var n=e(r);return $(r)?n:Ir(n,t(r))}var fs=Sh;function Ih(r){return fs(r,Oe,as)}var On=Ih;var Ph=oe(z,"DataView"),Pr=Ph;var Oh=oe(z,"Promise"),Or=Oh;var Ch=oe(z,"Set"),Cr=Ch;var ls="[object Map]",Ah="[object Object]",us="[object Promise]",cs="[object Set]",hs="[object WeakMap]",ds="[object DataView]",Rh=Ee(Pr),kh=Ee(Re),Lh=Ee(Or),Nh=Ee(Cr),Mh=Ee(yr),Je=se;(Pr&&Je(new Pr(new ArrayBuffer(1)))!=ds||Re&&Je(new Re)!=ls||Or&&Je(Or.resolve())!=us||Cr&&Je(new Cr)!=cs||yr&&Je(new yr)!=hs)&&(Je=function(r){var e=se(r),t=e==Ah?r.constructor:void 0,n=t?Ee(t):"";if(n)switch(n){case Rh:return ds;case kh:return ls;case Lh:return us;case Nh:return cs;case Mh:return hs}return e});var Cn=Je;var Bh=z.Uint8Array,An=Bh;var Fh="__lodash_hash_undefined__";function Uh(r){return this.__data__.set(r,Fh),this}var ps=Uh;function Dh(r){return this.__data__.has(r)}var ms=Dh;function Ar(r){var e=-1,t=r==null?0:r.length;for(this.__data__=new ze;++e<t;)this.add(r[e])}Ar.prototype.add=Ar.prototype.push=ps;Ar.prototype.has=ms;var _s=Ar;function Gh(r,e){for(var t=-1,n=r==null?0:r.length;++t<n;)if(e(r[t],t,r))return!0;return!1}var Rr=Gh;function jh(r,e){return r.has(e)}var gs=jh;var Vh=1,qh=2;function Wh(r,e,t,n,i,o){var s=t&Vh,l=r.length,c=e.length;if(l!=c&&!(s&&c>l))return!1;var d=o.get(r),h=o.get(e);if(d&&h)return d==e&&h==r;var b=-1,x=!0,E=t&qh?new _s:void 0;for(o.set(r,e),o.set(e,r);++b<l;){var I=r[b],S=e[b];if(n)var P=s?n(S,I,b,e,r,o):n(I,S,b,r,e,o);if(P!==void 0){if(P)continue;x=!1;break}if(E){if(!Rr(e,function(A,L){if(!gs(E,L)&&(I===A||i(I,A,t,n,o)))return E.push(L)})){x=!1;break}}else if(!(I===S||i(I,S,t,n,o))){x=!1;break}}return o.delete(r),o.delete(e),x}var kr=Wh;function $h(r){var e=-1,t=Array(r.size);return r.forEach(function(n,i){t[++e]=[i,n]}),t}var bs=$h;function Hh(r){var e=-1,t=Array(r.size);return r.forEach(function(n){t[++e]=n}),t}var vs=Hh;var zh=1,Jh=2,Yh="[object Boolean]",Xh="[object Date]",Qh="[object Error]",Kh="[object Map]",Zh="[object Number]",ed="[object RegExp]",td="[object Set]",rd="[object String]",nd="[object Symbol]",id="[object ArrayBuffer]",od="[object DataView]",xs=ee?ee.prototype:void 0,Rn=xs?xs.valueOf:void 0;function sd(r,e,t,n,i,o,s){switch(t){case od:if(r.byteLength!=e.byteLength||r.byteOffset!=e.byteOffset)return!1;r=r.buffer,e=e.buffer;case id:return!(r.byteLength!=e.byteLength||!o(new An(r),new An(e)));case Yh:case Xh:case Zh:return ct(+r,+e);case Qh:return r.name==e.name&&r.message==e.message;case ed:case rd:return r==e+"";case Kh:var l=bs;case td:var c=n&zh;if(l||(l=vs),r.size!=e.size&&!c)return!1;var d=s.get(r);if(d)return d==e;n|=Jh,s.set(r,e);var h=kr(l(r),l(e),n,i,o,s);return s.delete(r),h;case nd:if(Rn)return Rn.call(r)==Rn.call(e)}return!1}var ys=sd;var ad=1,fd=Object.prototype,ld=fd.hasOwnProperty;function ud(r,e,t,n,i,o){var s=t&ad,l=On(r),c=l.length,d=On(e),h=d.length;if(c!=h&&!s)return!1;for(var b=c;b--;){var x=l[b];if(!(s?x in e:ld.call(e,x)))return!1}var E=o.get(r),I=o.get(e);if(E&&I)return E==e&&I==r;var S=!0;o.set(r,e),o.set(e,r);for(var P=s;++b<c;){x=l[b];var A=r[x],L=e[x];if(n)var O=s?n(L,A,x,e,r,o):n(A,L,x,r,e,o);if(!(O===void 0?A===L||i(A,L,t,n,o):O)){S=!1;break}P||(P=x=="constructor")}if(S&&!P){var U=r.constructor,q=e.constructor;U!=q&&"constructor"in r&&"constructor"in e&&!(typeof U=="function"&&U instanceof U&&typeof q=="function"&&q instanceof q)&&(S=!1)}return o.delete(r),o.delete(e),S}var Ts=ud;var cd=1,Es="[object Arguments]",ws="[object Array]",Lr="[object Object]",hd=Object.prototype,Ss=hd.hasOwnProperty;function dd(r,e,t,n,i,o){var s=$(r),l=$(e),c=s?ws:Cn(r),d=l?ws:Cn(e);c=c==Es?Lr:c,d=d==Es?Lr:d;var h=c==Lr,b=d==Lr,x=c==d;if(x&&qt(r)){if(!qt(e))return!1;s=!0,h=!1}if(x&&!h)return o||(o=new vt),s||Er(r)?kr(r,e,t,n,i,o):ys(r,e,c,t,n,i,o);if(!(t&cd)){var E=h&&Ss.call(r,"__wrapped__"),I=b&&Ss.call(e,"__wrapped__");if(E||I){var S=E?r.value():r,P=I?e.value():e;return o||(o=new vt),i(S,P,t,n,o)}}return x?(o||(o=new vt),Ts(r,e,t,n,i,o)):!1}var Is=dd;function Ps(r,e,t,n,i){return r===e?!0:r==null||e==null||!ae(r)&&!ae(e)?r!==r&&e!==e:Is(r,e,t,n,Ps,i)}var Nr=Ps;var pd=1,md=2;function _d(r,e,t,n){var i=t.length,o=i,s=!n;if(r==null)return!o;for(r=Object(r);i--;){var l=t[i];if(s&&l[2]?l[1]!==r[l[0]]:!(l[0]in r))return!1}for(;++i<o;){l=t[i];var c=l[0],d=r[c],h=l[1];if(s&&l[2]){if(d===void 0&&!(c in r))return!1}else{var b=new vt;if(n)var x=n(d,h,c,r,e,b);if(!(x===void 0?Nr(h,d,pd|md,n,b):x))return!1}}return!0}var Os=_d;function gd(r){return r===r&&!te(r)}var Mr=gd;function bd(r){for(var e=Oe(r),t=e.length;t--;){var n=e[t],i=r[n];e[t]=[n,i,Mr(i)]}return e}var Cs=bd;function vd(r,e){return function(t){return t==null?!1:t[r]===e&&(e!==void 0||r in Object(t))}}var Br=vd;function xd(r){var e=Cs(r);return e.length==1&&e[0][2]?Br(e[0][0],e[0][1]):function(t){return t===r||Os(t,r,e)}}var As=xd;function yd(r,e){return r!=null&&e in Object(r)}var Rs=yd;function Td(r,e,t){e=wr(e,r);for(var n=-1,i=e.length,o=!1;++n<i;){var s=Le(e[n]);if(!(o=r!=null&&t(r,s)))break;r=r[s]}return o||++n!=i?o:(i=r==null?0:r.length,!!i&&ht(i)&&ut(s,i)&&($(r)||dt(r)))}var ks=Td;function Ed(r,e){return r!=null&&ks(r,e,Rs)}var Ls=Ed;var wd=1,Sd=2;function Id(r,e){return pt(r)&&Mr(e)?Br(Le(r),e):function(t){var n=Ho(t,r);return n===void 0&&n===e?Ls(t,r):Nr(e,n,wd|Sd)}}var Ns=Id;function Pd(r){return function(e){return e==null?void 0:e[r]}}var Ms=Pd;function Od(r){return function(e){return Sr(e,r)}}var Bs=Od;function Cd(r){return pt(r)?Ms(Le(r)):Bs(r)}var Fs=Cd;function Ad(r){return typeof r=="function"?r:r==null?oo:typeof r=="object"?$(r)?Ns(r[0],r[1]):As(r):Fs(r)}var me=Ad;function Rd(r){return function(e,t,n){for(var i=-1,o=Object(e),s=n(e),l=s.length;l--;){var c=s[r?l:++i];if(t(o[c],c,o)===!1)break}return e}}var Us=Rd;var kd=Us(),Ds=kd;function Ld(r,e){return r&&Ds(r,e,Oe)}var Gs=Ld;function Nd(r,e){return function(t,n){if(t==null)return t;if(!pe(t))return r(t,n);for(var i=t.length,o=e?i:-1,s=Object(t);(e?o--:++o<i)&&n(s[o],o,s)!==!1;);return t}}var js=Nd;var Md=js(Gs),Fr=Md;var Bd=function(){return z.Date.now()},Ur=Bd;var Fd="Expected a function",Ud=Math.max,Dd=Math.min;function Gd(r,e,t){var n,i,o,s,l,c,d=0,h=!1,b=!1,x=!0;if(typeof r!="function")throw new TypeError(Fd);e=Te(e)||0,te(t)&&(h=!!t.leading,b="maxWait"in t,o=b?Ud(Te(t.maxWait)||0,e):o,x="trailing"in t?!!t.trailing:x);function E(F){var G=n,D=i;return n=i=void 0,d=F,s=r.apply(D,G),s}function I(F){return d=F,l=setTimeout(A,e),h?E(F):s}function S(F){var G=F-c,D=F-d,y=e-G;return b?Dd(y,o-D):y}function P(F){var G=F-c,D=F-d;return c===void 0||G>=e||G<0||b&&D>=o}function A(){var F=Ur();if(P(F))return L(F);l=setTimeout(A,S(F))}function L(F){return l=void 0,x&&n?E(F):(n=i=void 0,s)}function O(){l!==void 0&&clearTimeout(l),d=0,n=c=i=l=void 0}function U(){return l===void 0?s:L(Ur())}function q(){var F=Ur(),G=P(F);if(n=arguments,i=this,c=F,G){if(l===void 0)return I(c);if(b)return clearTimeout(l),l=setTimeout(A,e),E(c)}return l===void 0&&(l=setTimeout(A,e)),s}return q.cancel=O,q.flush=U,q}var Vs=Gd;function jd(r){return function(e,t,n){var i=Object(e);if(!pe(e)){var o=me(t,3);e=Oe(e),t=function(l){return o(i[l],l,i)}}var s=r(e,t,n);return s>-1?i[o?e[s]:s]:void 0}}var qs=jd;var Vd=Math.max;function qd(r,e,t){var n=r==null?0:r.length;if(!n)return-1;var i=t==null?0:br(t);return i<0&&(i=Vd(n+i,0)),uo(r,me(e,3),i)}var Ws=qd;var Wd=qs(Ws),xt=Wd;function $d(r,e){var t=-1,n=pe(r)?Array(r.length):[];return Fr(r,function(i,o,s){n[++t]=e(i,o,s)}),n}var $s=$d;function Hd(r,e){var t=$(r)?gr:$s;return t(r,me(e,3))}var Hs=Hd;function zd(r,e){return Xo(Hs(r,e),1)}var kn=zd;function Jd(r,e){return r<e}var zs=Jd;function Yd(r,e,t){for(var n=-1,i=r.length;++n<i;){var o=r[n],s=e(o);if(s!=null&&(l===void 0?s===s&&!de(s):t(s,l)))var l=s,c=o}return c}var Js=Yd;function Xd(r,e){return r&&r.length?Js(r,me(e,2),zs):void 0}var Ln=Xd;function Qd(r){return Qo(2,r)}var Nn=Qd;var Kd=Math.floor,Zd=Math.random;function ep(r,e){return r+Kd(Zd()*(e-r+1))}var Ys=ep;var tp=parseFloat,rp=Math.min,np=Math.random;function ip(r,e,t){if(t&&typeof t!="boolean"&&Tr(r,e,t)&&(e=t=void 0),t===void 0&&(typeof e=="boolean"?(t=e,e=void 0):typeof r=="boolean"&&(t=r,r=void 0)),r===void 0&&e===void 0?(r=0,e=1):(r=Vt(r),e===void 0?(e=r,r=0):e=Vt(e)),r>e){var n=r;r=e,e=n}if(t||r%1||e%1){var i=np();return rp(r+i*(e-r+tp("1e-"+((i+"").length-1))),e)}return Ys(r,e)}var Ht=ip;function op(r,e){var t;return Fr(r,function(n,i,o){return t=e(n,i,o),!t}),!!t}var Xs=op;function sp(r,e,t){var n=$(r)?Rr:Xs;return t&&Tr(r,e,t)&&(e=void 0),n(r,me(e,3))}var Mn=sp;var ap="Expected a function";function fp(r,e,t){var n=!0,i=!0;if(typeof r!="function")throw new TypeError(ap);return te(t)&&(n="leading"in t?!!t.leading:n,i="trailing"in t?!!t.trailing:i),Vs(r,e,{leading:n,maxWait:e,trailing:i})}var zt=fp;var Ne={};oi(Ne,{BOUNDARY:()=>_e,CCW:()=>lp,CONTAINS:()=>mp,CW:()=>up,END_VERTEX:()=>Ye,INSIDE:()=>dp,INTERLACE:()=>_p,NOT_VERTEX:()=>Dr,ORIENTATION:()=>cp,OUTSIDE:()=>pp,OVERLAP_OPPOSITE:()=>bp,OVERLAP_SAME:()=>gp,PIx2:()=>hp,START_VERTEX:()=>Jt});var lp=!0,up=!1,cp={CCW:-1,CW:1,NOT_ORIENTABLE:0},hp=2*Math.PI,dp=1,pp=0,_e=2,mp=3,_p=4,gp=1,bp=2,Dr=0,Jt=1,Ye=2;var Gr={};oi(Gr,{DECIMALS:()=>vp,EQ:()=>yt,EQ_0:()=>xp,GE:()=>Tp,GT:()=>yp,LE:()=>wp,LT:()=>Ep,getTolerance:()=>Fn,setTolerance:()=>Bn});var ge=1e-6;function Bn(r){ge=r}function Fn(){return ge}var vp=3;function xp(r){return r<ge&&r>-ge}function yt(r,e){return r-e<ge&&r-e>-ge}function yp(r,e){return r-e>ge}function Tp(r,e){return r-e>-ge}function Ep(r,e){return r-e<-ge}function wp(r,e){return r-e<ge}var Qs=class{static get ILLEGAL_PARAMETERS(){return new ReferenceError("Illegal Parameters")}static get ZERO_DIVISION(){return new Error("Zero division")}static get UNRESOLVED_BOUNDARY_CONFLICT(){return new Error("Unresolved boundary conflict in boolean operation")}static get INFINITE_LOOP(){return new Error("Infinite loop")}},Yt=Qs;var Un={Utils:Gr,Errors:Yt,Matrix:void 0,Planar_set:void 0,Point:void 0,Vector:void 0,Line:void 0,Circle:void 0,Segment:void 0,Arc:void 0,Box:void 0,Edge:void 0,Face:void 0,Ray:void 0,Ray_shooting:void 0,Multiline:void 0,Polygon:void 0,Distance:void 0,Inversion:void 0};for(let r in Ne)Un[r]=Ne[r];Object.defineProperty(Un,"DP_TOL",{get:function(){return Fn()},set:function(r){Bn(r)}});var jr=Un;var Ks=class{constructor(e,t){this.first=e,this.last=t||this.first}[Symbol.iterator](){let e;return{next:()=>(e=e?e.next:this.first,{value:e,done:e===void 0})}}get size(){let e=0;for(let t of this)e++;return e}toArray(e=void 0,t=void 0){let n=[],i=e||this.first,o=t||this.last,s=i;if(s===void 0)return n;do n.push(s),s=s.next;while(s!==o.next);return n}append(e){return this.isEmpty()?this.first=e:(e.prev=this.last,this.last.next=e),this.last=e,this.last.next=void 0,this.first.prev=void 0,this}insert(e,t){if(this.isEmpty())this.first=e,this.last=e;else if(t==null)e.next=this.first,this.first.prev=e,this.first=e;else{let n=t.next;t.next=e,n&&(n.prev=e),e.prev=t,e.next=n,this.last===t&&(this.last=e)}return this.last.next=void 0,this.first.prev=void 0,this}remove(e){return e===this.first&&e===this.last?(this.first=void 0,this.last=void 0):(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e===this.first&&(this.first=e.next),e===this.last&&(this.last=e.prev)),this}isEmpty(){return this.first===void 0}static testInfiniteLoop(e){let t=e,n=e;do{if(t!=e&&t===n)throw jr.Errors.INFINITE_LOOP;t=t.next,n=n.next.next}while(t!=e)}},Zs=Ks;function Xt(r,e,t){let n=t.length,i=r.shape.split(e);if(i.length===0)return;let o=0;i[0]===null?o=0:i[1]===null?o=r.shape.length:o=i[0].length;let s=Dr;yt(o,0)&&(s|=Jt),yt(o,r.shape.length)&&(s|=Ye);let l=s&Ye&&r.next.arc_length===0?0:r.arc_length+o;t.push({id:n,pt:e,arc_length:l,edge_before:r,edge_after:void 0,face:r.face,is_vertex:s})}function Vr(r){r.int_points1_sorted=ea(r.int_points1),r.int_points2_sorted=ea(r.int_points2)}function ea(r){let e=new Map,t=0;for(let i of r)e.has(i.face)||(e.set(i.face,t),t++);for(let i of r)i.faceId=e.get(i.face);return r.slice().sort(Sp)}function Sp(r,e){return r.faceId<e.faceId?-1:r.faceId>e.faceId?1:r.arc_length<e.arc_length?-1:r.arc_length>e.arc_length?1:0}function ta(r){if(r.int_points1.length<2)return;let e=!1,t,n,i,o;for(let s=0;s<r.int_points1_sorted.length;s++)if(r.int_points1_sorted[s].id!==-1){t=r.int_points1_sorted[s],n=r.int_points2[t.id];for(let l=s+1;l<r.int_points1_sorted.length&&(i=r.int_points1_sorted[l],!!yt(i.arc_length,t.arc_length));l++)i.id!==-1&&(o=r.int_points2[i.id],o.id!==-1&&i.edge_before===t.edge_before&&i.edge_after===t.edge_after&&o.edge_before===n.edge_before&&o.edge_after===n.edge_after&&(i.id=-1,o.id=-1,e=!0))}n=r.int_points2_sorted[0],t=r.int_points1[n.id];for(let s=1;s<r.int_points2_sorted.length;s++){let l=r.int_points2_sorted[s];if(l.id==-1)continue;if(n.id==-1||!yt(l.arc_length,n.arc_length)){n=l,t=r.int_points1[n.id];continue}let c=r.int_points1[l.id];c.edge_before===t.edge_before&&c.edge_after===t.edge_after&&l.edge_before===n.edge_before&&l.edge_after===n.edge_after&&(c.id=-1,l.id=-1,e=!0)}e&&(r.int_points1=r.int_points1.filter(s=>s.id>=0),r.int_points2=r.int_points2.filter(s=>s.id>=0),r.int_points1.forEach((s,l)=>s.id=l),r.int_points2.forEach((s,l)=>s.id=l))}function Dn(r){for(let e of r)e.edge_before.bvStart=void 0,e.edge_before.bvEnd=void 0,e.edge_before.bv=void 0,e.edge_before.overlap=void 0,e.edge_after.bvStart=void 0,e.edge_after.bvEnd=void 0,e.edge_after.bv=void 0,e.edge_after.overlap=void 0;for(let e of r)e.edge_before.bvEnd=_e,e.edge_after.bvStart=_e}function Gn(r,e){for(let t of r)t.edge_before.setInclusion(e),t.edge_after.setInclusion(e)}function ra(r){let e,t,n,i=r.int_points1.length;for(let o=0;o<i;o++){let s=r.int_points1_sorted[o];s.face!==e&&(t=o,e=s.face);let l=o,c=Xe(r.int_points1_sorted,o,e),d;l+c<i&&r.int_points1_sorted[l+c].face===e?d=l+c:d=t;let h=Xe(r.int_points1_sorted,d,e);n=null;for(let A=d;A<d+h;A++){let L=r.int_points1_sorted[A];if(L.face===e&&r.int_points2[L.id].face===r.int_points2[s.id].face){n=L;break}}if(n===null)continue;let b=s.edge_after,x=n.edge_before;if(!(b.bv===_e&&x.bv===_e)||b!==x)continue;let E=r.int_points2[s.id],I=r.int_points2[n.id],S=E.edge_after,P=I.edge_before;S.bv===_e&&P.bv===_e&&S===P||(E=r.int_points2[n.id],I=r.int_points2[s.id],S=E.edge_after,P=I.edge_before),S.bv===_e&&P.bv===_e&&S===P&&b.setOverlap(S)}}function Xe(r,e,t){let n,i,o=1;if(r.length==1)return 1;n=r[e];for(let s=e+1;s<r.length&&!(n.face!=t||(i=r[s],!(i.pt.equalTo(n.pt)&&i.edge_before===n.edge_before&&i.edge_after===n.edge_after)));s++)o++;return o}function jn(r,e){if(!!e){for(let t of e){let n=t.edge_before;if(t.is_vertex=Dr,n.shape.start&&n.shape.start.equalTo(t.pt)&&(t.is_vertex|=Jt),n.shape.end&&n.shape.end.equalTo(t.pt)&&(t.is_vertex|=Ye),t.is_vertex&Jt){t.edge_before=n.prev,t.is_vertex=Ye;continue}if(t.is_vertex&Ye)continue;let i=r.addVertex(t.pt,n);t.edge_before=i}for(let t of e)t.edge_after=t.edge_before.next}}var{INSIDE:be,OUTSIDE:ve,BOUNDARY:Y,OVERLAP_SAME:Ip,OVERLAP_OPPOSITE:Pp}=Ne,{NOT_VERTEX:RT,START_VERTEX:na,END_VERTEX:ia}=Ne,Vn=1,ca=2,Qt=3;function ha(r,e){let[t,n]=pa(r,e,Vn,!0);return t}function da(r,e){let n=e.clone().reverse(),[i,o]=pa(r,n,Qt,!0);return i}function Op(r,e,t,n){let i=oa(r,t.int_points1),o=oa(e,t.int_points2);for(sa(i,e),sa(o,r),Dn(t.int_points1),Dn(t.int_points2),Gn(t.int_points1,e),Gn(t.int_points2,r);Rp(r,e,t.int_points1,t.int_points1_sorted,t.int_points2,t););ra(t),aa(r,n,t.int_points1_sorted,!0),aa(e,n,t.int_points2_sorted,!1),ua(r,i,n,!0),ua(e,o,n,!1)}function Cp(r,e,t,n){kp(r,e,n,t.int_points2),Lp(r,e,t),fa(r,t.int_points1),fa(e,t.int_points2),la(r,t.int_points1,t.int_points2),la(r,t.int_points2,t.int_points1)}function pa(r,e,t,n){let i=r,o=e.clone(),s=Ap(i,o);return Vr(s),jn(i,s.int_points1_sorted),jn(o,s.int_points2_sorted),ta(s),Vr(s),Op(i,o,s,t),n&&Cp(i,o,s,t),[i,o]}function Ap(r,e){let t={int_points1:[],int_points2:[]};for(let n of e.edges){let i=r.edges.search(n.box);for(let o of i){let s=n.shape.intersect(o.shape);for(let l of s)Xt(n,l,t.int_points2),Xt(o,l,t.int_points1)}}return t}function oa(r,e){let t=[];for(let n of r.faces)e.find(i=>i.face===n)||t.push(n);return t}function sa(r,e){for(let t of r)t.first.bv=t.first.bvStart=t.first.bvEnd=void 0,t.first.setInclusion(e)}function Rp(r,e,t,n,i,o){let s,l,c,d=n.length,h=!1;for(let b=0;b<d;b++){let x=n[b];x.face!==s&&(l=b,s=x.face);let E=b,I=Xe(n,b,s),S;E+I<d&&n[E+I].face===s?S=E+I:S=l;let P=Xe(n,S,s);c=null;for(let O=S;O<S+P;O++){let U=n[O];if(U.face===s&&i[U.id].face===i[x.id].face){c=U;break}}if(c===null)continue;let A=x.edge_after,L=c.edge_before;if(A.bv===Y&&L.bv!=Y){A.bv=L.bv;continue}if(A.bv!=Y&&L.bv===Y){L.bv=A.bv;continue}if(A.bv===Y&&L.bv===Y&&A!=L||A.bv===be&&L.bv===ve||A.bv===ve&&L.bv===be){let O=A.next;for(;O!=L;)O.bvStart=void 0,O.bvEnd=void 0,O.bv=void 0,O.setInclusion(e),O=O.next}if(A.bv===Y&&L.bv===Y&&A!=L){let O=A.next,U;for(;O!=L;){if(O.bv!=Y){if(U===void 0)U=O.bv;else if(O.bv!=U)throw Yt.UNRESOLVED_BOUNDARY_CONFLICT}O=O.next}U!=null&&(A.bv=U,L.bv=U);continue}if(A.bv===be&&L.bv===ve||A.bv===ve&&L.bv===be){let O=A;for(;O!=L;){if(O.bvStart===A.bv&&O.bvEnd===L.bv){let[U,q]=O.shape.distanceTo(e);if(U<10*jr.DP_TOL){Xt(O,q.ps,t);let F=t[t.length-1];if(F.is_vertex&na)F.edge_after=O,F.edge_before=O.prev,O.bvStart=Y,O.bv=void 0,O.setInclusion(e);else if(F.is_vertex&ia)F.edge_after=O.next,O.bvEnd=Y,O.bv=void 0,O.setInclusion(e);else{let y=e.addVertex(F.pt,O);F.edge_before=y,F.edge_after=y.next,y.setInclusion(e),y.next.bvStart=Y,y.next.bvEnd=void 0,y.next.bv=void 0,y.next.setInclusion(e)}let G=e.findEdgeByPoint(q.pe);Xt(G,q.pe,i);let D=i[i.length-1];if(D.is_vertex&na)D.edge_after=G,D.edge_before=G.prev;else if(D.is_vertex&ia)D.edge_after=G.next;else{let y=i.find(v=>v.edge_after===G),g=e.addVertex(D.pt,G);D.edge_before=g,D.edge_after=g.next,y&&(y.edge_after=g),g.bvStart=void 0,g.bvEnd=Y,g.bv=void 0,g.setInclusion(r),g.next.bvStart=Y,g.next.bvEnd=void 0,g.next.bv=void 0,g.next.setInclusion(r)}Vr(o),h=!0;break}}O=O.next}if(h)break;throw Yt.UNRESOLVED_BOUNDARY_CONFLICT}}return h}function aa(r,e,t,n){if(!t)return;let i,o,s,l;for(let c=0;c<t.length;c++){if(s=t[c],s.face!==i&&(o=c,i=s.face),i.isEmpty())continue;let d=c,h=Xe(t,c,i),b;d+h<t.length&&t[d+h].face===s.face?b=d+h:b=o,l=t[b];let x=b,E=Xe(t,x,i),I=s.edge_after,S=l.edge_before;if(I.bv===be&&S.bv===be&&e===Vn||I.bv===ve&&S.bv===ve&&e===ca||(I.bv===ve||S.bv===ve)&&e===Qt&&!n||(I.bv===be||S.bv===be)&&e===Qt&&n||I.bv===Y&&S.bv===Y&&I.overlap&Ip&&n||I.bv===Y&&S.bv===Y&&I.overlap&Pp){r.removeChain(i,I,S);for(let P=d;P<d+h;P++)t[P].edge_after=void 0;for(let P=x;P<x+E;P++)t[P].edge_before=void 0}c+=h-1}}function kp(r,e,t,n){for(let i of e.faces){for(let o of i)r.edges.add(o);n.find(o=>o.face===i)===void 0&&r.addFace(i.first,i.last)}}function Lp(r,e,t){if(t.int_points1.length!==0)for(let n=0;n<t.int_points1.length;n++){let i=t.int_points1[n],o=t.int_points2[n];if(i.edge_before!==void 0&&i.edge_after===void 0&&o.edge_before===void 0&&o.edge_after!==void 0&&(i.edge_before.next=o.edge_after,o.edge_after.prev=i.edge_before,i.edge_after=o.edge_after,o.edge_before=i.edge_before),o.edge_before!==void 0&&o.edge_after===void 0&&i.edge_before===void 0&&i.edge_after!==void 0&&(o.edge_before.next=i.edge_after,i.edge_after.prev=o.edge_before,o.edge_after=i.edge_after,i.edge_before=o.edge_before),i.edge_before!==void 0&&i.edge_after===void 0)for(let s of t.int_points1_sorted)s!==i&&s.edge_before===void 0&&s.edge_after!==void 0&&s.pt.equalTo(i.pt)&&(i.edge_before.next=s.edge_after,s.edge_after.prev=i.edge_before,i.edge_after=s.edge_after,s.edge_before=i.edge_before);if(o.edge_before!==void 0&&o.edge_after===void 0)for(let s of t.int_points2_sorted)s!==o&&s.edge_before===void 0&&s.edge_after!==void 0&&s.pt.equalTo(o.pt)&&(o.edge_before.next=s.edge_after,s.edge_after.prev=o.edge_before,o.edge_after=s.edge_after,s.edge_before=o.edge_before)}}function fa(r,e){for(let t of e)r.faces.delete(t.face),t.face=void 0,t.edge_before&&(t.edge_before.face=void 0),t.edge_after&&(t.edge_after.face=void 0)}function la(r,e,t){for(let n of e){if(n.edge_before===void 0||n.edge_after===void 0||n.face||n.edge_after.face||n.edge_before.face)continue;let i=n.edge_after,o=n.edge_before;Zs.testInfiniteLoop(i);let s=r.addFace(i,o);for(let l of e)l.edge_before&&l.edge_after&&l.edge_before.face===s&&l.edge_after.face===s&&(l.face=s);for(let l of t)l.edge_before&&l.edge_after&&l.edge_before.face===s&&l.edge_after.face===s&&(l.face=s)}}function ua(r,e,t,n){for(let i of e){let o=i.first.bv;(t===Vn&&o===be||t===Qt&&o===be&&n||t===Qt&&o===ve&&!n||t===ca&&o===ve)&&r.deleteFace(i)}}var qn=class{multipolygon=new k.Polygon;constructor(e){let t=$t(this.intersects,n=>{let{cache:i}=t;return i.size===3e4&&i.clear?.(),`${n.xmin}_${n.xmax}_${n.ymin}_${n.ymax}`});this.intersects=t;for(let n of e)this.multipolygon.addFace(n.map(i=>new k.Point(i.x,i.y)))}makeHole(e,t,n){da(this.multipolygon,new k.Polygon(new k.Circle(new k.Point(e,t),n))),this.intersects.cache.clear()}draw(e,t,n){ha(this.multipolygon,new k.Polygon(new k.Circle(new k.Point(e,t),n))),this.intersects.cache.clear()}intersects(e){let t=new Array;for(let{shape:n}of this.multipolygon.edges.search(e)){let i=n.intersect(e);i.length>0&&t.push({shape:n,points:i})}return t}intersectsShapeSome(e){for(let t of this.multipolygon.edges.search(e.box))if(t.shape.intersect(e).length>0)return!0;return!1}intersectsSeg(e){for(let{shape:t}of this.multipolygon.edges.search(e.box))if(t.intersect(e).length>0)return!0;return!1}intersectsSeg2(e){let t=new Array;for(let{shape:n}of this.multipolygon.edges.search(e.box)){let i=n.intersect(e);i.length>0&&t.push(...i)}return t}};var re=class{x;y;velocity;constructor(e,t,n=0,i=0){this.x=e,this.y=t,this.velocity=new k.Vector(n,i)}beforeUpdate(e){}onEntityCollide(e){}onOutOfWorld(e){}onUnderwater(){}onGroundCollide(e,t,n){return!0}onResolve(e,t){}};var Wn=new Map;function ma(r){for(let e of C.gameEntities){Wn.set(e,{x:e.x,y:e.y,velocity:e.velocity.clone()});let t=1/r;if(e.beforeUpdate(t),e.type===1){let i=new k.Vector(0,e.mass*1540);e.velocity=e.velocity.add(i.multiply(t))}e.x+=e.velocity.x*t,e.y+=e.velocity.y*t}for(let e of C.gameEntities){if(e.collideWithEntities)for(let o of C.gameEntities){if(o===e)continue;let s=new k.Box(e.x,e.y,e.x+e.width,e.y+e.height),l=new k.Box(o.x,o.y,o.x+o.width,o.y+o.height);s.intersect(l)&&e.onEntityCollide(o)}e.y<=-5e3||e.x>=5e3||e.x<=-5e3?(e.onOutOfWorld(!1),e.type===0&&C.gameEntities.delete(e)):e.y>=C.waterOffset+150&&(e.onOutOfWorld(!0),C.gameEntities.delete(e)),e.y>=C.waterOffset-e.height&&e.onUnderwater();let t=e.x,n=e.y,i=e.collideWithGround?C.terrain.intersects(new k.Box(t,n,t+e.width,n+e.height)):[];if(i.length>0){if(!e.onGroundCollide(t,n,i))continue;let s=Wn.get(e);if(e.x=s.x,e.y=s.y,e.velocity=s.velocity,e.velocity.length<e.bounceThreshold){e.velocity=new k.Vector,e.onResolve(!0,i);continue}let l=i[0],c;l.shape instanceof k.Arc?c=new k.Vector(l.points[0],l.shape.pc).normalize():c=new k.Vector(l.shape.ps,l.shape.pe).rotate90CCW().normalize();let d=c.multiply(e.velocity.dot(c)),h=e.velocity.subtract(d);e.velocity=h.multiply(e.COF).subtract(d.multiply(e.COR))}e.onResolve(!1,i)}Wn.clear()}var $n=450,Hn=10,Me=class extends re{type=0;width=10;height=10;COF=1;COR=1;bounceThreshold=9e3;collideWithEntities=!1;collideWithGround=!1;mass=1;pinPoint=null;initialPosition;charCol;center(){return new k.Point(this.x+this.width/2,this.y+this.height/2)}constructor(e,t){let n=C.currentControlledChar.collider,i=n.center();super(i.x-5,i.y-5,e,t);this.charCol=n,C.hookShot=this;let o=this.velocity.normalize().multiply($n),s=C.terrain.multipolygon.intersect(new k.Segment(i,new k.Point(i.x+o.x,i.y+o.y)));s.length>0&&(this.pinPoint=Ln(s,l=>l.distanceTo(i)[0]),this.initialPosition=i)}beforeUpdate(e){let t=this.charCol,n=this.center();if(t.testGavnina===!1){let i=t.center(),[o]=i.distanceTo(n);if(o>$n){C.gameEntities.delete(this),Tt("idle");return}if(this.pinPoint===null)return;let s=1/e,l=this.velocity.length/s,c=this.velocity.normalize().multiply(l),d=new k.Point(n.x+c.x,n.y+c.y),[h]=this.initialPosition.distanceTo(d),[b]=this.initialPosition.distanceTo(this.pinPoint);if(h>=b){this.velocity=new k.Vector,this.x=this.pinPoint.x-this.width/2,this.y=this.pinPoint.y-this.height/2,this.pinPoint=null;let x=this.center(),E=t.center(),I=new k.Vector(E,x);if(C.terrain.intersectsSeg2(new k.Segment(E,new k.Point(E.x+I.x,E.y+I.y))).filter(P=>P.equalTo(x)===!1).length>0){C.gameEntities.delete(this),Tt("idle");return}t.initialPointX=x.x,t.initialPointY=x.y,globalThis.point_i=0,C.hookSegments.length=0;for(let P=1;P<$n/Hn;P++){let A=new Qe(0,0);A.i=P,A.updateToMatchChar(!0),C.gameEntities.add(A),C.hookSegments.push(A)}t.testGavnina=!0}}}onOutOfWorld(e){let t=this.charCol;t.testGavnina=!1}};var eE=zt((...r)=>{console.log(...r)},75),zn=!1,Qe=class extends re{type=0;width=6;height=6;COF=1;COR=1;bounceThreshold=1/0;collideWithEntities=!1;mass=1;get collideWithGround(){return!1}i;active=!0;checkpoint=!1;halfWidth=this.width/2;halfHeight=this.height/2;arr;updateToMatchChar(e){let t=C.hookShot.charCol,n=t.pointX,i=t.pointY;e&&(n=t.initialPointX,i=t.initialPointY);let o=t.center(),s=(this.i-globalThis.point_i)*10,l=new k.Vector(new k.Point(n,i),o).normalize().multiply(s);this.x=n+l.x-this.halfWidth,this.y=i+l.y-this.halfHeight}beforeUpdate(e){let t=C.hookShot.charCol;zn=!1,t.testGavnina===!1,this.active&&this.updateToMatchChar(!1)}onResolve(e){let t=C.hookShot.charCol;if(this.active&&zn===!1&&this.isVisible()){let o=new k.Point(this.x+this.halfWidth,this.y+this.halfHeight),s=new k.Point(t.pointX??t.initialPointX,t.pointY??t.initialPointY),l=new k.Vector(o,s),c=Hn,d=l.normalize().multiply(c/2),h=d.rotate(Math.PI);C.terrain.intersectsSeg(new k.Segment(new k.Point(o.x+d.x,o.y+d.y),new k.Point(o.x+h.x,o.y+h.y)))&&this.handleCollision()}let n=C.hookSegments;if(this!==n[0])return;let i=new Array;for(let o of n)o.checkpoint&&i.push(o);i.reverse(),i=i.slice(0,1);for(let o of i){let[s,l,c,d,h,b]=o.arr,x=new k.Vector(new k.Point(l,c),new k.Point(t.x+t.width/2,t.y+t.height/2)).cross(d);if(b==="RIGHT"&&x<0||b==="LEFT"&&x>0){if(h===0)for(let E of n)E.active=!0;else for(let E of n)E.i>h&&(E.active=!0);t.pointX=l,t.pointY=c,globalThis.point_i=h,s.checkpoint=!1;break}}}isVisible(){let e=C.hookShot.charCol,t=new k.Point(e.pointX??e.initialPointX,e.pointY??e.initialPointY),[n]=t.distanceTo(new k.Point(e.x+e.width/2,e.y+e.height/2)),[i]=t.distanceTo(new k.Point(this.x+this.halfWidth,this.y+this.halfHeight));return i<n}handleCollision(){let e=C.hookShot.charCol;e.x=e.prevState.x,e.y=e.prevState.y,e.velocity=e.prevState.velocity,e.aVelocity=e.prevState.aVelocity;for(let t of C.hookSegments)t.active&&t.updateToMatchChar(!1);zn=!0,this.checkpoint=!0,this.arr=[this,e.pointX,e.pointY,new k.Vector(new k.Point(e.pointX,e.pointY),new k.Point(e.x+e.width/2,e.y+e.height/2)),globalThis.point_i,e.aVelocity<0?"LEFT":e.aVelocity===0?"STOP":"RIGHT"];for(let t=0;t<this.i-1+1;t++)C.hookSegments[t].active=!1;return e.pointX=this.x+this.halfWidth,e.pointY=this.y+this.halfHeight,globalThis.point_i=this.i,!1}};var wt=class extends re{type=1;width=15;height=25;COF=.3;COR=.5;bounceThreshold=75;collideWithEntities=!1;collideWithGround=!0;mass=1;angle=0;boom=Nn(()=>{setTimeout(()=>{Be(this.x,this.y,75),C.gameEntities.delete(this),ne("grenadeExplosion");let e=new k.Circle(new k.Point(this.x,this.y),90);for(let t of C.gameEntities)if(!(t instanceof Qe||t instanceof Me)){for(let n of new k.Box(t.x,t.y,t.x+t.width,t.y+t.height).toPoints())if(e.contains(n)){let i=new k.Vector(0,-1e3);t.velocity=t.velocity.add(i);break}}},1e3)});beforeUpdate(e){let t=i(this.velocity.slope),n=40;this.angle+=this.velocity.length/n*(t>270||t<90?1:-1)*e,this.angle%=Math.PI*2;function i(o){var s=Math.PI;return o*(180/s)}}onResolve(e,t){t.length>0&&!e&&ne("grenadeBounce"),e&&this.boom()}onOutOfWorld(e){e&&ne("waterSplash1")}};var St=class extends re{type=1;width=20;height=20;COF=1;COR=1;bounceThreshold=1e3;collideWithEntities=!0;collideWithGround=!0;mass=1;beforeUpdate(e){let t=new k.Vector(-1e3,0);this.velocity=this.velocity.add(t.multiply(e))}onOutOfWorld(e){e&&ne("waterSplash1")}onGroundCollide(e,t){return this.boom(),!1}boom(){Be(this.x,this.y,75),C.gameEntities.delete(this),ne("rocketExplosion")}};var It=class extends re{type=0;width=10;height=10;COF=1;COR=1;bounceThreshold=1e3;collideWithEntities=!0;collideWithGround=!0;mass=1;beforeUpdate(e){}onOutOfWorld(e){e&&ne("waterSplash1")}onGroundCollide(e,t){return this.boom(),!1}boom(){Be(this.x,this.y,30),C.gameEntities.delete(this),ne("grenadeExplosion")}};var qr=class extends re{type=1;width=13;height=60;COF=.7;COR=.15;bounceThreshold=1100;collideWithEntities=!1;collideWithGround=!0;mass=1;_testGavnina=!1;pointX;pointY;initialPointX;initialPointY;aVelocity=0;pull="none";prevState;center(){return new k.Point(this.x+this.width/2,this.y+this.height/2)}set testGavnina(e){if(this._testGavnina=e,e){Tt("rope"),xt([...C.characters],s=>s.collider===this).characterService.send("GRAB_ONTO_HOOK"),this.type=0,this.bounceThreshold=1/0;let n=C.hookShot;this.pointX=n.x+n.width/2,this.pointY=n.y+n.height/2;let i=new k.Vector(new k.Point(this.x+this.width/2,this.y+this.height/2),new k.Point(this.pointX,this.pointY)),o=i.slope;this.aVelocity=(o>=1.5*Math.PI||o<=.5*Math.PI?this.velocity.length:-this.velocity.length)/2,this.aVelocity=i.cross(this.velocity)/300,this.aVelocity=i.normalize().cross(this.velocity)*.66,this.velocity=new k.Vector}else{this.type=1,this.bounceThreshold=1100,C.gameEntities.delete(C.hookShot);for(let n of C.hookSegments)C.gameEntities.delete(n);Tt("idle");let t=xt([...C.characters],n=>n.collider===this);t.startJumpAnim="FORWARD",t.characterService.send("DEATTACH_ROPE")}}get testGavnina(){return this._testGavnina}beforeUpdate(e){if(this.prevState={x:this.x,y:this.y,velocity:this.velocity,aVelocity:this.aVelocity},this.testGavnina===!1){let b=xt([...C.characters],x=>x.collider===this);if(b.statNew==="preparationForJump"){let x=performance.now()-b.animState.startTime,E=1e3/24,I=globalThis.tickCounter,P=b.animState.anim.frameCount*E/(e*1e3);if(I>=b.startJumpTick+P){if(b.collider.testGavnina)return;b.jump()}}return}let t=this.center(),n=new k.Point(this.pointX,this.pointY),i=new k.Vector(t,n),o=4,s=.997,l=new k.Vector(0,1).cross(i)/i.length;this.aVelocity+=-1*o*l,this.aVelocity*=s;let c=i.normalize().multiply(this.aVelocity),d=c.rotate90CCW(),h=new k.Vector(0,0);if(this.pull==="W")h=i.normalize().multiply(200);else if(this.pull==="S"){let b=C.hookSegments.at(-1),[x]=n.distanceTo(t),[E]=n.distanceTo(new k.Point(b.x+b.halfWidth,b.y+b.halfHeight));E<x||(h=i.normalize().multiply(-200))}this.velocity=d.add(c.multiply(e).add(h))}onGroundCollide(e,t,n){return this.testGavnina&&(this.aVelocity*=-1),!0}onResolve(e,t){let n=xt([...C.characters],o=>o.collider===this),i=n.collider;if(e===!1&&t.length>0){n.startJumpAnim="FORWARD";return}if(e&&Mn(kn(t,o=>o.points),o=>o.y>=i.y+this.height*.75)&&n.characterService.send("GROUND"),n.moves!=="none"&&n.isGrounded&&(n.looksToLeft=n.moves==="left",n.characterService.send("START_MOVING")),i.velocity.length>90){n.startJumpAnim="FORWARD",n.characterService.send("TELEPORT");return}n.statNew==="moves"&&_a(i,150*(n.looksToLeft?-1:1))}onUnderwater(){this.testGavnina===!0&&(this.testGavnina=!1),this.velocity=new k.Vector,this.x=Ht(300,3100),this.y=-300}};function ga(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n,i,o=t.call(r),s=[];try{for(;(e===void 0||e-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(l){i={error:l}}finally{try{n&&!n.done&&(t=o.return)&&t.call(o)}finally{if(i)throw i.error}}return s}var Pt;(function(r){r[r.NotStarted=0]="NotStarted",r[r.Running=1]="Running",r[r.Stopped=2]="Stopped"})(Pt||(Pt={}));var Ta={type:"xstate.init"};function Jn(r){return r===void 0?[]:[].concat(r)}function ba(r,e){return typeof(r=typeof r=="string"&&e&&e[r]?e[r]:r)=="string"?{type:r}:typeof r=="function"?{type:r.name,exec:r}:r}function Wr(r){return function(e){return r===e}}function Ea(r){return typeof r=="string"?{type:r}:r}function va(r,e){return{value:r,context:e,actions:[],changed:!1,matches:Wr(r)}}function xa(r,e,t){var n=e,i=!1;return[r.filter(function(o){if(o.type==="xstate.assign"){i=!0;var s=Object.assign({},n);return typeof o.assignment=="function"?s=o.assignment(n,t):Object.keys(o.assignment).forEach(function(l){s[l]=typeof o.assignment[l]=="function"?o.assignment[l](n,t):o.assignment[l]}),n=s,!1}return!0}),n,i]}function wa(r,e){e===void 0&&(e={});var t=ga(xa(Jn(r.states[r.initial].entry).map(function(s){return ba(s,e.actions)}),r.context,Ta),2),n=t[0],i=t[1],o={config:r,_options:e,initialState:{value:r.initial,actions:n,context:i,matches:Wr(r.initial)},transition:function(s,l){var c,d,h=typeof s=="string"?{value:s,context:r.context}:s,b=h.value,x=h.context,E=Ea(l),I=r.states[b];if(I.on){var S=Jn(I.on[E.type]);try{for(var P=function(_){var w=typeof Symbol=="function"&&Symbol.iterator,R=w&&_[w],B=0;if(R)return R.call(_);if(_&&typeof _.length=="number")return{next:function(){return _&&B>=_.length&&(_=void 0),{value:_&&_[B++],done:!_}}};throw new TypeError(w?"Object is not iterable.":"Symbol.iterator is not defined.")}(S),A=P.next();!A.done;A=P.next()){var L=A.value;if(L===void 0)return va(b,x);var O=typeof L=="string"?{target:L}:L,U=O.target,q=O.actions,F=q===void 0?[]:q,G=O.cond,D=G===void 0?function(){return!0}:G,y=U===void 0,g=U??b,v=r.states[g];if(D(x,E)){var T=ga(xa((y?Jn(F):[].concat(I.exit,F,v.entry).filter(function(_){return _})).map(function(_){return ba(_,o._options.actions)}),x,E),3),m=T[0],f=T[1],u=T[2],p=U??b;return{value:p,context:f,actions:m,changed:U!==b||m.length>0||u,matches:Wr(p)}}}}catch(_){c={error:_}}finally{try{A&&!A.done&&(d=P.return)&&d.call(P)}finally{if(c)throw c.error}}}return va(b,x)}};return o}var ya=function(r,e){return r.actions.forEach(function(t){var n=t.exec;return n&&n(r.context,e)})};function Sa(r){var e=r.initialState,t=Pt.NotStarted,n=new Set,i={_machine:r,send:function(o){t===Pt.Running&&(e=r.transition(e,o),ya(e,Ea(o)),n.forEach(function(s){return s(e)}))},subscribe:function(o){return n.add(o),o(e),{unsubscribe:function(){return n.delete(o)}}},start:function(o){if(o){var s=typeof o=="object"?o:{context:r.config.context,value:o};e={value:s.value,actions:[],context:s.context,matches:Wr(s.value)}}else e=r.initialState;return t=Pt.Running,ya(e,Ta),i},stop:function(){return t=Pt.Stopped,n.clear(),i},get state(){return e},get status(){return t}};return i}var Ia=wa({id:"character",initial:"idle",states:{idle:{on:{START_MOVING:"moves",START_JUMP:"preparationForJump",TELEPORT:"falls",GRAB_ONTO_HOOK:"onRope",DAMAGE:"damage"}},moves:{on:{STOP_MOVING:"idle",START_JUMP:"preparationForJump",GRAB_ONTO_HOOK:"onRope",DAMAGE:"damage",TELEPORT:"falls"}},preparationForJump:{on:{TELEPORT:"falls",GRAB_ONTO_HOOK:"onRope",DAMAGE:"damage"}},falls:{on:{GROUND:"idle",GRAB_ONTO_HOOK:"onRope",DAMAGE:"damage"}},onRope:{on:{DEATTACH_ROPE:"falls"}},damage:{on:{GROUND:"idle"}}}});var Fe=144,Pa=0,$r=0,Np;function Oa(r){let t=0;for(let o of r)for(let s of o)s.y>t&&(t=s.y);pi({terrain:new qn(r),waterOffset:t-150,gameEntities:new Set,characters:new Set,weaponBoxes:new Set,holes:[],terrainOffsetX:0,terrainOffsetY:0,hookSegments:[]}),setInterval(function(){if(C.weaponBoxes.size===25)return;let s=new Aa(Ht(300,2900),-300);C.gameEntities.add(s.collider),C.weaponBoxes.add(s)},3e3);function n(){let o=performance.now();o-Pa>1e3&&(globalThis.freq2=$r,$r=0,Pa=o),$r++,Fp()}let i=zt(n,4.25);Np=0,setTimeout(()=>{let o=new Bp(1e3/Fe,n)},0),Mp(n)}function Mp(r){let e=1e3/Fe,t=performance.now(),n=0;setInterval(i,1e3/60);function i(){let o=performance.now(),s=o-t;for(t=o,n+=s;n>=e;)r(),n-=e}}function Bp(r,e){var t=this;this.baseline=void 0,this.run=function(){t.baseline===void 0&&(t.baseline=new Date().getTime()),e();var n=new Date().getTime();t.baseline+=r;var i=r-(n-t.baseline);i<0&&(i=0),t.timer=setTimeout(function(){t.run(n)},i)},this.stop=function(){clearTimeout(t.timer)}}var Ca=class extends re{type=1;width=30;height=30;COF=.7;COR=.15;bounceThreshold=100;collideWithEntities=!0;collideWithGround=!0;mass=1;onOutOfWorld(){}onEntityCollide(e){e instanceof qr&&(C.gameEntities.delete(this),[...C.weaponBoxes].forEach(t=>{t.collider===this&&C.weaponBoxes.delete(t)}))}},Aa=class{collider;creationTime;constructor(e,t){this.collider=new Ca(e,t),this.creationTime=performance.now()}},Ra=class{collider;looksToLeft;name;health;team;animState;startJumpAnim;startJumpTick;handTool="bazooka";angle=90;aim="none";moves="none";stateMachine;characterService;get statNew(){return this.characterService.state.value}constructor(e,t,n){this.collider=e,this.looksToLeft=!1,this.name=t,this.health=530,this.team=n,this.stateMachine=Ia;let i=Sa(this.stateMachine);i.subscribe(o=>{if(o.changed===!1)return;let s;switch(o.value){case"idle":s=new ye(Z.rabbitBreath);break;case"moves":s=new ye(Z.rabbitGo);break;case"preparationForJump":s=new ye(Z.rabbitPrepareToJump);break;case"falls":this.startJumpAnim==="FORWARD"?s=new ye(Z.rabbitJump):s=new ye(Z.rabbitJumpBack);break;case"onRope":s=new ye(Z.rabbitBreath);break;case"damage":s=new ye(Z.rabbitBreath);break}this.animState=s}),i.start(),this.characterService=i,globalThis.test3=i,globalThis.test4=this.stateMachine}get isGrounded(){return this.collider.velocity.x===0&&this.collider.velocity.y===0}jump(){this.startJumpAnim==="FORWARD"?this.collider.velocity=new k.Vector(this.looksToLeft?-265:265,-420):this.collider.velocity=new k.Vector(this.looksToLeft?60:-60,-575)}};globalThis.tickCounter=0;globalThis.stopGameLoop=!1;globalThis.restore=!1;async function Fp(){if(globalThis.stopGameLoop)return;let r=C.currentControlledChar;if(r!==void 0&&r.aim!=="none"){let e=1/Fe;r.aim==="up"?r.angle+=130*e:r.angle-=130*e,r.angle=Pn(r.angle,0,180)}ma(Fe*(globalThis.bulletTime?7:1)),globalThis.tickCounter++,globalThis.callback2!==void 0&&await globalThis.callback2()}function ka(r){let e=C.currentControlledChar,t=1500;r<1e3&&(t=75*Math.ceil(r/50));let n=e.handTool;n==="rifle"?t=1500:n==="hook"&&(t=1400);let i=e.angle,o=(e.looksToLeft?i+90:450-i)*Math.PI/180,s=t*Math.cos(o),l=t*Math.sin(o);switch(n){case"gren":C.gameEntities.add(new wt(e.collider.x,e.collider.y,s,l)),ne("grenadeAttack");break;case"bazooka":C.gameEntities.add(new St(e.collider.x,e.collider.y,s,l)),ne("rocketAttack");break;case"rifle":ne("grenadeAttack"),C.gameEntities.add(new It(e.collider.x,e.collider.y,s,l));break;case"hook":C.gameEntities.add(new Me(s,l)),ne("grenadeAttack");break}}function _a(r,e){let n=e/Fe,i=0,o=r.x+n;for(let s=.9375;s<=.9375*8;s+=.9375){let l=r.y+s;if(C.terrain.intersectsShapeSome(new k.Box(o,l,o+r.width,l+r.height))){i=s-.9375;break}}if(i>0){r.y+=i,r.x+=n;return}for(let s=0;s<=.9375*7;s+=.9375){let l=r.y-s;if(C.terrain.intersectsShapeSome(new k.Box(o,l,o+r.width,l+r.height))===!1){r.y-=s,r.x+=n;return}}}function Be(r,e,t){C.holes.push({cx:r,cy:e,r:t}),C.terrain.makeHole(r,e,t)}function Yn(r,e,t,n){let i=new qr(r,e),o=new Ra(i,t??"\u041A\u043E\u043B\u044F",n);return C.gameEntities.add(i),C.characters.add(o),o}var Hr=class extends Error{constructor(e){super(e!=null?`Timed out after waiting for ${e} ms`:"Timed out"),Object.setPrototypeOf(this,Hr.prototype)}},La=(r,e)=>new Promise((t,n)=>{try{r.schedule(t,e)}catch(i){n(i)}}),Na={schedule:(r,e)=>{let t,n=i=>{i!=null&&clearTimeout(i),t=void 0};return t=setTimeout(()=>{n(t),r()},e),{cancel:()=>n(t)}}};var Up=Number.POSITIVE_INFINITY,Ma=(r,e,t)=>{var n,i;let o=(n=typeof e=="number"?e:e==null?void 0:e.timeout)!==null&&n!==void 0?n:5e3,s=(i=typeof e=="number"?t:e==null?void 0:e.intervalBetweenAttempts)!==null&&i!==void 0?i:50,l=!1,c=()=>new Promise((h,b)=>{let x=()=>{l||new Promise((E,I)=>{try{E(r())}catch(S){I(S)}}).then(E=>{E?h(E):La(Na,s).then(x).catch(b)}).catch(b)};x()}),d=o!==Up?()=>La(Na,o).then(()=>{throw l=!0,new Hr(o)}):void 0;return d!=null?Promise.race([c(),d()]):c()};var Ot=[];function Ba(r){if(Ot.push({req:r.req,tick:r.tick,id:r.id}),globalThis.eventQueue=Ot,r.id!==Ot.length-1){globalThis.stopGameLoop=!0,console.error("VERY BAD OUT OF ORDER");return}globalThis.callback2===void 0&&Dp()}function Dp(){globalThis.callback2=async()=>{globalThis.tickCounter=Ot[0].tick,globalThis.callback2=async()=>{let r=0;for(let{req:e,tick:t}of Ot){if(globalThis.tickCounter===t){if(e.method.startsWith("start")&&e.method!=="startJumping"){let i=()=>Gp([e.method,e.method.replace("start","stop")],r+1);if(i()===!1){globalThis.stopGameLoop=!0;try{await Ma(i)}catch(o){throw o}}}let n=C.currentControlledChar;Xn(e,e.params,n,n.collider)}r++}globalThis.stopGameLoop=!1},globalThis.callback2()}}function Gp(r,e){for(let{req:t}of Ot.slice(e))if(r.includes(t.method))return!0;return!1}var Fa=0;function Ua(){let r={characters:[...C.characters].map(t=>[t.name,t.health,t.team,t.collider.x,t.collider.y,t.collider.width,t.collider.height,t.looksToLeft,t.animState,t.handTool,t.angle]),weaponBoxes:[...C.weaponBoxes].map(t=>[t.collider.x,t.collider.y,t.collider.width,t.collider.height,t.creationTime]),hookSegments:[],ammo:[],meta:{waterOffset:C.waterOffset,currentControlledCharIdx:[...C.characters].indexOf(C.currentControlledChar),currentControlledCharState:(C.currentControlledChar?.statNew??"not exists").toUpperCase(),test1:globalThis.stopGameLoop,rate:Fe,freq2:globalThis.freq2}};for(let t of C.gameEntities){let n;switch(t.constructor){case wt:n="GrenadeCollider";break;case It:n="RifleAmmoCollider";break;case St:n="BazookaAmmoCollider";break;case Me:n="GrapplingHookShotCollider";break}switch(t.constructor){case wt:case It:case St:case Me:r.ammo.push([n,t.x,t.y,t.width,t.height,t.angle??t.velocity.slope??null])}t instanceof Qe&&(t.active===!1||t.isVisible())&&r.hookSegments.push([t.x,t.y,t.width,t.height])}let e=C.holes.slice(Fa);return Fa=C.holes.length,{snapshot:r,newHoles:e}}var ja=!1;var Va,Se,Qn={connectedToWS:!1,userId:"",startGame(r){Oa(r)},startOffline(){let r=Yn(1570,41.88753858024709,"dfgsfdggfs",1);C.currentControlledChar=r;let e=Yn(1370,118.23398919753112,"\u041F\u0435\u0442\u044F",0)},update(){globalThis.test?.()},collectRenderData(){return Ua()},makeHole(r,e){Be(r,e,60)},draw(r,e){C.terrain.draw(r,e,20)},handleChar(r,e={}){let t={method:r,params:e},n=C.currentControlledChar;n!==void 0&&(ja&&Va===!1||Xn(t,t.params,n,n.collider))},changeChar(){let r=C.currentControlledChar;if(r===void 0)return;let e=r.collider;e.testGavnina&&(e.testGavnina=!1);let t=[...C.characters],i=(t.indexOf(r)+1)%t.length;C.currentControlledChar=t[i]},async makeRPC(r,e){return(await Se.namedRPC(r,e)).data},toggleBulletTime(){globalThis.bulletTime=!globalThis.bulletTime}};er(Qn);var Da,jp=0;function Xn(r,e,t,n){let i=JSON.stringify(r);if(!(i===Da&&r.method!=="startJumping")&&!(r.method==="startJumping"&&!(t.statNew==="moves"||t.statNew==="idle")))switch(Da=i,globalThis.record!==void 0&&globalThis.record.addEvent(r),ja&&Va&&(async()=>{try{let o=await Se.namedRPC("input",{req:r,tick:globalThis.tickCounter,challengeId:globalThis.challengeId,command:"test",id:jp++})}catch(o){console.error(o)}})(),r.method){case"startMoving":(t.collider.testGavnina||!(t.statNew==="preparationForJump"||t.statNew==="falls"))&&(t.looksToLeft=e.direction),t.collider.testGavnina===!1&&(t.moves=e.direction?"left":"right");break;case"stopMoving":t.moves="none",t.characterService.send("STOP_MOVING");break;case"startJumping":t.startJumpAnim=e.direction,t.startJumpTick=globalThis.tickCounter,t.characterService.send("START_JUMP");break;case"setWeapon":t.handTool=e.name;break;case"fireTest":ka(e.force);break;case"startPull":if(n.testGavnina){n.pull=e.direction;break}t.aim=e.direction==="W"?"up":"down";break;case"stopPull":n.pull="none",t.aim="none";break;case"deattach":n.testGavnina&&(n.testGavnina=!1);break}}async function Vp(){let r;try{let e=await fetch("http://localhost:3000/connect");if(e.ok===!1)throw new Error;let{token:t,id:n}=await e.json();r=t,Qn.userId=n}catch(e){throw e}Se=new Ga.default("ws://localhost:8000/connection/websocket"),Se.setToken(r),Se.on("connect",async e=>{console.log("connected",e),Qn.connectedToWS=!0}),Se.on("disconnect",e=>{console.log("disconnected",e)}),Se.on("subscribe",async e=>{}),Se.on("publish",e=>{console.log(e);let{data:t}=e;switch(t.command){case"showChallenge":Rt.showBattleRequest(t);break;case"prepareScene":Rt.prepareScene();break;case"startMapLoad":break;case"startBattle":break;case"test":Ba(t);break}}),Se.connect()}Vp();async function ne(r){await Rt.playSound(r)}async function Tt(r){await Rt.setInputMode(r)}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/**
 * @license
 * Lodash (Custom Build) <https://lodash.com/>
 * Build: `lodash modularize exports="es" -o ./`
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
