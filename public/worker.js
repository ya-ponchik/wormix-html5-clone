(()=>{var an=Object.defineProperty;var _s=(r,t,e)=>t in r?an(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var fn=(r,t)=>{for(var e in t)an(r,e,{get:t[e],enumerable:!0})};var at=(r,t,e)=>(_s(r,typeof t!="symbol"?t+"":t,e),e);var p;function ln(r){p=r}var xs={CCW:-1,CW:1,NOT_ORIENTABLE:0},ys=2*Math.PI,te=1,yn=0,Y=2,bs=3,vs=4,ws=1,Es=2,Ir=0,Ie=1,Ot=2,Ae=Object.freeze({CCW:!0,CW:!1,ORIENTATION:xs,PIx2:ys,INSIDE:te,OUTSIDE:yn,BOUNDARY:Y,CONTAINS:bs,INTERLACE:vs,OVERLAP_SAME:ws,OVERLAP_OPPOSITE:Es,NOT_VERTEX:Ir,START_VERTEX:Ie,END_VERTEX:Ot}),Q=1e-6;function bn(r){Q=r}function vn(){return Q}var Ts=3;function gr(r){return r<Q&&r>-Q}function yt(r,t){return r-t<Q&&r-t>-Q}function wn(r,t){return r-t>Q}function Is(r,t){return r-t>-Q}function En(r,t){return r-t<-Q}function As(r,t){return r-t<Q}var Ss=Object.freeze({setTolerance:bn,getTolerance:vn,DECIMALS:Ts,EQ_0:gr,EQ:yt,GT:wn,GE:Is,LT:En,LE:As}),Se=class{static get ILLEGAL_PARAMETERS(){return new ReferenceError("Illegal Parameters")}static get ZERO_DIVISION(){return new Error("Zero division")}static get UNRESOLVED_BOUNDARY_CONFLICT(){return new Error("Unresolved boundary conflict in boolean operation")}static get INFINITE_LOOP(){return new Error("Infinite loop")}};var o={Utils:Ss,Errors:Se,Matrix:void 0,Planar_set:void 0,Point:void 0,Vector:void 0,Line:void 0,Circle:void 0,Segment:void 0,Arc:void 0,Box:void 0,Edge:void 0,Face:void 0,Ray:void 0,Ray_shooting:void 0,Multiline:void 0,Polygon:void 0,Distance:void 0,Inversion:void 0};for(let r in Ae)o[r]=Ae[r];Object.defineProperty(o,"DP_TOL",{get:function(){return vn()},set:function(r){bn(r)}});var Pe=class{constructor(t,e){this.first=t,this.last=e||this.first}static testInfiniteLoop(t){let e=t,n=t;do{if(e!=t&&e===n)throw o.Errors.INFINITE_LOOP;e=e.next,n=n.next.next}while(e!=t)}get size(){let t=0;for(let e of this)t++;return t}toArray(t=void 0,e=void 0){let n=[],i=t||this.first,s=e||this.last,a=i;if(a===void 0)return n;do n.push(a),a=a.next;while(a!==s.next);return n}append(t){return this.isEmpty()?this.first=t:(t.prev=this.last,this.last.next=t),this.last=t,this.last.next=void 0,this.first.prev=void 0,this}insert(t,e){if(this.isEmpty())this.first=t,this.last=t;else if(e==null)t.next=this.first,this.first.prev=t,this.first=t;else{let n=e.next;e.next=t,n&&(n.prev=t),t.prev=e,t.next=n,this.last===e&&(this.last=t)}return this.last.next=void 0,this.first.prev=void 0,this}remove(t){return t===this.first&&t===this.last?(this.first=void 0,this.last=void 0):(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t===this.first&&(this.first=t.next),t===this.last&&(this.last=t.prev)),this}isEmpty(){return this.first===void 0}[Symbol.iterator](){let t;return{next:()=>(t=t?t.next:this.first,{value:t,done:t===void 0})}}};function Nt(r,t,e){let n=e.length,i=r.shape.split(t);if(i.length===0)return;let s=0;i[0]===null?s=0:i[1]===null?s=r.shape.length:s=i[0].length;let a=Ir;yt(s,0)&&(a|=Ie),yt(s,r.shape.length)&&(a|=Ot);let f=a&Ot&&r.next.arc_length===0?0:r.arc_length+s;e.push({id:n,pt:t,arc_length:f,edge_before:r,edge_after:void 0,face:r.face,is_vertex:a})}function ne(r){r.int_points1_sorted=ee(r.int_points1),r.int_points2_sorted=ee(r.int_points2)}function ee(r){let t=new Map,e=0;for(let i of r)t.has(i.face)||(t.set(i.face,e),e++);for(let i of r)i.faceId=t.get(i.face);return r.slice().sort(Ps)}function Ps(r,t){return r.faceId<t.faceId?-1:r.faceId>t.faceId?1:r.arc_length<t.arc_length?-1:r.arc_length>t.arc_length?1:0}function pr(r,t){return t.slice().sort((e,n)=>r.coord(e.pt)<r.coord(n.pt)?-1:r.coord(e.pt)>r.coord(n.pt)?1:0)}function Ar(r){if(r.int_points1.length<2)return;let t=!1,e,n,i,s;for(let a=0;a<r.int_points1_sorted.length;a++)if(r.int_points1_sorted[a].id!==-1){e=r.int_points1_sorted[a],n=r.int_points2[e.id];for(let f=a+1;f<r.int_points1_sorted.length&&(i=r.int_points1_sorted[f],!!yt(i.arc_length,e.arc_length));f++)i.id!==-1&&(s=r.int_points2[i.id],s.id!==-1&&i.edge_before===e.edge_before&&i.edge_after===e.edge_after&&s.edge_before===n.edge_before&&s.edge_after===n.edge_after&&(i.id=-1,s.id=-1,t=!0))}n=r.int_points2_sorted[0],e=r.int_points1[n.id];for(let a=1;a<r.int_points2_sorted.length;a++){let f=r.int_points2_sorted[a];if(f.id==-1)continue;if(n.id==-1||!yt(f.arc_length,n.arc_length)){n=f,e=r.int_points1[n.id];continue}let l=r.int_points1[f.id];l.edge_before===e.edge_before&&l.edge_after===e.edge_after&&f.edge_before===n.edge_before&&f.edge_after===n.edge_after&&(l.id=-1,f.id=-1,t=!0)}t&&(r.int_points1=r.int_points1.filter(a=>a.id>=0),r.int_points2=r.int_points2.filter(a=>a.id>=0),r.int_points1.forEach((a,f)=>a.id=f),r.int_points2.forEach((a,f)=>a.id=f))}function _r(r){for(let t of r)t.edge_before.bvStart=void 0,t.edge_before.bvEnd=void 0,t.edge_before.bv=void 0,t.edge_before.overlap=void 0,t.edge_after.bvStart=void 0,t.edge_after.bvEnd=void 0,t.edge_after.bv=void 0,t.edge_after.overlap=void 0;for(let t of r)t.edge_before.bvEnd=Y,t.edge_after.bvStart=Y}function xr(r,t){for(let e of r)e.edge_before.setInclusion(t),e.edge_after.setInclusion(t)}function Cs(r){let t,e,n,i=r.int_points1.length;for(let s=0;s<i;s++){let a=r.int_points1_sorted[s];a.face!==t&&(e=s,t=a.face);let f=s,l=kt(r.int_points1_sorted,s,t),u;f+l<i&&r.int_points1_sorted[f+l].face===t?u=f+l:u=e;let d=kt(r.int_points1_sorted,u,t);n=null;for(let _=u;_<u+d;_++){let E=r.int_points1_sorted[_];if(E.face===t&&r.int_points2[E.id].face===r.int_points2[a.id].face){n=E;break}}if(n===null)continue;let c=a.edge_after,h=n.edge_before;if(!(c.bv===Y&&h.bv===Y)||c!==h)continue;let y=r.int_points2[a.id],v=r.int_points2[n.id],b=y.edge_after,w=v.edge_before;b.bv===Y&&w.bv===Y&&b===w||(y=r.int_points2[n.id],v=r.int_points2[a.id],b=y.edge_after,w=v.edge_before),b.bv===Y&&w.bv===Y&&b===w&&c.setOverlap(b)}}function kt(r,t,e){let n,i,s=1;if(r.length==1)return 1;n=r[t];for(let a=t+1;a<r.length&&!(n.face!=e||(i=r[a],!(i.pt.equalTo(n.pt)&&i.edge_before===n.edge_before&&i.edge_after===n.edge_after)));a++)s++;return s}function Mt(r,t){if(!!t){for(let e of t){let n=e.edge_before;if(e.is_vertex=Ir,n.shape.start&&n.shape.start.equalTo(e.pt)&&(e.is_vertex|=Ie),n.shape.end&&n.shape.end.equalTo(e.pt)&&(e.is_vertex|=Ot),e.is_vertex&Ie){e.edge_before=n.prev,e.is_vertex=Ot;continue}if(e.is_vertex&Ot)continue;let i=r.addVertex(e.pt,n);e.edge_before=i}for(let e of t)e.edge_after=e.edge_before.next}}function un(r,t,e){let n=r.edge_before,i=t.edge_after;n.next=e,e.prev=n,e.next=i,i.prev=e}var{INSIDE:X,OUTSIDE:H,BOUNDARY:k,OVERLAP_SAME:Os,OVERLAP_OPPOSITE:Ls}=Ae,{NOT_VERTEX:Xc,START_VERTEX:dn,END_VERTEX:cn}=Ae,Ce=1,se=2,bt=3;function Rs(r,t){let[e,n]=ae(r,t,Ce,!0);return e}function yr(r,t){let n=t.clone().reverse(),[i,s]=ae(r,n,bt,!0);return i}function Tn(r,t){let[e,n]=ae(r,t,se,!0);return e}function In(r,t){let[e,n]=ae(r,t,se,!1),i=[];for(let a of e.faces)i=[...i,...[...a.edges].map(f=>f.shape)];let s=[];for(let a of n.faces)s=[...s,...[...a.edges].map(f=>f.shape)];return[i,s]}function br(r,t){let[e,n]=ae(r,t,bt,!1),i=[];for(let s of e.faces)i=[...i,...[...s.edges].map(a=>a.shape)];return i}function An(r,t){let e=r.clone(),n=t.clone(),i=Sn(e,n);ne(i),Mt(e,i.int_points1_sorted),Mt(n,i.int_points2_sorted),Ar(i),ne(i);let s=i.int_points1_sorted.map(f=>f.pt),a=i.int_points2_sorted.map(f=>f.pt);return[s,a]}function Ns(r,t,e,n){let i=pn(r,e.int_points1),s=pn(t,e.int_points2);for(hn(i,t),hn(s,r),_r(e.int_points1),_r(e.int_points2),xr(e.int_points1,t),xr(e.int_points2,r);Ms(r,t,e.int_points1,e.int_points1_sorted,e.int_points2,e););Cs(e),vr(r,n,e.int_points1_sorted,!0),vr(t,n,e.int_points2_sorted,!1),mn(r,i,n,!0),mn(t,s,n,!1)}function ks(r,t,e,n){Fs(r,t,n,e.int_points2),Bs(r,t,e),wr(r,e.int_points1),wr(t,e.int_points2),Er(r,e.int_points1,e.int_points2),Er(r,e.int_points2,e.int_points1)}function ae(r,t,e,n){let i=r.clone(),s=t.clone(),a=Sn(i,s);return ne(a),Mt(i,a.int_points1_sorted),Mt(s,a.int_points2_sorted),Ar(a),ne(a),Ns(i,s,a,e),n&&ks(i,s,a,e),[i,s]}function Sn(r,t){let e={int_points1:[],int_points2:[]};for(let n of r.edges){let i=t.edges.search(n.box);for(let s of i){let a=n.shape.intersect(s.shape);for(let f of a)Nt(n,f,e.int_points1),Nt(s,f,e.int_points2)}}return e}function pn(r,t){let e=[];for(let n of r.faces)t.find(i=>i.face===n)||e.push(n);return e}function hn(r,t){for(let e of r)e.first.bv=e.first.bvStart=e.first.bvEnd=void 0,e.first.setInclusion(t)}function Ms(r,t,e,n,i,s){let a,f,l,u=n.length,d=!1;for(let c=0;c<u;c++){let h=n[c];h.face!==a&&(f=c,a=h.face);let y=c,v=kt(n,c,a),b;y+v<u&&n[y+v].face===a?b=y+v:b=f;let w=kt(n,b,a);l=null;for(let m=b;m<b+w;m++){let I=n[m];if(I.face===a&&i[I.id].face===i[h.id].face){l=I;break}}if(l===null)continue;let _=h.edge_after,E=l.edge_before;if(_.bv===k&&E.bv!=k){_.bv=E.bv;continue}if(_.bv!=k&&E.bv===k){E.bv=_.bv;continue}if(_.bv===k&&E.bv===k&&_!=E||_.bv===X&&E.bv===H||_.bv===H&&E.bv===X){let m=_.next;for(;m!=E;)m.bvStart=void 0,m.bvEnd=void 0,m.bv=void 0,m.setInclusion(t),m=m.next}if(_.bv===k&&E.bv===k&&_!=E){let m=_.next,I;for(;m!=E;){if(m.bv!=k){if(I===void 0)I=m.bv;else if(m.bv!=I)throw Se.UNRESOLVED_BOUNDARY_CONFLICT}m=m.next}I!=null&&(_.bv=I,E.bv=I);continue}if(_.bv===X&&E.bv===H||_.bv===H&&E.bv===X){let m=_;for(;m!=E;){if(m.bvStart===_.bv&&m.bvEnd===E.bv){let[I,B]=m.shape.distanceTo(t);if(I<10*o.DP_TOL){Nt(m,B.ps,e);let T=e[e.length-1];if(T.is_vertex&dn)T.edge_after=m,T.edge_before=m.prev,m.bvStart=k,m.bv=void 0,m.setInclusion(t);else if(T.is_vertex&cn)T.edge_after=m.next,m.bvEnd=k,m.bv=void 0,m.setInclusion(t);else{let P=t.addVertex(T.pt,m);T.edge_before=P,T.edge_after=P.next,P.setInclusion(t),P.next.bvStart=k,P.next.bvEnd=void 0,P.next.bv=void 0,P.next.setInclusion(t)}let R=t.findEdgeByPoint(B.pe);Nt(R,B.pe,i);let C=i[i.length-1];if(C.is_vertex&dn)C.edge_after=R,C.edge_before=R.prev;else if(C.is_vertex&cn)C.edge_after=R.next;else{let P=i.find(cr=>cr.edge_after===R),O=t.addVertex(C.pt,R);C.edge_before=O,C.edge_after=O.next,P&&(P.edge_after=O),O.bvStart=void 0,O.bvEnd=k,O.bv=void 0,O.setInclusion(r),O.next.bvStart=k,O.next.bvEnd=void 0,O.next.bv=void 0,O.next.setInclusion(r)}ne(s),d=!0;break}}m=m.next}if(d)break;throw Se.UNRESOLVED_BOUNDARY_CONFLICT}}return d}function vr(r,t,e,n){if(!e)return;let i,s,a,f;for(let l=0;l<e.length;l++){if(a=e[l],a.face!==i&&(s=l,i=a.face),i.isEmpty())continue;let u=l,d=kt(e,l,i),c;u+d<e.length&&e[u+d].face===a.face?c=u+d:c=s,f=e[c];let h=c,y=kt(e,h,i),v=a.edge_after,b=f.edge_before;if(v.bv===X&&b.bv===X&&t===Ce||v.bv===H&&b.bv===H&&t===se||(v.bv===H||b.bv===H)&&t===bt&&!n||(v.bv===X||b.bv===X)&&t===bt&&n||v.bv===k&&b.bv===k&&v.overlap&Os&&n||v.bv===k&&b.bv===k&&v.overlap&Ls){r.removeChain(i,v,b);for(let w=u;w<u+d;w++)e[w].edge_after=void 0;for(let w=h;w<h+y;w++)e[w].edge_before=void 0}l+=d-1}}function Fs(r,t,e,n){for(let i of t.faces){for(let s of i)r.edges.add(s);n.find(s=>s.face===i)===void 0&&r.addFace(i.first,i.last)}}function Bs(r,t,e){if(e.int_points1.length!==0)for(let n=0;n<e.int_points1.length;n++){let i=e.int_points1[n],s=e.int_points2[n];if(i.edge_before!==void 0&&i.edge_after===void 0&&s.edge_before===void 0&&s.edge_after!==void 0&&(i.edge_before.next=s.edge_after,s.edge_after.prev=i.edge_before,i.edge_after=s.edge_after,s.edge_before=i.edge_before),s.edge_before!==void 0&&s.edge_after===void 0&&i.edge_before===void 0&&i.edge_after!==void 0&&(s.edge_before.next=i.edge_after,i.edge_after.prev=s.edge_before,s.edge_after=i.edge_after,i.edge_before=s.edge_before),i.edge_before!==void 0&&i.edge_after===void 0)for(let a of e.int_points1_sorted)a!==i&&a.edge_before===void 0&&a.edge_after!==void 0&&a.pt.equalTo(i.pt)&&(i.edge_before.next=a.edge_after,a.edge_after.prev=i.edge_before,i.edge_after=a.edge_after,a.edge_before=i.edge_before);if(s.edge_before!==void 0&&s.edge_after===void 0)for(let a of e.int_points2_sorted)a!==s&&a.edge_before===void 0&&a.edge_after!==void 0&&a.pt.equalTo(s.pt)&&(s.edge_before.next=a.edge_after,a.edge_after.prev=s.edge_before,s.edge_after=a.edge_after,a.edge_before=s.edge_before)}}function wr(r,t){for(let e of t)r.faces.delete(e.face),e.face=void 0,e.edge_before&&(e.edge_before.face=void 0),e.edge_after&&(e.edge_after.face=void 0)}function Er(r,t,e){for(let n of t){if(n.edge_before===void 0||n.edge_after===void 0||n.face||n.edge_after.face||n.edge_before.face)continue;let i=n.edge_after,s=n.edge_before;Pe.testInfiniteLoop(i);let a=r.addFace(i,s);for(let f of t)f.edge_before&&f.edge_after&&f.edge_before.face===a&&f.edge_after.face===a&&(f.face=a);for(let f of e)f.edge_before&&f.edge_after&&f.edge_before.face===a&&f.edge_after.face===a&&(f.face=a)}}function mn(r,t,e,n){for(let i of t){let s=i.first.bv;(e===Ce&&s===X||e===bt&&s===X&&n||e===bt&&s===H&&!n||e===se&&s===H)&&r.deleteFace(i)}}var Us=Object.freeze({BOOLEAN_UNION:Ce,BOOLEAN_INTERSECT:se,BOOLEAN_SUBTRACT:bt,unify:Rs,subtract:yr,intersect:Tn,innerClip:In,outerClip:br,calculateIntersections:An,removeNotRelevantChains:vr,removeOldFaces:wr,restoreFaces:Er}),Vs=RegExp("T.F..FFF.|T.F...F.."),Ds=RegExp("T........|.T.......|...T.....|....T...."),Gs=RegExp("FT.......|F..T.....|F...T...."),$s=RegExp("T.F..F..."),Ws=RegExp("T.F..F...|.TF..F...|..FT.F...|..F.TF..."),wt=class{constructor(){this.m=new Array(9).fill(void 0)}get I2I(){return this.m[0]}set I2I(t){this.m[0]=t}get I2B(){return this.m[1]}set I2B(t){this.m[1]=t}get I2E(){return this.m[2]}set I2E(t){this.m[2]=t}get B2I(){return this.m[3]}set B2I(t){this.m[3]=t}get B2B(){return this.m[4]}set B2B(t){this.m[4]=t}get B2E(){return this.m[5]}set B2E(t){this.m[5]=t}get E2I(){return this.m[6]}set E2I(t){this.m[6]=t}get E2B(){return this.m[7]}set E2B(t){this.m[7]=t}get E2E(){return this.m[8]}set E2E(t){this.m[8]=t}toString(){return this.m.map(t=>t instanceof Array&&t.length>0?"T":t instanceof Array&&t.length===0?"F":"*").join("")}equal(){return Vs.test(this.toString())}intersect(){return Ds.test(this.toString())}touch(){return Gs.test(this.toString())}inside(){return $s.test(this.toString())}covered(){return Ws.test(this.toString())}};function Oe(r,t){let e=[],[n,i,s]=r.standard,[a,f,l]=t.standard,u=n*f-i*a,d=s*f-i*l,c=n*l-s*a;if(!o.Utils.EQ_0(u)){let h,y;i===0?(h=s/n,y=c/u):f===0?(h=l/a,y=c/u):n===0?(h=d/u,y=s/i):a===0?(h=d/u,y=l/f):(h=d/u,y=c/u),e.push(new o.Point(h,y))}return e}function Bt(r,t){let e=[],n=t.pc.projectionOn(r),i=t.pc.distanceTo(n)[0];if(o.Utils.EQ(i,t.r))e.push(n);else if(o.Utils.LT(i,t.r)){let s=Math.sqrt(t.r*t.r-i*i),a,f;a=r.norm.rotate90CCW().multiply(s),f=n.translate(a),e.push(f),a=r.norm.rotate90CW().multiply(s),f=n.translate(a),e.push(f)}return e}function ie(r,t){let e=[];for(let n of t.toSegments()){let i=Le(n,r);for(let s of i)Ln(s,e)||e.push(s)}return e}function Sr(r,t){let e=[];if(ie(r,t.box).length===0)return e;let n=new o.Circle(t.pc,t.r),i=Bt(r,n);for(let s of i)s.on(t)&&e.push(s);return e}function Le(r,t){let e=[];if(r.ps.on(t)&&e.push(r.ps),r.pe.on(t)&&!r.isZeroLength()&&e.push(r.pe),e.length>0||r.isZeroLength()||r.ps.leftTo(t)&&r.pe.leftTo(t)||!r.ps.leftTo(t)&&!r.pe.leftTo(t))return e;let n=new o.Line(r.ps,r.pe);return Oe(n,t)}function fe(r,t){let e=[];if(r.box.not_intersect(t.box))return e;if(r.isZeroLength())return r.ps.on(t)&&e.push(r.ps),e;if(t.isZeroLength())return t.ps.on(r)&&e.push(t.ps),e;let n=new o.Line(r.ps,r.pe),i=new o.Line(t.ps,t.pe);if(n.incidentTo(i))r.ps.on(t)&&e.push(r.ps),r.pe.on(t)&&e.push(r.pe),t.ps.on(r)&&!t.ps.equalTo(r.ps)&&!t.ps.equalTo(r.pe)&&e.push(t.ps),t.pe.on(r)&&!t.pe.equalTo(r.ps)&&!t.pe.equalTo(r.pe)&&e.push(t.pe);else{let s=Oe(n,i);s.length>0&&s[0].on(r)&&s[0].on(t)&&e.push(s[0])}return e}function Re(r,t){let e=[];if(r.box.not_intersect(t.box))return e;if(r.isZeroLength()){let[s,a]=r.ps.distanceTo(t.pc);return o.Utils.EQ(s,t.r)&&e.push(r.ps),e}let n=new o.Line(r.ps,r.pe),i=Bt(n,t);for(let s of i)s.on(r)&&e.push(s);return e}function vt(r,t){let e=[];if(r.box.not_intersect(t.box))return e;if(r.isZeroLength())return r.ps.on(t)&&e.push(r.ps),e;let n=new o.Line(r.ps,r.pe),i=new o.Circle(t.pc,t.r),s=Bt(n,i);for(let a of s)a.on(r)&&a.on(t)&&e.push(a);return e}function qs(r,t){let e=[];for(let n of t.toSegments()){let i=fe(n,r);for(let s of i)e.push(s)}return e}function Pn(r,t){let e=[];if(r.box.not_intersect(t.box))return e;let n=new o.Vector(r.pc,t.pc),i=r.r,s=t.r;if(o.Utils.EQ_0(i)||o.Utils.EQ_0(s))return e;if(o.Utils.EQ_0(n.x)&&o.Utils.EQ_0(n.y)&&o.Utils.EQ(i,s))return e.push(r.pc.translate(-i,0)),e;let a=r.pc.distanceTo(t.pc)[0];if(o.Utils.GT(a,i+s)||o.Utils.LT(a,Math.abs(i-s)))return e;n.x/=a,n.y/=a;let f;if(o.Utils.EQ(a,i+s)||o.Utils.EQ(a,Math.abs(i-s)))return f=r.pc.translate(i*n.x,i*n.y),e.push(f),e;let l=i*i/(2*a)-s*s/(2*a)+a/2,u=r.pc.translate(l*n.x,l*n.y),d=Math.sqrt(i*i-l*l);return f=u.translate(n.rotate90CCW().multiply(d)),e.push(f),f=u.translate(n.rotate90CW().multiply(d)),e.push(f),e}function js(r,t){let e=[];for(let n of t.toSegments()){let i=Re(n,r);for(let s of i)e.push(s)}return e}function Pr(r,t){var e=[];if(r.box.not_intersect(t.box))return e;if(r.pc.equalTo(t.pc)&&o.Utils.EQ(r.r,t.r)){let a;return a=r.start,a.on(t)&&e.push(a),a=r.end,a.on(t)&&e.push(a),a=t.start,a.on(r)&&e.push(a),a=t.end,a.on(r)&&e.push(a),e}let n=new o.Circle(r.pc,r.r),i=new o.Circle(t.pc,t.r),s=n.intersect(i);for(let a of s)a.on(r)&&a.on(t)&&e.push(a);return e}function Cr(r,t){let e=[];if(r.box.not_intersect(t.box))return e;if(t.pc.equalTo(r.pc)&&o.Utils.EQ(t.r,r.r))return e.push(r.start),e.push(r.end),e;let n=t,i=new o.Circle(r.pc,r.r),s=Pn(n,i);for(let a of s)a.on(r)&&e.push(a);return e}function zs(r,t){let e=[];for(let n of t.toSegments()){let i=vt(n,r);for(let s of i)e.push(s)}return e}function Ys(r,t){return r.isSegment()?fe(r.shape,t):vt(t,r.shape)}function Xs(r,t){return r.isSegment()?vt(r.shape,t):Pr(r.shape,t)}function Cn(r,t){return r.isSegment()?Le(r.shape,t):Sr(t,r.shape)}function Hs(r,t){return r.isSegment()?Re(r.shape,t):Cr(r.shape,t)}function Or(r,t){let e=[];for(let n of t.edges)for(let i of Ys(n,r))e.push(i);return e}function Lr(r,t){let e=[];for(let n of t.edges)for(let i of Xs(n,r))e.push(i);return e}function Ne(r,t){let e=[];if(t.isEmpty())return e;for(let n of t.edges)for(let i of Cn(n,r))Ln(i,e)||e.push(i);return r.sortPoints(e)}function On(r,t){let e=[];if(t.isEmpty())return e;for(let n of t.edges)for(let i of Hs(n,r))e.push(i);return e}function Qs(r,t){let e=r.shape,n=t.shape;return r.isSegment()?t.isSegment()?fe(e,n):vt(e,n):t.isSegment()?vt(n,e):Pr(e,n)}function Js(r,t){let e=[];if(t.isEmpty()||r.shape.box.not_intersect(t.box))return e;let n=t.edges.search(r.shape.box);for(let i of n)for(let s of Qs(r,i))e.push(s);return e}function Ks(r,t){let e=[];if(r.isEmpty()||t.isEmpty()||r.box.not_intersect(t.box))return e;for(let n of r.edges)for(let i of Js(n,t))e.push(i);return e}function Zs(r,t){return r instanceof o.Line?Ne(r,t):r instanceof o.Segment?Or(r,t):r instanceof o.Arc?Lr(r,t):[]}function Ln(r,t){return t.some(e=>e.equalTo(r))}var W=class extends Pe{constructor(...t){super();if(t.length!==0&&t.length==1&&t[0]instanceof Array){let e=t[0];if(e.length==0)return;let n=e.every(i=>i instanceof o.Segment||i instanceof o.Arc||i instanceof o.Ray||i instanceof o.Line);for(let i of e){let s=new o.Edge(i);this.append(s)}}}get edges(){return[...this]}get box(){return this.edges.reduce((t,e)=>t=t.merge(e.box),new o.Box)}get vertices(){let t=this.edges.map(e=>e.start);return t.push(this.last.end),t}clone(){return new W(this.toShapes())}addVertex(t,e){let n=e.shape.split(t);if(n[0]===null)return e.prev;if(n[1]===null)return e;let i=new o.Edge(n[0]),s=e.prev;return this.insert(i,s),e.shape=n[1],i}split(t){for(let e of t){let n=this.findEdgeByPoint(e);this.addVertex(e,n)}return this}findEdgeByPoint(t){let e;for(let n of this)if(n.shape.contains(t)){e=n;break}return e}translate(t){return new W(this.edges.map(e=>e.shape.translate(t)))}rotate(t=0,e=new o.Point){return new W(this.edges.map(n=>n.shape.rotate(t,e)))}transform(t=new o.Matrix){return new W(this.edges.map(e=>e.shape.transform(t)))}toShapes(){return this.edges.map(t=>t.shape.clone())}toJSON(){return this.edges.map(t=>t.toJSON())}svg(t={}){let{stroke:e,strokeWidth:n,fill:i,fillRule:s,fillOpacity:a,id:f,className:l}=t,u=f&&f.length>0?`id="${f}"`:"",d=l&&l.length>0?`class="${l}"`:"",c=`
<path stroke="${e||"black"}" stroke-width="${n||1}" fill="${i||"none"}" fill-opacity="${a||1}" ${u} ${d} d="`;c+=`
M${this.first.start.x},${this.first.start.y}`;for(let h of this)c+=h.svg();return c+=`" >
</path>`,c}};o.Multiline=W;var ta=(...r)=>new o.Multiline(...r);o.multiline=ta;function re(r,t){let e,n=new o.Ray(t),i=new o.Line(n.pt,n.norm),s=new o.Box(n.box.xmin-o.DP_TOL,n.box.ymin-o.DP_TOL,n.box.xmax,n.box.ymax+o.DP_TOL);if(r.box.not_intersect(s))return o.OUTSIDE;let a=r.edges.search(s);if(a.length==0)return o.OUTSIDE;for(let u of a)if(u.shape.contains(t))return o.BOUNDARY;let f=[];for(let u of a)for(let d of n.intersect(u.shape)){if(d.equalTo(t))return o.BOUNDARY;f.push({pt:d,edge:u})}f.sort((u,d)=>En(u.pt.x,d.pt.x)?-1:wn(u.pt.x,d.pt.x)?1:0);let l=0;for(let u=0;u<f.length;u++){let d=f[u];if(d.pt.equalTo(d.edge.shape.start)){if(u>0&&d.pt.equalTo(f[u-1].pt)&&d.edge.prev===f[u-1].edge)continue;let c=d.edge.prev;for(;gr(c.length);)c=c.prev;let h=c.shape.tangentInEnd(),y=d.pt.translate(h),v=d.edge.shape.tangentInStart(),b=d.pt.translate(v),w=y.leftTo(i),_=b.leftTo(i);(w&&!_||!w&&_)&&l++}else if(d.pt.equalTo(d.edge.shape.end)){if(u>0&&d.pt.equalTo(f[u-1].pt)&&d.edge.next===f[u-1].edge)continue;let c=d.edge.next;for(;gr(c.length);)c=c.next;let h=c.shape.tangentInStart(),y=d.pt.translate(h),v=d.edge.shape.tangentInEnd(),b=d.pt.translate(v),w=y.leftTo(i),_=b.leftTo(i);(w&&!_||!w&&_)&&l++}else if(d.edge.shape instanceof o.Segment)l++;else{let c=d.edge.shape.box;yt(d.pt.y,c.ymin)||yt(d.pt.y,c.ymax)||l++}}return e=l%2==1?te:yn,e}function ea(r,t){return Ut(r,t).equal()}function Rn(r,t){return Ut(r,t).intersect()}function ra(r,t){return Ut(r,t).touch()}function na(r,t){return!Rn(r,t)}function Nn(r,t){return Ut(r,t).inside()}function kn(r,t){return Ut(r,t).covered()}function ia(r,t){return Nn(t,r)}function Mn(r,t){return kn(t,r)}function Ut(r,t){if(r instanceof o.Line&&t instanceof o.Line)return oa(r,t);if(r instanceof o.Line&&t instanceof o.Circle)return sa(r,t);if(r instanceof o.Line&&t instanceof o.Box)return aa(r,t);if(r instanceof o.Line&&t instanceof o.Polygon)return fa(r,t);if((r instanceof o.Segment||r instanceof o.Arc)&&t instanceof o.Polygon)return gn(r,t);if((r instanceof o.Segment||r instanceof o.Arc)&&(t instanceof o.Circle||t instanceof o.Box))return gn(r,new o.Polygon(t));if(r instanceof o.Polygon&&t instanceof o.Polygon)return we(r,t);if((r instanceof o.Circle||r instanceof o.Box)&&(t instanceof o.Circle||t instanceof o.Box))return we(new o.Polygon(r),new o.Polygon(t));if((r instanceof o.Circle||r instanceof o.Box)&&t instanceof o.Polygon)return we(new o.Polygon(r),t);if(r instanceof o.Polygon&&(t instanceof o.Circle||t instanceof o.Box))return we(r,new o.Polygon(t))}function oa(r,t){let e=new wt,n=Oe(r,t);return n.length===0?r.contains(t.pt)&&t.contains(r.pt)?(e.I2I=[r],e.I2E=[],e.E2I=[]):(e.I2I=[],e.I2E=[r],e.E2I=[t]):(e.I2I=n,e.I2E=r.split(n),e.E2I=t.split(n)),e}function sa(r,t){let e=new wt,n=Bt(r,t);if(n.length===0)e.I2I=[],e.I2B=[],e.I2E=[r],e.E2I=[t];else if(n.length===1)e.I2I=[],e.I2B=n,e.I2E=r.split(n),e.E2I=[t];else{let i=new W([r]),s=r.sortPoints(n);i.split(s);let a=i.toShapes();e.I2I=[a[1]],e.I2B=s,e.I2E=[a[0],a[2]],e.E2I=new o.Polygon([t.toArc()]).cut(i)}return e}function aa(r,t){let e=new wt,n=ie(r,t);if(n.length===0)e.I2I=[],e.I2B=[],e.I2E=[r],e.E2I=[t];else if(n.length===1)e.I2I=[],e.I2B=n,e.I2E=r.split(n),e.E2I=[t];else{let i=new W([r]),s=r.sortPoints(n);i.split(s);let a=i.toShapes();t.toSegments().some(f=>f.contains(n[0])&&f.contains(n[1]))?(e.I2I=[],e.I2B=[a[1]],e.I2E=[a[0],a[2]],e.E2I=[t]):(e.I2I=[a[1]],e.I2B=s,e.I2E=[a[0],a[2]],e.E2I=new o.Polygon(t.toSegments()).cut(i))}return e}function fa(r,t){let e=new wt,n=Ne(r,t),i=new W([r]),s=n.length>0?n.slice():r.sortPoints(n);return i.split(s),[...i].forEach(a=>a.setInclusion(t)),e.I2I=[...i].filter(a=>a.bv===o.INSIDE).map(a=>a.shape),e.I2B=[...i].slice(1).map(a=>a.bv===o.BOUNDARY?a.shape:a.shape.start),e.I2E=[...i].filter(a=>a.bv===o.OUTSIDE).map(a=>a.shape),e.E2I=t.cut(i),e}function gn(r,t){let e=new wt,n=Zs(r,t),i=n.length>0?n.slice():r.sortPoints(n),s=new W([r]);s.split(i),[...s].forEach(a=>a.setInclusion(t)),e.I2I=[...s].filter(a=>a.bv===o.INSIDE).map(a=>a.shape),e.I2B=[...s].slice(1).map(a=>a.bv===o.BOUNDARY?a.shape:a.shape.start),e.I2E=[...s].filter(a=>a.bv===o.OUTSIDE).map(a=>a.shape),e.B2I=[],e.B2B=[],e.B2E=[];for(let a of[r.start,r.end])switch(re(t,a)){case o.INSIDE:e.B2I.push(a);break;case o.BOUNDARY:e.B2B.push(a);break;case o.OUTSIDE:e.B2E.push(a);break;default:break}return e}function we(r,t){let e=new wt,[n,i]=An(r,t),s=Tn(r,t),a=yr(r,t),f=yr(t,r),[l,u]=In(r,t),d=br(r,t),c=br(t,r);return e.I2I=s.isEmpty()?[]:[s],e.I2B=u,e.I2E=a.isEmpty()?[]:[a],e.B2I=l,e.B2B=n,e.B2E=d,e.E2I=f.isEmpty()?[]:[f],e.E2B=c,e}var la=Object.freeze({equal:ea,intersect:Rn,touch:ra,disjoint:na,inside:Nn,covered:kn,contain:ia,cover:Mn,relate:Ut}),ft=class{constructor(t=1,e=0,n=0,i=1,s=0,a=0){this.a=t,this.b=e,this.c=n,this.d=i,this.tx=s,this.ty=a}clone(){return new ft(this.a,this.b,this.c,this.d,this.tx,this.ty)}transform(t){return[t[0]*this.a+t[1]*this.c+this.tx,t[0]*this.b+t[1]*this.d+this.ty]}multiply(t){return new ft(this.a*t.a+this.c*t.b,this.b*t.a+this.d*t.b,this.a*t.c+this.c*t.d,this.b*t.c+this.d*t.d,this.a*t.tx+this.c*t.ty+this.tx,this.b*t.tx+this.d*t.ty+this.ty)}translate(...t){let e,n;if(t.length==1&&t[0]instanceof o.Vector)e=t[0].x,n=t[0].y;else if(t.length==2&&typeof t[0]=="number"&&typeof t[1]=="number")e=t[0],n=t[1];else throw o.Errors.ILLEGAL_PARAMETERS;return this.multiply(new ft(1,0,0,1,e,n))}rotate(t){let e=Math.cos(t),n=Math.sin(t);return this.multiply(new ft(e,n,-n,e,0,0))}scale(t,e){return this.multiply(new ft(t,0,0,e,0,0))}equalTo(t){return!(!o.Utils.EQ(this.tx,t.tx)||!o.Utils.EQ(this.ty,t.ty)||!o.Utils.EQ(this.a,t.a)||!o.Utils.EQ(this.b,t.b)||!o.Utils.EQ(this.c,t.c)||!o.Utils.EQ(this.d,t.d))}};o.Matrix=ft;var ua=(...r)=>new o.Matrix(...r);o.matrix=ua;var da=class Tr{constructor(t,e){this.low=t,this.high=e}clone(){return new Tr(this.low,this.high)}get max(){return this.clone()}less_than(t){return this.low<t.low||this.low==t.low&&this.high<t.high}equal_to(t){return this.low==t.low&&this.high==t.high}intersect(t){return!this.not_intersect(t)}not_intersect(t){return this.high<t.low||t.high<this.low}merge(t){return new Tr(this.low===void 0?t.low:Math.min(this.low,t.low),this.high===void 0?t.high:Math.max(this.high,t.high))}output(){return[this.low,this.high]}static comparable_max(t,e){return t.merge(e)}static comparable_less_than(t,e){return t<e}},F=0,A=1,gt=class{constructor(t=void 0,e=void 0,n=null,i=null,s=null,a=A){this.left=n,this.right=i,this.parent=s,this.color=a,this.item={key:t,value:e},t&&t instanceof Array&&t.length==2&&!Number.isNaN(t[0])&&!Number.isNaN(t[1])&&(this.item.key=new da(Math.min(t[0],t[1]),Math.max(t[0],t[1]))),this.max=this.item.key?this.item.key.max:void 0}isNil(){return this.item.key===void 0&&this.item.value===void 0&&this.left===null&&this.right===null&&this.color===A}less_than(t){if(this.item.value===this.item.key&&t.item.value===t.item.key)return this.item.key.less_than(t.item.key);{let e=this.item.value&&t.item.value&&this.item.value.less_than?this.item.value.less_than(t.item.value):this.item.value<t.item.value;return this.item.key.less_than(t.item.key)||this.item.key.equal_to(t.item.key)&&e}}equal_to(t){if(this.item.value===this.item.key&&t.item.value===t.item.key)return this.item.key.equal_to(t.item.key);{let e=this.item.value&&t.item.value&&this.item.value.equal_to?this.item.value.equal_to(t.item.value):this.item.value==t.item.value;return this.item.key.equal_to(t.item.key)&&e}}intersect(t){return this.item.key.intersect(t.item.key)}copy_data(t){this.item.key=t.item.key.clone(),this.item.value=t.item.value&&t.item.value.clone?t.item.value.clone():t.item.value}update_max(){if(this.max=this.item.key?this.item.key.max:void 0,this.right&&this.right.max){let t=this.item.key.constructor.comparable_max;this.max=t(this.max,this.right.max)}if(this.left&&this.left.max){let t=this.item.key.constructor.comparable_max;this.max=t(this.max,this.left.max)}}not_intersect_left_subtree(t){let e=this.item.key.constructor.comparable_less_than,n=this.left.max.high!==void 0?this.left.max.high:this.left.max;return e(n,t.item.key.low)}not_intersect_right_subtree(t){let e=this.item.key.constructor.comparable_less_than,n=this.right.max.low!==void 0?this.right.max.low:this.right.item.key.low;return e(t.item.key.high,n)}},Ft=class{constructor(){this.root=null,this.nil_node=new gt}get size(){let t=0;return this.tree_walk(this.root,()=>t++),t}get keys(){let t=[];return this.tree_walk(this.root,e=>t.push(e.item.key.output?e.item.key.output():e.item.key)),t}get values(){let t=[];return this.tree_walk(this.root,e=>t.push(e.item.value)),t}get items(){let t=[];return this.tree_walk(this.root,e=>t.push({key:e.item.key.output?e.item.key.output():e.item.key,value:e.item.value})),t}isEmpty(){return this.root==null||this.root==this.nil_node}insert(t,e=t){if(t===void 0)return;let n=new gt(t,e,this.nil_node,this.nil_node,null,F);return this.tree_insert(n),this.recalc_max(n),n}exist(t,e=t){let n=new gt(t,e);return!!this.tree_search(this.root,n)}remove(t,e=t){let n=new gt(t,e),i=this.tree_search(this.root,n);return i&&this.tree_delete(i),i}search(t,e=(n,i)=>n===i?i.output():n){let n=new gt(t),i=[];return this.tree_search_interval(this.root,n,i),i.map(s=>e(s.item.value,s.item.key))}intersect_any(t){let e=new gt(t);return this.tree_find_any_interval(this.root,e)}forEach(t){this.tree_walk(this.root,e=>t(e.item.key,e.item.value))}map(t){let e=new Ft;return this.tree_walk(this.root,n=>e.insert(n.item.key,t(n.item.value,n.item.key))),e}recalc_max(t){let e=t;for(;e.parent!=null;)e.parent.update_max(),e=e.parent}tree_insert(t){let e=this.root,n=null;if(this.root==null||this.root==this.nil_node)this.root=t;else{for(;e!=this.nil_node;)n=e,t.less_than(e)?e=e.left:e=e.right;t.parent=n,t.less_than(n)?n.left=t:n.right=t}this.insert_fixup(t)}insert_fixup(t){let e,n;for(e=t;e!=this.root&&e.parent.color==F;)e.parent==e.parent.parent.left?(n=e.parent.parent.right,n.color==F?(e.parent.color=A,n.color=A,e.parent.parent.color=F,e=e.parent.parent):(e==e.parent.right&&(e=e.parent,this.rotate_left(e)),e.parent.color=A,e.parent.parent.color=F,this.rotate_right(e.parent.parent))):(n=e.parent.parent.left,n.color==F?(e.parent.color=A,n.color=A,e.parent.parent.color=F,e=e.parent.parent):(e==e.parent.left&&(e=e.parent,this.rotate_right(e)),e.parent.color=A,e.parent.parent.color=F,this.rotate_left(e.parent.parent)));this.root.color=A}tree_delete(t){let e,n;t.left==this.nil_node||t.right==this.nil_node?e=t:e=this.tree_successor(t),e.left!=this.nil_node?n=e.left:n=e.right,n.parent=e.parent,e==this.root?this.root=n:(e==e.parent.left?e.parent.left=n:e.parent.right=n,e.parent.update_max()),this.recalc_max(n),e!=t&&(t.copy_data(e),t.update_max(),this.recalc_max(t)),e.color==A&&this.delete_fixup(n)}delete_fixup(t){let e=t,n;for(;e!=this.root&&e.parent!=null&&e.color==A;)e==e.parent.left?(n=e.parent.right,n.color==F&&(n.color=A,e.parent.color=F,this.rotate_left(e.parent),n=e.parent.right),n.left.color==A&&n.right.color==A?(n.color=F,e=e.parent):(n.right.color==A&&(n.color=F,n.left.color=A,this.rotate_right(n),n=e.parent.right),n.color=e.parent.color,e.parent.color=A,n.right.color=A,this.rotate_left(e.parent),e=this.root)):(n=e.parent.left,n.color==F&&(n.color=A,e.parent.color=F,this.rotate_right(e.parent),n=e.parent.left),n.left.color==A&&n.right.color==A?(n.color=F,e=e.parent):(n.left.color==A&&(n.color=F,n.right.color=A,this.rotate_left(n),n=e.parent.left),n.color=e.parent.color,e.parent.color=A,n.left.color=A,this.rotate_right(e.parent),e=this.root));e.color=A}tree_search(t,e){if(!(t==null||t==this.nil_node))return e.equal_to(t)?t:e.less_than(t)?this.tree_search(t.left,e):this.tree_search(t.right,e)}tree_search_interval(t,e,n){t!=null&&t!=this.nil_node&&(t.left!=this.nil_node&&!t.not_intersect_left_subtree(e)&&this.tree_search_interval(t.left,e,n),t.intersect(e)&&n.push(t),t.right!=this.nil_node&&!t.not_intersect_right_subtree(e)&&this.tree_search_interval(t.right,e,n))}tree_find_any_interval(t,e){let n=!1;return t!=null&&t!=this.nil_node&&(t.left!=this.nil_node&&!t.not_intersect_left_subtree(e)&&(n=this.tree_find_any_interval(t.left,e)),n||(n=t.intersect(e)),!n&&t.right!=this.nil_node&&!t.not_intersect_right_subtree(e)&&(n=this.tree_find_any_interval(t.right,e))),n}local_minimum(t){let e=t;for(;e.left!=null&&e.left!=this.nil_node;)e=e.left;return e}local_maximum(t){let e=t;for(;e.right!=null&&e.right!=this.nil_node;)e=e.right;return e}tree_successor(t){let e,n,i;if(t.right!=this.nil_node)e=this.local_minimum(t.right);else{for(n=t,i=t.parent;i!=null&&i.right==n;)n=i,i=i.parent;e=i}return e}rotate_left(t){let e=t.right;t.right=e.left,e.left!=this.nil_node&&(e.left.parent=t),e.parent=t.parent,t==this.root?this.root=e:t==t.parent.left?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e,t!=null&&t!=this.nil_node&&t.update_max(),e=t.parent,e!=null&&e!=this.nil_node&&e.update_max()}rotate_right(t){let e=t.left;t.left=e.right,e.right!=this.nil_node&&(e.right.parent=t),e.parent=t.parent,t==this.root?this.root=e:t==t.parent.left?t.parent.left=e:t.parent.right=e,e.right=t,t.parent=e,t!=null&&t!=this.nil_node&&t.update_max(),e=t.parent,e!=null&&e!=this.nil_node&&e.update_max()}tree_walk(t,e){t!=null&&t!=this.nil_node&&(this.tree_walk(t.left,e),e(t),this.tree_walk(t.right,e))}testRedBlackProperty(){let t=!0;return this.tree_walk(this.root,function(e){e.color==F&&(e.left.color==A&&e.right.color==A||(t=!1))}),t}testBlackHeightProperty(t){let e=0,n=0,i=0;if(t.color==A&&e++,t.left!=this.nil_node?n=this.testBlackHeightProperty(t.left):n=1,t.right!=this.nil_node?i=this.testBlackHeightProperty(t.right):i=1,n!=i)throw new Error("Red-black height property violated");return e+=n,e}},Fn=class extends Set{constructor(t){super(t);this.index=new Ft,this.forEach(e=>this.index.insert(e))}add(t){let e=this.size;if(super.add(t),this.size>e){let n=this.index.insert(t.box,t)}return this}delete(t){let e=super.delete(t);return e&&this.index.remove(t.box,t),e}clear(){super.clear(),this.index=new Ft}search(t){return this.index.search(t)}hit(t){let e=new o.Box(t.x-1,t.y-1,t.x+1,t.y+1);return this.index.search(e).filter(i=>t.on(i))}svg(){return[...this].reduce((e,n)=>e+n.svg(),"")}};o.PlanarSet=Fn;var ke=class{constructor(...t){if(this.x=0,this.y=0,t.length!==0){if(t.length===1&&t[0]instanceof Array&&t[0].length===2){let e=t[0];if(typeof e[0]=="number"&&typeof e[1]=="number"){this.x=e[0],this.y=e[1];return}}if(t.length===1&&t[0]instanceof Object&&t[0].name==="point"){let{x:e,y:n}=t[0];this.x=e,this.y=n;return}if(t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number"){this.x=t[0],this.y=t[1];return}throw o.Errors.ILLEGAL_PARAMETERS}}get box(){return new o.Box(this.x,this.y,this.x,this.y)}clone(){return new o.Point(this.x,this.y)}get vertices(){return[this.clone()]}equalTo(t){return o.Utils.EQ(this.x,t.x)&&o.Utils.EQ(this.y,t.y)}lessThan(t){return!!(o.Utils.LT(this.y,t.y)||o.Utils.EQ(this.y,t.y)&&o.Utils.LT(this.x,t.x))}rotate(t,e={x:0,y:0}){var n=e.x+(this.x-e.x)*Math.cos(t)-(this.y-e.y)*Math.sin(t),i=e.y+(this.x-e.x)*Math.sin(t)+(this.y-e.y)*Math.cos(t);return new o.Point(n,i)}translate(...t){if(t.length==1&&(t[0]instanceof o.Vector||!isNaN(t[0].x)&&!isNaN(t[0].y)))return new o.Point(this.x+t[0].x,this.y+t[0].y);if(t.length==2&&typeof t[0]=="number"&&typeof t[1]=="number")return new o.Point(this.x+t[0],this.y+t[1]);throw o.Errors.ILLEGAL_PARAMETERS}transform(t){return new o.Point(t.transform([this.x,this.y]))}projectionOn(t){if(this.equalTo(t.pt))return this.clone();let e=new o.Vector(this,t.pt);if(o.Utils.EQ_0(e.cross(t.norm)))return t.pt.clone();let n=e.dot(t.norm),i=t.norm.multiply(n);return this.translate(i)}leftTo(t){let e=new o.Vector(t.pt,this);return o.Utils.GT(e.dot(t.norm),0)}distanceTo(t){if(t instanceof ke){let e=t.x-this.x,n=t.y-this.y;return[Math.sqrt(e*e+n*n),new o.Segment(this,t)]}if(t instanceof o.Line)return o.Distance.point2line(this,t);if(t instanceof o.Circle)return o.Distance.point2circle(this,t);if(t instanceof o.Segment)return o.Distance.point2segment(this,t);if(t instanceof o.Arc)return o.Distance.point2arc(this,t);if(t instanceof o.Polygon)return o.Distance.point2polygon(this,t);if(t instanceof o.PlanarSet)return o.Distance.shape2planarSet(this,t)}on(t){if(t instanceof o.Point)return this.equalTo(t);if(t instanceof o.Line)return t.contains(this);if(t instanceof o.Circle)return t.contains(this);if(t instanceof o.Segment)return t.contains(this);if(t instanceof o.Arc)return t.contains(this);if(t instanceof o.Polygon)return t.contains(this)}toJSON(){return Object.assign({},this,{name:"point"})}svg(t={}){let{r:e,stroke:n,strokeWidth:i,fill:s,id:a,className:f}=t,l=a&&a.length>0?`id="${a}"`:"",u=f&&f.length>0?`class="${f}"`:"";return`
<circle cx="${this.x}" cy="${this.y}" r="${e||3}" stroke="${n||"black"}" stroke-width="${i||1}" fill="${s||"red"}" ${l} ${u} />`}};o.Point=ke;var ca=(...r)=>new o.Point(...r);o.point=ca;var Bn=class{constructor(...t){if(this.x=0,this.y=0,t.length!==0){if(t.length===1&&t[0]instanceof Array&&t[0].length===2){let e=t[0];if(typeof e[0]=="number"&&typeof e[1]=="number"){this.x=e[0],this.y=e[1];return}}if(t.length===1&&t[0]instanceof Object&&t[0].name==="vector"){let{x:e,y:n}=t[0];this.x=e,this.y=n;return}if(t.length===2){let e=t[0],n=t[1];if(typeof e=="number"&&typeof n=="number"){this.x=e,this.y=n;return}if(e instanceof o.Point&&n instanceof o.Point){this.x=n.x-e.x,this.y=n.y-e.y;return}}throw o.Errors.ILLEGAL_PARAMETERS}}clone(){return new o.Vector(this.x,this.y)}get slope(){let t=Math.atan2(this.y,this.x);return t<0&&(t=2*Math.PI+t),t}get length(){return Math.sqrt(this.dot(this))}equalTo(t){return o.Utils.EQ(this.x,t.x)&&o.Utils.EQ(this.y,t.y)}multiply(t){return new o.Vector(t*this.x,t*this.y)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}normalize(){if(!o.Utils.EQ_0(this.length))return new o.Vector(this.x/this.length,this.y/this.length);throw o.Errors.ZERO_DIVISION}rotate(t){let n=new o.Point(this.x,this.y).rotate(t);return new o.Vector(n.x,n.y)}rotate90CCW(){return new o.Vector(-this.y,this.x)}rotate90CW(){return new o.Vector(this.y,-this.x)}invert(){return new o.Vector(-this.x,-this.y)}add(t){return new o.Vector(this.x+t.x,this.y+t.y)}subtract(t){return new o.Vector(this.x-t.x,this.y-t.y)}angleTo(t){let e=this.normalize(),n=t.normalize(),i=Math.atan2(e.cross(n),e.dot(n));return i<0&&(i+=2*Math.PI),i}projectionOn(t){let e=t.normalize(),n=this.dot(e);return e.multiply(n)}toJSON(){return Object.assign({},this,{name:"vector"})}};o.Vector=Bn;var pa=(...r)=>new o.Vector(...r);o.vector=pa;var Lt=class{constructor(...t){if(this.ps=new o.Point,this.pe=new o.Point,t.length!==0){if(t.length===1&&t[0]instanceof Array&&t[0].length===4){let e=t[0];this.ps=new o.Point(e[0],e[1]),this.pe=new o.Point(e[2],e[3]);return}if(t.length===1&&t[0]instanceof Object&&t[0].name==="segment"){let{ps:e,pe:n}=t[0];this.ps=new o.Point(e.x,e.y),this.pe=new o.Point(n.x,n.y);return}if(t.length===1&&t[0]instanceof o.Point){this.ps=t[0].clone();return}if(t.length===2&&t[0]instanceof o.Point&&t[1]instanceof o.Point){this.ps=t[0].clone(),this.pe=t[1].clone();return}if(t.length===4){this.ps=new o.Point(t[0],t[1]),this.pe=new o.Point(t[2],t[3]);return}throw o.Errors.ILLEGAL_PARAMETERS}}clone(){return new o.Segment(this.start,this.end)}get start(){return this.ps}get end(){return this.pe}get vertices(){return[this.ps.clone(),this.pe.clone()]}get length(){return this.start.distanceTo(this.end)[0]}get slope(){return new o.Vector(this.start,this.end).slope}get box(){return new o.Box(Math.min(this.start.x,this.end.x),Math.min(this.start.y,this.end.y),Math.max(this.start.x,this.end.x),Math.max(this.start.y,this.end.y))}equalTo(t){return this.ps.equalTo(t.ps)&&this.pe.equalTo(t.pe)}contains(t){return o.Utils.EQ_0(this.distanceToPoint(t))}intersect(t){if(t instanceof o.Point)return this.contains(t)?[t]:[];if(t instanceof o.Line)return Le(this,t);if(t instanceof o.Segment)return fe(this,t);if(t instanceof o.Circle)return Re(this,t);if(t instanceof o.Box)return qs(this,t);if(t instanceof o.Arc)return vt(this,t);if(t instanceof o.Polygon)return Or(this,t)}distanceTo(t){if(t instanceof o.Point){let[e,n]=o.Distance.point2segment(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Circle){let[e,n]=o.Distance.segment2circle(this,t);return[e,n]}if(t instanceof o.Line){let[e,n]=o.Distance.segment2line(this,t);return[e,n]}if(t instanceof o.Segment){let[e,n]=o.Distance.segment2segment(this,t);return[e,n]}if(t instanceof o.Arc){let[e,n]=o.Distance.segment2arc(this,t);return[e,n]}if(t instanceof o.Polygon){let[e,n]=o.Distance.shape2polygon(this,t);return[e,n]}if(t instanceof o.PlanarSet){let[e,n]=o.Distance.shape2planarSet(this,t);return[e,n]}}tangentInStart(){return new o.Vector(this.start,this.end).normalize()}tangentInEnd(){return new o.Vector(this.end,this.start).normalize()}reverse(){return new Lt(this.end,this.start)}split(t){return this.start.equalTo(t)?[null,this.clone()]:this.end.equalTo(t)?[this.clone(),null]:[new o.Segment(this.start,t),new o.Segment(t,this.end)]}middle(){return new o.Point((this.start.x+this.end.x)/2,(this.start.y+this.end.y)/2)}pointAtLength(t){if(t>this.length||t<0)return null;if(t==0)return this.start;if(t==this.length)return this.end;let e=t/this.length;return new o.Point((this.end.x-this.start.x)*e+this.start.x,(this.end.y-this.start.y)*e+this.start.y)}distanceToPoint(t){let[e,...n]=o.Distance.point2segment(t,this);return e}definiteIntegral(t=0){let e=this.end.x-this.start.x,n=this.start.y-t,i=this.end.y-t;return e*(n+i)/2}translate(...t){return new Lt(this.ps.translate(...t),this.pe.translate(...t))}rotate(t=0,e=new o.Point){let n=new o.Matrix;return n=n.translate(e.x,e.y).rotate(t).translate(-e.x,-e.y),this.transform(n)}transform(t=new o.Matrix){return new Lt(this.ps.transform(t),this.pe.transform(t))}isZeroLength(){return this.ps.equalTo(this.pe)}sortPoints(t){return new o.Line(this.start,this.end).sortPoints(t)}toJSON(){return Object.assign({},this,{name:"segment"})}svg(t={}){let{stroke:e,strokeWidth:n,id:i,className:s}=t,a=i&&i.length>0?`id="${i}"`:"",f=s&&s.length>0?`class="${s}"`:"";return`
<line x1="${this.start.x}" y1="${this.start.y}" x2="${this.end.x}" y2="${this.end.y}" stroke="${e||"black"}" stroke-width="${n||1}" ${a} ${f} />`}};o.Segment=Lt;var ha=(...r)=>new o.Segment(...r);o.segment=ha;var{vector:Ee}=o,Me=class{constructor(...t){if(this.pt=new o.Point,this.norm=new o.Vector(0,1),t.length!=0){if(t.length==1&&t[0]instanceof Object&&t[0].name==="line"){let{pt:e,norm:n}=t[0];this.pt=new o.Point(e),this.norm=new o.Vector(n);return}if(t.length==2){let e=t[0],n=t[1];if(e instanceof o.Point&&n instanceof o.Point){this.pt=e,this.norm=Me.points2norm(e,n),this.norm.dot(Ee(this.pt.x,this.pt.y))>=0&&this.norm.invert();return}if(e instanceof o.Point&&n instanceof o.Vector){if(o.Utils.EQ_0(n.x)&&o.Utils.EQ_0(n.y))throw o.Errors.ILLEGAL_PARAMETERS;this.pt=e.clone(),this.norm=n.clone(),this.norm=this.norm.normalize(),this.norm.dot(Ee(this.pt.x,this.pt.y))>=0&&this.norm.invert();return}if(e instanceof o.Vector&&n instanceof o.Point){if(o.Utils.EQ_0(e.x)&&o.Utils.EQ_0(e.y))throw o.Errors.ILLEGAL_PARAMETERS;this.pt=n.clone(),this.norm=e.clone(),this.norm=this.norm.normalize(),this.norm.dot(Ee(this.pt.x,this.pt.y))>=0&&this.norm.invert();return}}throw o.Errors.ILLEGAL_PARAMETERS}}clone(){return new o.Line(this.pt,this.norm)}get start(){}get end(){}get length(){return Number.POSITIVE_INFINITY}get box(){return new o.Box(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY)}get middle(){}get slope(){return new o.Vector(this.norm.y,-this.norm.x).slope}get standard(){let t=this.norm.x,e=this.norm.y,n=this.norm.dot(this.pt);return[t,e,n]}parallelTo(t){return o.Utils.EQ_0(this.norm.cross(t.norm))}incidentTo(t){return this.parallelTo(t)&&this.pt.on(t)}contains(t){if(this.pt.equalTo(t))return!0;let e=new o.Vector(this.pt,t);return o.Utils.EQ_0(this.norm.dot(e))}coord(t){return Ee(t.x,t.y).cross(this.norm)}intersect(t){if(t instanceof o.Point)return this.contains(t)?[t]:[];if(t instanceof o.Line)return Oe(this,t);if(t instanceof o.Circle)return Bt(this,t);if(t instanceof o.Box)return ie(this,t);if(t instanceof o.Segment)return Le(t,this);if(t instanceof o.Arc)return Sr(this,t);if(t instanceof o.Polygon)return Ne(this,t)}distanceTo(t){if(t instanceof o.Point){let[e,n]=o.Distance.point2line(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Circle){let[e,n]=o.Distance.circle2line(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Segment){let[e,n]=o.Distance.segment2line(t,this);return[e,n.reverse()]}if(t instanceof o.Arc){let[e,n]=o.Distance.arc2line(t,this);return[e,n.reverse()]}if(t instanceof o.Polygon){let[e,n]=o.Distance.shape2polygon(this,t);return[e,n]}}split(t){if(t instanceof o.Point)return[new o.Ray(t,this.norm.invert()),new o.Ray(t,this.norm)];{let e=new o.Multiline([this]),n=this.sortPoints(t);return e.split(n),e.toShapes()}}sortPoints(t){return t.slice().sort((e,n)=>this.coord(e)<this.coord(n)?-1:this.coord(e)>this.coord(n)?1:0)}toJSON(){return Object.assign({},this,{name:"line"})}svg(t,e={}){let n=ie(this,t);if(n.length===0)return"";let i=n[0],s=n.length==2?n[1]:n.find(f=>!f.equalTo(i));return s===void 0&&(s=i),new o.Segment(i,s).svg(e)}static points2norm(t,e){if(t.equalTo(e))throw o.Errors.ILLEGAL_PARAMETERS;return new o.Vector(t,e).normalize().rotate90CCW()}};o.Line=Me;var ma=(...r)=>new o.Line(...r);o.line=ma;var Un=class{constructor(...t){if(this.pc=new o.Point,this.r=1,t.length==1&&t[0]instanceof Object&&t[0].name==="circle"){let{pc:e,r:n}=t[0];this.pc=new o.Point(e),this.r=n;return}else{let[e,n]=[...t];e&&e instanceof o.Point&&(this.pc=e.clone()),n!==void 0&&(this.r=n);return}throw o.Errors.ILLEGAL_PARAMETERS}clone(){return new o.Circle(this.pc.clone(),this.r)}get center(){return this.pc}get box(){return new o.Box(this.pc.x-this.r,this.pc.y-this.r,this.pc.x+this.r,this.pc.y+this.r)}contains(t){if(t instanceof o.Point)return o.Utils.LE(t.distanceTo(this.center)[0],this.r);if(t instanceof o.Segment)return o.Utils.LE(t.start.distanceTo(this.center)[0],this.r)&&o.Utils.LE(t.end.distanceTo(this.center)[0],this.r);if(t instanceof o.Arc)return this.intersect(t).length===0&&o.Utils.LE(t.start.distanceTo(this.center)[0],this.r)&&o.Utils.LE(t.end.distanceTo(this.center)[0],this.r);if(t instanceof o.Circle)return this.intersect(t).length===0&&o.Utils.LE(t.r,this.r)&&o.Utils.LE(t.center.distanceTo(this.center)[0],this.r)}toArc(t=!0){return new o.Arc(this.center,this.r,Math.PI,-Math.PI,t)}intersect(t){if(t instanceof o.Point)return this.contains(t)?[t]:[];if(t instanceof o.Line)return Bt(t,this);if(t instanceof o.Segment)return Re(t,this);if(t instanceof o.Circle)return Pn(t,this);if(t instanceof o.Box)return js(this,t);if(t instanceof o.Arc)return Cr(t,this);if(t instanceof o.Polygon)return On(this,t)}distanceTo(t){if(t instanceof o.Point){let[e,n]=o.Distance.point2circle(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Circle){let[e,n]=o.Distance.circle2circle(this,t);return[e,n]}if(t instanceof o.Line){let[e,n]=o.Distance.circle2line(this,t);return[e,n]}if(t instanceof o.Segment){let[e,n]=o.Distance.segment2circle(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Arc){let[e,n]=o.Distance.arc2circle(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Polygon){let[e,n]=o.Distance.shape2polygon(this,t);return[e,n]}if(t instanceof o.PlanarSet){let[e,n]=o.Distance.shape2planarSet(this,t);return[e,n]}}toJSON(){return Object.assign({},this,{name:"circle"})}svg(t={}){let{stroke:e,strokeWidth:n,fill:i,fillOpacity:s,id:a,className:f}=t,l=a&&a.length>0?`id="${a}"`:"",u=f&&f.length>0?`class="${f}"`:"";return`
<circle cx="${this.pc.x}" cy="${this.pc.y}" r="${this.r}" stroke="${e||"black"}" stroke-width="${n||1}" fill="${i||"none"}" fill-opacity="${s||1}" ${l} ${u} />`}};o.Circle=Un;var ga=(...r)=>new o.Circle(...r);o.circle=ga;var Vn=class{constructor(...t){if(this.pc=new o.Point,this.r=1,this.startAngle=0,this.endAngle=2*Math.PI,this.counterClockwise=o.CCW,t.length!=0){if(t.length==1&&t[0]instanceof Object&&t[0].name==="arc"){let{pc:e,r:n,startAngle:i,endAngle:s,counterClockwise:a}=t[0];this.pc=new o.Point(e.x,e.y),this.r=n,this.startAngle=i,this.endAngle=s,this.counterClockwise=a;return}else{let[e,n,i,s,a]=[...t];e&&e instanceof o.Point&&(this.pc=e.clone()),n!==void 0&&(this.r=n),i!==void 0&&(this.startAngle=i),s!==void 0&&(this.endAngle=s),a!==void 0&&(this.counterClockwise=a);return}throw o.Errors.ILLEGAL_PARAMETERS}}clone(){return new o.Arc(this.pc.clone(),this.r,this.startAngle,this.endAngle,this.counterClockwise)}get sweep(){if(o.Utils.EQ(this.startAngle,this.endAngle))return 0;if(o.Utils.EQ(Math.abs(this.startAngle-this.endAngle),o.PIx2))return o.PIx2;let t;return this.counterClockwise?t=o.Utils.GT(this.endAngle,this.startAngle)?this.endAngle-this.startAngle:this.endAngle-this.startAngle+o.PIx2:t=o.Utils.GT(this.startAngle,this.endAngle)?this.startAngle-this.endAngle:this.startAngle-this.endAngle+o.PIx2,o.Utils.GT(t,o.PIx2)&&(t-=o.PIx2),o.Utils.LT(t,0)&&(t+=o.PIx2),t}get start(){return new o.Point(this.pc.x+this.r,this.pc.y).rotate(this.startAngle,this.pc)}get end(){return new o.Point(this.pc.x+this.r,this.pc.y).rotate(this.endAngle,this.pc)}get center(){return this.pc.clone()}get vertices(){return[this.start.clone(),this.end.clone()]}get length(){return Math.abs(this.sweep*this.r)}get box(){let e=this.breakToFunctional().reduce((n,i)=>n.merge(i.start.box),new o.Box);return e=e.merge(this.end.box),e}contains(t){if(!o.Utils.EQ(this.pc.distanceTo(t)[0],this.r))return!1;if(t.equalTo(this.start))return!0;let e=new o.Vector(this.pc,t).slope,n=new o.Arc(this.pc,this.r,this.startAngle,e,this.counterClockwise);return o.Utils.LE(n.length,this.length)}split(t){if(this.start.equalTo(t))return[null,this.clone()];if(this.end.equalTo(t))return[this.clone(),null];let e=new o.Vector(this.pc,t).slope;return[new o.Arc(this.pc,this.r,this.startAngle,e,this.counterClockwise),new o.Arc(this.pc,this.r,e,this.endAngle,this.counterClockwise)]}middle(){let t=this.counterClockwise?this.startAngle+this.sweep/2:this.startAngle-this.sweep/2;return new o.Arc(this.pc,this.r,this.startAngle,t,this.counterClockwise).end}pointAtLength(t){if(t>this.length||t<0)return null;if(t==0)return this.start;if(t==this.length)return this.end;let e=t/this.length,n=this.counterClockwise?this.startAngle+this.sweep*e:this.startAngle-this.sweep*e;return new o.Arc(this.pc,this.r,this.startAngle,n,this.counterClockwise).end}chordHeight(){return(1-Math.cos(Math.abs(this.sweep/2)))*this.r}intersect(t){if(t instanceof o.Point)return this.contains(t)?[t]:[];if(t instanceof o.Line)return Sr(t,this);if(t instanceof o.Circle)return Cr(this,t);if(t instanceof o.Segment)return vt(t,this);if(t instanceof o.Box)return zs(this,t);if(t instanceof o.Arc)return Pr(this,t);if(t instanceof o.Polygon)return Lr(this,t)}distanceTo(t){if(t instanceof o.Point){let[e,n]=o.Distance.point2arc(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Circle){let[e,n]=o.Distance.arc2circle(this,t);return[e,n]}if(t instanceof o.Line){let[e,n]=o.Distance.arc2line(this,t);return[e,n]}if(t instanceof o.Segment){let[e,n]=o.Distance.segment2arc(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Arc){let[e,n]=o.Distance.arc2arc(this,t);return[e,n]}if(t instanceof o.Polygon){let[e,n]=o.Distance.shape2polygon(this,t);return[e,n]}if(t instanceof o.PlanarSet){let[e,n]=o.Distance.shape2planarSet(this,t);return[e,n]}}breakToFunctional(){let t=[],e=[0,Math.PI/2,2*Math.PI/2,3*Math.PI/2],n=[this.pc.translate(this.r,0),this.pc.translate(0,this.r),this.pc.translate(-this.r,0),this.pc.translate(0,-this.r)],i=[];for(let s=0;s<4;s++)n[s].on(this)&&i.push(new o.Arc(this.pc,this.r,this.startAngle,e[s],this.counterClockwise));if(i.length==0)t.push(this.clone());else{i.sort((f,l)=>f.length-l.length);for(let f=0;f<i.length;f++){let l=t.length>0?t[t.length-1]:void 0,u;l?u=new o.Arc(this.pc,this.r,l.endAngle,i[f].endAngle,this.counterClockwise):u=new o.Arc(this.pc,this.r,this.startAngle,i[f].endAngle,this.counterClockwise),o.Utils.EQ_0(u.length)||t.push(u.clone())}let s=t.length>0?t[t.length-1]:void 0,a;s?a=new o.Arc(this.pc,this.r,s.endAngle,this.endAngle,this.counterClockwise):a=new o.Arc(this.pc,this.r,this.startAngle,this.endAngle,this.counterClockwise),!o.Utils.EQ_0(a.length)&&!o.Utils.EQ(a.sweep,2*Math.PI)&&t.push(a.clone())}return t}tangentInStart(){let t=new o.Vector(this.pc,this.start),e=this.counterClockwise?Math.PI/2:-Math.PI/2;return t.rotate(e).normalize()}tangentInEnd(){let t=new o.Vector(this.pc,this.end),e=this.counterClockwise?-Math.PI/2:Math.PI/2;return t.rotate(e).normalize()}reverse(){return new o.Arc(this.pc,this.r,this.endAngle,this.startAngle,!this.counterClockwise)}translate(...t){let e=this.clone();return e.pc=this.pc.translate(...t),e}rotate(t=0,e=new o.Point){let n=new o.Matrix;return n=n.translate(e.x,e.y).rotate(t).translate(-e.x,-e.y),this.transform(n)}scale(t=1,e=1){let n=new o.Matrix;return n=n.scale(t,e),this.transform(n)}transform(t=new o.Matrix){let e=this.start.transform(t),n=this.end.transform(t),i=this.pc.transform(t),s=this.counterClockwise;return t.a*t.d<0&&(s=!s),o.Arc.arcSE(i,e,n,s)}static arcSE(t,e,n,i){let{vector:s}=o,a=s(t,e).slope,f=s(t,n).slope;o.Utils.EQ(a,f)&&(f+=2*Math.PI,i=!0);let l=s(t,e).length;return new o.Arc(t,l,a,f,i)}definiteIntegral(t=0){return this.breakToFunctional().reduce((i,s)=>i+s.circularSegmentDefiniteIntegral(t),0)}circularSegmentDefiniteIntegral(t){let e=new o.Line(this.start,this.end),n=this.pc.leftTo(e),s=new o.Segment(this.start,this.end).definiteIntegral(t),a=this.circularSegmentArea();return n?s-a:s+a}circularSegmentArea(){return .5*this.r*this.r*(this.sweep-Math.sin(this.sweep))}sortPoints(t){let{vector:e}=o;return t.slice().sort((n,i)=>{let s=e(this.pc,n).slope,a=e(this.pc,i).slope;return s<a?-1:s>a?1:0})}toJSON(){return Object.assign({},this,{name:"arc"})}svg(t={}){let e=this.sweep<=Math.PI?"0":"1",n=this.counterClockwise?"1":"0",{stroke:i,strokeWidth:s,fill:a,id:f,className:l}=t,u=f&&f.length>0?`id="${f}"`:"",d=l&&l.length>0?`class="${l}"`:"";return o.Utils.EQ(this.sweep,2*Math.PI)?new o.Circle(this.pc,this.r).svg(t):`
<path d="M${this.start.x},${this.start.y}
                             A${this.r},${this.r} 0 ${e},${n} ${this.end.x},${this.end.y}"
                    stroke="${i||"black"}" stroke-width="${s||1}" fill="${a||"none"}" ${u} ${d} />`}};o.Arc=Vn;var _a=(...r)=>new o.Arc(...r);o.arc=_a;var oe=class{constructor(t=void 0,e=void 0,n=void 0,i=void 0){this.xmin=t,this.ymin=e,this.xmax=n,this.ymax=i}clone(){return new oe(this.xmin,this.ymin,this.xmax,this.ymax)}get low(){return new o.Point(this.xmin,this.ymin)}get high(){return new o.Point(this.xmax,this.ymax)}get max(){return this.clone()}get center(){return new o.Point((this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)}get width(){return Math.abs(this.xmax-this.xmin)}get height(){return Math.abs(this.ymax-this.ymin)}get box(){return this.clone()}not_intersect(t){return this.xmax<t.xmin||this.xmin>t.xmax||this.ymax<t.ymin||this.ymin>t.ymax}intersect(t){return!this.not_intersect(t)}merge(t){return new oe(this.xmin===void 0?t.xmin:Math.min(this.xmin,t.xmin),this.ymin===void 0?t.ymin:Math.min(this.ymin,t.ymin),this.xmax===void 0?t.xmax:Math.max(this.xmax,t.xmax),this.ymax===void 0?t.ymax:Math.max(this.ymax,t.ymax))}less_than(t){return!!(this.low.lessThan(t.low)||this.low.equalTo(t.low)&&this.high.lessThan(t.high))}equal_to(t){return this.low.equalTo(t.low)&&this.high.equalTo(t.high)}output(){return this.clone()}static comparable_max(t,e){return t.merge(e)}static comparable_less_than(t,e){return t.lessThan(e)}set(t,e,n,i){this.xmin=t,this.ymin=e,this.xmax=n,this.ymax=i}toPoints(){return[new o.Point(this.xmin,this.ymin),new o.Point(this.xmax,this.ymin),new o.Point(this.xmax,this.ymax),new o.Point(this.xmin,this.ymax)]}toSegments(){let t=this.toPoints();return[new o.Segment(t[0],t[1]),new o.Segment(t[1],t[2]),new o.Segment(t[2],t[3]),new o.Segment(t[3],t[0])]}svg(t={}){let{stroke:e,strokeWidth:n,fill:i,id:s,className:a}=t,f=s&&s.length>0?`id="${s}"`:"",l=a&&a.length>0?`class="${a}"`:"",u=this.xmax-this.xmin,d=this.ymax-this.ymin;return`
<rect x="${this.xmin}" y="${this.ymin}" width=${u} height=${d} stroke="${e||"black"}" stroke-width="${n||1}" fill="${i||"none"}" ${f} ${l} />`}};o.Box=oe;var xa=(...r)=>new o.Box(...r);o.box=xa;var Dn=class{constructor(t){this.shape=t,this.next=void 0,this.prev=void 0,this.face=void 0,this.arc_length=0,this.bvStart=void 0,this.bvEnd=void 0,this.bv=void 0,this.overlap=void 0}get start(){return this.shape.start}get end(){return this.shape.end}get length(){return this.shape.length}get box(){return this.shape.box}isSegment(){return this.shape instanceof o.Segment}isArc(){return this.shape instanceof o.Arc}middle(){return this.shape.middle()}pointAtLength(t){return this.shape.pointAtLength(t)}contains(t){return this.shape.contains(t)}setInclusion(t){if(this.bv!==void 0)return this.bv;if(this.shape instanceof o.Line||this.shape instanceof o.Ray)return this.bv=o.OUTSIDE,this.bv;if(this.bvStart===void 0&&(this.bvStart=re(t,this.start)),this.bvEnd===void 0&&(this.bvEnd=re(t,this.end)),this.bvStart===o.OUTSIDE||this.bvEnd==o.OUTSIDE)this.bv=o.OUTSIDE;else if(this.bvStart===o.INSIDE||this.bvEnd==o.INSIDE)this.bv=o.INSIDE;else{let e=re(t,this.middle());this.bv=e}return this.bv}setOverlap(t){let e,n=this.shape,i=t.shape;n instanceof o.Segment&&i instanceof o.Segment?n.start.equalTo(i.start)&&n.end.equalTo(i.end)?e=o.OVERLAP_SAME:n.start.equalTo(i.end)&&n.end.equalTo(i.start)&&(e=o.OVERLAP_OPPOSITE):(n instanceof o.Arc&&i instanceof o.Arc||n instanceof o.Segment&&i instanceof o.Arc||n instanceof o.Arc&&i instanceof o.Segment)&&(n.start.equalTo(i.start)&&n.end.equalTo(i.end)&&n.middle().equalTo(i.middle())?e=o.OVERLAP_SAME:n.start.equalTo(i.end)&&n.end.equalTo(i.start)&&n.middle().equalTo(i.middle())&&(e=o.OVERLAP_OPPOSITE)),this.overlap===void 0&&(this.overlap=e),t.overlap===void 0&&(t.overlap=e)}svg(){if(this.shape instanceof o.Segment)return` L${this.shape.end.x},${this.shape.end.y}`;if(this.shape instanceof o.Arc){let t=this.shape,e,n=t.counterClockwise?"1":"0";if(o.Utils.EQ(t.sweep,2*Math.PI)){let i=t.counterClockwise?1:-1,s=new o.Arc(t.pc,t.r,t.startAngle,t.startAngle+i*Math.PI,t.counterClockwise),a=new o.Arc(t.pc,t.r,t.startAngle+i*Math.PI,t.endAngle,t.counterClockwise);return e="0",` A${s.r},${s.r} 0 ${e},${n} ${s.end.x},${s.end.y}
                    A${a.r},${a.r} 0 ${e},${n} ${a.end.x},${a.end.y}`}else return e=t.sweep<=Math.PI?"0":"1",` A${t.r},${t.r} 0 ${e},${n} ${t.end.x},${t.end.y}`}}toJSON(){return this.shape.toJSON()}};o.Edge=Dn;var Gn=class extends Pe{constructor(t,e){super(t,e);this.setCircularLinks()}setCircularLinks(){this.isEmpty()||(this.last.next=this.first,this.first.prev=this.last)}[Symbol.iterator](){let t;return{next:()=>{let e=t||this.first,n=this.first?t?t===this.first:!1:!0;return t=e?e.next:void 0,{value:e,done:n}}}}append(t){return super.append(t),this.setCircularLinks(),this}insert(t,e){return super.insert(t,e),this.setCircularLinks(),this}remove(t){return super.remove(t),this}},_t=class extends Gn{constructor(t,...e){super();if(this._box=void 0,this._orientation=void 0,e.length!=0){if(e.length==1){if(e[0]instanceof Array){let n=e[0];if(n.length==0)return;if(n.every(i=>i instanceof o.Point)){let i=_t.points2segments(n);this.shapes2face(t.edges,i)}else if(n.every(i=>i instanceof Array&&i.length===2)){let i=n.map(a=>new o.Point(a[0],a[1])),s=_t.points2segments(i);this.shapes2face(t.edges,s)}else if(n.every(i=>i instanceof o.Segment||i instanceof o.Arc))this.shapes2face(t.edges,n);else if(n.every(i=>i.name==="segment"||i.name==="arc")){let i=[];for(let s of n){let a;s.name==="segment"?a=new o.Segment(s):a=new o.Arc(s),i.push(a)}this.shapes2face(t.edges,i)}}else if(e[0]instanceof _t){let n=e[0];this.first=n.first,this.last=n.last;for(let i of n)t.edges.add(i)}else if(e[0]instanceof o.Circle)this.shapes2face(t.edges,[e[0].toArc(o.CCW)]);else if(e[0]instanceof o.Box){let n=e[0];this.shapes2face(t.edges,[new o.Segment(new o.Point(n.xmin,n.ymin),new o.Point(n.xmax,n.ymin)),new o.Segment(new o.Point(n.xmax,n.ymin),new o.Point(n.xmax,n.ymax)),new o.Segment(new o.Point(n.xmax,n.ymax),new o.Point(n.xmin,n.ymax)),new o.Segment(new o.Point(n.xmin,n.ymax),new o.Point(n.xmin,n.ymin))])}}e.length==2&&e[0]instanceof o.Edge&&e[1]instanceof o.Edge&&(this.first=e[0],this.last=e[1],this.last.next=this.first,this.first.prev=this.last,this.setArcLength())}}get edges(){return this.toArray()}get shapes(){return this.edges.map(t=>t.shape.clone())}get box(){if(this._box===void 0){let t=new o.Box;for(let e of this)t=t.merge(e.box);this._box=t}return this._box}get perimeter(){return this.last.arc_length+this.last.length}pointAtLength(t){if(t>this.perimeter||t<0)return null;let e=null;for(let n of this)if(t>=n.arc_length&&(n===this.last||t<n.next.arc_length)){e=n.pointAtLength(t-n.arc_length);break}return e}static points2segments(t){let e=[];for(let n=0;n<t.length;n++)t[n].equalTo(t[(n+1)%t.length])||e.push(new o.Segment(t[n],t[(n+1)%t.length]));return e}shapes2face(t,e){for(let n of e){let i=new o.Edge(n);this.append(i),t.add(i)}}append(t){return super.append(t),this.setOneEdgeArcLength(t),t.face=this,this}insert(t,e){return super.insert(t,e),this.setOneEdgeArcLength(t),t.face=this,this}remove(t){return super.remove(t),this.setArcLength(),this}reverse(){let t=[],e=this.last;do e.shape=e.shape.reverse(),t.push(e),e=e.prev;while(e!==this.last);this.first=void 0,this.last=void 0;for(let n of t)this.first===void 0?(n.prev=n,n.next=n,this.first=n,this.last=n):(n.prev=this.last,this.last.next=n,this.last=n,this.last.next=this.first,this.first.prev=this.last),this.setOneEdgeArcLength(n);this._orientation!==void 0&&(this._orientation=void 0,this._orientation=this.orientation())}setArcLength(){for(let t of this)this.setOneEdgeArcLength(t),t.face=this}setOneEdgeArcLength(t){t===this.first?t.arc_length=0:t.arc_length=t.prev.arc_length+t.prev.length}area(){return Math.abs(this.signedArea())}signedArea(){let t=0,e=this.box.ymin;for(let n of this)t+=n.shape.definiteIntegral(e);return t}orientation(){if(this._orientation===void 0){let t=this.signedArea();o.Utils.EQ_0(t)?this._orientation=o.ORIENTATION.NOT_ORIENTABLE:o.Utils.LT(t,0)?this._orientation=o.ORIENTATION.CCW:this._orientation=o.ORIENTATION.CW}return this._orientation}isSimple(t){return _t.getSelfIntersections(this,t,!0).length==0}static getSelfIntersections(t,e,n=!1){let i=[];for(let s of t){let a=e.search(s.box);for(let f of a){if(s===f||f.face!==t||s.shape instanceof o.Segment&&f.shape instanceof o.Segment&&(s.next===f||s.prev===f))continue;let l=s.shape.intersect(f.shape);for(let u of l)if(!(u.equalTo(s.start)&&u.equalTo(f.end)&&f===s.prev)&&!(u.equalTo(s.end)&&u.equalTo(f.start)&&f===s.next)&&(i.push(u),n))break;if(i.length>0&&n)break}if(i.length>0&&n)break}return i}findEdgeByPoint(t){let e;for(let n of this)if(n.shape.contains(t)){e=n;break}return e}toPolygon(){return new o.Polygon(this.shapes)}toJSON(){return this.edges.map(t=>t.toJSON())}svg(){let t=`
M${this.first.start.x},${this.first.start.y}`;for(let e of this)t+=e.svg();return t+=" z",t}};o.Face=_t;var Fe=class{constructor(...t){if(this.pt=new o.Point,this.norm=new o.Vector(0,1),t.length!=0&&(t.length>=1&&t[0]instanceof o.Point&&(this.pt=t[0].clone()),t.length!==1)){if(t.length===2&&t[1]instanceof o.Vector){this.norm=t[1].clone();return}throw o.Errors.ILLEGAL_PARAMETERS}}clone(){return new Fe(this.pt,this.norm)}get slope(){return new o.Vector(this.norm.y,-this.norm.x).slope}get box(){let t=this.slope;return new o.Box(t>Math.PI/2&&t<3*Math.PI/2?Number.NEGATIVE_INFINITY:this.pt.x,t>=0&&t<=Math.PI?this.pt.y:Number.NEGATIVE_INFINITY,t>=Math.PI/2&&t<=3*Math.PI/2?this.pt.x:Number.POSITIVE_INFINITY,t>=Math.PI&&t<=2*Math.PI||t==0?this.pt.y:Number.POSITIVE_INFINITY)}get start(){return this.pt}get end(){}get length(){return Number.POSITIVE_INFINITY}contains(t){if(this.pt.equalTo(t))return!0;let e=new o.Vector(this.pt,t);return o.Utils.EQ_0(this.norm.dot(e))&&o.Utils.GE(e.cross(this.norm),0)}split(t){return this.contains(t)?this.pt.equalTo(t)?[this]:[new o.Segment(this.pt,t),new o.Ray(t,this.norm)]:[]}intersect(t){if(t instanceof o.Segment)return this.intersectRay2Segment(this,t);if(t instanceof o.Arc)return this.intersectRay2Arc(this,t)}intersectRay2Segment(t,e){let n=[],i=new o.Line(t.start,t.norm),s=i.intersect(e);for(let a of s)t.contains(a)&&n.push(a);return s.length==2&&n.length==1&&t.start.on(i)&&n.push(t.start),n}intersectRay2Arc(t,e){let n=[],s=new o.Line(t.start,t.norm).intersect(e);for(let a of s)t.contains(a)&&n.push(a);return n}svg(t,e={}){let n=new o.Line(this.pt,this.norm),i=ie(n,t);return i=i.filter(a=>this.contains(a)),i.length===0||i.length===2?"":new o.Segment(this.pt,i[0]).svg(e)}};o.Ray=Fe;var ya=(...r)=>new o.Ray(...r);o.ray=ya;var xt=class{constructor(){this.faces=new o.PlanarSet,this.edges=new o.PlanarSet;let t=[...arguments];if(t.length===1&&(t[0]instanceof Array&&t[0].length>0||t[0]instanceof o.Circle||t[0]instanceof o.Box)){let e=t[0];if(t[0]instanceof Array&&t[0].every(n=>n instanceof Array))if(e.every(n=>n instanceof Array&&n.length===2&&typeof n[0]=="number"&&typeof n[1]=="number"))this.faces.add(new o.Face(this,e));else for(let n of e)if(n instanceof Array&&n[0]instanceof Array&&n[0].every(i=>i instanceof Array&&i.length===2&&typeof i[0]=="number"&&typeof i[1]=="number"))for(let i of n)this.faces.add(new o.Face(this,i));else this.faces.add(new o.Face(this,n));else this.faces.add(new o.Face(this,e))}}get box(){return[...this.faces].reduce((t,e)=>t.merge(e.box),new o.Box)}get vertices(){return[...this.edges].map(t=>t.start)}clone(){let t=new xt;for(let e of this.faces)t.addFace(e.shapes);return t}isEmpty(){return this.edges.size===0}isValid(){let t=!0;for(let e of this.faces)if(!e.isSimple(this.edges)){t=!1;break}return t}area(){let t=[...this.faces].reduce((e,n)=>e+n.signedArea(),0);return Math.abs(t)}addFace(...t){let e=new o.Face(this,...t);return this.faces.add(e),e}deleteFace(t){for(let e of t)this.edges.delete(e);return this.faces.delete(t)}recreateFaces(){this.faces.clear();for(let n of this.edges)n.face=null;let t,e=!0;for(;e;){e=!1;for(let n of this.edges)if(n.face===null){t=n,e=!0;break}if(e){let n=t;do n=n.next;while(n.next!==t);this.addFace(t,n)}}}removeChain(t,e,n){if(n.next===e){this.deleteFace(t);return}for(let i=e;i!==n.next;i=i.next)if(t.remove(i),this.edges.delete(i),t.isEmpty()){this.deleteFace(t);break}}addVertex(t,e){let n=e.shape.split(t);if(n[0]===null)return e.prev;if(n[1]===null)return e;let i=new o.Edge(n[0]),s=e.prev;return e.face.insert(i,s),this.edges.delete(e),this.edges.add(i),e.shape=n[1],this.edges.add(e),i}cut(t){let e=[this.clone()];for(let n of t){if(n.setInclusion(this)!==te)continue;let i=n.shape.start,s=n.shape.end,a=[];for(let f of e)if(f.findEdgeByPoint(i)===void 0)a.push(f);else{let[l,u]=f.cutFace(i,s);a.push(l,u)}e=a}return e}cutFace(t,e){let n=this.findEdgeByPoint(t),i=this.findEdgeByPoint(e);if(n.face!==i.face)return[];let s=this.addVertex(t,n);i=this.findEdgeByPoint(e);let a=this.addVertex(e,i),f=s.face,l=new o.Edge(new o.Segment(s.end,a.end)),u=new o.Edge(new o.Segment(a.end,s.end));s.next.prev=u,u.next=s.next,s.next=l,l.prev=s,a.next.prev=l,l.next=a.next,a.next=u,u.prev=a,this.edges.add(l),this.edges.add(u);let d=this.addFace(l,s),c=this.addFace(u,a);return this.faces.delete(f),[d.toPolygon(),c.toPolygon()]}cutWithLine(t){let e=this.clone(),n=new W([t]),i={int_points1:[],int_points2:[],int_points1_sorted:[],int_points2_sorted:[]};for(let f of e.edges){let l=Cn(f,t);for(let u of l)Nt(n.first,u,i.int_points1),Nt(f,u,i.int_points2)}if(i.int_points1.length===0)return e;i.int_points1_sorted=pr(t,i.int_points1),i.int_points2_sorted=ee(i.int_points2),Mt(n,i.int_points1_sorted),Mt(e,i.int_points2_sorted),Ar(i),i.int_points1_sorted=pr(t,i.int_points1),i.int_points2_sorted=ee(i.int_points2),_r(i.int_points1),xr(i.int_points1,e);for(let f of i.int_points1_sorted)f.edge_before.bv===f.edge_after.bv&&(i.int_points2[f.id]=-1,f.id=-1);if(i.int_points1=i.int_points1.filter(f=>f.id>=0),i.int_points2=i.int_points2.filter(f=>f.id>=0),i.int_points1.length===0)return e;i.int_points1_sorted=pr(t,i.int_points1),i.int_points2_sorted=ee(i.int_points2);let s=i.int_points1[0],a;for(let f of i.int_points1_sorted)f.edge_before.bv===te&&(a=new o.Edge(new o.Segment(s.pt,f.pt)),un(i.int_points2[s.id],i.int_points2[f.id],a),e.edges.add(a),a=new o.Edge(new o.Segment(f.pt,s.pt)),un(i.int_points2[f.id],i.int_points2[s.id],a),e.edges.add(a)),s=f;return e.recreateFaces(),e}findEdgeByPoint(t){let e;for(let n of this.faces)if(e=n.findEdgeByPoint(t),e!==void 0)break;return e}splitToIslands(){let t=this.toArray();t.sort((i,s)=>s.area()-i.area());let e=[...t[0].faces][0].orientation(),n=t.filter(i=>[...i.faces][0].orientation()===e);for(let i of t){let s=[...i.faces][0];if(s.orientation()!==e){for(let a of n)if(s.shapes.every(f=>a.contains(f))){a.addFace(s.shapes);break}}}return n}reverse(){for(let t of this.faces)t.reverse();return this}contains(t){if(t instanceof o.Point){let e=re(this,t);return e===te||e===Y}else return Mn(this,t)}distanceTo(t){if(t instanceof o.Point){let[e,n]=o.Distance.point2polygon(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Circle||t instanceof o.Line||t instanceof o.Segment||t instanceof o.Arc){let[e,n]=o.Distance.shape2polygon(t,this);return n=n.reverse(),[e,n]}if(t instanceof o.Polygon){let e=[Number.POSITIVE_INFINITY,new o.Segment],n,i;for(let s of this.edges){let a=e[0];[n,i]=o.Distance.shape2planarSet(s.shape,t.edges,a),o.Utils.LT(n,a)&&(e=[n,i])}return e}}intersect(t){if(t instanceof o.Point)return this.contains(t)?[t]:[];if(t instanceof o.Line)return Ne(t,this);if(t instanceof o.Circle)return On(t,this);if(t instanceof o.Segment)return Or(t,this);if(t instanceof o.Arc)return Lr(t,this);if(t instanceof o.Polygon)return Ks(t,this)}translate(t){let e=new xt;for(let n of this.faces)e.addFace(n.shapes.map(i=>i.translate(t)));return e}rotate(t=0,e=new o.Point){let n=new xt;for(let i of this.faces)n.addFace(i.shapes.map(s=>s.rotate(t,e)));return n}transform(t=new o.Matrix){let e=new xt;for(let n of this.faces)e.addFace(n.shapes.map(i=>i.transform(t)));return e}toJSON(){return[...this.faces].map(t=>t.toJSON())}toArray(){return[...this.faces].map(t=>t.toPolygon())}svg(t={}){let{stroke:e,strokeWidth:n,fill:i,fillRule:s,fillOpacity:a,id:f,className:l}=t,u=f&&f.length>0?`id="${f}"`:"",d=l&&l.length>0?`class="${l}"`:"",c=`
<path stroke="${e||"black"}" stroke-width="${n||1}" fill="${i||"lightcyan"}" fill-rule="${s||"evenodd"}" fill-opacity="${a||1}" ${u} ${d} d="`;for(let h of this.faces)c+=h.svg();return c+=`" >
</path>`,c}};o.Polygon=xt;var ba=(...r)=>new o.Polygon(...r);o.polygon=ba;var{Circle:hr,Line:_n,Point:xn,Vector:Te,Utils:mr}=o,Rt=class{constructor(t){this.circle=t}get inversion_circle(){return this.circle}static inversePoint(t,e){let n=new Te(t.pc,e),i=t.r*t.r,s=n.dot(n);return mr.EQ_0(s)?new xn(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY):t.pc.translate(n.multiply(i/s))}static inverseCircle(t,e){let n=t.pc.distanceTo(e.pc)[0];if(mr.EQ(n,e.r)){let i=t.r*t.r/(2*e.r),s=new Te(t.pc,e.pc);s=s.normalize();let a=t.pc.translate(s.multiply(i));return new _n(a,s)}else{let i=new Te(t.pc,e.pc),s=t.r*t.r/(i.dot(i)-e.r*e.r),a=t.pc.translate(i.multiply(s)),f=Math.abs(s)*e.r;return new hr(a,f)}}static inverseLine(t,e){let[n,i]=t.pc.distanceTo(e);if(mr.EQ_0(n))return e.clone();{let s=t.r*t.r/(2*n),a=new Te(t.pc,i.end);return a=a.multiply(s/n),new hr(t.pc.translate(a),s)}}inverse(t){if(t instanceof xn)return Rt.inversePoint(this.circle,t);if(t instanceof hr)return Rt.inverseCircle(this.circle,t);if(t instanceof _n)return Rt.inverseLine(this.circle,t)}};o.Inversion=Rt;var va=r=>new o.Inversion(r);o.inversion=va;var x=class{static point2point(t,e){return t.distanceTo(e)}static point2line(t,e){let n=t.projectionOn(e);return[new o.Vector(t,n).length,new o.Segment(t,n)]}static point2circle(t,e){let[n,i]=t.distanceTo(e.center);if(o.Utils.EQ_0(n))return[e.r,new o.Segment(t,e.toArc().start)];{let s=Math.abs(n-e.r),a=new o.Vector(e.pc,t).normalize().multiply(e.r),f=e.pc.translate(a);return[s,new o.Segment(t,f)]}}static point2segment(t,e){if(e.start.equalTo(e.end))return x.point2point(t,e.start);let n=new o.Vector(e.start,e.end),i=new o.Vector(e.start,t),s=new o.Vector(e.end,t),a=n.dot(i),f=-n.dot(s),l,u;if(o.Utils.GE(a,0)&&o.Utils.GE(f,0)){let d=e.tangentInStart();return l=Math.abs(d.cross(i)),u=e.start.translate(d.multiply(d.dot(i))),[l,new o.Segment(t,u)]}else return a<0?t.distanceTo(e.start):t.distanceTo(e.end)}static point2arc(t,e){let n=new o.Circle(e.pc,e.r),i=[],s,a;return[s,a]=x.point2circle(t,n),a.end.on(e)&&i.push(x.point2circle(t,n)),i.push(x.point2point(t,e.start)),i.push(x.point2point(t,e.end)),x.sort(i),i[0]}static segment2line(t,e){let n=t.intersect(e);if(n.length>0)return[0,new o.Segment(n[0],n[0])];let i=[];return i.push(x.point2line(t.start,e)),i.push(x.point2line(t.end,e)),x.sort(i),i[0]}static segment2segment(t,e){let n=fe(t,e);if(n.length>0)return[0,new o.Segment(n[0],n[0])];let i=[],s,a;return[s,a]=x.point2segment(e.start,t),i.push([s,a.reverse()]),[s,a]=x.point2segment(e.end,t),i.push([s,a.reverse()]),i.push(x.point2segment(t.start,e)),i.push(x.point2segment(t.end,e)),x.sort(i),i[0]}static segment2circle(t,e){let n=t.intersect(e);if(n.length>0)return[0,new o.Segment(n[0],n[0])];let i=new o.Line(t.ps,t.pe),[s,a]=x.point2line(e.center,i);if(o.Utils.GE(s,e.r)&&a.end.on(t))return x.point2circle(a.end,e);{let[f,l]=x.point2circle(t.start,e),[u,d]=x.point2circle(t.end,e);return o.Utils.LT(f,u)?[f,l]:[u,d]}}static segment2arc(t,e){let n=t.intersect(e);if(n.length>0)return[0,new o.Segment(n[0],n[0])];let i=new o.Line(t.ps,t.pe),s=new o.Circle(e.pc,e.r),[a,f]=x.point2line(s.center,i);if(o.Utils.GE(a,s.r)&&f.end.on(t)){let[c,h]=x.point2circle(f.end,s);if(h.end.on(e))return[c,h]}let l=[];l.push(x.point2arc(t.start,e)),l.push(x.point2arc(t.end,e));let u,d;return[u,d]=x.point2segment(e.start,t),l.push([u,d.reverse()]),[u,d]=x.point2segment(e.end,t),l.push([u,d.reverse()]),x.sort(l),l[0]}static circle2circle(t,e){let n=t.intersect(e);if(n.length>0)return[0,new o.Segment(n[0],n[0])];if(t.center.equalTo(e.center)){let i=t.toArc(),s=e.toArc();return x.point2point(i.start,s.start)}else{let i=new o.Line(t.center,e.center),s=i.intersect(t),a=i.intersect(e),f=[];return f.push(x.point2point(s[0],a[0])),f.push(x.point2point(s[0],a[1])),f.push(x.point2point(s[1],a[0])),f.push(x.point2point(s[1],a[1])),x.sort(f),f[0]}}static circle2line(t,e){let n=t.intersect(e);if(n.length>0)return[0,new o.Segment(n[0],n[0])];let[i,s]=x.point2line(t.center,e),[a,f]=x.point2circle(s.end,t);return f=f.reverse(),[a,f]}static arc2line(t,e){let n=e.intersect(t);if(n.length>0)return[0,new o.Segment(n[0],n[0])];let i=new o.Circle(t.center,t.r),[s,a]=x.point2line(i.center,e);if(o.Utils.GE(s,i.r)){let[f,l]=x.point2circle(a.end,i);if(l.end.on(t))return[f,l]}else{let f=[];return f.push(x.point2line(t.start,e)),f.push(x.point2line(t.end,e)),x.sort(f),f[0]}}static arc2circle(t,e){let n=t.intersect(e);if(n.length>0)return[0,new o.Segment(n[0],n[0])];let i=new o.Circle(t.center,t.r),[s,a]=x.circle2circle(i,e);if(a.start.on(t))return[s,a];{let f=[];return f.push(x.point2circle(t.start,e)),f.push(x.point2circle(t.end,e)),x.sort(f),f[0]}}static arc2arc(t,e){let n=t.intersect(e);if(n.length>0)return[0,new o.Segment(n[0],n[0])];let i=new o.Circle(t.center,t.r),s=new o.Circle(e.center,e.r),[a,f]=x.circle2circle(i,s);if(f.start.on(t)&&f.end.on(e))return[a,f];{let l=[],u,d;return[u,d]=x.point2arc(t.start,e),d.end.on(e)&&l.push([u,d]),[u,d]=x.point2arc(t.end,e),d.end.on(e)&&l.push([u,d]),[u,d]=x.point2arc(e.start,t),d.end.on(t)&&l.push([u,d.reverse()]),[u,d]=x.point2arc(e.end,t),d.end.on(t)&&l.push([u,d.reverse()]),[u,d]=x.point2point(t.start,e.start),l.push([u,d]),[u,d]=x.point2point(t.start,e.end),l.push([u,d]),[u,d]=x.point2point(t.end,e.start),l.push([u,d]),[u,d]=x.point2point(t.end,e.end),l.push([u,d]),x.sort(l),l[0]}}static point2polygon(t,e){let n=[Number.POSITIVE_INFINITY,new o.Segment];for(let i of e.edges){let[s,a]=i.shape instanceof o.Segment?x.point2segment(t,i.shape):x.point2arc(t,i.shape);o.Utils.LT(s,n[0])&&(n=[s,a])}return n}static shape2polygon(t,e){let n=[Number.POSITIVE_INFINITY,new o.Segment];for(let i of e.edges){let[s,a]=t.distanceTo(i.shape);o.Utils.LT(s,n[0])&&(n=[s,a])}return n}static polygon2polygon(t,e){let n=[Number.POSITIVE_INFINITY,new o.Segment];for(let i of t.edges)for(let s of e.edges){let[a,f]=i.shape.distanceTo(s.shape);o.Utils.LT(a,n[0])&&(n=[a,f])}return n}static box2box_minmax(t,e){let n=Math.max(Math.max(t.xmin-e.xmax,0),Math.max(e.xmin-t.xmax,0)),i=Math.max(Math.max(t.ymin-e.ymax,0),Math.max(e.ymin-t.ymax,0)),s=n*n+i*i,a=t.merge(e),f=a.xmax-a.xmin,l=a.ymax-a.ymin,u=f*f+l*l;return[s,u]}static minmax_tree_process_level(t,e,n,i){let s,a;for(let d of e)[s,a]=x.box2box_minmax(t.box,d.item.key),d.item.value instanceof o.Edge?i.insert([s,a],d.item.value.shape):i.insert([s,a],d.item.value),o.Utils.LT(a,n)&&(n=a);if(e.length===0)return n;let f=e.map(d=>d.left.isNil()?void 0:d.left).filter(d=>d!==void 0),l=e.map(d=>d.right.isNil()?void 0:d.right).filter(d=>d!==void 0),u=[...f,...l].filter(d=>{let[c,h]=x.box2box_minmax(t.box,d.max);return o.Utils.LE(c,n)});return n=x.minmax_tree_process_level(t,u,n,i),n}static minmax_tree(t,e,n){let i=new Ft,s=[e.index.root],a=n<Number.POSITIVE_INFINITY?n*n:Number.POSITIVE_INFINITY;return a=x.minmax_tree_process_level(t,s,a,i),i}static minmax_tree_calc_distance(t,e,n){let i,s;if(e!=null&&!e.isNil()){if([i,s]=x.minmax_tree_calc_distance(t,e.left,n),s)return[i,s];if(o.Utils.LT(i[0],Math.sqrt(e.item.key.low)))return[i,!0];let[a,f]=x.distance(t,e.item.value);return o.Utils.LT(a,i[0])&&(i=[a,f]),[i,s]=x.minmax_tree_calc_distance(t,e.right,i),[i,s]}return[n,!1]}static shape2planarSet(t,e,n=Number.POSITIVE_INFINITY){let i=[n,new o.Segment],s=!1;if(e instanceof o.PlanarSet){let a=x.minmax_tree(t,e,n);[i,s]=x.minmax_tree_calc_distance(t,a.root,i)}return i}static sort(t){t.sort((e,n)=>o.Utils.LT(e[0],n[0])?-1:o.Utils.GT(e[0],n[0])?1:0)}static distance(t,e){return t.distanceTo(e)}};o.Distance=x;o.BooleanOperations=Us;o.Relations=la;var g=o;var $=class{};at($,"weaponBox",{spriteName:"weaponBox",frameCount:16}),at($,"rabbitBreath",{spriteName:"rabbitBreath",frameCount:60}),at($,"bubbles",{spriteName:"bubbles",frameCount:68}),at($,"rabbitGo",{spriteName:"rabbitGo",frameCount:24}),at($,"rabbitPrepareToJump",{spriteName:"rabbitPrepareToJump",frameCount:9}),at($,"rabbitJumpBack",{spriteName:"rabbitJumpBack",frameCount:30}),at($,"rabbitJump",{spriteName:"rabbitJump",frameCount:9});var Et=class{anim;startTime;constructor(t){this.anim=t,this.startTime=performance.now()}};var wa=typeof global=="object"&&global&&global.Object===Object&&global,Be=wa;var Ea=typeof self=="object"&&self&&self.Object===Object&&self,Ta=Be||Ea||Function("return this")(),N=Ta;var Ia=N.Symbol,U=Ia;var $n=Object.prototype,Aa=$n.hasOwnProperty,Sa=$n.toString,le=U?U.toStringTag:void 0;function Pa(r){var t=Aa.call(r,le),e=r[le];try{r[le]=void 0;var n=!0}catch{}var i=Sa.call(r);return n&&(t?r[le]=e:delete r[le]),i}var Wn=Pa;var Ca=Object.prototype,Oa=Ca.toString;function La(r){return Oa.call(r)}var qn=La;var Ra="[object Null]",Na="[object Undefined]",jn=U?U.toStringTag:void 0;function ka(r){return r==null?r===void 0?Na:Ra:jn&&jn in Object(r)?Wn(r):qn(r)}var j=ka;function Ma(r){return r!=null&&typeof r=="object"}var z=Ma;var Fa="[object Symbol]";function Ba(r){return typeof r=="symbol"||z(r)&&j(r)==Fa}var J=Ba;function Ua(r,t){for(var e=-1,n=r==null?0:r.length,i=Array(n);++e<n;)i[e]=t(r[e],e,r);return i}var Ue=Ua;var Va=Array.isArray,L=Va;var Da=1/0,zn=U?U.prototype:void 0,Yn=zn?zn.toString:void 0;function Xn(r){if(typeof r=="string")return r;if(L(r))return Ue(r,Xn)+"";if(J(r))return Yn?Yn.call(r):"";var t=r+"";return t=="0"&&1/r==-Da?"-0":t}var Hn=Xn;var Ga=/\s/;function $a(r){for(var t=r.length;t--&&Ga.test(r.charAt(t)););return t}var Qn=$a;var Wa=/^\s+/;function qa(r){return r&&r.slice(0,Qn(r)+1).replace(Wa,"")}var Jn=qa;function ja(r){var t=typeof r;return r!=null&&(t=="object"||t=="function")}var V=ja;var Kn=0/0,za=/^[-+]0x[0-9a-f]+$/i,Ya=/^0b[01]+$/i,Xa=/^0o[0-7]+$/i,Ha=parseInt;function Qa(r){if(typeof r=="number")return r;if(J(r))return Kn;if(V(r)){var t=typeof r.valueOf=="function"?r.valueOf():r;r=V(t)?t+"":t}if(typeof r!="string")return r===0?r:+r;r=Jn(r);var e=Ya.test(r);return e||Xa.test(r)?Ha(r.slice(2),e?2:8):za.test(r)?Kn:+r}var it=Qa;var Zn=1/0,Ja=17976931348623157e292;function Ka(r){if(!r)return r===0?r:0;if(r=it(r),r===Zn||r===-Zn){var t=r<0?-1:1;return t*Ja}return r===r?r:0}var ue=Ka;function Za(r){var t=ue(r),e=t%1;return t===t?e?t-e:t:0}var Ve=Za;function tf(r){return r}var ti=tf;var ef="[object AsyncFunction]",rf="[object Function]",nf="[object GeneratorFunction]",of="[object Proxy]";function sf(r){if(!V(r))return!1;var t=j(r);return t==rf||t==nf||t==ef||t==of}var De=sf;var af=N["__core-js_shared__"],Ge=af;var ei=function(){var r=/[^.]+$/.exec(Ge&&Ge.keys&&Ge.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function ff(r){return!!ei&&ei in r}var ri=ff;var lf=Function.prototype,uf=lf.toString;function df(r){if(r!=null){try{return uf.call(r)}catch{}try{return r+""}catch{}}return""}var ot=df;var cf=/[\\^$.*+?()[\]{}|]/g,pf=/^\[object .+?Constructor\]$/,hf=Function.prototype,mf=Object.prototype,gf=hf.toString,_f=mf.hasOwnProperty,xf=RegExp("^"+gf.call(_f).replace(cf,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function yf(r){if(!V(r)||ri(r))return!1;var t=De(r)?xf:pf;return t.test(ot(r))}var ni=yf;function bf(r,t){return r==null?void 0:r[t]}var ii=bf;function vf(r,t){var e=ii(r,t);return ni(e)?e:void 0}var q=vf;var wf=q(N,"WeakMap"),$e=wf;function Ef(r,t,e,n){for(var i=r.length,s=e+(n?1:-1);n?s--:++s<i;)if(t(r[s],s,r))return s;return-1}var oi=Ef;var Tf=9007199254740991,If=/^(?:0|[1-9]\d*)$/;function Af(r,t){var e=typeof r;return t=t??Tf,!!t&&(e=="number"||e!="symbol"&&If.test(r))&&r>-1&&r%1==0&&r<t}var Vt=Af;function Sf(r,t){return r===t||r!==r&&t!==t}var Dt=Sf;var Pf=9007199254740991;function Cf(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=Pf}var Gt=Cf;function Of(r){return r!=null&&Gt(r.length)&&!De(r)}var K=Of;function Lf(r,t,e){if(!V(e))return!1;var n=typeof t;return(n=="number"?K(e)&&Vt(t,e.length):n=="string"&&t in e)?Dt(e[t],r):!1}var We=Lf;var Rf=Object.prototype;function Nf(r){var t=r&&r.constructor,e=typeof t=="function"&&t.prototype||Rf;return r===e}var si=Nf;function kf(r,t){for(var e=-1,n=Array(r);++e<r;)n[e]=t(e);return n}var ai=kf;var Mf="[object Arguments]";function Ff(r){return z(r)&&j(r)==Mf}var Rr=Ff;var fi=Object.prototype,Bf=fi.hasOwnProperty,Uf=fi.propertyIsEnumerable,Vf=Rr(function(){return arguments}())?Rr:function(r){return z(r)&&Bf.call(r,"callee")&&!Uf.call(r,"callee")},$t=Vf;function Df(){return!1}var li=Df;var ci=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ui=ci&&typeof module=="object"&&module&&!module.nodeType&&module,Gf=ui&&ui.exports===ci,di=Gf?N.Buffer:void 0,$f=di?di.isBuffer:void 0,Wf=$f||li,de=Wf;var qf="[object Arguments]",jf="[object Array]",zf="[object Boolean]",Yf="[object Date]",Xf="[object Error]",Hf="[object Function]",Qf="[object Map]",Jf="[object Number]",Kf="[object Object]",Zf="[object RegExp]",tl="[object Set]",el="[object String]",rl="[object WeakMap]",nl="[object ArrayBuffer]",il="[object DataView]",ol="[object Float32Array]",sl="[object Float64Array]",al="[object Int8Array]",fl="[object Int16Array]",ll="[object Int32Array]",ul="[object Uint8Array]",dl="[object Uint8ClampedArray]",cl="[object Uint16Array]",pl="[object Uint32Array]",S={};S[ol]=S[sl]=S[al]=S[fl]=S[ll]=S[ul]=S[dl]=S[cl]=S[pl]=!0;S[qf]=S[jf]=S[nl]=S[zf]=S[il]=S[Yf]=S[Xf]=S[Hf]=S[Qf]=S[Jf]=S[Kf]=S[Zf]=S[tl]=S[el]=S[rl]=!1;function hl(r){return z(r)&&Gt(r.length)&&!!S[j(r)]}var pi=hl;function ml(r){return function(t){return r(t)}}var hi=ml;var mi=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ce=mi&&typeof module=="object"&&module&&!module.nodeType&&module,gl=ce&&ce.exports===mi,Nr=gl&&Be.process,_l=function(){try{var r=ce&&ce.require&&ce.require("util").types;return r||Nr&&Nr.binding&&Nr.binding("util")}catch{}}(),kr=_l;var gi=kr&&kr.isTypedArray,xl=gi?hi(gi):pi,qe=xl;var yl=Object.prototype,bl=yl.hasOwnProperty;function vl(r,t){var e=L(r),n=!e&&$t(r),i=!e&&!n&&de(r),s=!e&&!n&&!i&&qe(r),a=e||n||i||s,f=a?ai(r.length,String):[],l=f.length;for(var u in r)(t||bl.call(r,u))&&!(a&&(u=="length"||i&&(u=="offset"||u=="parent")||s&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||Vt(u,l)))&&f.push(u);return f}var _i=vl;function wl(r,t){return function(e){return r(t(e))}}var xi=wl;var El=xi(Object.keys,Object),yi=El;var Tl=Object.prototype,Il=Tl.hasOwnProperty;function Al(r){if(!si(r))return yi(r);var t=[];for(var e in Object(r))Il.call(r,e)&&e!="constructor"&&t.push(e);return t}var bi=Al;function Sl(r){return K(r)?_i(r):bi(r)}var lt=Sl;var Pl=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Cl=/^\w*$/;function Ol(r,t){if(L(r))return!1;var e=typeof r;return e=="number"||e=="symbol"||e=="boolean"||r==null||J(r)?!0:Cl.test(r)||!Pl.test(r)||t!=null&&r in Object(t)}var Wt=Ol;var Ll=q(Object,"create"),st=Ll;function Rl(){this.__data__=st?st(null):{},this.size=0}var vi=Rl;function Nl(r){var t=this.has(r)&&delete this.__data__[r];return this.size-=t?1:0,t}var wi=Nl;var kl="__lodash_hash_undefined__",Ml=Object.prototype,Fl=Ml.hasOwnProperty;function Bl(r){var t=this.__data__;if(st){var e=t[r];return e===kl?void 0:e}return Fl.call(t,r)?t[r]:void 0}var Ei=Bl;var Ul=Object.prototype,Vl=Ul.hasOwnProperty;function Dl(r){var t=this.__data__;return st?t[r]!==void 0:Vl.call(t,r)}var Ti=Dl;var Gl="__lodash_hash_undefined__";function $l(r,t){var e=this.__data__;return this.size+=this.has(r)?0:1,e[r]=st&&t===void 0?Gl:t,this}var Ii=$l;function qt(r){var t=-1,e=r==null?0:r.length;for(this.clear();++t<e;){var n=r[t];this.set(n[0],n[1])}}qt.prototype.clear=vi;qt.prototype.delete=wi;qt.prototype.get=Ei;qt.prototype.has=Ti;qt.prototype.set=Ii;var Mr=qt;function Wl(){this.__data__=[],this.size=0}var Ai=Wl;function ql(r,t){for(var e=r.length;e--;)if(Dt(r[e][0],t))return e;return-1}var ut=ql;var jl=Array.prototype,zl=jl.splice;function Yl(r){var t=this.__data__,e=ut(t,r);if(e<0)return!1;var n=t.length-1;return e==n?t.pop():zl.call(t,e,1),--this.size,!0}var Si=Yl;function Xl(r){var t=this.__data__,e=ut(t,r);return e<0?void 0:t[e][1]}var Pi=Xl;function Hl(r){return ut(this.__data__,r)>-1}var Ci=Hl;function Ql(r,t){var e=this.__data__,n=ut(e,r);return n<0?(++this.size,e.push([r,t])):e[n][1]=t,this}var Oi=Ql;function jt(r){var t=-1,e=r==null?0:r.length;for(this.clear();++t<e;){var n=r[t];this.set(n[0],n[1])}}jt.prototype.clear=Ai;jt.prototype.delete=Si;jt.prototype.get=Pi;jt.prototype.has=Ci;jt.prototype.set=Oi;var dt=jt;var Jl=q(N,"Map"),ct=Jl;function Kl(){this.size=0,this.__data__={hash:new Mr,map:new(ct||dt),string:new Mr}}var Li=Kl;function Zl(r){var t=typeof r;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?r!=="__proto__":r===null}var Ri=Zl;function tu(r,t){var e=r.__data__;return Ri(t)?e[typeof t=="string"?"string":"hash"]:e.map}var pt=tu;function eu(r){var t=pt(this,r).delete(r);return this.size-=t?1:0,t}var Ni=eu;function ru(r){return pt(this,r).get(r)}var ki=ru;function nu(r){return pt(this,r).has(r)}var Mi=nu;function iu(r,t){var e=pt(this,r),n=e.size;return e.set(r,t),this.size+=e.size==n?0:1,this}var Fi=iu;function zt(r){var t=-1,e=r==null?0:r.length;for(this.clear();++t<e;){var n=r[t];this.set(n[0],n[1])}}zt.prototype.clear=Li;zt.prototype.delete=Ni;zt.prototype.get=ki;zt.prototype.has=Mi;zt.prototype.set=Fi;var Tt=zt;var ou="Expected a function";function Fr(r,t){if(typeof r!="function"||t!=null&&typeof t!="function")throw new TypeError(ou);var e=function(){var n=arguments,i=t?t.apply(this,n):n[0],s=e.cache;if(s.has(i))return s.get(i);var a=r.apply(this,n);return e.cache=s.set(i,a)||s,a};return e.cache=new(Fr.Cache||Tt),e}Fr.Cache=Tt;var pe=Fr;var su=500;function au(r){var t=pe(r,function(n){return e.size===su&&e.clear(),n}),e=t.cache;return t}var Bi=au;var fu=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,lu=/\\(\\)?/g,uu=Bi(function(r){var t=[];return r.charCodeAt(0)===46&&t.push(""),r.replace(fu,function(e,n,i,s){t.push(i?s.replace(lu,"$1"):n||e)}),t}),Ui=uu;function du(r){return r==null?"":Hn(r)}var Vi=du;function cu(r,t){return L(r)?r:Wt(r,t)?[r]:Ui(Vi(r))}var je=cu;var pu=1/0;function hu(r){if(typeof r=="string"||J(r))return r;var t=r+"";return t=="0"&&1/r==-pu?"-0":t}var ht=hu;function mu(r,t){t=je(t,r);for(var e=0,n=t.length;r!=null&&e<n;)r=r[ht(t[e++])];return e&&e==n?r:void 0}var ze=mu;function gu(r,t,e){var n=r==null?void 0:ze(r,t);return n===void 0?e:n}var Di=gu;function _u(r,t){for(var e=-1,n=t.length,i=r.length;++e<n;)r[i+e]=t[e];return r}var Ye=_u;var Gi=U?U.isConcatSpreadable:void 0;function xu(r){return L(r)||$t(r)||!!(Gi&&r&&r[Gi])}var $i=xu;function Wi(r,t,e,n,i){var s=-1,a=r.length;for(e||(e=$i),i||(i=[]);++s<a;){var f=r[s];t>0&&e(f)?t>1?Wi(f,t-1,e,n,i):Ye(i,f):n||(i[i.length]=f)}return i}var qi=Wi;var yu="Expected a function";function bu(r,t){var e;if(typeof t!="function")throw new TypeError(yu);return r=Ve(r),function(){return--r>0&&(e=t.apply(this,arguments)),r<=1&&(t=void 0),e}}var ji=bu;function vu(r,t,e){return r===r&&(e!==void 0&&(r=r<=e?r:e),t!==void 0&&(r=r>=t?r:t)),r}var zi=vu;function wu(r,t,e){return e===void 0&&(e=t,t=void 0),e!==void 0&&(e=it(e),e=e===e?e:0),t!==void 0&&(t=it(t),t=t===t?t:0),zi(it(r),t,e)}var Br=wu;function Eu(){this.__data__=new dt,this.size=0}var Yi=Eu;function Tu(r){var t=this.__data__,e=t.delete(r);return this.size=t.size,e}var Xi=Tu;function Iu(r){return this.__data__.get(r)}var Hi=Iu;function Au(r){return this.__data__.has(r)}var Qi=Au;var Su=200;function Pu(r,t){var e=this.__data__;if(e instanceof dt){var n=e.__data__;if(!ct||n.length<Su-1)return n.push([r,t]),this.size=++e.size,this;e=this.__data__=new Tt(n)}return e.set(r,t),this.size=e.size,this}var Ji=Pu;function Yt(r){var t=this.__data__=new dt(r);this.size=t.size}Yt.prototype.clear=Yi;Yt.prototype.delete=Xi;Yt.prototype.get=Hi;Yt.prototype.has=Qi;Yt.prototype.set=Ji;var Xt=Yt;function Cu(r,t){for(var e=-1,n=r==null?0:r.length,i=0,s=[];++e<n;){var a=r[e];t(a,e,r)&&(s[i++]=a)}return s}var Ki=Cu;function Ou(){return[]}var Zi=Ou;var Lu=Object.prototype,Ru=Lu.propertyIsEnumerable,to=Object.getOwnPropertySymbols,Nu=to?function(r){return r==null?[]:(r=Object(r),Ki(to(r),function(t){return Ru.call(r,t)}))}:Zi,eo=Nu;function ku(r,t,e){var n=t(r);return L(r)?n:Ye(n,e(r))}var ro=ku;function Mu(r){return ro(r,lt,eo)}var Ur=Mu;var Fu=q(N,"DataView"),Xe=Fu;var Bu=q(N,"Promise"),He=Bu;var Uu=q(N,"Set"),Qe=Uu;var no="[object Map]",Vu="[object Object]",io="[object Promise]",oo="[object Set]",so="[object WeakMap]",ao="[object DataView]",Du=ot(Xe),Gu=ot(ct),$u=ot(He),Wu=ot(Qe),qu=ot($e),It=j;(Xe&&It(new Xe(new ArrayBuffer(1)))!=ao||ct&&It(new ct)!=no||He&&It(He.resolve())!=io||Qe&&It(new Qe)!=oo||$e&&It(new $e)!=so)&&(It=function(r){var t=j(r),e=t==Vu?r.constructor:void 0,n=e?ot(e):"";if(n)switch(n){case Du:return ao;case Gu:return no;case $u:return io;case Wu:return oo;case qu:return so}return t});var Vr=It;var ju=N.Uint8Array,Dr=ju;var zu="__lodash_hash_undefined__";function Yu(r){return this.__data__.set(r,zu),this}var fo=Yu;function Xu(r){return this.__data__.has(r)}var lo=Xu;function Je(r){var t=-1,e=r==null?0:r.length;for(this.__data__=new Tt;++t<e;)this.add(r[t])}Je.prototype.add=Je.prototype.push=fo;Je.prototype.has=lo;var uo=Je;function Hu(r,t){for(var e=-1,n=r==null?0:r.length;++e<n;)if(t(r[e],e,r))return!0;return!1}var Ke=Hu;function Qu(r,t){return r.has(t)}var co=Qu;var Ju=1,Ku=2;function Zu(r,t,e,n,i,s){var a=e&Ju,f=r.length,l=t.length;if(f!=l&&!(a&&l>f))return!1;var u=s.get(r),d=s.get(t);if(u&&d)return u==t&&d==r;var c=-1,h=!0,y=e&Ku?new uo:void 0;for(s.set(r,t),s.set(t,r);++c<f;){var v=r[c],b=t[c];if(n)var w=a?n(b,v,c,t,r,s):n(v,b,c,r,t,s);if(w!==void 0){if(w)continue;h=!1;break}if(y){if(!Ke(t,function(_,E){if(!co(y,E)&&(v===_||i(v,_,e,n,s)))return y.push(E)})){h=!1;break}}else if(!(v===b||i(v,b,e,n,s))){h=!1;break}}return s.delete(r),s.delete(t),h}var Ze=Zu;function td(r){var t=-1,e=Array(r.size);return r.forEach(function(n,i){e[++t]=[i,n]}),e}var po=td;function ed(r){var t=-1,e=Array(r.size);return r.forEach(function(n){e[++t]=n}),e}var ho=ed;var rd=1,nd=2,id="[object Boolean]",od="[object Date]",sd="[object Error]",ad="[object Map]",fd="[object Number]",ld="[object RegExp]",ud="[object Set]",dd="[object String]",cd="[object Symbol]",pd="[object ArrayBuffer]",hd="[object DataView]",mo=U?U.prototype:void 0,Gr=mo?mo.valueOf:void 0;function md(r,t,e,n,i,s,a){switch(e){case hd:if(r.byteLength!=t.byteLength||r.byteOffset!=t.byteOffset)return!1;r=r.buffer,t=t.buffer;case pd:return!(r.byteLength!=t.byteLength||!s(new Dr(r),new Dr(t)));case id:case od:case fd:return Dt(+r,+t);case sd:return r.name==t.name&&r.message==t.message;case ld:case dd:return r==t+"";case ad:var f=po;case ud:var l=n&rd;if(f||(f=ho),r.size!=t.size&&!l)return!1;var u=a.get(r);if(u)return u==t;n|=nd,a.set(r,t);var d=Ze(f(r),f(t),n,i,s,a);return a.delete(r),d;case cd:if(Gr)return Gr.call(r)==Gr.call(t)}return!1}var go=md;var gd=1,_d=Object.prototype,xd=_d.hasOwnProperty;function yd(r,t,e,n,i,s){var a=e&gd,f=Ur(r),l=f.length,u=Ur(t),d=u.length;if(l!=d&&!a)return!1;for(var c=l;c--;){var h=f[c];if(!(a?h in t:xd.call(t,h)))return!1}var y=s.get(r),v=s.get(t);if(y&&v)return y==t&&v==r;var b=!0;s.set(r,t),s.set(t,r);for(var w=a;++c<l;){h=f[c];var _=r[h],E=t[h];if(n)var m=a?n(E,_,h,t,r,s):n(_,E,h,r,t,s);if(!(m===void 0?_===E||i(_,E,e,n,s):m)){b=!1;break}w||(w=h=="constructor")}if(b&&!w){var I=r.constructor,B=t.constructor;I!=B&&"constructor"in r&&"constructor"in t&&!(typeof I=="function"&&I instanceof I&&typeof B=="function"&&B instanceof B)&&(b=!1)}return s.delete(r),s.delete(t),b}var _o=yd;var bd=1,xo="[object Arguments]",yo="[object Array]",tr="[object Object]",vd=Object.prototype,bo=vd.hasOwnProperty;function wd(r,t,e,n,i,s){var a=L(r),f=L(t),l=a?yo:Vr(r),u=f?yo:Vr(t);l=l==xo?tr:l,u=u==xo?tr:u;var d=l==tr,c=u==tr,h=l==u;if(h&&de(r)){if(!de(t))return!1;a=!0,d=!1}if(h&&!d)return s||(s=new Xt),a||qe(r)?Ze(r,t,e,n,i,s):go(r,t,l,e,n,i,s);if(!(e&bd)){var y=d&&bo.call(r,"__wrapped__"),v=c&&bo.call(t,"__wrapped__");if(y||v){var b=y?r.value():r,w=v?t.value():t;return s||(s=new Xt),i(b,w,e,n,s)}}return h?(s||(s=new Xt),_o(r,t,e,n,i,s)):!1}var vo=wd;function wo(r,t,e,n,i){return r===t?!0:r==null||t==null||!z(r)&&!z(t)?r!==r&&t!==t:vo(r,t,e,n,wo,i)}var er=wo;var Ed=1,Td=2;function Id(r,t,e,n){var i=e.length,s=i,a=!n;if(r==null)return!s;for(r=Object(r);i--;){var f=e[i];if(a&&f[2]?f[1]!==r[f[0]]:!(f[0]in r))return!1}for(;++i<s;){f=e[i];var l=f[0],u=r[l],d=f[1];if(a&&f[2]){if(u===void 0&&!(l in r))return!1}else{var c=new Xt;if(n)var h=n(u,d,l,r,t,c);if(!(h===void 0?er(d,u,Ed|Td,n,c):h))return!1}}return!0}var Eo=Id;function Ad(r){return r===r&&!V(r)}var rr=Ad;function Sd(r){for(var t=lt(r),e=t.length;e--;){var n=t[e],i=r[n];t[e]=[n,i,rr(i)]}return t}var To=Sd;function Pd(r,t){return function(e){return e==null?!1:e[r]===t&&(t!==void 0||r in Object(e))}}var nr=Pd;function Cd(r){var t=To(r);return t.length==1&&t[0][2]?nr(t[0][0],t[0][1]):function(e){return e===r||Eo(e,r,t)}}var Io=Cd;function Od(r,t){return r!=null&&t in Object(r)}var Ao=Od;function Ld(r,t,e){t=je(t,r);for(var n=-1,i=t.length,s=!1;++n<i;){var a=ht(t[n]);if(!(s=r!=null&&e(r,a)))break;r=r[a]}return s||++n!=i?s:(i=r==null?0:r.length,!!i&&Gt(i)&&Vt(a,i)&&(L(r)||$t(r)))}var So=Ld;function Rd(r,t){return r!=null&&So(r,t,Ao)}var Po=Rd;var Nd=1,kd=2;function Md(r,t){return Wt(r)&&rr(t)?nr(ht(r),t):function(e){var n=Di(e,r);return n===void 0&&n===t?Po(e,r):er(t,n,Nd|kd)}}var Co=Md;function Fd(r){return function(t){return t==null?void 0:t[r]}}var Oo=Fd;function Bd(r){return function(t){return ze(t,r)}}var Lo=Bd;function Ud(r){return Wt(r)?Oo(ht(r)):Lo(r)}var Ro=Ud;function Vd(r){return typeof r=="function"?r:r==null?ti:typeof r=="object"?L(r)?Co(r[0],r[1]):Io(r):Ro(r)}var Z=Vd;function Dd(r){return function(t,e,n){for(var i=-1,s=Object(t),a=n(t),f=a.length;f--;){var l=a[r?f:++i];if(e(s[l],l,s)===!1)break}return t}}var No=Dd;var Gd=No(),ko=Gd;function $d(r,t){return r&&ko(r,t,lt)}var Mo=$d;function Wd(r,t){return function(e,n){if(e==null)return e;if(!K(e))return r(e,n);for(var i=e.length,s=t?i:-1,a=Object(e);(t?s--:++s<i)&&n(a[s],s,a)!==!1;);return e}}var Fo=Wd;var qd=Fo(Mo),ir=qd;var jd=function(){return N.Date.now()},or=jd;var zd="Expected a function",Yd=Math.max,Xd=Math.min;function Hd(r,t,e){var n,i,s,a,f,l,u=0,d=!1,c=!1,h=!0;if(typeof r!="function")throw new TypeError(zd);t=it(t)||0,V(e)&&(d=!!e.leading,c="maxWait"in e,s=c?Yd(it(e.maxWait)||0,t):s,h="trailing"in e?!!e.trailing:h);function y(T){var R=n,C=i;return n=i=void 0,u=T,a=r.apply(C,R),a}function v(T){return u=T,f=setTimeout(_,t),d?y(T):a}function b(T){var R=T-l,C=T-u,P=t-R;return c?Xd(P,s-C):P}function w(T){var R=T-l,C=T-u;return l===void 0||R>=t||R<0||c&&C>=s}function _(){var T=or();if(w(T))return E(T);f=setTimeout(_,b(T))}function E(T){return f=void 0,h&&n?y(T):(n=i=void 0,a)}function m(){f!==void 0&&clearTimeout(f),u=0,n=l=i=f=void 0}function I(){return f===void 0?a:E(or())}function B(){var T=or(),R=w(T);if(n=arguments,i=this,l=T,R){if(f===void 0)return v(l);if(c)return clearTimeout(f),f=setTimeout(_,t),y(l)}return f===void 0&&(f=setTimeout(_,t)),a}return B.cancel=m,B.flush=I,B}var Bo=Hd;function Qd(r){return function(t,e,n){var i=Object(t);if(!K(t)){var s=Z(e,3);t=lt(t),e=function(f){return s(i[f],f,i)}}var a=r(t,e,n);return a>-1?i[s?t[a]:a]:void 0}}var Uo=Qd;var Jd=Math.max;function Kd(r,t,e){var n=r==null?0:r.length;if(!n)return-1;var i=e==null?0:Ve(e);return i<0&&(i=Jd(n+i,0)),oi(r,Z(t,3),i)}var Vo=Kd;var Zd=Uo(Vo),Ht=Zd;function tc(r,t){var e=-1,n=K(r)?Array(r.length):[];return ir(r,function(i,s,a){n[++e]=t(i,s,a)}),n}var Do=tc;function ec(r,t){var e=L(r)?Ue:Do;return e(r,Z(t,3))}var Go=ec;function rc(r,t){return qi(Go(r,t),1)}var $r=rc;function nc(r,t){return r<t}var $o=nc;function ic(r,t,e){for(var n=-1,i=r.length;++n<i;){var s=r[n],a=t(s);if(a!=null&&(f===void 0?a===a&&!J(a):e(a,f)))var f=a,l=s}return l}var Wo=ic;function oc(r,t){return r&&r.length?Wo(r,Z(t,2),$o):void 0}var Wr=oc;function sc(r){return ji(2,r)}var qr=sc;var ac=Math.floor,fc=Math.random;function lc(r,t){return r+ac(fc()*(t-r+1))}var qo=lc;var uc=parseFloat,dc=Math.min,cc=Math.random;function pc(r,t,e){if(e&&typeof e!="boolean"&&We(r,t,e)&&(t=e=void 0),e===void 0&&(typeof t=="boolean"?(e=t,t=void 0):typeof r=="boolean"&&(e=r,r=void 0)),r===void 0&&t===void 0?(r=0,t=1):(r=ue(r),t===void 0?(t=r,r=0):t=ue(t)),r>t){var n=r;r=t,t=n}if(e||r%1||t%1){var i=cc();return dc(r+i*(t-r+uc("1e-"+((i+"").length-1))),t)}return qo(r,t)}var he=pc;function hc(r,t){var e;return ir(r,function(n,i,s){return e=t(n,i,s),!e}),!!e}var jo=hc;function mc(r,t,e){var n=L(r)?Ke:jo;return e&&We(r,t,e)&&(t=void 0),n(r,Z(t,3))}var jr=mc;var gc="Expected a function";function _c(r,t,e){var n=!0,i=!0;if(typeof r!="function")throw new TypeError(gc);return V(e)&&(n="leading"in e?!!e.leading:n,i="trailing"in e?!!e.trailing:i),Bo(r,t,{leading:n,maxWait:t,trailing:i})}var zr=_c;var mt={};fn(mt,{BOUNDARY:()=>tt,CCW:()=>xc,CONTAINS:()=>Tc,CW:()=>yc,END_VERTEX:()=>At,INSIDE:()=>wc,INTERLACE:()=>Ic,NOT_VERTEX:()=>sr,ORIENTATION:()=>bc,OUTSIDE:()=>Ec,OVERLAP_OPPOSITE:()=>Sc,OVERLAP_SAME:()=>Ac,PIx2:()=>vc,START_VERTEX:()=>me});var xc=!0,yc=!1,bc={CCW:-1,CW:1,NOT_ORIENTABLE:0},vc=2*Math.PI,wc=1,Ec=0,tt=2,Tc=3,Ic=4,Ac=1,Sc=2,sr=0,me=1,At=2;var ar={};fn(ar,{DECIMALS:()=>Pc,EQ:()=>Qt,EQ_0:()=>Cc,GE:()=>Lc,GT:()=>Oc,LE:()=>Nc,LT:()=>Rc,getTolerance:()=>Xr,setTolerance:()=>Yr});var et=1e-6;function Yr(r){et=r}function Xr(){return et}var Pc=3;function Cc(r){return r<et&&r>-et}function Qt(r,t){return r-t<et&&r-t>-et}function Oc(r,t){return r-t>et}function Lc(r,t){return r-t>-et}function Rc(r,t){return r-t<-et}function Nc(r,t){return r-t<et}var zo=class{static get ILLEGAL_PARAMETERS(){return new ReferenceError("Illegal Parameters")}static get ZERO_DIVISION(){return new Error("Zero division")}static get UNRESOLVED_BOUNDARY_CONFLICT(){return new Error("Unresolved boundary conflict in boolean operation")}static get INFINITE_LOOP(){return new Error("Infinite loop")}},ge=zo;var Hr={Utils:ar,Errors:ge,Matrix:void 0,Planar_set:void 0,Point:void 0,Vector:void 0,Line:void 0,Circle:void 0,Segment:void 0,Arc:void 0,Box:void 0,Edge:void 0,Face:void 0,Ray:void 0,Ray_shooting:void 0,Multiline:void 0,Polygon:void 0,Distance:void 0,Inversion:void 0};for(let r in mt)Hr[r]=mt[r];Object.defineProperty(Hr,"DP_TOL",{get:function(){return Xr()},set:function(r){Yr(r)}});var fr=Hr;var Yo=class{constructor(t,e){this.first=t,this.last=e||this.first}[Symbol.iterator](){let t;return{next:()=>(t=t?t.next:this.first,{value:t,done:t===void 0})}}get size(){let t=0;for(let e of this)t++;return t}toArray(t=void 0,e=void 0){let n=[],i=t||this.first,s=e||this.last,a=i;if(a===void 0)return n;do n.push(a),a=a.next;while(a!==s.next);return n}append(t){return this.isEmpty()?this.first=t:(t.prev=this.last,this.last.next=t),this.last=t,this.last.next=void 0,this.first.prev=void 0,this}insert(t,e){if(this.isEmpty())this.first=t,this.last=t;else if(e==null)t.next=this.first,this.first.prev=t,this.first=t;else{let n=e.next;e.next=t,n&&(n.prev=t),t.prev=e,t.next=n,this.last===e&&(this.last=t)}return this.last.next=void 0,this.first.prev=void 0,this}remove(t){return t===this.first&&t===this.last?(this.first=void 0,this.last=void 0):(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t===this.first&&(this.first=t.next),t===this.last&&(this.last=t.prev)),this}isEmpty(){return this.first===void 0}static testInfiniteLoop(t){let e=t,n=t;do{if(e!=t&&e===n)throw fr.Errors.INFINITE_LOOP;e=e.next,n=n.next.next}while(e!=t)}},Xo=Yo;function _e(r,t,e){let n=e.length,i=r.shape.split(t);if(i.length===0)return;let s=0;i[0]===null?s=0:i[1]===null?s=r.shape.length:s=i[0].length;let a=sr;Qt(s,0)&&(a|=me),Qt(s,r.shape.length)&&(a|=At);let f=a&At&&r.next.arc_length===0?0:r.arc_length+s;e.push({id:n,pt:t,arc_length:f,edge_before:r,edge_after:void 0,face:r.face,is_vertex:a})}function lr(r){r.int_points1_sorted=Ho(r.int_points1),r.int_points2_sorted=Ho(r.int_points2)}function Ho(r){let t=new Map,e=0;for(let i of r)t.has(i.face)||(t.set(i.face,e),e++);for(let i of r)i.faceId=t.get(i.face);return r.slice().sort(kc)}function kc(r,t){return r.faceId<t.faceId?-1:r.faceId>t.faceId?1:r.arc_length<t.arc_length?-1:r.arc_length>t.arc_length?1:0}function Qo(r){if(r.int_points1.length<2)return;let t=!1,e,n,i,s;for(let a=0;a<r.int_points1_sorted.length;a++)if(r.int_points1_sorted[a].id!==-1){e=r.int_points1_sorted[a],n=r.int_points2[e.id];for(let f=a+1;f<r.int_points1_sorted.length&&(i=r.int_points1_sorted[f],!!Qt(i.arc_length,e.arc_length));f++)i.id!==-1&&(s=r.int_points2[i.id],s.id!==-1&&i.edge_before===e.edge_before&&i.edge_after===e.edge_after&&s.edge_before===n.edge_before&&s.edge_after===n.edge_after&&(i.id=-1,s.id=-1,t=!0))}n=r.int_points2_sorted[0],e=r.int_points1[n.id];for(let a=1;a<r.int_points2_sorted.length;a++){let f=r.int_points2_sorted[a];if(f.id==-1)continue;if(n.id==-1||!Qt(f.arc_length,n.arc_length)){n=f,e=r.int_points1[n.id];continue}let l=r.int_points1[f.id];l.edge_before===e.edge_before&&l.edge_after===e.edge_after&&f.edge_before===n.edge_before&&f.edge_after===n.edge_after&&(l.id=-1,f.id=-1,t=!0)}t&&(r.int_points1=r.int_points1.filter(a=>a.id>=0),r.int_points2=r.int_points2.filter(a=>a.id>=0),r.int_points1.forEach((a,f)=>a.id=f),r.int_points2.forEach((a,f)=>a.id=f))}function Qr(r){for(let t of r)t.edge_before.bvStart=void 0,t.edge_before.bvEnd=void 0,t.edge_before.bv=void 0,t.edge_before.overlap=void 0,t.edge_after.bvStart=void 0,t.edge_after.bvEnd=void 0,t.edge_after.bv=void 0,t.edge_after.overlap=void 0;for(let t of r)t.edge_before.bvEnd=tt,t.edge_after.bvStart=tt}function Jr(r,t){for(let e of r)e.edge_before.setInclusion(t),e.edge_after.setInclusion(t)}function Jo(r){let t,e,n,i=r.int_points1.length;for(let s=0;s<i;s++){let a=r.int_points1_sorted[s];a.face!==t&&(e=s,t=a.face);let f=s,l=St(r.int_points1_sorted,s,t),u;f+l<i&&r.int_points1_sorted[f+l].face===t?u=f+l:u=e;let d=St(r.int_points1_sorted,u,t);n=null;for(let _=u;_<u+d;_++){let E=r.int_points1_sorted[_];if(E.face===t&&r.int_points2[E.id].face===r.int_points2[a.id].face){n=E;break}}if(n===null)continue;let c=a.edge_after,h=n.edge_before;if(!(c.bv===tt&&h.bv===tt)||c!==h)continue;let y=r.int_points2[a.id],v=r.int_points2[n.id],b=y.edge_after,w=v.edge_before;b.bv===tt&&w.bv===tt&&b===w||(y=r.int_points2[n.id],v=r.int_points2[a.id],b=y.edge_after,w=v.edge_before),b.bv===tt&&w.bv===tt&&b===w&&c.setOverlap(b)}}function St(r,t,e){let n,i,s=1;if(r.length==1)return 1;n=r[t];for(let a=t+1;a<r.length&&!(n.face!=e||(i=r[a],!(i.pt.equalTo(n.pt)&&i.edge_before===n.edge_before&&i.edge_after===n.edge_after)));a++)s++;return s}function Kr(r,t){if(!!t){for(let e of t){let n=e.edge_before;if(e.is_vertex=sr,n.shape.start&&n.shape.start.equalTo(e.pt)&&(e.is_vertex|=me),n.shape.end&&n.shape.end.equalTo(e.pt)&&(e.is_vertex|=At),e.is_vertex&me){e.edge_before=n.prev,e.is_vertex=At;continue}if(e.is_vertex&At)continue;let i=r.addVertex(e.pt,n);e.edge_before=i}for(let e of t)e.edge_after=e.edge_before.next}}var{INSIDE:rt,OUTSIDE:nt,BOUNDARY:M,OVERLAP_SAME:Mc,OVERLAP_OPPOSITE:Fc}=mt,{NOT_VERTEX:kb,START_VERTEX:Ko,END_VERTEX:Zo}=mt,Zr=1,ss=2,xe=3;function as(r,t){let[e,n]=ls(r,t,Zr,!0);return e}function fs(r,t){let n=t.clone().reverse(),[i,s]=ls(r,n,xe,!0);return i}function Bc(r,t,e,n){let i=ts(r,e.int_points1),s=ts(t,e.int_points2);for(es(i,t),es(s,r),Qr(e.int_points1),Qr(e.int_points2),Jr(e.int_points1,t),Jr(e.int_points2,r);Dc(r,t,e.int_points1,e.int_points1_sorted,e.int_points2,e););Jo(e),rs(r,n,e.int_points1_sorted,!0),rs(t,n,e.int_points2_sorted,!1),os(r,i,n,!0),os(t,s,n,!1)}function Uc(r,t,e,n){Gc(r,t,n,e.int_points2),$c(r,t,e),ns(r,e.int_points1),ns(t,e.int_points2),is(r,e.int_points1,e.int_points2),is(r,e.int_points2,e.int_points1)}function ls(r,t,e,n){let i=r,s=t.clone(),a=Vc(i,s);return lr(a),Kr(i,a.int_points1_sorted),Kr(s,a.int_points2_sorted),Qo(a),lr(a),Bc(i,s,a,e),n&&Uc(i,s,a,e),[i,s]}function Vc(r,t){let e={int_points1:[],int_points2:[]};for(let n of t.edges){let i=r.edges.search(n.box);for(let s of i){let a=n.shape.intersect(s.shape);for(let f of a)_e(n,f,e.int_points2),_e(s,f,e.int_points1)}}return e}function ts(r,t){let e=[];for(let n of r.faces)t.find(i=>i.face===n)||e.push(n);return e}function es(r,t){for(let e of r)e.first.bv=e.first.bvStart=e.first.bvEnd=void 0,e.first.setInclusion(t)}function Dc(r,t,e,n,i,s){let a,f,l,u=n.length,d=!1;for(let c=0;c<u;c++){let h=n[c];h.face!==a&&(f=c,a=h.face);let y=c,v=St(n,c,a),b;y+v<u&&n[y+v].face===a?b=y+v:b=f;let w=St(n,b,a);l=null;for(let m=b;m<b+w;m++){let I=n[m];if(I.face===a&&i[I.id].face===i[h.id].face){l=I;break}}if(l===null)continue;let _=h.edge_after,E=l.edge_before;if(_.bv===M&&E.bv!=M){_.bv=E.bv;continue}if(_.bv!=M&&E.bv===M){E.bv=_.bv;continue}if(_.bv===M&&E.bv===M&&_!=E||_.bv===rt&&E.bv===nt||_.bv===nt&&E.bv===rt){let m=_.next;for(;m!=E;)m.bvStart=void 0,m.bvEnd=void 0,m.bv=void 0,m.setInclusion(t),m=m.next}if(_.bv===M&&E.bv===M&&_!=E){let m=_.next,I;for(;m!=E;){if(m.bv!=M){if(I===void 0)I=m.bv;else if(m.bv!=I)throw ge.UNRESOLVED_BOUNDARY_CONFLICT}m=m.next}I!=null&&(_.bv=I,E.bv=I);continue}if(_.bv===rt&&E.bv===nt||_.bv===nt&&E.bv===rt){let m=_;for(;m!=E;){if(m.bvStart===_.bv&&m.bvEnd===E.bv){let[I,B]=m.shape.distanceTo(t);if(I<10*fr.DP_TOL){_e(m,B.ps,e);let T=e[e.length-1];if(T.is_vertex&Ko)T.edge_after=m,T.edge_before=m.prev,m.bvStart=M,m.bv=void 0,m.setInclusion(t);else if(T.is_vertex&Zo)T.edge_after=m.next,m.bvEnd=M,m.bv=void 0,m.setInclusion(t);else{let P=t.addVertex(T.pt,m);T.edge_before=P,T.edge_after=P.next,P.setInclusion(t),P.next.bvStart=M,P.next.bvEnd=void 0,P.next.bv=void 0,P.next.setInclusion(t)}let R=t.findEdgeByPoint(B.pe);_e(R,B.pe,i);let C=i[i.length-1];if(C.is_vertex&Ko)C.edge_after=R,C.edge_before=R.prev;else if(C.is_vertex&Zo)C.edge_after=R.next;else{let P=i.find(cr=>cr.edge_after===R),O=t.addVertex(C.pt,R);C.edge_before=O,C.edge_after=O.next,P&&(P.edge_after=O),O.bvStart=void 0,O.bvEnd=M,O.bv=void 0,O.setInclusion(r),O.next.bvStart=M,O.next.bvEnd=void 0,O.next.bv=void 0,O.next.setInclusion(r)}lr(s),d=!0;break}}m=m.next}if(d)break;throw ge.UNRESOLVED_BOUNDARY_CONFLICT}}return d}function rs(r,t,e,n){if(!e)return;let i,s,a,f;for(let l=0;l<e.length;l++){if(a=e[l],a.face!==i&&(s=l,i=a.face),i.isEmpty())continue;let u=l,d=St(e,l,i),c;u+d<e.length&&e[u+d].face===a.face?c=u+d:c=s,f=e[c];let h=c,y=St(e,h,i),v=a.edge_after,b=f.edge_before;if(v.bv===rt&&b.bv===rt&&t===Zr||v.bv===nt&&b.bv===nt&&t===ss||(v.bv===nt||b.bv===nt)&&t===xe&&!n||(v.bv===rt||b.bv===rt)&&t===xe&&n||v.bv===M&&b.bv===M&&v.overlap&Mc&&n||v.bv===M&&b.bv===M&&v.overlap&Fc){r.removeChain(i,v,b);for(let w=u;w<u+d;w++)e[w].edge_after=void 0;for(let w=h;w<h+y;w++)e[w].edge_before=void 0}l+=d-1}}function Gc(r,t,e,n){for(let i of t.faces){for(let s of i)r.edges.add(s);n.find(s=>s.face===i)===void 0&&r.addFace(i.first,i.last)}}function $c(r,t,e){if(e.int_points1.length!==0)for(let n=0;n<e.int_points1.length;n++){let i=e.int_points1[n],s=e.int_points2[n];if(i.edge_before!==void 0&&i.edge_after===void 0&&s.edge_before===void 0&&s.edge_after!==void 0&&(i.edge_before.next=s.edge_after,s.edge_after.prev=i.edge_before,i.edge_after=s.edge_after,s.edge_before=i.edge_before),s.edge_before!==void 0&&s.edge_after===void 0&&i.edge_before===void 0&&i.edge_after!==void 0&&(s.edge_before.next=i.edge_after,i.edge_after.prev=s.edge_before,s.edge_after=i.edge_after,i.edge_before=s.edge_before),i.edge_before!==void 0&&i.edge_after===void 0)for(let a of e.int_points1_sorted)a!==i&&a.edge_before===void 0&&a.edge_after!==void 0&&a.pt.equalTo(i.pt)&&(i.edge_before.next=a.edge_after,a.edge_after.prev=i.edge_before,i.edge_after=a.edge_after,a.edge_before=i.edge_before);if(s.edge_before!==void 0&&s.edge_after===void 0)for(let a of e.int_points2_sorted)a!==s&&a.edge_before===void 0&&a.edge_after!==void 0&&a.pt.equalTo(s.pt)&&(s.edge_before.next=a.edge_after,a.edge_after.prev=s.edge_before,s.edge_after=a.edge_after,a.edge_before=s.edge_before)}}function ns(r,t){for(let e of t)r.faces.delete(e.face),e.face=void 0,e.edge_before&&(e.edge_before.face=void 0),e.edge_after&&(e.edge_after.face=void 0)}function is(r,t,e){for(let n of t){if(n.edge_before===void 0||n.edge_after===void 0||n.face||n.edge_after.face||n.edge_before.face)continue;let i=n.edge_after,s=n.edge_before;Xo.testInfiniteLoop(i);let a=r.addFace(i,s);for(let f of t)f.edge_before&&f.edge_after&&f.edge_before.face===a&&f.edge_after.face===a&&(f.face=a);for(let f of e)f.edge_before&&f.edge_after&&f.edge_before.face===a&&f.edge_after.face===a&&(f.face=a)}}function os(r,t,e,n){for(let i of t){let s=i.first.bv;(e===Zr&&s===rt||e===xe&&s===rt&&n||e===xe&&s===nt&&!n||e===ss&&s===nt)&&r.deleteFace(i)}}var tn=class{multipolygon=new g.Polygon;constructor(t){let e=pe(this.intersects,n=>{let{cache:i}=e;return i.size===3e4&&i.clear?.(),`${n.xmin}_${n.xmax}_${n.ymin}_${n.ymax}`});this.intersects=e;for(let n of t)this.multipolygon.addFace(n.map(i=>new g.Point(i.x,i.y)))}makeHole(t,e,n){fs(this.multipolygon,new g.Polygon(new g.Circle(new g.Point(t,e),n))),this.intersects.cache.clear()}draw(t,e,n){as(this.multipolygon,new g.Polygon(new g.Circle(new g.Point(t,e),n))),this.intersects.cache.clear()}intersects(t){let e=new Array;for(let{shape:n}of this.multipolygon.edges.search(t)){let i=n.intersect(t);i.length>0&&e.push({shape:n,points:i})}return e}intersectsShapeSome(t){for(let e of this.multipolygon.edges.search(t.box))if(e.shape.intersect(t).length>0)return!0;return!1}intersectsSeg(t){for(let{shape:e}of this.multipolygon.edges.search(t.box))if(e.intersect(t).length>0)return!0;return!1}intersectsSeg2(t){let e=new Array;for(let{shape:n}of this.multipolygon.edges.search(t.box)){let i=n.intersect(t);i.length>0&&e.push(...i)}return e}};var D=class{x;y;velocity;constructor(t,e,n=0,i=0){this.x=t,this.y=e,this.velocity=new g.Vector(n,i)}beforeUpdate(t){}onEntityCollide(t){}onOutOfWorld(t){}onUnderwater(){}onGroundCollide(t,e,n){return!0}onResolve(t,e){}};var en=new Map;function us(r){for(let t of p.gameEntities){en.set(t,{x:t.x,y:t.y,velocity:t.velocity.clone()});let e=1/r;if(t.beforeUpdate(e),t.type===1){let i=new g.Vector(0,t.mass*1540);t.velocity=t.velocity.add(i.multiply(e))}t.x+=t.velocity.x*e,t.y+=t.velocity.y*e}for(let t of p.gameEntities){if(t.collideWithEntities)for(let s of p.gameEntities){if(s===t)continue;let a=new g.Box(t.x,t.y,t.x+t.width,t.y+t.height),f=new g.Box(s.x,s.y,s.x+s.width,s.y+s.height);a.intersect(f)&&t.onEntityCollide(s)}t.y<=-5e3||t.x>=5e3||t.x<=-5e3?(t.onOutOfWorld(!1),t.type===0&&p.gameEntities.delete(t)):t.y>=p.waterOffset+150&&(t.onOutOfWorld(!0),p.gameEntities.delete(t)),t.y>=p.waterOffset-t.height&&t.onUnderwater();let e=t.x,n=t.y,i=t.collideWithGround?p.terrain.intersects(new g.Box(e,n,e+t.width,n+t.height)):[];if(i.length>0){if(!t.onGroundCollide(e,n,i))continue;let a=en.get(t);if(t.x=a.x,t.y=a.y,t.velocity=a.velocity,t.velocity.length<t.bounceThreshold){t.velocity=new g.Vector,t.onResolve(!0,i);continue}let f=i[0],l;f.shape instanceof g.Arc?l=new g.Vector(f.points[0],f.shape.pc).normalize():l=new g.Vector(f.shape.ps,f.shape.pe).rotate90CCW().normalize();let u=l.multiply(t.velocity.dot(l)),d=t.velocity.subtract(u);t.velocity=d.multiply(t.COF).subtract(u.multiply(t.COR))}t.onResolve(!1,i)}en.clear()}var rn=450,nn=10,Pt=class extends D{type=0;width=10;height=10;COF=1;COR=1;bounceThreshold=9e3;collideWithEntities=!1;collideWithGround=!1;mass=1;pinPoint=null;initialPosition;charCol;center(){return new g.Point(this.x+this.width/2,this.y+this.height/2)}constructor(t,e){let n=p.currentControlledChar.collider,i=n.center();super(i.x-5,i.y-5,t,e);this.charCol=n,p.hookShot=this;let s=this.velocity.normalize().multiply(rn),a=p.terrain.multipolygon.intersect(new g.Segment(i,new g.Point(i.x+s.x,i.y+s.y)));a.length>0&&(this.pinPoint=Wr(a,f=>f.distanceTo(i)[0]),this.initialPosition=i)}beforeUpdate(t){let e=this.charCol,n=this.center();if(e.testGavnina===!1){let i=e.center(),[s]=i.distanceTo(n);if(s>rn){p.gameEntities.delete(this),Jt("idle");return}if(this.pinPoint===null)return;let a=1/t,f=this.velocity.length/a,l=this.velocity.normalize().multiply(f),u=new g.Point(n.x+l.x,n.y+l.y),[d]=this.initialPosition.distanceTo(u),[c]=this.initialPosition.distanceTo(this.pinPoint);if(d>=c){this.velocity=new g.Vector,this.x=this.pinPoint.x-this.width/2,this.y=this.pinPoint.y-this.height/2,this.pinPoint=null;let h=this.center(),y=e.center(),v=new g.Vector(y,h);if(p.terrain.intersectsSeg2(new g.Segment(y,new g.Point(y.x+v.x,y.y+v.y))).filter(w=>w.equalTo(h)===!1).length>0){p.gameEntities.delete(this),Jt("idle");return}e.initialPointX=h.x,e.initialPointY=h.y,globalThis.point_i=0,p.hookSegments.length=0;for(let w=1;w<rn/nn;w++){let _=new Ct(0,0);_.i=w,_.updateToMatchChar(!0),p.gameEntities.add(_),p.hookSegments.push(_)}e.testGavnina=!0}}}onOutOfWorld(t){let e=this.charCol;e.testGavnina=!1}};var Wc=zr((...r)=>{console.log(...r)},75),on=!1,Ct=class extends D{type=0;width=6;height=6;COF=1;COR=1;bounceThreshold=1/0;collideWithEntities=!1;mass=1;get collideWithGround(){return!1}i;active=!0;checkpoint=!1;halfWidth=this.width/2;halfHeight=this.height/2;arr;updateToMatchChar(t){let e=p.hookShot.charCol,n=e.pointX,i=e.pointY;t&&(n=e.initialPointX,i=e.initialPointY);let s=e.center(),a=(this.i-globalThis.point_i)*10,f=new g.Vector(new g.Point(n,i),s).normalize().multiply(a);this.x=n+f.x-this.halfWidth,this.y=i+f.y-this.halfHeight}beforeUpdate(t){let e=p.hookShot.charCol;on=!1,e.testGavnina===!1,this.active&&this.updateToMatchChar(!1)}onResolve(t){let e=p.hookShot.charCol;if(this.active){let s=new g.Point(this.x+this.halfWidth,this.y+this.halfHeight),a=new g.Point(e.pointX??e.initialPointX,e.pointY??e.initialPointY),f=new g.Vector(s,a),l=nn,u=f.normalize().multiply(l/2),d=u.rotate(Math.PI);p.terrain.intersectsSeg(new g.Segment(new g.Point(s.x+u.x,s.y+u.y),new g.Point(s.x+d.x,s.y+d.y)))&&this.handleCollision()}let n=p.hookSegments;if(this!==n[0])return;let i=new Array;for(let s of n)s.checkpoint&&i.push(s);i.reverse(),i=i.slice(0,1);for(let s of i){let[a,f,l,u,d,c]=s.arr,h=new g.Vector(new g.Point(f,l),new g.Point(e.x+e.width/2,e.y+e.height/2)).cross(u);if(c==="RIGHT"&&h<0||c==="LEFT"&&h>0){if(Wc("join"),d===0)for(let y of n)y.active=!0;else for(let y of n)y.i>d&&(y.active=!0);e.pointX=f,e.pointY=l,globalThis.point_i=d,a.checkpoint=!1;break}}}handleCollision(){if(on)return!1;let t=p.hookShot.charCol,e=new g.Point(t.pointX??t.initialPointX,t.pointY??t.initialPointY),[n]=e.distanceTo(new g.Point(t.x+t.width/2,t.y+t.height/2)),[i]=e.distanceTo(new g.Point(this.x+this.halfWidth,this.y+this.halfHeight));if(i<n){t.x=t.prevState.x,t.y=t.prevState.y,t.velocity=t.prevState.velocity,t.aVelocity=t.prevState.aVelocity;for(let s of p.hookSegments)s.active&&s.updateToMatchChar(!1);on=!0,this.checkpoint=!0,this.arr=[this,t.pointX,t.pointY,new g.Vector(new g.Point(t.pointX,t.pointY),new g.Point(t.x+t.width/2,t.y+t.height/2)),globalThis.point_i,t.aVelocity<0?"LEFT":t.aVelocity===0?"STOP":"RIGHT"];for(let s=0;s<this.i-1+1;s++)p.hookSegments[s].active=!1;t.pointX=this.x+this.halfWidth,t.pointY=this.y+this.halfHeight,globalThis.point_i=this.i}return!1}};var ye=class extends D{type=1;width=15;height=25;COF=.3;COR=.5;bounceThreshold=75;collideWithEntities=!1;collideWithGround=!0;mass=1;angle=0;boom=qr(()=>{setTimeout(()=>{p.holes2.push({cx:this.x,cy:this.y,r:75}),p.terrain.makeHole(this.x,this.y,75),p.gameEntities.delete(this),G("grenadeExplosion");let t=new g.Circle(new g.Point(this.x,this.y),90);for(let e of p.gameEntities)if(!(e instanceof Ct||e instanceof Pt)){for(let n of new g.Box(e.x,e.y,e.x+e.width,e.y+e.height).toPoints())if(t.contains(n)){let i=new g.Vector(0,-1e3);e.velocity=e.velocity.add(i);break}}},1e3)});beforeUpdate(t){let e=i(this.velocity.slope),n=40;this.angle+=this.velocity.length/n*(e>270||e<90?1:-1)*t,this.angle%=Math.PI*2;function i(s){var a=Math.PI;return s*(180/a)}}onResolve(t,e){e.length>0&&!t&&G("grenadeBounce"),t&&this.boom()}onOutOfWorld(t){t&&G("waterSplash1")}};var be=class extends D{type=1;width=20;height=20;COF=1;COR=1;bounceThreshold=1e3;collideWithEntities=!0;collideWithGround=!0;mass=1;beforeUpdate(t){let e=new g.Vector(-1e3,0);this.velocity=this.velocity.add(e.multiply(t))}onOutOfWorld(t){t&&G("waterSplash1")}onGroundCollide(t,e){return this.boom(),!1}boom(){p.holes2.push({cx:this.x,cy:this.y,r:75}),p.terrain.makeHole(this.x,this.y,75),p.gameEntities.delete(this),G("rocketExplosion")}};var ve=class extends D{type=0;width=10;height=10;COF=1;COR=1;bounceThreshold=1e3;collideWithEntities=!0;collideWithGround=!0;mass=1;beforeUpdate(t){}onOutOfWorld(t){t&&G("waterSplash1")}onGroundCollide(t,e){return this.boom(),!1}boom(){p.holes2.push({cx:this.x,cy:this.y,r:30}),p.terrain.makeHole(this.x,this.y,30),p.gameEntities.delete(this),G("grenadeExplosion")}};var Zt=class extends D{type=1;width=13;height=60;COF=.7;COR=.15;bounceThreshold=1100;collideWithEntities=!1;collideWithGround=!0;mass=1;_testGavnina=!1;pointX;pointY;initialPointX;initialPointY;aVelocity=0;pull="none";prevState;center(){return new g.Point(this.x+this.width/2,this.y+this.height/2)}set testGavnina(t){if(this._testGavnina=t,t){Jt("rope"),Ht([...p.characters],a=>a.collider===this).stopMoving(),this.type=0,this.bounceThreshold=1/0;let n=p.hookShot;this.pointX=n.x+n.width/2,this.pointY=n.y+n.height/2;let i=new g.Vector(new g.Point(this.x+this.width/2,this.y+this.height/2),new g.Point(this.pointX,this.pointY)),s=i.slope;this.aVelocity=(s>=1.5*Math.PI||s<=.5*Math.PI?this.velocity.length:-this.velocity.length)/2,this.aVelocity=i.cross(this.velocity)/300,this.aVelocity=i.normalize().cross(this.velocity)*.66,console.log(this.aVelocity),this.velocity=new g.Vector}else{this.type=1,this.bounceThreshold=1100,p.gameEntities.delete(p.hookShot);for(let e of p.hookSegments)p.gameEntities.delete(e);Jt("idle")}}get testGavnina(){return this._testGavnina}beforeUpdate(t){if(this.prevState={x:this.x,y:this.y,velocity:this.velocity,aVelocity:this.aVelocity},this.testGavnina===!1){let c=Ht([...p.characters],h=>h.collider===this);if(c.state==="PREPARE_TO_JUMP"){let h=performance.now()-c.animState.startTime,y=1e3/24;if(h>=c.animState.anim.frameCount*y){if(c.state="JUMP",c.collider.testGavnina)return;c.jump()}}return}let e=this.center(),n=new g.Point(this.pointX,this.pointY),i=new g.Vector(e,n),s=4,a=.997,f=new g.Vector(0,1).cross(i)/i.length;this.aVelocity+=-1*s*f,this.aVelocity*=a;let l=i.normalize().multiply(this.aVelocity),u=l.rotate90CCW(),d=new g.Vector(0,0);if(this.pull==="W")d=l.normalize().multiply(this.aVelocity>0?200:-200);else if(this.pull==="S"){let c=p.hookSegments.at(-1),[h]=n.distanceTo(e),[y]=n.distanceTo(new g.Point(c.x+c.halfWidth,c.y+c.halfHeight));y<h||(d=l.normalize().multiply(this.aVelocity>0?-200:200))}this.velocity=u.add(l.multiply(t).add(d))}onGroundCollide(t,e,n){if(this.testGavnina)return this.aVelocity*=-1,!0;let i=Ht([...p.characters],s=>s.collider===this);return i.state==="JUMP"&&jr($r(n,s=>s.points),s=>s.y>=e+this.height*.75)&&(i.state="IDLE"),!0}onResolve(t,e){let n=Ht([...p.characters],s=>s.collider===this),i=n.collider;if(t===!1&&e.length>0){n.startJumpAnim="FORWARD",n.state="JUMP";return}if(i.velocity.length>90){n.state==="WALK"&&(n.startJumpAnim="FORWARD",n.state="JUMP");return}n.state==="WALK"&&ds(i,150*(n.looksToLeft?-1:1))}onUnderwater(){this.testGavnina===!0&&(this.testGavnina=!1),this.velocity=new g.Vector,this.x=he(300,3100),this.y=-300}};var ur=144;function cs(r,t){let n=0;for(let i of r)for(let s of i)s.y>n&&(n=s.y);ln({terrain:new tn(r),waterOffset:n-150,gameEntities:new Set,characters:new Set,weaponBoxes:new Set,holes2:[],terrainOffsetX:0,terrainOffsetY:0,hookSegments:[]}),setInterval(function(){if(p.weaponBoxes.size===25)return;let s=new hs(he(300,2900),-300);p.gameEntities.add(s.collider),p.weaponBoxes.add(s)},3e3),setInterval(qc,1e3/ur)}var ps=class extends D{type=1;width=30;height=30;COF=.7;COR=.15;bounceThreshold=100;collideWithEntities=!0;collideWithGround=!0;mass=1;onOutOfWorld(){}onEntityCollide(t){t instanceof Zt&&(p.gameEntities.delete(this),[...p.weaponBoxes].forEach(e=>{e.collider===this&&p.weaponBoxes.delete(e)}))}},hs=class{collider;creationTime;constructor(t,e){this.collider=new ps(t,e),this.creationTime=performance.now()}},dr=class{collider;looksToLeft;name;health;team;animState;#t="IDLE";startJumpAnim;handTool="bazooka";angle=90;aim="none";get state(){return this.#t}set state(t){let e;switch(t){case"IDLE":e=new Et($.rabbitBreath);break;case"WALK":e=new Et($.rabbitGo);break;case"PREPARE_TO_JUMP":e=new Et($.rabbitPrepareToJump);break;case"JUMP":this.startJumpAnim==="FORWARD"?e=new Et($.rabbitJump):e=new Et($.rabbitJumpBack);break}this.animState=e,this.#t=t}constructor(t,e,n){this.collider=t,this.looksToLeft=!1,this.name=e,this.health=530,this.team=n}get isGrounded(){return this.collider.velocity.x===0&&this.collider.velocity.y===0}startMoving(t){this.state==="IDLE"&&this.isGrounded&&(this.state="WALK")}stopMoving(){this.state==="WALK"&&(this.state="IDLE")}startJumping(t){this.state==="PREPARE_TO_JUMP"||this.state==="JUMP"||(this.state==="WALK"||this.isGrounded)&&(this.state="PREPARE_TO_JUMP",this.startJumpAnim=t)}jump(){this.startJumpAnim==="FORWARD"?this.collider.velocity=new g.Vector(this.looksToLeft?-265:265,-420):this.collider.velocity=new g.Vector(this.looksToLeft?60:-60,-575)}};function qc(){let r=p.currentControlledChar;if(r.aim!=="none"){let t=1/ur;r.aim==="up"?r.angle+=130*t:r.angle-=130*t,r.angle=Br(r.angle,0,180)}us(ur*(globalThis.bulletTime?7:1))}function ms(r){let t=p.currentControlledChar,e=1500;r<1e3&&(e=75*Math.ceil(r/50));let n=t.handTool;n==="rifle"?e=1500:n==="hook"&&(e=1400);let i=t.angle,s=(t.looksToLeft?i+90:450-i)*Math.PI/180,a=e*Math.cos(s),f=e*Math.sin(s);switch(n){case"gren":p.gameEntities.add(new ye(t.collider.x,t.collider.y,a,f)),G("grenadeAttack");break;case"bazooka":p.gameEntities.add(new be(t.collider.x,t.collider.y,a,f)),G("rocketAttack");break;case"rifle":G("grenadeAttack"),p.gameEntities.add(new ve(t.collider.x,t.collider.y,a,f));break;case"hook":p.gameEntities.add(new Pt(a,f)),G("grenadeAttack");break}}function ds(r,t){let n=t/ur,i=0,s=r.x+n;for(let a=.9375;a<=.9375*8;a+=.9375){let f=r.y+a;if(p.terrain.intersectsShapeSome(new g.Box(s,f,s+r.width,f+r.height))){i=a-.9375;break}}if(i>0){r.y+=i,r.x+=n;return}for(let a=0;a<=.9375*7;a+=.9375){let f=r.y-a;if(p.terrain.intersectsShapeSome(new g.Box(s,f,s+r.width,f+r.height))===!1){r.y-=a,r.x+=n;return}}}globalThis.onmessage=async r=>{let t=r.data,e=t.params,n,i;switch(p&&(n=p.currentControlledChar,i=n.collider),t.method){case"join":{let l;try{let y=await fetch(`./${t.params.map}.json`);if(y.ok===!1)throw new Error("");l=await y.json(),cs(l,t.params.map)}catch(y){throw y}let u=new Zt(1570,-200);p.gameEntities.add(u);let d=new dr(u,t.params.nickname??"\u041A\u043E\u043B\u044F",1);d.state="IDLE",p.characters.add(d),p.currentControlledChar=d;let c=new Zt(1370,-200);p.gameEntities.add(c);let h=new dr(c,"\u041F\u0435\u0442\u044F",0);h.state="IDLE",p.characters.add(h),globalThis.postMessage({type:"debug",data:[l]}),sn(!0),setTimeout(sn,1e3/gs);break}case"stopMoving":n.stopMoving();break;case"startMoving":n.state==="PREPARE_TO_JUMP"||n.state==="JUMP"||(n.looksToLeft=e.direction),n.startMoving(e.direction);break;case"startJumping":n.startJumping(e.direction);break;case"changeChar":i.testGavnina&&(i.testGavnina=!1);let s=[...p.characters],f=(s.indexOf(n)+1)%s.length;p.currentControlledChar=s[f];break;case"setWeapon":n.handTool=e.name;break;case"fireTest":ms(e.force);break;case"toggleBulletTime":globalThis.bulletTime=!globalThis.bulletTime;break;case"stopPull":i.pull="none",n.aim="none";break;case"startPull":if(i.testGavnina){i.pull=e.direction;break}n.aim=e.direction==="W"?"up":"down";break;case"deattach":i.testGavnina&&(i.testGavnina=!1);break;case"changeDirection":n.looksToLeft=e.direction;break;case"draw":{p.terrain.draw(e.cx,e.cy,20);break}case"makeHole":return p.holes2.push({cx:e.cx,cy:e.cy,r:60}),p.terrain.makeHole(e.cx,e.cy,60),new Response(JSON.stringify({result:{data:""}}))}};var jc={},gs=64;async function sn(r=!1){let t={characters:[...p.characters].map(e=>({name:e.name,health:e.health,team:e.team,colX:e.collider.x,colY:e.collider.y,colWidth:e.collider.width,colHeight:e.collider.height,direction:e.looksToLeft,visual:e.animState,handTool:e.handTool,angle:e.angle})),weaponBoxes:[...p.weaponBoxes].map(e=>({colX:e.collider.x,colY:e.collider.y,colWidth:e.collider.width,colHeight:e.collider.height,creationTime:e.creationTime})),holes:[...p.holes2],meta:{terrainOffsetX:p.terrainOffsetX,terrainOffsetY:p.terrainOffsetY,waterOffset:p.waterOffset,currentControlledCharIdx:[...p.characters].indexOf(p.currentControlledChar),currentControlledCharState:p.currentControlledChar.state}};t.testGrenades=[];for(let e of p.gameEntities)e instanceof ye&&t.testGrenades.push({x:e.x,y:e.y,w:e.width,h:e.height,angle:e.angle});t.testBullets=[];for(let e of p.gameEntities)e instanceof ve&&t.testBullets.push({x:e.x,y:e.y,w:e.width,h:e.height,angle:e.velocity.slope});t.testBazookas=[];for(let e of p.gameEntities)e instanceof be&&t.testBazookas.push({x:e.x,y:e.y,w:e.width,h:e.height,angle:e.velocity.slope});t.testHookShot=[];for(let e of p.gameEntities)e instanceof Pt&&t.testHookShot.push({x:e.x,y:e.y,w:e.width,h:e.height});t.testHookSegments=[];for(let e of p.gameEntities)if(e instanceof Ct){let i=p.currentControlledChar.collider;if(i.pointX===void 0)continue;let s=new g.Vector(new g.Point(i.pointX,i.pointY),new g.Point(i.x+i.width/2,i.y+i.height/2)),a=new g.Vector(new g.Point(i.pointX,i.pointY),new g.Point(e.x+e.width/2,e.y+e.height/2));(e.active===!1||a.length<s.length)&&t.testHookSegments.push({x:e.x,y:e.y,w:e.width,h:e.height})}jc=t,globalThis.postMessage({type:"fullSnapshot",data:t}),setTimeout(sn,1e3/gs)}function G(r){globalThis.postMessage({type:"playSound",data:r})}function Jt(r){globalThis.postMessage({type:"setInputMode",data:r})}})();
/**
 * @license
 * Lodash (Custom Build) <https://lodash.com/>
 * Build: `lodash modularize exports="es" -o ./`
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
