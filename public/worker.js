(()=>{var Yr=Object.defineProperty;var Yo=(n,t,e)=>t in n?Yr(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var Xr=(n,t)=>{for(var e in t)Yr(n,e,{get:t[e],enumerable:!0})};var ot=(n,t,e)=>(Yo(n,typeof t!="symbol"?t+"":t,e),e);var h;function Hr(n){h=n}var R=class{};ot(R,"weaponBox",{spriteName:"weaponBox",frameCount:16}),ot(R,"rabbitBreath",{spriteName:"rabbitBreath",frameCount:60}),ot(R,"bubbles",{spriteName:"bubbles",frameCount:68}),ot(R,"rabbitGo",{spriteName:"rabbitGo",frameCount:24}),ot(R,"rabbitPrepareToJump",{spriteName:"rabbitPrepareToJump",frameCount:9}),ot(R,"rabbitJumpBack",{spriteName:"rabbitJumpBack",frameCount:30}),ot(R,"rabbitJump",{spriteName:"rabbitJump",frameCount:9});var $=class{anim;startTime;constructor(t){this.anim=t,this.startTime=performance.now()}};var Xo={CCW:-1,CW:1,NOT_ORIENTABLE:0},Ho=2*Math.PI,zt=1,sn=0,X=2,Qo=3,Jo=4,Ko=1,Zo=2,xr=0,be=1,St=2,ve=Object.freeze({CCW:!0,CW:!1,ORIENTATION:Xo,PIx2:Ho,INSIDE:zt,OUTSIDE:sn,BOUNDARY:X,CONTAINS:Qo,INTERLACE:Jo,OVERLAP_SAME:Ko,OVERLAP_OPPOSITE:Zo,NOT_VERTEX:xr,START_VERTEX:be,END_VERTEX:St}),J=1e-6;function an(n){J=n}function ln(){return J}var ts=3;function fr(n){return n<J&&n>-J}function gt(n,t){return n-t<J&&n-t>-J}function fn(n,t){return n-t>J}function es(n,t){return n-t>-J}function un(n,t){return n-t<-J}function rs(n,t){return n-t<J}var ns=Object.freeze({setTolerance:an,getTolerance:ln,DECIMALS:ts,EQ_0:fr,EQ:gt,GT:fn,GE:es,LT:un,LE:rs}),we=class{static get ILLEGAL_PARAMETERS(){return new ReferenceError("Illegal Parameters")}static get ZERO_DIVISION(){return new Error("Zero division")}static get UNRESOLVED_BOUNDARY_CONFLICT(){return new Error("Unresolved boundary conflict in boolean operation")}static get INFINITE_LOOP(){return new Error("Infinite loop")}};var o={Utils:ns,Errors:we,Matrix:void 0,Planar_set:void 0,Point:void 0,Vector:void 0,Line:void 0,Circle:void 0,Segment:void 0,Arc:void 0,Box:void 0,Edge:void 0,Face:void 0,Ray:void 0,Ray_shooting:void 0,Multiline:void 0,Polygon:void 0,Distance:void 0,Inversion:void 0};for(let n in ve)o[n]=ve[n];Object.defineProperty(o,"DP_TOL",{get:function(){return ln()},set:function(n){an(n)}});var Ee=class{constructor(t,e){this.first=t,this.last=e||this.first}static testInfiniteLoop(t){let e=t,r=t;do{if(e!=t&&e===r)throw o.Errors.INFINITE_LOOP;e=e.next,r=r.next.next}while(e!=t)}get size(){let t=0;for(let e of this)t++;return t}toArray(t=void 0,e=void 0){let r=[],i=t||this.first,a=e||this.last,s=i;if(s===void 0)return r;do r.push(s),s=s.next;while(s!==a.next);return r}append(t){return this.isEmpty()?this.first=t:(t.prev=this.last,this.last.next=t),this.last=t,this.last.next=void 0,this.first.prev=void 0,this}insert(t,e){if(this.isEmpty())this.first=t,this.last=t;else if(e==null)t.next=this.first,this.first.prev=t,this.first=t;else{let r=e.next;e.next=t,r&&(r.prev=t),t.prev=e,t.next=r,this.last===e&&(this.last=t)}return this.last.next=void 0,this.first.prev=void 0,this}remove(t){return t===this.first&&t===this.last?(this.first=void 0,this.last=void 0):(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t===this.first&&(this.first=t.next),t===this.last&&(this.last=t.prev)),this}isEmpty(){return this.first===void 0}[Symbol.iterator](){let t;return{next:()=>(t=t?t.next:this.first,{value:t,done:t===void 0})}}};function Ct(n,t,e){let r=e.length,i=n.shape.split(t);if(i.length===0)return;let a=0;i[0]===null?a=0:i[1]===null?a=n.shape.length:a=i[0].length;let s=xr;gt(a,0)&&(s|=be),gt(a,n.shape.length)&&(s|=St);let l=s&St&&n.next.arc_length===0?0:n.arc_length+a;e.push({id:r,pt:t,arc_length:l,edge_before:n,edge_after:void 0,face:n.face,is_vertex:s})}function Ht(n){n.int_points1_sorted=Yt(n.int_points1),n.int_points2_sorted=Yt(n.int_points2)}function Yt(n){let t=new Map,e=0;for(let i of n)t.has(i.face)||(t.set(i.face,e),e++);for(let i of n)i.faceId=t.get(i.face);return n.slice().sort(is)}function is(n,t){return n.faceId<t.faceId?-1:n.faceId>t.faceId?1:n.arc_length<t.arc_length?-1:n.arc_length>t.arc_length?1:0}function sr(n,t){return t.slice().sort((e,r)=>n.coord(e.pt)<n.coord(r.pt)?-1:n.coord(e.pt)>n.coord(r.pt)?1:0)}function yr(n){if(n.int_points1.length<2)return;let t=!1,e,r,i,a;for(let s=0;s<n.int_points1_sorted.length;s++)if(n.int_points1_sorted[s].id!==-1){e=n.int_points1_sorted[s],r=n.int_points2[e.id];for(let l=s+1;l<n.int_points1_sorted.length&&(i=n.int_points1_sorted[l],!!gt(i.arc_length,e.arc_length));l++)i.id!==-1&&(a=n.int_points2[i.id],a.id!==-1&&i.edge_before===e.edge_before&&i.edge_after===e.edge_after&&a.edge_before===r.edge_before&&a.edge_after===r.edge_after&&(i.id=-1,a.id=-1,t=!0))}r=n.int_points2_sorted[0],e=n.int_points1[r.id];for(let s=1;s<n.int_points2_sorted.length;s++){let l=n.int_points2_sorted[s];if(l.id==-1)continue;if(r.id==-1||!gt(l.arc_length,r.arc_length)){r=l,e=n.int_points1[r.id];continue}let f=n.int_points1[l.id];f.edge_before===e.edge_before&&f.edge_after===e.edge_after&&l.edge_before===r.edge_before&&l.edge_after===r.edge_after&&(f.id=-1,l.id=-1,t=!0)}t&&(n.int_points1=n.int_points1.filter(s=>s.id>=0),n.int_points2=n.int_points2.filter(s=>s.id>=0),n.int_points1.forEach((s,l)=>s.id=l),n.int_points2.forEach((s,l)=>s.id=l))}function ur(n){for(let t of n)t.edge_before.bvStart=void 0,t.edge_before.bvEnd=void 0,t.edge_before.bv=void 0,t.edge_before.overlap=void 0,t.edge_after.bvStart=void 0,t.edge_after.bvEnd=void 0,t.edge_after.bv=void 0,t.edge_after.overlap=void 0;for(let t of n)t.edge_before.bvEnd=X,t.edge_after.bvStart=X}function dr(n,t){for(let e of n)e.edge_before.setInclusion(t),e.edge_after.setInclusion(t)}function os(n){let t,e,r,i=n.int_points1.length;for(let a=0;a<i;a++){let s=n.int_points1_sorted[a];s.face!==t&&(e=a,t=s.face);let l=a,f=Ot(n.int_points1_sorted,a,t),u;l+f<i&&n.int_points1_sorted[l+f].face===t?u=l+f:u=e;let d=Ot(n.int_points1_sorted,u,t);r=null;for(let x=u;x<u+d;x++){let v=n.int_points1_sorted[x];if(v.face===t&&n.int_points2[v.id].face===n.int_points2[s.id].face){r=v;break}}if(r===null)continue;let c=s.edge_after,m=r.edge_before;if(!(c.bv===X&&m.bv===X)||c!==m)continue;let w=n.int_points2[s.id],y=n.int_points2[r.id],b=w.edge_after,E=y.edge_before;b.bv===X&&E.bv===X&&b===E||(w=n.int_points2[r.id],y=n.int_points2[s.id],b=w.edge_after,E=y.edge_before),b.bv===X&&E.bv===X&&b===E&&c.setOverlap(b)}}function Ot(n,t,e){let r,i,a=1;if(n.length==1)return 1;r=n[t];for(let s=t+1;s<n.length&&!(r.face!=e||(i=n[s],!(i.pt.equalTo(r.pt)&&i.edge_before===r.edge_before&&i.edge_after===r.edge_after)));s++)a++;return a}function Lt(n,t){if(!!t){for(let e of t){let r=e.edge_before;if(e.is_vertex=xr,r.shape.start&&r.shape.start.equalTo(e.pt)&&(e.is_vertex|=be),r.shape.end&&r.shape.end.equalTo(e.pt)&&(e.is_vertex|=St),e.is_vertex&be){e.edge_before=r.prev,e.is_vertex=St;continue}if(e.is_vertex&St)continue;let i=n.addVertex(e.pt,r);e.edge_before=i}for(let e of t)e.edge_after=e.edge_before.next}}function Qr(n,t,e){let r=n.edge_before,i=t.edge_after;r.next=e,e.prev=r,e.next=i,i.prev=e}var{INSIDE:H,OUTSIDE:Q,BOUNDARY:k,OVERLAP_SAME:ss,OVERLAP_OPPOSITE:as}=ve,{NOT_VERTEX:lc,START_VERTEX:Jr,END_VERTEX:Kr}=ve,Te=1,Kt=2,_t=3;function ls(n,t){let[e,r]=Zt(n,t,Te,!0);return e}function cr(n,t){let r=t.clone().reverse(),[i,a]=Zt(n,r,_t,!0);return i}function dn(n,t){let[e,r]=Zt(n,t,Kt,!0);return e}function cn(n,t){let[e,r]=Zt(n,t,Kt,!1),i=[];for(let s of e.faces)i=[...i,...[...s.edges].map(l=>l.shape)];let a=[];for(let s of r.faces)a=[...a,...[...s.edges].map(l=>l.shape)];return[i,a]}function hr(n,t){let[e,r]=Zt(n,t,_t,!1),i=[];for(let a of e.faces)i=[...i,...[...a.edges].map(s=>s.shape)];return i}function hn(n,t){let e=n.clone(),r=t.clone(),i=pn(e,r);Ht(i),Lt(e,i.int_points1_sorted),Lt(r,i.int_points2_sorted),yr(i),Ht(i);let a=i.int_points1_sorted.map(l=>l.pt),s=i.int_points2_sorted.map(l=>l.pt);return[a,s]}function fs(n,t,e,r){let i=Zr(n,e.int_points1),a=Zr(t,e.int_points2);for(tn(i,t),tn(a,n),ur(e.int_points1),ur(e.int_points2),dr(e.int_points1,t),dr(e.int_points2,n);ds(n,t,e.int_points1,e.int_points1_sorted,e.int_points2,e););os(e),pr(n,r,e.int_points1_sorted,!0),pr(t,r,e.int_points2_sorted,!1),en(n,i,r,!0),en(t,a,r,!1)}function us(n,t,e,r){cs(n,t,r,e.int_points2),hs(n,t,e),mr(n,e.int_points1),mr(t,e.int_points2),gr(n,e.int_points1,e.int_points2),gr(n,e.int_points2,e.int_points1)}function Zt(n,t,e,r){let i=n.clone(),a=t.clone(),s=pn(i,a);return Ht(s),Lt(i,s.int_points1_sorted),Lt(a,s.int_points2_sorted),yr(s),Ht(s),fs(i,a,s,e),r&&us(i,a,s,e),[i,a]}function pn(n,t){let e={int_points1:[],int_points2:[]};for(let r of n.edges){let i=t.edges.search(r.box);for(let a of i){let s=r.shape.intersect(a.shape);for(let l of s)Ct(r,l,e.int_points1),Ct(a,l,e.int_points2)}}return e}function Zr(n,t){let e=[];for(let r of n.faces)t.find(i=>i.face===r)||e.push(r);return e}function tn(n,t){for(let e of n)e.first.bv=e.first.bvStart=e.first.bvEnd=void 0,e.first.setInclusion(t)}function ds(n,t,e,r,i,a){let s,l,f,u=r.length,d=!1;for(let c=0;c<u;c++){let m=r[c];m.face!==s&&(l=c,s=m.face);let w=c,y=Ot(r,c,s),b;w+y<u&&r[w+y].face===s?b=w+y:b=l;let E=Ot(r,b,s);f=null;for(let g=b;g<b+E;g++){let I=r[g];if(I.face===s&&i[I.id].face===i[m.id].face){f=I;break}}if(f===null)continue;let x=m.edge_after,v=f.edge_before;if(x.bv===k&&v.bv!=k){x.bv=v.bv;continue}if(x.bv!=k&&v.bv===k){v.bv=x.bv;continue}if(x.bv===k&&v.bv===k&&x!=v||x.bv===H&&v.bv===Q||x.bv===Q&&v.bv===H){let g=x.next;for(;g!=v;)g.bvStart=void 0,g.bvEnd=void 0,g.bv=void 0,g.setInclusion(t),g=g.next}if(x.bv===k&&v.bv===k&&x!=v){let g=x.next,I;for(;g!=v;){if(g.bv!=k){if(I===void 0)I=g.bv;else if(g.bv!=I)throw we.UNRESOLVED_BOUNDARY_CONFLICT}g=g.next}I!=null&&(x.bv=I,v.bv=I);continue}if(x.bv===H&&v.bv===Q||x.bv===Q&&v.bv===H){let g=x;for(;g!=v;){if(g.bvStart===x.bv&&g.bvEnd===v.bv){let[I,U]=g.shape.distanceTo(t);if(I<10*o.DP_TOL){Ct(g,U.ps,e);let T=e[e.length-1];if(T.is_vertex&Jr)T.edge_after=g,T.edge_before=g.prev,g.bvStart=k,g.bv=void 0,g.setInclusion(t);else if(T.is_vertex&Kr)T.edge_after=g.next,g.bvEnd=k,g.bv=void 0,g.setInclusion(t);else{let P=t.addVertex(T.pt,g);T.edge_before=P,T.edge_after=P.next,P.setInclusion(t),P.next.bvStart=k,P.next.bvEnd=void 0,P.next.bv=void 0,P.next.setInclusion(t)}let L=t.findEdgeByPoint(U.pe);Ct(L,U.pe,i);let C=i[i.length-1];if(C.is_vertex&Jr)C.edge_after=L,C.edge_before=L.prev;else if(C.is_vertex&Kr)C.edge_after=L.next;else{let P=i.find(or=>or.edge_after===L),O=t.addVertex(C.pt,L);C.edge_before=O,C.edge_after=O.next,P&&(P.edge_after=O),O.bvStart=void 0,O.bvEnd=k,O.bv=void 0,O.setInclusion(n),O.next.bvStart=k,O.next.bvEnd=void 0,O.next.bv=void 0,O.next.setInclusion(n)}Ht(a),d=!0;break}}g=g.next}if(d)break;throw we.UNRESOLVED_BOUNDARY_CONFLICT}}return d}function pr(n,t,e,r){if(!e)return;let i,a,s,l;for(let f=0;f<e.length;f++){if(s=e[f],s.face!==i&&(a=f,i=s.face),i.isEmpty())continue;let u=f,d=Ot(e,f,i),c;u+d<e.length&&e[u+d].face===s.face?c=u+d:c=a,l=e[c];let m=c,w=Ot(e,m,i),y=s.edge_after,b=l.edge_before;if(y.bv===H&&b.bv===H&&t===Te||y.bv===Q&&b.bv===Q&&t===Kt||(y.bv===Q||b.bv===Q)&&t===_t&&!r||(y.bv===H||b.bv===H)&&t===_t&&r||y.bv===k&&b.bv===k&&y.overlap&ss&&r||y.bv===k&&b.bv===k&&y.overlap&as){n.removeChain(i,y,b);for(let E=u;E<u+d;E++)e[E].edge_after=void 0;for(let E=m;E<m+w;E++)e[E].edge_before=void 0}f+=d-1}}function cs(n,t,e,r){for(let i of t.faces){for(let a of i)n.edges.add(a);r.find(a=>a.face===i)===void 0&&n.addFace(i.first,i.last)}}function hs(n,t,e){if(e.int_points1.length!==0)for(let r=0;r<e.int_points1.length;r++){let i=e.int_points1[r],a=e.int_points2[r];if(i.edge_before!==void 0&&i.edge_after===void 0&&a.edge_before===void 0&&a.edge_after!==void 0&&(i.edge_before.next=a.edge_after,a.edge_after.prev=i.edge_before,i.edge_after=a.edge_after,a.edge_before=i.edge_before),a.edge_before!==void 0&&a.edge_after===void 0&&i.edge_before===void 0&&i.edge_after!==void 0&&(a.edge_before.next=i.edge_after,i.edge_after.prev=a.edge_before,a.edge_after=i.edge_after,i.edge_before=a.edge_before),i.edge_before!==void 0&&i.edge_after===void 0)for(let s of e.int_points1_sorted)s!==i&&s.edge_before===void 0&&s.edge_after!==void 0&&s.pt.equalTo(i.pt)&&(i.edge_before.next=s.edge_after,s.edge_after.prev=i.edge_before,i.edge_after=s.edge_after,s.edge_before=i.edge_before);if(a.edge_before!==void 0&&a.edge_after===void 0)for(let s of e.int_points2_sorted)s!==a&&s.edge_before===void 0&&s.edge_after!==void 0&&s.pt.equalTo(a.pt)&&(a.edge_before.next=s.edge_after,s.edge_after.prev=a.edge_before,a.edge_after=s.edge_after,s.edge_before=a.edge_before)}}function mr(n,t){for(let e of t)n.faces.delete(e.face),e.face=void 0,e.edge_before&&(e.edge_before.face=void 0),e.edge_after&&(e.edge_after.face=void 0)}function gr(n,t,e){for(let r of t){if(r.edge_before===void 0||r.edge_after===void 0||r.face||r.edge_after.face||r.edge_before.face)continue;let i=r.edge_after,a=r.edge_before;Ee.testInfiniteLoop(i);let s=n.addFace(i,a);for(let l of t)l.edge_before&&l.edge_after&&l.edge_before.face===s&&l.edge_after.face===s&&(l.face=s);for(let l of e)l.edge_before&&l.edge_after&&l.edge_before.face===s&&l.edge_after.face===s&&(l.face=s)}}function en(n,t,e,r){for(let i of t){let a=i.first.bv;(e===Te&&a===H||e===_t&&a===H&&r||e===_t&&a===Q&&!r||e===Kt&&a===Q)&&n.deleteFace(i)}}var ps=Object.freeze({BOOLEAN_UNION:Te,BOOLEAN_INTERSECT:Kt,BOOLEAN_SUBTRACT:_t,unify:ls,subtract:cr,intersect:dn,innerClip:cn,outerClip:hr,calculateIntersections:hn,removeNotRelevantChains:pr,removeOldFaces:mr,restoreFaces:gr}),ms=RegExp("T.F..FFF.|T.F...F.."),gs=RegExp("T........|.T.......|...T.....|....T...."),_s=RegExp("FT.......|F..T.....|F...T...."),xs=RegExp("T.F..F..."),ys=RegExp("T.F..F...|.TF..F...|..FT.F...|..F.TF..."),yt=class{constructor(){this.m=new Array(9).fill(void 0)}get I2I(){return this.m[0]}set I2I(t){this.m[0]=t}get I2B(){return this.m[1]}set I2B(t){this.m[1]=t}get I2E(){return this.m[2]}set I2E(t){this.m[2]=t}get B2I(){return this.m[3]}set B2I(t){this.m[3]=t}get B2B(){return this.m[4]}set B2B(t){this.m[4]=t}get B2E(){return this.m[5]}set B2E(t){this.m[5]=t}get E2I(){return this.m[6]}set E2I(t){this.m[6]=t}get E2B(){return this.m[7]}set E2B(t){this.m[7]=t}get E2E(){return this.m[8]}set E2E(t){this.m[8]=t}toString(){return this.m.map(t=>t instanceof Array&&t.length>0?"T":t instanceof Array&&t.length===0?"F":"*").join("")}equal(){return ms.test(this.toString())}intersect(){return gs.test(this.toString())}touch(){return _s.test(this.toString())}inside(){return xs.test(this.toString())}covered(){return ys.test(this.toString())}};function Ie(n,t){let e=[],[r,i,a]=n.standard,[s,l,f]=t.standard,u=r*l-i*s,d=a*l-i*f,c=r*f-a*s;if(!o.Utils.EQ_0(u)){let m,w;i===0?(m=a/r,w=c/u):l===0?(m=f/s,w=c/u):r===0?(m=d/u,w=a/i):s===0?(m=d/u,w=f/l):(m=d/u,w=c/u),e.push(new o.Point(m,w))}return e}function Rt(n,t){let e=[],r=t.pc.projectionOn(n),i=t.pc.distanceTo(r)[0];if(o.Utils.EQ(i,t.r))e.push(r);else if(o.Utils.LT(i,t.r)){let a=Math.sqrt(t.r*t.r-i*i),s,l;s=n.norm.rotate90CCW().multiply(a),l=r.translate(s),e.push(l),s=n.norm.rotate90CW().multiply(a),l=r.translate(s),e.push(l)}return e}function Qt(n,t){let e=[];for(let r of t.toSegments()){let i=Se(r,n);for(let a of i)xn(a,e)||e.push(a)}return e}function br(n,t){let e=[];if(Qt(n,t.box).length===0)return e;let r=new o.Circle(t.pc,t.r),i=Rt(n,r);for(let a of i)a.on(t)&&e.push(a);return e}function Se(n,t){let e=[];if(n.ps.on(t)&&e.push(n.ps),n.pe.on(t)&&!n.isZeroLength()&&e.push(n.pe),e.length>0||n.isZeroLength()||n.ps.leftTo(t)&&n.pe.leftTo(t)||!n.ps.leftTo(t)&&!n.pe.leftTo(t))return e;let r=new o.Line(n.ps,n.pe);return Ie(r,t)}function te(n,t){let e=[];if(n.box.not_intersect(t.box))return e;if(n.isZeroLength())return n.ps.on(t)&&e.push(n.ps),e;if(t.isZeroLength())return t.ps.on(n)&&e.push(t.ps),e;let r=new o.Line(n.ps,n.pe),i=new o.Line(t.ps,t.pe);if(r.incidentTo(i))n.ps.on(t)&&e.push(n.ps),n.pe.on(t)&&e.push(n.pe),t.ps.on(n)&&!t.ps.equalTo(n.ps)&&!t.ps.equalTo(n.pe)&&e.push(t.ps),t.pe.on(n)&&!t.pe.equalTo(n.ps)&&!t.pe.equalTo(n.pe)&&e.push(t.pe);else{let a=Ie(r,i);a.length>0&&a[0].on(n)&&a[0].on(t)&&e.push(a[0])}return e}function Ae(n,t){let e=[];if(n.box.not_intersect(t.box))return e;if(n.isZeroLength()){let[a,s]=n.ps.distanceTo(t.pc);return o.Utils.EQ(a,t.r)&&e.push(n.ps),e}let r=new o.Line(n.ps,n.pe),i=Rt(r,t);for(let a of i)a.on(n)&&e.push(a);return e}function xt(n,t){let e=[];if(n.box.not_intersect(t.box))return e;if(n.isZeroLength())return n.ps.on(t)&&e.push(n.ps),e;let r=new o.Line(n.ps,n.pe),i=new o.Circle(t.pc,t.r),a=Rt(r,i);for(let s of a)s.on(n)&&s.on(t)&&e.push(s);return e}function bs(n,t){let e=[];for(let r of t.toSegments()){let i=te(r,n);for(let a of i)e.push(a)}return e}function mn(n,t){let e=[];if(n.box.not_intersect(t.box))return e;let r=new o.Vector(n.pc,t.pc),i=n.r,a=t.r;if(o.Utils.EQ_0(i)||o.Utils.EQ_0(a))return e;if(o.Utils.EQ_0(r.x)&&o.Utils.EQ_0(r.y)&&o.Utils.EQ(i,a))return e.push(n.pc.translate(-i,0)),e;let s=n.pc.distanceTo(t.pc)[0];if(o.Utils.GT(s,i+a)||o.Utils.LT(s,Math.abs(i-a)))return e;r.x/=s,r.y/=s;let l;if(o.Utils.EQ(s,i+a)||o.Utils.EQ(s,Math.abs(i-a)))return l=n.pc.translate(i*r.x,i*r.y),e.push(l),e;let f=i*i/(2*s)-a*a/(2*s)+s/2,u=n.pc.translate(f*r.x,f*r.y),d=Math.sqrt(i*i-f*f);return l=u.translate(r.rotate90CCW().multiply(d)),e.push(l),l=u.translate(r.rotate90CW().multiply(d)),e.push(l),e}function vs(n,t){let e=[];for(let r of t.toSegments()){let i=Ae(r,n);for(let a of i)e.push(a)}return e}function vr(n,t){var e=[];if(n.box.not_intersect(t.box))return e;if(n.pc.equalTo(t.pc)&&o.Utils.EQ(n.r,t.r)){let s;return s=n.start,s.on(t)&&e.push(s),s=n.end,s.on(t)&&e.push(s),s=t.start,s.on(n)&&e.push(s),s=t.end,s.on(n)&&e.push(s),e}let r=new o.Circle(n.pc,n.r),i=new o.Circle(t.pc,t.r),a=r.intersect(i);for(let s of a)s.on(n)&&s.on(t)&&e.push(s);return e}function wr(n,t){let e=[];if(n.box.not_intersect(t.box))return e;if(t.pc.equalTo(n.pc)&&o.Utils.EQ(t.r,n.r))return e.push(n.start),e.push(n.end),e;let r=t,i=new o.Circle(n.pc,n.r),a=mn(r,i);for(let s of a)s.on(n)&&e.push(s);return e}function ws(n,t){let e=[];for(let r of t.toSegments()){let i=xt(r,n);for(let a of i)e.push(a)}return e}function Es(n,t){return n.isSegment()?te(n.shape,t):xt(t,n.shape)}function Ts(n,t){return n.isSegment()?xt(n.shape,t):vr(n.shape,t)}function gn(n,t){return n.isSegment()?Se(n.shape,t):br(t,n.shape)}function Is(n,t){return n.isSegment()?Ae(n.shape,t):wr(n.shape,t)}function Er(n,t){let e=[];for(let r of t.edges)for(let i of Es(r,n))e.push(i);return e}function Tr(n,t){let e=[];for(let r of t.edges)for(let i of Ts(r,n))e.push(i);return e}function Pe(n,t){let e=[];if(t.isEmpty())return e;for(let r of t.edges)for(let i of gn(r,n))xn(i,e)||e.push(i);return n.sortPoints(e)}function _n(n,t){let e=[];if(t.isEmpty())return e;for(let r of t.edges)for(let i of Is(r,n))e.push(i);return e}function Ss(n,t){let e=n.shape,r=t.shape;return n.isSegment()?t.isSegment()?te(e,r):xt(e,r):t.isSegment()?xt(r,e):vr(e,r)}function As(n,t){let e=[];if(t.isEmpty()||n.shape.box.not_intersect(t.box))return e;let r=t.edges.search(n.shape.box);for(let i of r)for(let a of Ss(n,i))e.push(a);return e}function Ps(n,t){let e=[];if(n.isEmpty()||t.isEmpty()||n.box.not_intersect(t.box))return e;for(let r of n.edges)for(let i of As(r,t))e.push(i);return e}function Cs(n,t){return n instanceof o.Line?Pe(n,t):n instanceof o.Segment?Er(n,t):n instanceof o.Arc?Tr(n,t):[]}function xn(n,t){return t.some(e=>e.equalTo(n))}var W=class extends Ee{constructor(...t){super();if(t.length!==0&&t.length==1&&t[0]instanceof Array){let e=t[0];if(e.length==0)return;let r=e.every(i=>i instanceof o.Segment||i instanceof o.Arc||i instanceof o.Ray||i instanceof o.Line);for(let i of e){let a=new o.Edge(i);this.append(a)}}}get edges(){return[...this]}get box(){return this.edges.reduce((t,e)=>t=t.merge(e.box),new o.Box)}get vertices(){let t=this.edges.map(e=>e.start);return t.push(this.last.end),t}clone(){return new W(this.toShapes())}addVertex(t,e){let r=e.shape.split(t);if(r[0]===null)return e.prev;if(r[1]===null)return e;let i=new o.Edge(r[0]),a=e.prev;return this.insert(i,a),e.shape=r[1],i}split(t){for(let e of t){let r=this.findEdgeByPoint(e);this.addVertex(e,r)}return this}findEdgeByPoint(t){let e;for(let r of this)if(r.shape.contains(t)){e=r;break}return e}translate(t){return new W(this.edges.map(e=>e.shape.translate(t)))}rotate(t=0,e=new o.Point){return new W(this.edges.map(r=>r.shape.rotate(t,e)))}transform(t=new o.Matrix){return new W(this.edges.map(e=>e.shape.transform(t)))}toShapes(){return this.edges.map(t=>t.shape.clone())}toJSON(){return this.edges.map(t=>t.toJSON())}svg(t={}){let{stroke:e,strokeWidth:r,fill:i,fillRule:a,fillOpacity:s,id:l,className:f}=t,u=l&&l.length>0?`id="${l}"`:"",d=f&&f.length>0?`class="${f}"`:"",c=`
<path stroke="${e||"black"}" stroke-width="${r||1}" fill="${i||"none"}" fill-opacity="${s||1}" ${u} ${d} d="`;c+=`
M${this.first.start.x},${this.first.start.y}`;for(let m of this)c+=m.svg();return c+=`" >
</path>`,c}};o.Multiline=W;var Os=(...n)=>new o.Multiline(...n);o.multiline=Os;function Xt(n,t){let e,r=new o.Ray(t),i=new o.Line(r.pt,r.norm),a=new o.Box(r.box.xmin-o.DP_TOL,r.box.ymin-o.DP_TOL,r.box.xmax,r.box.ymax+o.DP_TOL);if(n.box.not_intersect(a))return o.OUTSIDE;let s=n.edges.search(a);if(s.length==0)return o.OUTSIDE;for(let u of s)if(u.shape.contains(t))return o.BOUNDARY;let l=[];for(let u of s)for(let d of r.intersect(u.shape)){if(d.equalTo(t))return o.BOUNDARY;l.push({pt:d,edge:u})}l.sort((u,d)=>un(u.pt.x,d.pt.x)?-1:fn(u.pt.x,d.pt.x)?1:0);let f=0;for(let u=0;u<l.length;u++){let d=l[u];if(d.pt.equalTo(d.edge.shape.start)){if(u>0&&d.pt.equalTo(l[u-1].pt)&&d.edge.prev===l[u-1].edge)continue;let c=d.edge.prev;for(;fr(c.length);)c=c.prev;let m=c.shape.tangentInEnd(),w=d.pt.translate(m),y=d.edge.shape.tangentInStart(),b=d.pt.translate(y),E=w.leftTo(i),x=b.leftTo(i);(E&&!x||!E&&x)&&f++}else if(d.pt.equalTo(d.edge.shape.end)){if(u>0&&d.pt.equalTo(l[u-1].pt)&&d.edge.next===l[u-1].edge)continue;let c=d.edge.next;for(;fr(c.length);)c=c.next;let m=c.shape.tangentInStart(),w=d.pt.translate(m),y=d.edge.shape.tangentInEnd(),b=d.pt.translate(y),E=w.leftTo(i),x=b.leftTo(i);(E&&!x||!E&&x)&&f++}else if(d.edge.shape instanceof o.Segment)f++;else{let c=d.edge.shape.box;gt(d.pt.y,c.ymin)||gt(d.pt.y,c.ymax)||f++}}return e=f%2==1?zt:sn,e}function Ls(n,t){return kt(n,t).equal()}function yn(n,t){return kt(n,t).intersect()}function Ns(n,t){return kt(n,t).touch()}function Rs(n,t){return!yn(n,t)}function bn(n,t){return kt(n,t).inside()}function vn(n,t){return kt(n,t).covered()}function ks(n,t){return bn(t,n)}function wn(n,t){return vn(t,n)}function kt(n,t){if(n instanceof o.Line&&t instanceof o.Line)return Ms(n,t);if(n instanceof o.Line&&t instanceof o.Circle)return Bs(n,t);if(n instanceof o.Line&&t instanceof o.Box)return Fs(n,t);if(n instanceof o.Line&&t instanceof o.Polygon)return Us(n,t);if((n instanceof o.Segment||n instanceof o.Arc)&&t instanceof o.Polygon)return rn(n,t);if((n instanceof o.Segment||n instanceof o.Arc)&&(t instanceof o.Circle||t instanceof o.Box))return rn(n,new o.Polygon(t));if(n instanceof o.Polygon&&t instanceof o.Polygon)return _e(n,t);if((n instanceof o.Circle||n instanceof o.Box)&&(t instanceof o.Circle||t instanceof o.Box))return _e(new o.Polygon(n),new o.Polygon(t));if((n instanceof o.Circle||n instanceof o.Box)&&t instanceof o.Polygon)return _e(new o.Polygon(n),t);if(n instanceof o.Polygon&&(t instanceof o.Circle||t instanceof o.Box))return _e(n,new o.Polygon(t))}function Ms(n,t){let e=new yt,r=Ie(n,t);return r.length===0?n.contains(t.pt)&&t.contains(n.pt)?(e.I2I=[n],e.I2E=[],e.E2I=[]):(e.I2I=[],e.I2E=[n],e.E2I=[t]):(e.I2I=r,e.I2E=n.split(r),e.E2I=t.split(r)),e}function Bs(n,t){let e=new yt,r=Rt(n,t);if(r.length===0)e.I2I=[],e.I2B=[],e.I2E=[n],e.E2I=[t];else if(r.length===1)e.I2I=[],e.I2B=r,e.I2E=n.split(r),e.E2I=[t];else{let i=new W([n]),a=n.sortPoints(r);i.split(a);let s=i.toShapes();e.I2I=[s[1]],e.I2B=a,e.I2E=[s[0],s[2]],e.E2I=new o.Polygon([t.toArc()]).cut(i)}return e}function Fs(n,t){let e=new yt,r=Qt(n,t);if(r.length===0)e.I2I=[],e.I2B=[],e.I2E=[n],e.E2I=[t];else if(r.length===1)e.I2I=[],e.I2B=r,e.I2E=n.split(r),e.E2I=[t];else{let i=new W([n]),a=n.sortPoints(r);i.split(a);let s=i.toShapes();t.toSegments().some(l=>l.contains(r[0])&&l.contains(r[1]))?(e.I2I=[],e.I2B=[s[1]],e.I2E=[s[0],s[2]],e.E2I=[t]):(e.I2I=[s[1]],e.I2B=a,e.I2E=[s[0],s[2]],e.E2I=new o.Polygon(t.toSegments()).cut(i))}return e}function Us(n,t){let e=new yt,r=Pe(n,t),i=new W([n]),a=r.length>0?r.slice():n.sortPoints(r);return i.split(a),[...i].forEach(s=>s.setInclusion(t)),e.I2I=[...i].filter(s=>s.bv===o.INSIDE).map(s=>s.shape),e.I2B=[...i].slice(1).map(s=>s.bv===o.BOUNDARY?s.shape:s.shape.start),e.I2E=[...i].filter(s=>s.bv===o.OUTSIDE).map(s=>s.shape),e.E2I=t.cut(i),e}function rn(n,t){let e=new yt,r=Cs(n,t),i=r.length>0?r.slice():n.sortPoints(r),a=new W([n]);a.split(i),[...a].forEach(s=>s.setInclusion(t)),e.I2I=[...a].filter(s=>s.bv===o.INSIDE).map(s=>s.shape),e.I2B=[...a].slice(1).map(s=>s.bv===o.BOUNDARY?s.shape:s.shape.start),e.I2E=[...a].filter(s=>s.bv===o.OUTSIDE).map(s=>s.shape),e.B2I=[],e.B2B=[],e.B2E=[];for(let s of[n.start,n.end])switch(Xt(t,s)){case o.INSIDE:e.B2I.push(s);break;case o.BOUNDARY:e.B2B.push(s);break;case o.OUTSIDE:e.B2E.push(s);break;default:break}return e}function _e(n,t){let e=new yt,[r,i]=hn(n,t),a=dn(n,t),s=cr(n,t),l=cr(t,n),[f,u]=cn(n,t),d=hr(n,t),c=hr(t,n);return e.I2I=a.isEmpty()?[]:[a],e.I2B=u,e.I2E=s.isEmpty()?[]:[s],e.B2I=f,e.B2B=r,e.B2E=d,e.E2I=l.isEmpty()?[]:[l],e.E2B=c,e}var Vs=Object.freeze({equal:Ls,intersect:yn,touch:Ns,disjoint:Rs,inside:bn,covered:vn,contain:ks,cover:wn,relate:kt}),st=class{constructor(t=1,e=0,r=0,i=1,a=0,s=0){this.a=t,this.b=e,this.c=r,this.d=i,this.tx=a,this.ty=s}clone(){return new st(this.a,this.b,this.c,this.d,this.tx,this.ty)}transform(t){return[t[0]*this.a+t[1]*this.c+this.tx,t[0]*this.b+t[1]*this.d+this.ty]}multiply(t){return new st(this.a*t.a+this.c*t.b,this.b*t.a+this.d*t.b,this.a*t.c+this.c*t.d,this.b*t.c+this.d*t.d,this.a*t.tx+this.c*t.ty+this.tx,this.b*t.tx+this.d*t.ty+this.ty)}translate(...t){let e,r;if(t.length==1&&t[0]instanceof o.Vector)e=t[0].x,r=t[0].y;else if(t.length==2&&typeof t[0]=="number"&&typeof t[1]=="number")e=t[0],r=t[1];else throw o.Errors.ILLEGAL_PARAMETERS;return this.multiply(new st(1,0,0,1,e,r))}rotate(t){let e=Math.cos(t),r=Math.sin(t);return this.multiply(new st(e,r,-r,e,0,0))}scale(t,e){return this.multiply(new st(t,0,0,e,0,0))}equalTo(t){return!(!o.Utils.EQ(this.tx,t.tx)||!o.Utils.EQ(this.ty,t.ty)||!o.Utils.EQ(this.a,t.a)||!o.Utils.EQ(this.b,t.b)||!o.Utils.EQ(this.c,t.c)||!o.Utils.EQ(this.d,t.d))}};o.Matrix=st;var Gs=(...n)=>new o.Matrix(...n);o.matrix=Gs;var Ds=class _r{constructor(t,e){this.low=t,this.high=e}clone(){return new _r(this.low,this.high)}get max(){return this.clone()}less_than(t){return this.low<t.low||this.low==t.low&&this.high<t.high}equal_to(t){return this.low==t.low&&this.high==t.high}intersect(t){return!this.not_intersect(t)}not_intersect(t){return this.high<t.low||t.high<this.low}merge(t){return new _r(this.low===void 0?t.low:Math.min(this.low,t.low),this.high===void 0?t.high:Math.max(this.high,t.high))}output(){return[this.low,this.high]}static comparable_max(t,e){return t.merge(e)}static comparable_less_than(t,e){return t<e}},B=0,S=1,ht=class{constructor(t=void 0,e=void 0,r=null,i=null,a=null,s=S){this.left=r,this.right=i,this.parent=a,this.color=s,this.item={key:t,value:e},t&&t instanceof Array&&t.length==2&&!Number.isNaN(t[0])&&!Number.isNaN(t[1])&&(this.item.key=new Ds(Math.min(t[0],t[1]),Math.max(t[0],t[1]))),this.max=this.item.key?this.item.key.max:void 0}isNil(){return this.item.key===void 0&&this.item.value===void 0&&this.left===null&&this.right===null&&this.color===S}less_than(t){if(this.item.value===this.item.key&&t.item.value===t.item.key)return this.item.key.less_than(t.item.key);{let e=this.item.value&&t.item.value&&this.item.value.less_than?this.item.value.less_than(t.item.value):this.item.value<t.item.value;return this.item.key.less_than(t.item.key)||this.item.key.equal_to(t.item.key)&&e}}equal_to(t){if(this.item.value===this.item.key&&t.item.value===t.item.key)return this.item.key.equal_to(t.item.key);{let e=this.item.value&&t.item.value&&this.item.value.equal_to?this.item.value.equal_to(t.item.value):this.item.value==t.item.value;return this.item.key.equal_to(t.item.key)&&e}}intersect(t){return this.item.key.intersect(t.item.key)}copy_data(t){this.item.key=t.item.key.clone(),this.item.value=t.item.value&&t.item.value.clone?t.item.value.clone():t.item.value}update_max(){if(this.max=this.item.key?this.item.key.max:void 0,this.right&&this.right.max){let t=this.item.key.constructor.comparable_max;this.max=t(this.max,this.right.max)}if(this.left&&this.left.max){let t=this.item.key.constructor.comparable_max;this.max=t(this.max,this.left.max)}}not_intersect_left_subtree(t){let e=this.item.key.constructor.comparable_less_than,r=this.left.max.high!==void 0?this.left.max.high:this.left.max;return e(r,t.item.key.low)}not_intersect_right_subtree(t){let e=this.item.key.constructor.comparable_less_than,r=this.right.max.low!==void 0?this.right.max.low:this.right.item.key.low;return e(t.item.key.high,r)}},Nt=class{constructor(){this.root=null,this.nil_node=new ht}get size(){let t=0;return this.tree_walk(this.root,()=>t++),t}get keys(){let t=[];return this.tree_walk(this.root,e=>t.push(e.item.key.output?e.item.key.output():e.item.key)),t}get values(){let t=[];return this.tree_walk(this.root,e=>t.push(e.item.value)),t}get items(){let t=[];return this.tree_walk(this.root,e=>t.push({key:e.item.key.output?e.item.key.output():e.item.key,value:e.item.value})),t}isEmpty(){return this.root==null||this.root==this.nil_node}insert(t,e=t){if(t===void 0)return;let r=new ht(t,e,this.nil_node,this.nil_node,null,B);return this.tree_insert(r),this.recalc_max(r),r}exist(t,e=t){let r=new ht(t,e);return!!this.tree_search(this.root,r)}remove(t,e=t){let r=new ht(t,e),i=this.tree_search(this.root,r);return i&&this.tree_delete(i),i}search(t,e=(r,i)=>r===i?i.output():r){let r=new ht(t),i=[];return this.tree_search_interval(this.root,r,i),i.map(a=>e(a.item.value,a.item.key))}intersect_any(t){let e=new ht(t);return this.tree_find_any_interval(this.root,e)}forEach(t){this.tree_walk(this.root,e=>t(e.item.key,e.item.value))}map(t){let e=new Nt;return this.tree_walk(this.root,r=>e.insert(r.item.key,t(r.item.value,r.item.key))),e}recalc_max(t){let e=t;for(;e.parent!=null;)e.parent.update_max(),e=e.parent}tree_insert(t){let e=this.root,r=null;if(this.root==null||this.root==this.nil_node)this.root=t;else{for(;e!=this.nil_node;)r=e,t.less_than(e)?e=e.left:e=e.right;t.parent=r,t.less_than(r)?r.left=t:r.right=t}this.insert_fixup(t)}insert_fixup(t){let e,r;for(e=t;e!=this.root&&e.parent.color==B;)e.parent==e.parent.parent.left?(r=e.parent.parent.right,r.color==B?(e.parent.color=S,r.color=S,e.parent.parent.color=B,e=e.parent.parent):(e==e.parent.right&&(e=e.parent,this.rotate_left(e)),e.parent.color=S,e.parent.parent.color=B,this.rotate_right(e.parent.parent))):(r=e.parent.parent.left,r.color==B?(e.parent.color=S,r.color=S,e.parent.parent.color=B,e=e.parent.parent):(e==e.parent.left&&(e=e.parent,this.rotate_right(e)),e.parent.color=S,e.parent.parent.color=B,this.rotate_left(e.parent.parent)));this.root.color=S}tree_delete(t){let e,r;t.left==this.nil_node||t.right==this.nil_node?e=t:e=this.tree_successor(t),e.left!=this.nil_node?r=e.left:r=e.right,r.parent=e.parent,e==this.root?this.root=r:(e==e.parent.left?e.parent.left=r:e.parent.right=r,e.parent.update_max()),this.recalc_max(r),e!=t&&(t.copy_data(e),t.update_max(),this.recalc_max(t)),e.color==S&&this.delete_fixup(r)}delete_fixup(t){let e=t,r;for(;e!=this.root&&e.parent!=null&&e.color==S;)e==e.parent.left?(r=e.parent.right,r.color==B&&(r.color=S,e.parent.color=B,this.rotate_left(e.parent),r=e.parent.right),r.left.color==S&&r.right.color==S?(r.color=B,e=e.parent):(r.right.color==S&&(r.color=B,r.left.color=S,this.rotate_right(r),r=e.parent.right),r.color=e.parent.color,e.parent.color=S,r.right.color=S,this.rotate_left(e.parent),e=this.root)):(r=e.parent.left,r.color==B&&(r.color=S,e.parent.color=B,this.rotate_right(e.parent),r=e.parent.left),r.left.color==S&&r.right.color==S?(r.color=B,e=e.parent):(r.left.color==S&&(r.color=B,r.right.color=S,this.rotate_left(r),r=e.parent.left),r.color=e.parent.color,e.parent.color=S,r.left.color=S,this.rotate_right(e.parent),e=this.root));e.color=S}tree_search(t,e){if(!(t==null||t==this.nil_node))return e.equal_to(t)?t:e.less_than(t)?this.tree_search(t.left,e):this.tree_search(t.right,e)}tree_search_interval(t,e,r){t!=null&&t!=this.nil_node&&(t.left!=this.nil_node&&!t.not_intersect_left_subtree(e)&&this.tree_search_interval(t.left,e,r),t.intersect(e)&&r.push(t),t.right!=this.nil_node&&!t.not_intersect_right_subtree(e)&&this.tree_search_interval(t.right,e,r))}tree_find_any_interval(t,e){let r=!1;return t!=null&&t!=this.nil_node&&(t.left!=this.nil_node&&!t.not_intersect_left_subtree(e)&&(r=this.tree_find_any_interval(t.left,e)),r||(r=t.intersect(e)),!r&&t.right!=this.nil_node&&!t.not_intersect_right_subtree(e)&&(r=this.tree_find_any_interval(t.right,e))),r}local_minimum(t){let e=t;for(;e.left!=null&&e.left!=this.nil_node;)e=e.left;return e}local_maximum(t){let e=t;for(;e.right!=null&&e.right!=this.nil_node;)e=e.right;return e}tree_successor(t){let e,r,i;if(t.right!=this.nil_node)e=this.local_minimum(t.right);else{for(r=t,i=t.parent;i!=null&&i.right==r;)r=i,i=i.parent;e=i}return e}rotate_left(t){let e=t.right;t.right=e.left,e.left!=this.nil_node&&(e.left.parent=t),e.parent=t.parent,t==this.root?this.root=e:t==t.parent.left?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e,t!=null&&t!=this.nil_node&&t.update_max(),e=t.parent,e!=null&&e!=this.nil_node&&e.update_max()}rotate_right(t){let e=t.left;t.left=e.right,e.right!=this.nil_node&&(e.right.parent=t),e.parent=t.parent,t==this.root?this.root=e:t==t.parent.left?t.parent.left=e:t.parent.right=e,e.right=t,t.parent=e,t!=null&&t!=this.nil_node&&t.update_max(),e=t.parent,e!=null&&e!=this.nil_node&&e.update_max()}tree_walk(t,e){t!=null&&t!=this.nil_node&&(this.tree_walk(t.left,e),e(t),this.tree_walk(t.right,e))}testRedBlackProperty(){let t=!0;return this.tree_walk(this.root,function(e){e.color==B&&(e.left.color==S&&e.right.color==S||(t=!1))}),t}testBlackHeightProperty(t){let e=0,r=0,i=0;if(t.color==S&&e++,t.left!=this.nil_node?r=this.testBlackHeightProperty(t.left):r=1,t.right!=this.nil_node?i=this.testBlackHeightProperty(t.right):i=1,r!=i)throw new Error("Red-black height property violated");return e+=r,e}},En=class extends Set{constructor(t){super(t);this.index=new Nt,this.forEach(e=>this.index.insert(e))}add(t){let e=this.size;if(super.add(t),this.size>e){let r=this.index.insert(t.box,t)}return this}delete(t){let e=super.delete(t);return e&&this.index.remove(t.box,t),e}clear(){super.clear(),this.index=new Nt}search(t){return this.index.search(t)}hit(t){let e=new o.Box(t.x-1,t.y-1,t.x+1,t.y+1);return this.index.search(e).filter(i=>t.on(i))}svg(){return[...this].reduce((e,r)=>e+r.svg(),"")}};o.PlanarSet=En;var Ce=class{constructor(...t){if(this.x=0,this.y=0,t.length!==0){if(t.length===1&&t[0]instanceof Array&&t[0].length===2){let e=t[0];if(typeof e[0]=="number"&&typeof e[1]=="number"){this.x=e[0],this.y=e[1];return}}if(t.length===1&&t[0]instanceof Object&&t[0].name==="point"){let{x:e,y:r}=t[0];this.x=e,this.y=r;return}if(t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number"){this.x=t[0],this.y=t[1];return}throw o.Errors.ILLEGAL_PARAMETERS}}get box(){return new o.Box(this.x,this.y,this.x,this.y)}clone(){return new o.Point(this.x,this.y)}get vertices(){return[this.clone()]}equalTo(t){return o.Utils.EQ(this.x,t.x)&&o.Utils.EQ(this.y,t.y)}lessThan(t){return!!(o.Utils.LT(this.y,t.y)||o.Utils.EQ(this.y,t.y)&&o.Utils.LT(this.x,t.x))}rotate(t,e={x:0,y:0}){var r=e.x+(this.x-e.x)*Math.cos(t)-(this.y-e.y)*Math.sin(t),i=e.y+(this.x-e.x)*Math.sin(t)+(this.y-e.y)*Math.cos(t);return new o.Point(r,i)}translate(...t){if(t.length==1&&(t[0]instanceof o.Vector||!isNaN(t[0].x)&&!isNaN(t[0].y)))return new o.Point(this.x+t[0].x,this.y+t[0].y);if(t.length==2&&typeof t[0]=="number"&&typeof t[1]=="number")return new o.Point(this.x+t[0],this.y+t[1]);throw o.Errors.ILLEGAL_PARAMETERS}transform(t){return new o.Point(t.transform([this.x,this.y]))}projectionOn(t){if(this.equalTo(t.pt))return this.clone();let e=new o.Vector(this,t.pt);if(o.Utils.EQ_0(e.cross(t.norm)))return t.pt.clone();let r=e.dot(t.norm),i=t.norm.multiply(r);return this.translate(i)}leftTo(t){let e=new o.Vector(t.pt,this);return o.Utils.GT(e.dot(t.norm),0)}distanceTo(t){if(t instanceof Ce){let e=t.x-this.x,r=t.y-this.y;return[Math.sqrt(e*e+r*r),new o.Segment(this,t)]}if(t instanceof o.Line)return o.Distance.point2line(this,t);if(t instanceof o.Circle)return o.Distance.point2circle(this,t);if(t instanceof o.Segment)return o.Distance.point2segment(this,t);if(t instanceof o.Arc)return o.Distance.point2arc(this,t);if(t instanceof o.Polygon)return o.Distance.point2polygon(this,t);if(t instanceof o.PlanarSet)return o.Distance.shape2planarSet(this,t)}on(t){if(t instanceof o.Point)return this.equalTo(t);if(t instanceof o.Line)return t.contains(this);if(t instanceof o.Circle)return t.contains(this);if(t instanceof o.Segment)return t.contains(this);if(t instanceof o.Arc)return t.contains(this);if(t instanceof o.Polygon)return t.contains(this)}toJSON(){return Object.assign({},this,{name:"point"})}svg(t={}){let{r:e,stroke:r,strokeWidth:i,fill:a,id:s,className:l}=t,f=s&&s.length>0?`id="${s}"`:"",u=l&&l.length>0?`class="${l}"`:"";return`
<circle cx="${this.x}" cy="${this.y}" r="${e||3}" stroke="${r||"black"}" stroke-width="${i||1}" fill="${a||"red"}" ${f} ${u} />`}};o.Point=Ce;var $s=(...n)=>new o.Point(...n);o.point=$s;var Tn=class{constructor(...t){if(this.x=0,this.y=0,t.length!==0){if(t.length===1&&t[0]instanceof Array&&t[0].length===2){let e=t[0];if(typeof e[0]=="number"&&typeof e[1]=="number"){this.x=e[0],this.y=e[1];return}}if(t.length===1&&t[0]instanceof Object&&t[0].name==="vector"){let{x:e,y:r}=t[0];this.x=e,this.y=r;return}if(t.length===2){let e=t[0],r=t[1];if(typeof e=="number"&&typeof r=="number"){this.x=e,this.y=r;return}if(e instanceof o.Point&&r instanceof o.Point){this.x=r.x-e.x,this.y=r.y-e.y;return}}throw o.Errors.ILLEGAL_PARAMETERS}}clone(){return new o.Vector(this.x,this.y)}get slope(){let t=Math.atan2(this.y,this.x);return t<0&&(t=2*Math.PI+t),t}get length(){return Math.sqrt(this.dot(this))}equalTo(t){return o.Utils.EQ(this.x,t.x)&&o.Utils.EQ(this.y,t.y)}multiply(t){return new o.Vector(t*this.x,t*this.y)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}normalize(){if(!o.Utils.EQ_0(this.length))return new o.Vector(this.x/this.length,this.y/this.length);throw o.Errors.ZERO_DIVISION}rotate(t){let r=new o.Point(this.x,this.y).rotate(t);return new o.Vector(r.x,r.y)}rotate90CCW(){return new o.Vector(-this.y,this.x)}rotate90CW(){return new o.Vector(this.y,-this.x)}invert(){return new o.Vector(-this.x,-this.y)}add(t){return new o.Vector(this.x+t.x,this.y+t.y)}subtract(t){return new o.Vector(this.x-t.x,this.y-t.y)}angleTo(t){let e=this.normalize(),r=t.normalize(),i=Math.atan2(e.cross(r),e.dot(r));return i<0&&(i+=2*Math.PI),i}projectionOn(t){let e=t.normalize(),r=this.dot(e);return e.multiply(r)}toJSON(){return Object.assign({},this,{name:"vector"})}};o.Vector=Tn;var Ws=(...n)=>new o.Vector(...n);o.vector=Ws;var At=class{constructor(...t){if(this.ps=new o.Point,this.pe=new o.Point,t.length!==0){if(t.length===1&&t[0]instanceof Array&&t[0].length===4){let e=t[0];this.ps=new o.Point(e[0],e[1]),this.pe=new o.Point(e[2],e[3]);return}if(t.length===1&&t[0]instanceof Object&&t[0].name==="segment"){let{ps:e,pe:r}=t[0];this.ps=new o.Point(e.x,e.y),this.pe=new o.Point(r.x,r.y);return}if(t.length===1&&t[0]instanceof o.Point){this.ps=t[0].clone();return}if(t.length===2&&t[0]instanceof o.Point&&t[1]instanceof o.Point){this.ps=t[0].clone(),this.pe=t[1].clone();return}if(t.length===4){this.ps=new o.Point(t[0],t[1]),this.pe=new o.Point(t[2],t[3]);return}throw o.Errors.ILLEGAL_PARAMETERS}}clone(){return new o.Segment(this.start,this.end)}get start(){return this.ps}get end(){return this.pe}get vertices(){return[this.ps.clone(),this.pe.clone()]}get length(){return this.start.distanceTo(this.end)[0]}get slope(){return new o.Vector(this.start,this.end).slope}get box(){return new o.Box(Math.min(this.start.x,this.end.x),Math.min(this.start.y,this.end.y),Math.max(this.start.x,this.end.x),Math.max(this.start.y,this.end.y))}equalTo(t){return this.ps.equalTo(t.ps)&&this.pe.equalTo(t.pe)}contains(t){return o.Utils.EQ_0(this.distanceToPoint(t))}intersect(t){if(t instanceof o.Point)return this.contains(t)?[t]:[];if(t instanceof o.Line)return Se(this,t);if(t instanceof o.Segment)return te(this,t);if(t instanceof o.Circle)return Ae(this,t);if(t instanceof o.Box)return bs(this,t);if(t instanceof o.Arc)return xt(this,t);if(t instanceof o.Polygon)return Er(this,t)}distanceTo(t){if(t instanceof o.Point){let[e,r]=o.Distance.point2segment(t,this);return r=r.reverse(),[e,r]}if(t instanceof o.Circle){let[e,r]=o.Distance.segment2circle(this,t);return[e,r]}if(t instanceof o.Line){let[e,r]=o.Distance.segment2line(this,t);return[e,r]}if(t instanceof o.Segment){let[e,r]=o.Distance.segment2segment(this,t);return[e,r]}if(t instanceof o.Arc){let[e,r]=o.Distance.segment2arc(this,t);return[e,r]}if(t instanceof o.Polygon){let[e,r]=o.Distance.shape2polygon(this,t);return[e,r]}if(t instanceof o.PlanarSet){let[e,r]=o.Distance.shape2planarSet(this,t);return[e,r]}}tangentInStart(){return new o.Vector(this.start,this.end).normalize()}tangentInEnd(){return new o.Vector(this.end,this.start).normalize()}reverse(){return new At(this.end,this.start)}split(t){return this.start.equalTo(t)?[null,this.clone()]:this.end.equalTo(t)?[this.clone(),null]:[new o.Segment(this.start,t),new o.Segment(t,this.end)]}middle(){return new o.Point((this.start.x+this.end.x)/2,(this.start.y+this.end.y)/2)}pointAtLength(t){if(t>this.length||t<0)return null;if(t==0)return this.start;if(t==this.length)return this.end;let e=t/this.length;return new o.Point((this.end.x-this.start.x)*e+this.start.x,(this.end.y-this.start.y)*e+this.start.y)}distanceToPoint(t){let[e,...r]=o.Distance.point2segment(t,this);return e}definiteIntegral(t=0){let e=this.end.x-this.start.x,r=this.start.y-t,i=this.end.y-t;return e*(r+i)/2}translate(...t){return new At(this.ps.translate(...t),this.pe.translate(...t))}rotate(t=0,e=new o.Point){let r=new o.Matrix;return r=r.translate(e.x,e.y).rotate(t).translate(-e.x,-e.y),this.transform(r)}transform(t=new o.Matrix){return new At(this.ps.transform(t),this.pe.transform(t))}isZeroLength(){return this.ps.equalTo(this.pe)}sortPoints(t){return new o.Line(this.start,this.end).sortPoints(t)}toJSON(){return Object.assign({},this,{name:"segment"})}svg(t={}){let{stroke:e,strokeWidth:r,id:i,className:a}=t,s=i&&i.length>0?`id="${i}"`:"",l=a&&a.length>0?`class="${a}"`:"";return`
<line x1="${this.start.x}" y1="${this.start.y}" x2="${this.end.x}" y2="${this.end.y}" stroke="${e||"black"}" stroke-width="${r||1}" ${s} ${l} />`}};o.Segment=At;var qs=(...n)=>new o.Segment(...n);o.segment=qs;var{vector:xe}=o,Oe=class{constructor(...t){if(this.pt=new o.Point,this.norm=new o.Vector(0,1),t.length!=0){if(t.length==1&&t[0]instanceof Object&&t[0].name==="line"){let{pt:e,norm:r}=t[0];this.pt=new o.Point(e),this.norm=new o.Vector(r);return}if(t.length==2){let e=t[0],r=t[1];if(e instanceof o.Point&&r instanceof o.Point){this.pt=e,this.norm=Oe.points2norm(e,r),this.norm.dot(xe(this.pt.x,this.pt.y))>=0&&this.norm.invert();return}if(e instanceof o.Point&&r instanceof o.Vector){if(o.Utils.EQ_0(r.x)&&o.Utils.EQ_0(r.y))throw o.Errors.ILLEGAL_PARAMETERS;this.pt=e.clone(),this.norm=r.clone(),this.norm=this.norm.normalize(),this.norm.dot(xe(this.pt.x,this.pt.y))>=0&&this.norm.invert();return}if(e instanceof o.Vector&&r instanceof o.Point){if(o.Utils.EQ_0(e.x)&&o.Utils.EQ_0(e.y))throw o.Errors.ILLEGAL_PARAMETERS;this.pt=r.clone(),this.norm=e.clone(),this.norm=this.norm.normalize(),this.norm.dot(xe(this.pt.x,this.pt.y))>=0&&this.norm.invert();return}}throw o.Errors.ILLEGAL_PARAMETERS}}clone(){return new o.Line(this.pt,this.norm)}get start(){}get end(){}get length(){return Number.POSITIVE_INFINITY}get box(){return new o.Box(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY)}get middle(){}get slope(){return new o.Vector(this.norm.y,-this.norm.x).slope}get standard(){let t=this.norm.x,e=this.norm.y,r=this.norm.dot(this.pt);return[t,e,r]}parallelTo(t){return o.Utils.EQ_0(this.norm.cross(t.norm))}incidentTo(t){return this.parallelTo(t)&&this.pt.on(t)}contains(t){if(this.pt.equalTo(t))return!0;let e=new o.Vector(this.pt,t);return o.Utils.EQ_0(this.norm.dot(e))}coord(t){return xe(t.x,t.y).cross(this.norm)}intersect(t){if(t instanceof o.Point)return this.contains(t)?[t]:[];if(t instanceof o.Line)return Ie(this,t);if(t instanceof o.Circle)return Rt(this,t);if(t instanceof o.Box)return Qt(this,t);if(t instanceof o.Segment)return Se(t,this);if(t instanceof o.Arc)return br(this,t);if(t instanceof o.Polygon)return Pe(this,t)}distanceTo(t){if(t instanceof o.Point){let[e,r]=o.Distance.point2line(t,this);return r=r.reverse(),[e,r]}if(t instanceof o.Circle){let[e,r]=o.Distance.circle2line(t,this);return r=r.reverse(),[e,r]}if(t instanceof o.Segment){let[e,r]=o.Distance.segment2line(t,this);return[e,r.reverse()]}if(t instanceof o.Arc){let[e,r]=o.Distance.arc2line(t,this);return[e,r.reverse()]}if(t instanceof o.Polygon){let[e,r]=o.Distance.shape2polygon(this,t);return[e,r]}}split(t){if(t instanceof o.Point)return[new o.Ray(t,this.norm.invert()),new o.Ray(t,this.norm)];{let e=new o.Multiline([this]),r=this.sortPoints(t);return e.split(r),e.toShapes()}}sortPoints(t){return t.slice().sort((e,r)=>this.coord(e)<this.coord(r)?-1:this.coord(e)>this.coord(r)?1:0)}toJSON(){return Object.assign({},this,{name:"line"})}svg(t,e={}){let r=Qt(this,t);if(r.length===0)return"";let i=r[0],a=r.length==2?r[1]:r.find(l=>!l.equalTo(i));return a===void 0&&(a=i),new o.Segment(i,a).svg(e)}static points2norm(t,e){if(t.equalTo(e))throw o.Errors.ILLEGAL_PARAMETERS;return new o.Vector(t,e).normalize().rotate90CCW()}};o.Line=Oe;var js=(...n)=>new o.Line(...n);o.line=js;var In=class{constructor(...t){if(this.pc=new o.Point,this.r=1,t.length==1&&t[0]instanceof Object&&t[0].name==="circle"){let{pc:e,r}=t[0];this.pc=new o.Point(e),this.r=r;return}else{let[e,r]=[...t];e&&e instanceof o.Point&&(this.pc=e.clone()),r!==void 0&&(this.r=r);return}throw o.Errors.ILLEGAL_PARAMETERS}clone(){return new o.Circle(this.pc.clone(),this.r)}get center(){return this.pc}get box(){return new o.Box(this.pc.x-this.r,this.pc.y-this.r,this.pc.x+this.r,this.pc.y+this.r)}contains(t){if(t instanceof o.Point)return o.Utils.LE(t.distanceTo(this.center)[0],this.r);if(t instanceof o.Segment)return o.Utils.LE(t.start.distanceTo(this.center)[0],this.r)&&o.Utils.LE(t.end.distanceTo(this.center)[0],this.r);if(t instanceof o.Arc)return this.intersect(t).length===0&&o.Utils.LE(t.start.distanceTo(this.center)[0],this.r)&&o.Utils.LE(t.end.distanceTo(this.center)[0],this.r);if(t instanceof o.Circle)return this.intersect(t).length===0&&o.Utils.LE(t.r,this.r)&&o.Utils.LE(t.center.distanceTo(this.center)[0],this.r)}toArc(t=!0){return new o.Arc(this.center,this.r,Math.PI,-Math.PI,t)}intersect(t){if(t instanceof o.Point)return this.contains(t)?[t]:[];if(t instanceof o.Line)return Rt(t,this);if(t instanceof o.Segment)return Ae(t,this);if(t instanceof o.Circle)return mn(t,this);if(t instanceof o.Box)return vs(this,t);if(t instanceof o.Arc)return wr(t,this);if(t instanceof o.Polygon)return _n(this,t)}distanceTo(t){if(t instanceof o.Point){let[e,r]=o.Distance.point2circle(t,this);return r=r.reverse(),[e,r]}if(t instanceof o.Circle){let[e,r]=o.Distance.circle2circle(this,t);return[e,r]}if(t instanceof o.Line){let[e,r]=o.Distance.circle2line(this,t);return[e,r]}if(t instanceof o.Segment){let[e,r]=o.Distance.segment2circle(t,this);return r=r.reverse(),[e,r]}if(t instanceof o.Arc){let[e,r]=o.Distance.arc2circle(t,this);return r=r.reverse(),[e,r]}if(t instanceof o.Polygon){let[e,r]=o.Distance.shape2polygon(this,t);return[e,r]}if(t instanceof o.PlanarSet){let[e,r]=o.Distance.shape2planarSet(this,t);return[e,r]}}toJSON(){return Object.assign({},this,{name:"circle"})}svg(t={}){let{stroke:e,strokeWidth:r,fill:i,fillOpacity:a,id:s,className:l}=t,f=s&&s.length>0?`id="${s}"`:"",u=l&&l.length>0?`class="${l}"`:"";return`
<circle cx="${this.pc.x}" cy="${this.pc.y}" r="${this.r}" stroke="${e||"black"}" stroke-width="${r||1}" fill="${i||"none"}" fill-opacity="${a||1}" ${f} ${u} />`}};o.Circle=In;var zs=(...n)=>new o.Circle(...n);o.circle=zs;var Sn=class{constructor(...t){if(this.pc=new o.Point,this.r=1,this.startAngle=0,this.endAngle=2*Math.PI,this.counterClockwise=o.CCW,t.length!=0){if(t.length==1&&t[0]instanceof Object&&t[0].name==="arc"){let{pc:e,r,startAngle:i,endAngle:a,counterClockwise:s}=t[0];this.pc=new o.Point(e.x,e.y),this.r=r,this.startAngle=i,this.endAngle=a,this.counterClockwise=s;return}else{let[e,r,i,a,s]=[...t];e&&e instanceof o.Point&&(this.pc=e.clone()),r!==void 0&&(this.r=r),i!==void 0&&(this.startAngle=i),a!==void 0&&(this.endAngle=a),s!==void 0&&(this.counterClockwise=s);return}throw o.Errors.ILLEGAL_PARAMETERS}}clone(){return new o.Arc(this.pc.clone(),this.r,this.startAngle,this.endAngle,this.counterClockwise)}get sweep(){if(o.Utils.EQ(this.startAngle,this.endAngle))return 0;if(o.Utils.EQ(Math.abs(this.startAngle-this.endAngle),o.PIx2))return o.PIx2;let t;return this.counterClockwise?t=o.Utils.GT(this.endAngle,this.startAngle)?this.endAngle-this.startAngle:this.endAngle-this.startAngle+o.PIx2:t=o.Utils.GT(this.startAngle,this.endAngle)?this.startAngle-this.endAngle:this.startAngle-this.endAngle+o.PIx2,o.Utils.GT(t,o.PIx2)&&(t-=o.PIx2),o.Utils.LT(t,0)&&(t+=o.PIx2),t}get start(){return new o.Point(this.pc.x+this.r,this.pc.y).rotate(this.startAngle,this.pc)}get end(){return new o.Point(this.pc.x+this.r,this.pc.y).rotate(this.endAngle,this.pc)}get center(){return this.pc.clone()}get vertices(){return[this.start.clone(),this.end.clone()]}get length(){return Math.abs(this.sweep*this.r)}get box(){let e=this.breakToFunctional().reduce((r,i)=>r.merge(i.start.box),new o.Box);return e=e.merge(this.end.box),e}contains(t){if(!o.Utils.EQ(this.pc.distanceTo(t)[0],this.r))return!1;if(t.equalTo(this.start))return!0;let e=new o.Vector(this.pc,t).slope,r=new o.Arc(this.pc,this.r,this.startAngle,e,this.counterClockwise);return o.Utils.LE(r.length,this.length)}split(t){if(this.start.equalTo(t))return[null,this.clone()];if(this.end.equalTo(t))return[this.clone(),null];let e=new o.Vector(this.pc,t).slope;return[new o.Arc(this.pc,this.r,this.startAngle,e,this.counterClockwise),new o.Arc(this.pc,this.r,e,this.endAngle,this.counterClockwise)]}middle(){let t=this.counterClockwise?this.startAngle+this.sweep/2:this.startAngle-this.sweep/2;return new o.Arc(this.pc,this.r,this.startAngle,t,this.counterClockwise).end}pointAtLength(t){if(t>this.length||t<0)return null;if(t==0)return this.start;if(t==this.length)return this.end;let e=t/this.length,r=this.counterClockwise?this.startAngle+this.sweep*e:this.startAngle-this.sweep*e;return new o.Arc(this.pc,this.r,this.startAngle,r,this.counterClockwise).end}chordHeight(){return(1-Math.cos(Math.abs(this.sweep/2)))*this.r}intersect(t){if(t instanceof o.Point)return this.contains(t)?[t]:[];if(t instanceof o.Line)return br(t,this);if(t instanceof o.Circle)return wr(this,t);if(t instanceof o.Segment)return xt(t,this);if(t instanceof o.Box)return ws(this,t);if(t instanceof o.Arc)return vr(this,t);if(t instanceof o.Polygon)return Tr(this,t)}distanceTo(t){if(t instanceof o.Point){let[e,r]=o.Distance.point2arc(t,this);return r=r.reverse(),[e,r]}if(t instanceof o.Circle){let[e,r]=o.Distance.arc2circle(this,t);return[e,r]}if(t instanceof o.Line){let[e,r]=o.Distance.arc2line(this,t);return[e,r]}if(t instanceof o.Segment){let[e,r]=o.Distance.segment2arc(t,this);return r=r.reverse(),[e,r]}if(t instanceof o.Arc){let[e,r]=o.Distance.arc2arc(this,t);return[e,r]}if(t instanceof o.Polygon){let[e,r]=o.Distance.shape2polygon(this,t);return[e,r]}if(t instanceof o.PlanarSet){let[e,r]=o.Distance.shape2planarSet(this,t);return[e,r]}}breakToFunctional(){let t=[],e=[0,Math.PI/2,2*Math.PI/2,3*Math.PI/2],r=[this.pc.translate(this.r,0),this.pc.translate(0,this.r),this.pc.translate(-this.r,0),this.pc.translate(0,-this.r)],i=[];for(let a=0;a<4;a++)r[a].on(this)&&i.push(new o.Arc(this.pc,this.r,this.startAngle,e[a],this.counterClockwise));if(i.length==0)t.push(this.clone());else{i.sort((l,f)=>l.length-f.length);for(let l=0;l<i.length;l++){let f=t.length>0?t[t.length-1]:void 0,u;f?u=new o.Arc(this.pc,this.r,f.endAngle,i[l].endAngle,this.counterClockwise):u=new o.Arc(this.pc,this.r,this.startAngle,i[l].endAngle,this.counterClockwise),o.Utils.EQ_0(u.length)||t.push(u.clone())}let a=t.length>0?t[t.length-1]:void 0,s;a?s=new o.Arc(this.pc,this.r,a.endAngle,this.endAngle,this.counterClockwise):s=new o.Arc(this.pc,this.r,this.startAngle,this.endAngle,this.counterClockwise),!o.Utils.EQ_0(s.length)&&!o.Utils.EQ(s.sweep,2*Math.PI)&&t.push(s.clone())}return t}tangentInStart(){let t=new o.Vector(this.pc,this.start),e=this.counterClockwise?Math.PI/2:-Math.PI/2;return t.rotate(e).normalize()}tangentInEnd(){let t=new o.Vector(this.pc,this.end),e=this.counterClockwise?-Math.PI/2:Math.PI/2;return t.rotate(e).normalize()}reverse(){return new o.Arc(this.pc,this.r,this.endAngle,this.startAngle,!this.counterClockwise)}translate(...t){let e=this.clone();return e.pc=this.pc.translate(...t),e}rotate(t=0,e=new o.Point){let r=new o.Matrix;return r=r.translate(e.x,e.y).rotate(t).translate(-e.x,-e.y),this.transform(r)}scale(t=1,e=1){let r=new o.Matrix;return r=r.scale(t,e),this.transform(r)}transform(t=new o.Matrix){let e=this.start.transform(t),r=this.end.transform(t),i=this.pc.transform(t),a=this.counterClockwise;return t.a*t.d<0&&(a=!a),o.Arc.arcSE(i,e,r,a)}static arcSE(t,e,r,i){let{vector:a}=o,s=a(t,e).slope,l=a(t,r).slope;o.Utils.EQ(s,l)&&(l+=2*Math.PI,i=!0);let f=a(t,e).length;return new o.Arc(t,f,s,l,i)}definiteIntegral(t=0){return this.breakToFunctional().reduce((i,a)=>i+a.circularSegmentDefiniteIntegral(t),0)}circularSegmentDefiniteIntegral(t){let e=new o.Line(this.start,this.end),r=this.pc.leftTo(e),a=new o.Segment(this.start,this.end).definiteIntegral(t),s=this.circularSegmentArea();return r?a-s:a+s}circularSegmentArea(){return .5*this.r*this.r*(this.sweep-Math.sin(this.sweep))}sortPoints(t){let{vector:e}=o;return t.slice().sort((r,i)=>{let a=e(this.pc,r).slope,s=e(this.pc,i).slope;return a<s?-1:a>s?1:0})}toJSON(){return Object.assign({},this,{name:"arc"})}svg(t={}){let e=this.sweep<=Math.PI?"0":"1",r=this.counterClockwise?"1":"0",{stroke:i,strokeWidth:a,fill:s,id:l,className:f}=t,u=l&&l.length>0?`id="${l}"`:"",d=f&&f.length>0?`class="${f}"`:"";return o.Utils.EQ(this.sweep,2*Math.PI)?new o.Circle(this.pc,this.r).svg(t):`
<path d="M${this.start.x},${this.start.y}
                             A${this.r},${this.r} 0 ${e},${r} ${this.end.x},${this.end.y}"
                    stroke="${i||"black"}" stroke-width="${a||1}" fill="${s||"none"}" ${u} ${d} />`}};o.Arc=Sn;var Ys=(...n)=>new o.Arc(...n);o.arc=Ys;var Jt=class{constructor(t=void 0,e=void 0,r=void 0,i=void 0){this.xmin=t,this.ymin=e,this.xmax=r,this.ymax=i}clone(){return new Jt(this.xmin,this.ymin,this.xmax,this.ymax)}get low(){return new o.Point(this.xmin,this.ymin)}get high(){return new o.Point(this.xmax,this.ymax)}get max(){return this.clone()}get center(){return new o.Point((this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)}get width(){return Math.abs(this.xmax-this.xmin)}get height(){return Math.abs(this.ymax-this.ymin)}get box(){return this.clone()}not_intersect(t){return this.xmax<t.xmin||this.xmin>t.xmax||this.ymax<t.ymin||this.ymin>t.ymax}intersect(t){return!this.not_intersect(t)}merge(t){return new Jt(this.xmin===void 0?t.xmin:Math.min(this.xmin,t.xmin),this.ymin===void 0?t.ymin:Math.min(this.ymin,t.ymin),this.xmax===void 0?t.xmax:Math.max(this.xmax,t.xmax),this.ymax===void 0?t.ymax:Math.max(this.ymax,t.ymax))}less_than(t){return!!(this.low.lessThan(t.low)||this.low.equalTo(t.low)&&this.high.lessThan(t.high))}equal_to(t){return this.low.equalTo(t.low)&&this.high.equalTo(t.high)}output(){return this.clone()}static comparable_max(t,e){return t.merge(e)}static comparable_less_than(t,e){return t.lessThan(e)}set(t,e,r,i){this.xmin=t,this.ymin=e,this.xmax=r,this.ymax=i}toPoints(){return[new o.Point(this.xmin,this.ymin),new o.Point(this.xmax,this.ymin),new o.Point(this.xmax,this.ymax),new o.Point(this.xmin,this.ymax)]}toSegments(){let t=this.toPoints();return[new o.Segment(t[0],t[1]),new o.Segment(t[1],t[2]),new o.Segment(t[2],t[3]),new o.Segment(t[3],t[0])]}svg(t={}){let{stroke:e,strokeWidth:r,fill:i,id:a,className:s}=t,l=a&&a.length>0?`id="${a}"`:"",f=s&&s.length>0?`class="${s}"`:"",u=this.xmax-this.xmin,d=this.ymax-this.ymin;return`
<rect x="${this.xmin}" y="${this.ymin}" width=${u} height=${d} stroke="${e||"black"}" stroke-width="${r||1}" fill="${i||"none"}" ${l} ${f} />`}};o.Box=Jt;var Xs=(...n)=>new o.Box(...n);o.box=Xs;var An=class{constructor(t){this.shape=t,this.next=void 0,this.prev=void 0,this.face=void 0,this.arc_length=0,this.bvStart=void 0,this.bvEnd=void 0,this.bv=void 0,this.overlap=void 0}get start(){return this.shape.start}get end(){return this.shape.end}get length(){return this.shape.length}get box(){return this.shape.box}isSegment(){return this.shape instanceof o.Segment}isArc(){return this.shape instanceof o.Arc}middle(){return this.shape.middle()}pointAtLength(t){return this.shape.pointAtLength(t)}contains(t){return this.shape.contains(t)}setInclusion(t){if(this.bv!==void 0)return this.bv;if(this.shape instanceof o.Line||this.shape instanceof o.Ray)return this.bv=o.OUTSIDE,this.bv;if(this.bvStart===void 0&&(this.bvStart=Xt(t,this.start)),this.bvEnd===void 0&&(this.bvEnd=Xt(t,this.end)),this.bvStart===o.OUTSIDE||this.bvEnd==o.OUTSIDE)this.bv=o.OUTSIDE;else if(this.bvStart===o.INSIDE||this.bvEnd==o.INSIDE)this.bv=o.INSIDE;else{let e=Xt(t,this.middle());this.bv=e}return this.bv}setOverlap(t){let e,r=this.shape,i=t.shape;r instanceof o.Segment&&i instanceof o.Segment?r.start.equalTo(i.start)&&r.end.equalTo(i.end)?e=o.OVERLAP_SAME:r.start.equalTo(i.end)&&r.end.equalTo(i.start)&&(e=o.OVERLAP_OPPOSITE):(r instanceof o.Arc&&i instanceof o.Arc||r instanceof o.Segment&&i instanceof o.Arc||r instanceof o.Arc&&i instanceof o.Segment)&&(r.start.equalTo(i.start)&&r.end.equalTo(i.end)&&r.middle().equalTo(i.middle())?e=o.OVERLAP_SAME:r.start.equalTo(i.end)&&r.end.equalTo(i.start)&&r.middle().equalTo(i.middle())&&(e=o.OVERLAP_OPPOSITE)),this.overlap===void 0&&(this.overlap=e),t.overlap===void 0&&(t.overlap=e)}svg(){if(this.shape instanceof o.Segment)return` L${this.shape.end.x},${this.shape.end.y}`;if(this.shape instanceof o.Arc){let t=this.shape,e,r=t.counterClockwise?"1":"0";if(o.Utils.EQ(t.sweep,2*Math.PI)){let i=t.counterClockwise?1:-1,a=new o.Arc(t.pc,t.r,t.startAngle,t.startAngle+i*Math.PI,t.counterClockwise),s=new o.Arc(t.pc,t.r,t.startAngle+i*Math.PI,t.endAngle,t.counterClockwise);return e="0",` A${a.r},${a.r} 0 ${e},${r} ${a.end.x},${a.end.y}
                    A${s.r},${s.r} 0 ${e},${r} ${s.end.x},${s.end.y}`}else return e=t.sweep<=Math.PI?"0":"1",` A${t.r},${t.r} 0 ${e},${r} ${t.end.x},${t.end.y}`}}toJSON(){return this.shape.toJSON()}};o.Edge=An;var Pn=class extends Ee{constructor(t,e){super(t,e);this.setCircularLinks()}setCircularLinks(){this.isEmpty()||(this.last.next=this.first,this.first.prev=this.last)}[Symbol.iterator](){let t;return{next:()=>{let e=t||this.first,r=this.first?t?t===this.first:!1:!0;return t=e?e.next:void 0,{value:e,done:r}}}}append(t){return super.append(t),this.setCircularLinks(),this}insert(t,e){return super.insert(t,e),this.setCircularLinks(),this}remove(t){return super.remove(t),this}},pt=class extends Pn{constructor(t,...e){super();if(this._box=void 0,this._orientation=void 0,e.length!=0){if(e.length==1){if(e[0]instanceof Array){let r=e[0];if(r.length==0)return;if(r.every(i=>i instanceof o.Point)){let i=pt.points2segments(r);this.shapes2face(t.edges,i)}else if(r.every(i=>i instanceof Array&&i.length===2)){let i=r.map(s=>new o.Point(s[0],s[1])),a=pt.points2segments(i);this.shapes2face(t.edges,a)}else if(r.every(i=>i instanceof o.Segment||i instanceof o.Arc))this.shapes2face(t.edges,r);else if(r.every(i=>i.name==="segment"||i.name==="arc")){let i=[];for(let a of r){let s;a.name==="segment"?s=new o.Segment(a):s=new o.Arc(a),i.push(s)}this.shapes2face(t.edges,i)}}else if(e[0]instanceof pt){let r=e[0];this.first=r.first,this.last=r.last;for(let i of r)t.edges.add(i)}else if(e[0]instanceof o.Circle)this.shapes2face(t.edges,[e[0].toArc(o.CCW)]);else if(e[0]instanceof o.Box){let r=e[0];this.shapes2face(t.edges,[new o.Segment(new o.Point(r.xmin,r.ymin),new o.Point(r.xmax,r.ymin)),new o.Segment(new o.Point(r.xmax,r.ymin),new o.Point(r.xmax,r.ymax)),new o.Segment(new o.Point(r.xmax,r.ymax),new o.Point(r.xmin,r.ymax)),new o.Segment(new o.Point(r.xmin,r.ymax),new o.Point(r.xmin,r.ymin))])}}e.length==2&&e[0]instanceof o.Edge&&e[1]instanceof o.Edge&&(this.first=e[0],this.last=e[1],this.last.next=this.first,this.first.prev=this.last,this.setArcLength())}}get edges(){return this.toArray()}get shapes(){return this.edges.map(t=>t.shape.clone())}get box(){if(this._box===void 0){let t=new o.Box;for(let e of this)t=t.merge(e.box);this._box=t}return this._box}get perimeter(){return this.last.arc_length+this.last.length}pointAtLength(t){if(t>this.perimeter||t<0)return null;let e=null;for(let r of this)if(t>=r.arc_length&&(r===this.last||t<r.next.arc_length)){e=r.pointAtLength(t-r.arc_length);break}return e}static points2segments(t){let e=[];for(let r=0;r<t.length;r++)t[r].equalTo(t[(r+1)%t.length])||e.push(new o.Segment(t[r],t[(r+1)%t.length]));return e}shapes2face(t,e){for(let r of e){let i=new o.Edge(r);this.append(i),t.add(i)}}append(t){return super.append(t),this.setOneEdgeArcLength(t),t.face=this,this}insert(t,e){return super.insert(t,e),this.setOneEdgeArcLength(t),t.face=this,this}remove(t){return super.remove(t),this.setArcLength(),this}reverse(){let t=[],e=this.last;do e.shape=e.shape.reverse(),t.push(e),e=e.prev;while(e!==this.last);this.first=void 0,this.last=void 0;for(let r of t)this.first===void 0?(r.prev=r,r.next=r,this.first=r,this.last=r):(r.prev=this.last,this.last.next=r,this.last=r,this.last.next=this.first,this.first.prev=this.last),this.setOneEdgeArcLength(r);this._orientation!==void 0&&(this._orientation=void 0,this._orientation=this.orientation())}setArcLength(){for(let t of this)this.setOneEdgeArcLength(t),t.face=this}setOneEdgeArcLength(t){t===this.first?t.arc_length=0:t.arc_length=t.prev.arc_length+t.prev.length}area(){return Math.abs(this.signedArea())}signedArea(){let t=0,e=this.box.ymin;for(let r of this)t+=r.shape.definiteIntegral(e);return t}orientation(){if(this._orientation===void 0){let t=this.signedArea();o.Utils.EQ_0(t)?this._orientation=o.ORIENTATION.NOT_ORIENTABLE:o.Utils.LT(t,0)?this._orientation=o.ORIENTATION.CCW:this._orientation=o.ORIENTATION.CW}return this._orientation}isSimple(t){return pt.getSelfIntersections(this,t,!0).length==0}static getSelfIntersections(t,e,r=!1){let i=[];for(let a of t){let s=e.search(a.box);for(let l of s){if(a===l||l.face!==t||a.shape instanceof o.Segment&&l.shape instanceof o.Segment&&(a.next===l||a.prev===l))continue;let f=a.shape.intersect(l.shape);for(let u of f)if(!(u.equalTo(a.start)&&u.equalTo(l.end)&&l===a.prev)&&!(u.equalTo(a.end)&&u.equalTo(l.start)&&l===a.next)&&(i.push(u),r))break;if(i.length>0&&r)break}if(i.length>0&&r)break}return i}findEdgeByPoint(t){let e;for(let r of this)if(r.shape.contains(t)){e=r;break}return e}toPolygon(){return new o.Polygon(this.shapes)}toJSON(){return this.edges.map(t=>t.toJSON())}svg(){let t=`
M${this.first.start.x},${this.first.start.y}`;for(let e of this)t+=e.svg();return t+=" z",t}};o.Face=pt;var Le=class{constructor(...t){if(this.pt=new o.Point,this.norm=new o.Vector(0,1),t.length!=0&&(t.length>=1&&t[0]instanceof o.Point&&(this.pt=t[0].clone()),t.length!==1)){if(t.length===2&&t[1]instanceof o.Vector){this.norm=t[1].clone();return}throw o.Errors.ILLEGAL_PARAMETERS}}clone(){return new Le(this.pt,this.norm)}get slope(){return new o.Vector(this.norm.y,-this.norm.x).slope}get box(){let t=this.slope;return new o.Box(t>Math.PI/2&&t<3*Math.PI/2?Number.NEGATIVE_INFINITY:this.pt.x,t>=0&&t<=Math.PI?this.pt.y:Number.NEGATIVE_INFINITY,t>=Math.PI/2&&t<=3*Math.PI/2?this.pt.x:Number.POSITIVE_INFINITY,t>=Math.PI&&t<=2*Math.PI||t==0?this.pt.y:Number.POSITIVE_INFINITY)}get start(){return this.pt}get end(){}get length(){return Number.POSITIVE_INFINITY}contains(t){if(this.pt.equalTo(t))return!0;let e=new o.Vector(this.pt,t);return o.Utils.EQ_0(this.norm.dot(e))&&o.Utils.GE(e.cross(this.norm),0)}split(t){return this.contains(t)?this.pt.equalTo(t)?[this]:[new o.Segment(this.pt,t),new o.Ray(t,this.norm)]:[]}intersect(t){if(t instanceof o.Segment)return this.intersectRay2Segment(this,t);if(t instanceof o.Arc)return this.intersectRay2Arc(this,t)}intersectRay2Segment(t,e){let r=[],i=new o.Line(t.start,t.norm),a=i.intersect(e);for(let s of a)t.contains(s)&&r.push(s);return a.length==2&&r.length==1&&t.start.on(i)&&r.push(t.start),r}intersectRay2Arc(t,e){let r=[],a=new o.Line(t.start,t.norm).intersect(e);for(let s of a)t.contains(s)&&r.push(s);return r}svg(t,e={}){let r=new o.Line(this.pt,this.norm),i=Qt(r,t);return i=i.filter(s=>this.contains(s)),i.length===0||i.length===2?"":new o.Segment(this.pt,i[0]).svg(e)}};o.Ray=Le;var Hs=(...n)=>new o.Ray(...n);o.ray=Hs;var mt=class{constructor(){this.faces=new o.PlanarSet,this.edges=new o.PlanarSet;let t=[...arguments];if(t.length===1&&(t[0]instanceof Array&&t[0].length>0||t[0]instanceof o.Circle||t[0]instanceof o.Box)){let e=t[0];if(t[0]instanceof Array&&t[0].every(r=>r instanceof Array))if(e.every(r=>r instanceof Array&&r.length===2&&typeof r[0]=="number"&&typeof r[1]=="number"))this.faces.add(new o.Face(this,e));else for(let r of e)if(r instanceof Array&&r[0]instanceof Array&&r[0].every(i=>i instanceof Array&&i.length===2&&typeof i[0]=="number"&&typeof i[1]=="number"))for(let i of r)this.faces.add(new o.Face(this,i));else this.faces.add(new o.Face(this,r));else this.faces.add(new o.Face(this,e))}}get box(){return[...this.faces].reduce((t,e)=>t.merge(e.box),new o.Box)}get vertices(){return[...this.edges].map(t=>t.start)}clone(){let t=new mt;for(let e of this.faces)t.addFace(e.shapes);return t}isEmpty(){return this.edges.size===0}isValid(){let t=!0;for(let e of this.faces)if(!e.isSimple(this.edges)){t=!1;break}return t}area(){let t=[...this.faces].reduce((e,r)=>e+r.signedArea(),0);return Math.abs(t)}addFace(...t){let e=new o.Face(this,...t);return this.faces.add(e),e}deleteFace(t){for(let e of t)this.edges.delete(e);return this.faces.delete(t)}recreateFaces(){this.faces.clear();for(let r of this.edges)r.face=null;let t,e=!0;for(;e;){e=!1;for(let r of this.edges)if(r.face===null){t=r,e=!0;break}if(e){let r=t;do r=r.next;while(r.next!==t);this.addFace(t,r)}}}removeChain(t,e,r){if(r.next===e){this.deleteFace(t);return}for(let i=e;i!==r.next;i=i.next)if(t.remove(i),this.edges.delete(i),t.isEmpty()){this.deleteFace(t);break}}addVertex(t,e){let r=e.shape.split(t);if(r[0]===null)return e.prev;if(r[1]===null)return e;let i=new o.Edge(r[0]),a=e.prev;return e.face.insert(i,a),this.edges.delete(e),this.edges.add(i),e.shape=r[1],this.edges.add(e),i}cut(t){let e=[this.clone()];for(let r of t){if(r.setInclusion(this)!==zt)continue;let i=r.shape.start,a=r.shape.end,s=[];for(let l of e)if(l.findEdgeByPoint(i)===void 0)s.push(l);else{let[f,u]=l.cutFace(i,a);s.push(f,u)}e=s}return e}cutFace(t,e){let r=this.findEdgeByPoint(t),i=this.findEdgeByPoint(e);if(r.face!==i.face)return[];let a=this.addVertex(t,r);i=this.findEdgeByPoint(e);let s=this.addVertex(e,i),l=a.face,f=new o.Edge(new o.Segment(a.end,s.end)),u=new o.Edge(new o.Segment(s.end,a.end));a.next.prev=u,u.next=a.next,a.next=f,f.prev=a,s.next.prev=f,f.next=s.next,s.next=u,u.prev=s,this.edges.add(f),this.edges.add(u);let d=this.addFace(f,a),c=this.addFace(u,s);return this.faces.delete(l),[d.toPolygon(),c.toPolygon()]}cutWithLine(t){let e=this.clone(),r=new W([t]),i={int_points1:[],int_points2:[],int_points1_sorted:[],int_points2_sorted:[]};for(let l of e.edges){let f=gn(l,t);for(let u of f)Ct(r.first,u,i.int_points1),Ct(l,u,i.int_points2)}if(i.int_points1.length===0)return e;i.int_points1_sorted=sr(t,i.int_points1),i.int_points2_sorted=Yt(i.int_points2),Lt(r,i.int_points1_sorted),Lt(e,i.int_points2_sorted),yr(i),i.int_points1_sorted=sr(t,i.int_points1),i.int_points2_sorted=Yt(i.int_points2),ur(i.int_points1),dr(i.int_points1,e);for(let l of i.int_points1_sorted)l.edge_before.bv===l.edge_after.bv&&(i.int_points2[l.id]=-1,l.id=-1);if(i.int_points1=i.int_points1.filter(l=>l.id>=0),i.int_points2=i.int_points2.filter(l=>l.id>=0),i.int_points1.length===0)return e;i.int_points1_sorted=sr(t,i.int_points1),i.int_points2_sorted=Yt(i.int_points2);let a=i.int_points1[0],s;for(let l of i.int_points1_sorted)l.edge_before.bv===zt&&(s=new o.Edge(new o.Segment(a.pt,l.pt)),Qr(i.int_points2[a.id],i.int_points2[l.id],s),e.edges.add(s),s=new o.Edge(new o.Segment(l.pt,a.pt)),Qr(i.int_points2[l.id],i.int_points2[a.id],s),e.edges.add(s)),a=l;return e.recreateFaces(),e}findEdgeByPoint(t){let e;for(let r of this.faces)if(e=r.findEdgeByPoint(t),e!==void 0)break;return e}splitToIslands(){let t=this.toArray();t.sort((i,a)=>a.area()-i.area());let e=[...t[0].faces][0].orientation(),r=t.filter(i=>[...i.faces][0].orientation()===e);for(let i of t){let a=[...i.faces][0];if(a.orientation()!==e){for(let s of r)if(a.shapes.every(l=>s.contains(l))){s.addFace(a.shapes);break}}}return r}reverse(){for(let t of this.faces)t.reverse();return this}contains(t){if(t instanceof o.Point){let e=Xt(this,t);return e===zt||e===X}else return wn(this,t)}distanceTo(t){if(t instanceof o.Point){let[e,r]=o.Distance.point2polygon(t,this);return r=r.reverse(),[e,r]}if(t instanceof o.Circle||t instanceof o.Line||t instanceof o.Segment||t instanceof o.Arc){let[e,r]=o.Distance.shape2polygon(t,this);return r=r.reverse(),[e,r]}if(t instanceof o.Polygon){let e=[Number.POSITIVE_INFINITY,new o.Segment],r,i;for(let a of this.edges){let s=e[0];[r,i]=o.Distance.shape2planarSet(a.shape,t.edges,s),o.Utils.LT(r,s)&&(e=[r,i])}return e}}intersect(t){if(t instanceof o.Point)return this.contains(t)?[t]:[];if(t instanceof o.Line)return Pe(t,this);if(t instanceof o.Circle)return _n(t,this);if(t instanceof o.Segment)return Er(t,this);if(t instanceof o.Arc)return Tr(t,this);if(t instanceof o.Polygon)return Ps(t,this)}translate(t){let e=new mt;for(let r of this.faces)e.addFace(r.shapes.map(i=>i.translate(t)));return e}rotate(t=0,e=new o.Point){let r=new mt;for(let i of this.faces)r.addFace(i.shapes.map(a=>a.rotate(t,e)));return r}transform(t=new o.Matrix){let e=new mt;for(let r of this.faces)e.addFace(r.shapes.map(i=>i.transform(t)));return e}toJSON(){return[...this.faces].map(t=>t.toJSON())}toArray(){return[...this.faces].map(t=>t.toPolygon())}svg(t={}){let{stroke:e,strokeWidth:r,fill:i,fillRule:a,fillOpacity:s,id:l,className:f}=t,u=l&&l.length>0?`id="${l}"`:"",d=f&&f.length>0?`class="${f}"`:"",c=`
<path stroke="${e||"black"}" stroke-width="${r||1}" fill="${i||"lightcyan"}" fill-rule="${a||"evenodd"}" fill-opacity="${s||1}" ${u} ${d} d="`;for(let m of this.faces)c+=m.svg();return c+=`" >
</path>`,c}};o.Polygon=mt;var Qs=(...n)=>new o.Polygon(...n);o.polygon=Qs;var{Circle:ar,Line:nn,Point:on,Vector:ye,Utils:lr}=o,Pt=class{constructor(t){this.circle=t}get inversion_circle(){return this.circle}static inversePoint(t,e){let r=new ye(t.pc,e),i=t.r*t.r,a=r.dot(r);return lr.EQ_0(a)?new on(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY):t.pc.translate(r.multiply(i/a))}static inverseCircle(t,e){let r=t.pc.distanceTo(e.pc)[0];if(lr.EQ(r,e.r)){let i=t.r*t.r/(2*e.r),a=new ye(t.pc,e.pc);a=a.normalize();let s=t.pc.translate(a.multiply(i));return new nn(s,a)}else{let i=new ye(t.pc,e.pc),a=t.r*t.r/(i.dot(i)-e.r*e.r),s=t.pc.translate(i.multiply(a)),l=Math.abs(a)*e.r;return new ar(s,l)}}static inverseLine(t,e){let[r,i]=t.pc.distanceTo(e);if(lr.EQ_0(r))return e.clone();{let a=t.r*t.r/(2*r),s=new ye(t.pc,i.end);return s=s.multiply(a/r),new ar(t.pc.translate(s),a)}}inverse(t){if(t instanceof on)return Pt.inversePoint(this.circle,t);if(t instanceof ar)return Pt.inverseCircle(this.circle,t);if(t instanceof nn)return Pt.inverseLine(this.circle,t)}};o.Inversion=Pt;var Js=n=>new o.Inversion(n);o.inversion=Js;var _=class{static point2point(t,e){return t.distanceTo(e)}static point2line(t,e){let r=t.projectionOn(e);return[new o.Vector(t,r).length,new o.Segment(t,r)]}static point2circle(t,e){let[r,i]=t.distanceTo(e.center);if(o.Utils.EQ_0(r))return[e.r,new o.Segment(t,e.toArc().start)];{let a=Math.abs(r-e.r),s=new o.Vector(e.pc,t).normalize().multiply(e.r),l=e.pc.translate(s);return[a,new o.Segment(t,l)]}}static point2segment(t,e){if(e.start.equalTo(e.end))return _.point2point(t,e.start);let r=new o.Vector(e.start,e.end),i=new o.Vector(e.start,t),a=new o.Vector(e.end,t),s=r.dot(i),l=-r.dot(a),f,u;if(o.Utils.GE(s,0)&&o.Utils.GE(l,0)){let d=e.tangentInStart();return f=Math.abs(d.cross(i)),u=e.start.translate(d.multiply(d.dot(i))),[f,new o.Segment(t,u)]}else return s<0?t.distanceTo(e.start):t.distanceTo(e.end)}static point2arc(t,e){let r=new o.Circle(e.pc,e.r),i=[],a,s;return[a,s]=_.point2circle(t,r),s.end.on(e)&&i.push(_.point2circle(t,r)),i.push(_.point2point(t,e.start)),i.push(_.point2point(t,e.end)),_.sort(i),i[0]}static segment2line(t,e){let r=t.intersect(e);if(r.length>0)return[0,new o.Segment(r[0],r[0])];let i=[];return i.push(_.point2line(t.start,e)),i.push(_.point2line(t.end,e)),_.sort(i),i[0]}static segment2segment(t,e){let r=te(t,e);if(r.length>0)return[0,new o.Segment(r[0],r[0])];let i=[],a,s;return[a,s]=_.point2segment(e.start,t),i.push([a,s.reverse()]),[a,s]=_.point2segment(e.end,t),i.push([a,s.reverse()]),i.push(_.point2segment(t.start,e)),i.push(_.point2segment(t.end,e)),_.sort(i),i[0]}static segment2circle(t,e){let r=t.intersect(e);if(r.length>0)return[0,new o.Segment(r[0],r[0])];let i=new o.Line(t.ps,t.pe),[a,s]=_.point2line(e.center,i);if(o.Utils.GE(a,e.r)&&s.end.on(t))return _.point2circle(s.end,e);{let[l,f]=_.point2circle(t.start,e),[u,d]=_.point2circle(t.end,e);return o.Utils.LT(l,u)?[l,f]:[u,d]}}static segment2arc(t,e){let r=t.intersect(e);if(r.length>0)return[0,new o.Segment(r[0],r[0])];let i=new o.Line(t.ps,t.pe),a=new o.Circle(e.pc,e.r),[s,l]=_.point2line(a.center,i);if(o.Utils.GE(s,a.r)&&l.end.on(t)){let[c,m]=_.point2circle(l.end,a);if(m.end.on(e))return[c,m]}let f=[];f.push(_.point2arc(t.start,e)),f.push(_.point2arc(t.end,e));let u,d;return[u,d]=_.point2segment(e.start,t),f.push([u,d.reverse()]),[u,d]=_.point2segment(e.end,t),f.push([u,d.reverse()]),_.sort(f),f[0]}static circle2circle(t,e){let r=t.intersect(e);if(r.length>0)return[0,new o.Segment(r[0],r[0])];if(t.center.equalTo(e.center)){let i=t.toArc(),a=e.toArc();return _.point2point(i.start,a.start)}else{let i=new o.Line(t.center,e.center),a=i.intersect(t),s=i.intersect(e),l=[];return l.push(_.point2point(a[0],s[0])),l.push(_.point2point(a[0],s[1])),l.push(_.point2point(a[1],s[0])),l.push(_.point2point(a[1],s[1])),_.sort(l),l[0]}}static circle2line(t,e){let r=t.intersect(e);if(r.length>0)return[0,new o.Segment(r[0],r[0])];let[i,a]=_.point2line(t.center,e),[s,l]=_.point2circle(a.end,t);return l=l.reverse(),[s,l]}static arc2line(t,e){let r=e.intersect(t);if(r.length>0)return[0,new o.Segment(r[0],r[0])];let i=new o.Circle(t.center,t.r),[a,s]=_.point2line(i.center,e);if(o.Utils.GE(a,i.r)){let[l,f]=_.point2circle(s.end,i);if(f.end.on(t))return[l,f]}else{let l=[];return l.push(_.point2line(t.start,e)),l.push(_.point2line(t.end,e)),_.sort(l),l[0]}}static arc2circle(t,e){let r=t.intersect(e);if(r.length>0)return[0,new o.Segment(r[0],r[0])];let i=new o.Circle(t.center,t.r),[a,s]=_.circle2circle(i,e);if(s.start.on(t))return[a,s];{let l=[];return l.push(_.point2circle(t.start,e)),l.push(_.point2circle(t.end,e)),_.sort(l),l[0]}}static arc2arc(t,e){let r=t.intersect(e);if(r.length>0)return[0,new o.Segment(r[0],r[0])];let i=new o.Circle(t.center,t.r),a=new o.Circle(e.center,e.r),[s,l]=_.circle2circle(i,a);if(l.start.on(t)&&l.end.on(e))return[s,l];{let f=[],u,d;return[u,d]=_.point2arc(t.start,e),d.end.on(e)&&f.push([u,d]),[u,d]=_.point2arc(t.end,e),d.end.on(e)&&f.push([u,d]),[u,d]=_.point2arc(e.start,t),d.end.on(t)&&f.push([u,d.reverse()]),[u,d]=_.point2arc(e.end,t),d.end.on(t)&&f.push([u,d.reverse()]),[u,d]=_.point2point(t.start,e.start),f.push([u,d]),[u,d]=_.point2point(t.start,e.end),f.push([u,d]),[u,d]=_.point2point(t.end,e.start),f.push([u,d]),[u,d]=_.point2point(t.end,e.end),f.push([u,d]),_.sort(f),f[0]}}static point2polygon(t,e){let r=[Number.POSITIVE_INFINITY,new o.Segment];for(let i of e.edges){let[a,s]=i.shape instanceof o.Segment?_.point2segment(t,i.shape):_.point2arc(t,i.shape);o.Utils.LT(a,r[0])&&(r=[a,s])}return r}static shape2polygon(t,e){let r=[Number.POSITIVE_INFINITY,new o.Segment];for(let i of e.edges){let[a,s]=t.distanceTo(i.shape);o.Utils.LT(a,r[0])&&(r=[a,s])}return r}static polygon2polygon(t,e){let r=[Number.POSITIVE_INFINITY,new o.Segment];for(let i of t.edges)for(let a of e.edges){let[s,l]=i.shape.distanceTo(a.shape);o.Utils.LT(s,r[0])&&(r=[s,l])}return r}static box2box_minmax(t,e){let r=Math.max(Math.max(t.xmin-e.xmax,0),Math.max(e.xmin-t.xmax,0)),i=Math.max(Math.max(t.ymin-e.ymax,0),Math.max(e.ymin-t.ymax,0)),a=r*r+i*i,s=t.merge(e),l=s.xmax-s.xmin,f=s.ymax-s.ymin,u=l*l+f*f;return[a,u]}static minmax_tree_process_level(t,e,r,i){let a,s;for(let d of e)[a,s]=_.box2box_minmax(t.box,d.item.key),d.item.value instanceof o.Edge?i.insert([a,s],d.item.value.shape):i.insert([a,s],d.item.value),o.Utils.LT(s,r)&&(r=s);if(e.length===0)return r;let l=e.map(d=>d.left.isNil()?void 0:d.left).filter(d=>d!==void 0),f=e.map(d=>d.right.isNil()?void 0:d.right).filter(d=>d!==void 0),u=[...l,...f].filter(d=>{let[c,m]=_.box2box_minmax(t.box,d.max);return o.Utils.LE(c,r)});return r=_.minmax_tree_process_level(t,u,r,i),r}static minmax_tree(t,e,r){let i=new Nt,a=[e.index.root],s=r<Number.POSITIVE_INFINITY?r*r:Number.POSITIVE_INFINITY;return s=_.minmax_tree_process_level(t,a,s,i),i}static minmax_tree_calc_distance(t,e,r){let i,a;if(e!=null&&!e.isNil()){if([i,a]=_.minmax_tree_calc_distance(t,e.left,r),a)return[i,a];if(o.Utils.LT(i[0],Math.sqrt(e.item.key.low)))return[i,!0];let[s,l]=_.distance(t,e.item.value);return o.Utils.LT(s,i[0])&&(i=[s,l]),[i,a]=_.minmax_tree_calc_distance(t,e.right,i),[i,a]}return[r,!1]}static shape2planarSet(t,e,r=Number.POSITIVE_INFINITY){let i=[r,new o.Segment],a=!1;if(e instanceof o.PlanarSet){let s=_.minmax_tree(t,e,r);[i,a]=_.minmax_tree_calc_distance(t,s.root,i)}return i}static sort(t){t.sort((e,r)=>o.Utils.LT(e[0],r[0])?-1:o.Utils.GT(e[0],r[0])?1:0)}static distance(t,e){return t.distanceTo(e)}};o.Distance=_;o.BooleanOperations=ps;o.Relations=Vs;var p=o;var Ks=typeof global=="object"&&global&&global.Object===Object&&global,Ne=Ks;var Zs=typeof self=="object"&&self&&self.Object===Object&&self,ta=Ne||Zs||Function("return this")(),N=ta;var ea=N.Symbol,q=ea;var Cn=Object.prototype,ra=Cn.hasOwnProperty,na=Cn.toString,ee=q?q.toStringTag:void 0;function ia(n){var t=ra.call(n,ee),e=n[ee];try{n[ee]=void 0;var r=!0}catch{}var i=na.call(n);return r&&(t?n[ee]=e:delete n[ee]),i}var On=ia;var oa=Object.prototype,sa=oa.toString;function aa(n){return sa.call(n)}var Ln=aa;var la="[object Null]",fa="[object Undefined]",Nn=q?q.toStringTag:void 0;function ua(n){return n==null?n===void 0?fa:la:Nn&&Nn in Object(n)?On(n):Ln(n)}var z=ua;function da(n){return n!=null&&typeof n=="object"}var Y=da;var ca="[object Symbol]";function ha(n){return typeof n=="symbol"||Y(n)&&z(n)==ca}var K=ha;function pa(n,t){for(var e=-1,r=n==null?0:n.length,i=Array(r);++e<r;)i[e]=t(n[e],e,n);return i}var Rn=pa;var ma=Array.isArray,F=ma;var ga=1/0,kn=q?q.prototype:void 0,Mn=kn?kn.toString:void 0;function Bn(n){if(typeof n=="string")return n;if(F(n))return Rn(n,Bn)+"";if(K(n))return Mn?Mn.call(n):"";var t=n+"";return t=="0"&&1/n==-ga?"-0":t}var Fn=Bn;var _a=/\s/;function xa(n){for(var t=n.length;t--&&_a.test(n.charAt(t)););return t}var Un=xa;var ya=/^\s+/;function ba(n){return n&&n.slice(0,Un(n)+1).replace(ya,"")}var Vn=ba;function va(n){var t=typeof n;return n!=null&&(t=="object"||t=="function")}var V=va;var Gn=0/0,wa=/^[-+]0x[0-9a-f]+$/i,Ea=/^0b[01]+$/i,Ta=/^0o[0-7]+$/i,Ia=parseInt;function Sa(n){if(typeof n=="number")return n;if(K(n))return Gn;if(V(n)){var t=typeof n.valueOf=="function"?n.valueOf():n;n=V(t)?t+"":t}if(typeof n!="string")return n===0?n:+n;n=Vn(n);var e=Ea.test(n);return e||Ta.test(n)?Ia(n.slice(2),e?2:8):wa.test(n)?Gn:+n}var re=Sa;var Dn=1/0,Aa=17976931348623157e292;function Pa(n){if(!n)return n===0?n:0;if(n=re(n),n===Dn||n===-Dn){var t=n<0?-1:1;return t*Aa}return n===n?n:0}var ne=Pa;function Ca(n){var t=ne(n),e=t%1;return t===t?e?t-e:t:0}var $n=Ca;function Oa(n){return n}var Wn=Oa;var La="[object AsyncFunction]",Na="[object Function]",Ra="[object GeneratorFunction]",ka="[object Proxy]";function Ma(n){if(!V(n))return!1;var t=z(n);return t==Na||t==Ra||t==La||t==ka}var Re=Ma;var Ba=N["__core-js_shared__"],ke=Ba;var qn=function(){var n=/[^.]+$/.exec(ke&&ke.keys&&ke.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();function Fa(n){return!!qn&&qn in n}var jn=Fa;var Ua=Function.prototype,Va=Ua.toString;function Ga(n){if(n!=null){try{return Va.call(n)}catch{}try{return n+""}catch{}}return""}var nt=Ga;var Da=/[\\^$.*+?()[\]{}|]/g,$a=/^\[object .+?Constructor\]$/,Wa=Function.prototype,qa=Object.prototype,ja=Wa.toString,za=qa.hasOwnProperty,Ya=RegExp("^"+ja.call(za).replace(Da,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Xa(n){if(!V(n)||jn(n))return!1;var t=Re(n)?Ya:$a;return t.test(nt(n))}var zn=Xa;function Ha(n,t){return n==null?void 0:n[t]}var Yn=Ha;function Qa(n,t){var e=Yn(n,t);return zn(e)?e:void 0}var j=Qa;var Ja=j(N,"WeakMap"),Me=Ja;var Ka=9007199254740991,Za=/^(?:0|[1-9]\d*)$/;function tl(n,t){var e=typeof n;return t=t??Ka,!!t&&(e=="number"||e!="symbol"&&Za.test(n))&&n>-1&&n%1==0&&n<t}var Mt=tl;function el(n,t){return n===t||n!==n&&t!==t}var Bt=el;var rl=9007199254740991;function nl(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=rl}var Ft=nl;function il(n){return n!=null&&Ft(n.length)&&!Re(n)}var Be=il;function ol(n,t,e){if(!V(e))return!1;var r=typeof t;return(r=="number"?Be(e)&&Mt(t,e.length):r=="string"&&t in e)?Bt(e[t],n):!1}var Xn=ol;var sl=Object.prototype;function al(n){var t=n&&n.constructor,e=typeof t=="function"&&t.prototype||sl;return n===e}var Hn=al;function ll(n,t){for(var e=-1,r=Array(n);++e<n;)r[e]=t(e);return r}var Qn=ll;var fl="[object Arguments]";function ul(n){return Y(n)&&z(n)==fl}var Ir=ul;var Jn=Object.prototype,dl=Jn.hasOwnProperty,cl=Jn.propertyIsEnumerable,hl=Ir(function(){return arguments}())?Ir:function(n){return Y(n)&&dl.call(n,"callee")&&!cl.call(n,"callee")},Fe=hl;function pl(){return!1}var Kn=pl;var ei=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Zn=ei&&typeof module=="object"&&module&&!module.nodeType&&module,ml=Zn&&Zn.exports===ei,ti=ml?N.Buffer:void 0,gl=ti?ti.isBuffer:void 0,_l=gl||Kn,ie=_l;var xl="[object Arguments]",yl="[object Array]",bl="[object Boolean]",vl="[object Date]",wl="[object Error]",El="[object Function]",Tl="[object Map]",Il="[object Number]",Sl="[object Object]",Al="[object RegExp]",Pl="[object Set]",Cl="[object String]",Ol="[object WeakMap]",Ll="[object ArrayBuffer]",Nl="[object DataView]",Rl="[object Float32Array]",kl="[object Float64Array]",Ml="[object Int8Array]",Bl="[object Int16Array]",Fl="[object Int32Array]",Ul="[object Uint8Array]",Vl="[object Uint8ClampedArray]",Gl="[object Uint16Array]",Dl="[object Uint32Array]",A={};A[Rl]=A[kl]=A[Ml]=A[Bl]=A[Fl]=A[Ul]=A[Vl]=A[Gl]=A[Dl]=!0;A[xl]=A[yl]=A[Ll]=A[bl]=A[Nl]=A[vl]=A[wl]=A[El]=A[Tl]=A[Il]=A[Sl]=A[Al]=A[Pl]=A[Cl]=A[Ol]=!1;function $l(n){return Y(n)&&Ft(n.length)&&!!A[z(n)]}var ri=$l;function Wl(n){return function(t){return n(t)}}var ni=Wl;var ii=typeof exports=="object"&&exports&&!exports.nodeType&&exports,oe=ii&&typeof module=="object"&&module&&!module.nodeType&&module,ql=oe&&oe.exports===ii,Sr=ql&&Ne.process,jl=function(){try{var n=oe&&oe.require&&oe.require("util").types;return n||Sr&&Sr.binding&&Sr.binding("util")}catch{}}(),Ar=jl;var oi=Ar&&Ar.isTypedArray,zl=oi?ni(oi):ri,Ue=zl;var Yl=Object.prototype,Xl=Yl.hasOwnProperty;function Hl(n,t){var e=F(n),r=!e&&Fe(n),i=!e&&!r&&ie(n),a=!e&&!r&&!i&&Ue(n),s=e||r||i||a,l=s?Qn(n.length,String):[],f=l.length;for(var u in n)(t||Xl.call(n,u))&&!(s&&(u=="length"||i&&(u=="offset"||u=="parent")||a&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||Mt(u,f)))&&l.push(u);return l}var si=Hl;function Ql(n,t){return function(e){return n(t(e))}}var ai=Ql;var Jl=ai(Object.keys,Object),li=Jl;var Kl=Object.prototype,Zl=Kl.hasOwnProperty;function tf(n){if(!Hn(n))return li(n);var t=[];for(var e in Object(n))Zl.call(n,e)&&e!="constructor"&&t.push(e);return t}var fi=tf;function ef(n){return Be(n)?si(n):fi(n)}var Ve=ef;var rf=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,nf=/^\w*$/;function of(n,t){if(F(n))return!1;var e=typeof n;return e=="number"||e=="symbol"||e=="boolean"||n==null||K(n)?!0:nf.test(n)||!rf.test(n)||t!=null&&n in Object(t)}var Ut=of;var sf=j(Object,"create"),it=sf;function af(){this.__data__=it?it(null):{},this.size=0}var ui=af;function lf(n){var t=this.has(n)&&delete this.__data__[n];return this.size-=t?1:0,t}var di=lf;var ff="__lodash_hash_undefined__",uf=Object.prototype,df=uf.hasOwnProperty;function cf(n){var t=this.__data__;if(it){var e=t[n];return e===ff?void 0:e}return df.call(t,n)?t[n]:void 0}var ci=cf;var hf=Object.prototype,pf=hf.hasOwnProperty;function mf(n){var t=this.__data__;return it?t[n]!==void 0:pf.call(t,n)}var hi=mf;var gf="__lodash_hash_undefined__";function _f(n,t){var e=this.__data__;return this.size+=this.has(n)?0:1,e[n]=it&&t===void 0?gf:t,this}var pi=_f;function Vt(n){var t=-1,e=n==null?0:n.length;for(this.clear();++t<e;){var r=n[t];this.set(r[0],r[1])}}Vt.prototype.clear=ui;Vt.prototype.delete=di;Vt.prototype.get=ci;Vt.prototype.has=hi;Vt.prototype.set=pi;var Pr=Vt;function xf(){this.__data__=[],this.size=0}var mi=xf;function yf(n,t){for(var e=n.length;e--;)if(Bt(n[e][0],t))return e;return-1}var at=yf;var bf=Array.prototype,vf=bf.splice;function wf(n){var t=this.__data__,e=at(t,n);if(e<0)return!1;var r=t.length-1;return e==r?t.pop():vf.call(t,e,1),--this.size,!0}var gi=wf;function Ef(n){var t=this.__data__,e=at(t,n);return e<0?void 0:t[e][1]}var _i=Ef;function Tf(n){return at(this.__data__,n)>-1}var xi=Tf;function If(n,t){var e=this.__data__,r=at(e,n);return r<0?(++this.size,e.push([n,t])):e[r][1]=t,this}var yi=If;function Gt(n){var t=-1,e=n==null?0:n.length;for(this.clear();++t<e;){var r=n[t];this.set(r[0],r[1])}}Gt.prototype.clear=mi;Gt.prototype.delete=gi;Gt.prototype.get=_i;Gt.prototype.has=xi;Gt.prototype.set=yi;var lt=Gt;var Sf=j(N,"Map"),ft=Sf;function Af(){this.size=0,this.__data__={hash:new Pr,map:new(ft||lt),string:new Pr}}var bi=Af;function Pf(n){var t=typeof n;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?n!=="__proto__":n===null}var vi=Pf;function Cf(n,t){var e=n.__data__;return vi(t)?e[typeof t=="string"?"string":"hash"]:e.map}var ut=Cf;function Of(n){var t=ut(this,n).delete(n);return this.size-=t?1:0,t}var wi=Of;function Lf(n){return ut(this,n).get(n)}var Ei=Lf;function Nf(n){return ut(this,n).has(n)}var Ti=Nf;function Rf(n,t){var e=ut(this,n),r=e.size;return e.set(n,t),this.size+=e.size==r?0:1,this}var Ii=Rf;function Dt(n){var t=-1,e=n==null?0:n.length;for(this.clear();++t<e;){var r=n[t];this.set(r[0],r[1])}}Dt.prototype.clear=bi;Dt.prototype.delete=wi;Dt.prototype.get=Ei;Dt.prototype.has=Ti;Dt.prototype.set=Ii;var bt=Dt;var kf="Expected a function";function Cr(n,t){if(typeof n!="function"||t!=null&&typeof t!="function")throw new TypeError(kf);var e=function(){var r=arguments,i=t?t.apply(this,r):r[0],a=e.cache;if(a.has(i))return a.get(i);var s=n.apply(this,r);return e.cache=a.set(i,s)||a,s};return e.cache=new(Cr.Cache||bt),e}Cr.Cache=bt;var se=Cr;var Mf=500;function Bf(n){var t=se(n,function(r){return e.size===Mf&&e.clear(),r}),e=t.cache;return t}var Si=Bf;var Ff=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Uf=/\\(\\)?/g,Vf=Si(function(n){var t=[];return n.charCodeAt(0)===46&&t.push(""),n.replace(Ff,function(e,r,i,a){t.push(i?a.replace(Uf,"$1"):r||e)}),t}),Ai=Vf;function Gf(n){return n==null?"":Fn(n)}var Pi=Gf;function Df(n,t){return F(n)?n:Ut(n,t)?[n]:Ai(Pi(n))}var Ge=Df;var $f=1/0;function Wf(n){if(typeof n=="string"||K(n))return n;var t=n+"";return t=="0"&&1/n==-$f?"-0":t}var dt=Wf;function qf(n,t){t=Ge(t,n);for(var e=0,r=t.length;n!=null&&e<r;)n=n[dt(t[e++])];return e&&e==r?n:void 0}var De=qf;function jf(n,t,e){var r=n==null?void 0:De(n,t);return r===void 0?e:r}var Ci=jf;function zf(n,t){for(var e=-1,r=t.length,i=n.length;++e<r;)n[i+e]=t[e];return n}var Oi=zf;var Yf="Expected a function";function Xf(n,t){var e;if(typeof t!="function")throw new TypeError(Yf);return n=$n(n),function(){return--n>0&&(e=t.apply(this,arguments)),n<=1&&(t=void 0),e}}var Li=Xf;function Hf(){this.__data__=new lt,this.size=0}var Ni=Hf;function Qf(n){var t=this.__data__,e=t.delete(n);return this.size=t.size,e}var Ri=Qf;function Jf(n){return this.__data__.get(n)}var ki=Jf;function Kf(n){return this.__data__.has(n)}var Mi=Kf;var Zf=200;function tu(n,t){var e=this.__data__;if(e instanceof lt){var r=e.__data__;if(!ft||r.length<Zf-1)return r.push([n,t]),this.size=++e.size,this;e=this.__data__=new bt(r)}return e.set(n,t),this.size=e.size,this}var Bi=tu;function $t(n){var t=this.__data__=new lt(n);this.size=t.size}$t.prototype.clear=Ni;$t.prototype.delete=Ri;$t.prototype.get=ki;$t.prototype.has=Mi;$t.prototype.set=Bi;var Wt=$t;function eu(n,t){for(var e=-1,r=n==null?0:n.length,i=0,a=[];++e<r;){var s=n[e];t(s,e,n)&&(a[i++]=s)}return a}var Fi=eu;function ru(){return[]}var Ui=ru;var nu=Object.prototype,iu=nu.propertyIsEnumerable,Vi=Object.getOwnPropertySymbols,ou=Vi?function(n){return n==null?[]:(n=Object(n),Fi(Vi(n),function(t){return iu.call(n,t)}))}:Ui,Gi=ou;function su(n,t,e){var r=t(n);return F(n)?r:Oi(r,e(n))}var Di=su;function au(n){return Di(n,Ve,Gi)}var Or=au;var lu=j(N,"DataView"),$e=lu;var fu=j(N,"Promise"),We=fu;var uu=j(N,"Set"),qe=uu;var $i="[object Map]",du="[object Object]",Wi="[object Promise]",qi="[object Set]",ji="[object WeakMap]",zi="[object DataView]",cu=nt($e),hu=nt(ft),pu=nt(We),mu=nt(qe),gu=nt(Me),vt=z;($e&&vt(new $e(new ArrayBuffer(1)))!=zi||ft&&vt(new ft)!=$i||We&&vt(We.resolve())!=Wi||qe&&vt(new qe)!=qi||Me&&vt(new Me)!=ji)&&(vt=function(n){var t=z(n),e=t==du?n.constructor:void 0,r=e?nt(e):"";if(r)switch(r){case cu:return zi;case hu:return $i;case pu:return Wi;case mu:return qi;case gu:return ji}return t});var Lr=vt;var _u=N.Uint8Array,Nr=_u;var xu="__lodash_hash_undefined__";function yu(n){return this.__data__.set(n,xu),this}var Yi=yu;function bu(n){return this.__data__.has(n)}var Xi=bu;function je(n){var t=-1,e=n==null?0:n.length;for(this.__data__=new bt;++t<e;)this.add(n[t])}je.prototype.add=je.prototype.push=Yi;je.prototype.has=Xi;var Hi=je;function vu(n,t){for(var e=-1,r=n==null?0:n.length;++e<r;)if(t(n[e],e,n))return!0;return!1}var Qi=vu;function wu(n,t){return n.has(t)}var Ji=wu;var Eu=1,Tu=2;function Iu(n,t,e,r,i,a){var s=e&Eu,l=n.length,f=t.length;if(l!=f&&!(s&&f>l))return!1;var u=a.get(n),d=a.get(t);if(u&&d)return u==t&&d==n;var c=-1,m=!0,w=e&Tu?new Hi:void 0;for(a.set(n,t),a.set(t,n);++c<l;){var y=n[c],b=t[c];if(r)var E=s?r(b,y,c,t,n,a):r(y,b,c,n,t,a);if(E!==void 0){if(E)continue;m=!1;break}if(w){if(!Qi(t,function(x,v){if(!Ji(w,v)&&(y===x||i(y,x,e,r,a)))return w.push(v)})){m=!1;break}}else if(!(y===b||i(y,b,e,r,a))){m=!1;break}}return a.delete(n),a.delete(t),m}var ze=Iu;function Su(n){var t=-1,e=Array(n.size);return n.forEach(function(r,i){e[++t]=[i,r]}),e}var Ki=Su;function Au(n){var t=-1,e=Array(n.size);return n.forEach(function(r){e[++t]=r}),e}var Zi=Au;var Pu=1,Cu=2,Ou="[object Boolean]",Lu="[object Date]",Nu="[object Error]",Ru="[object Map]",ku="[object Number]",Mu="[object RegExp]",Bu="[object Set]",Fu="[object String]",Uu="[object Symbol]",Vu="[object ArrayBuffer]",Gu="[object DataView]",to=q?q.prototype:void 0,Rr=to?to.valueOf:void 0;function Du(n,t,e,r,i,a,s){switch(e){case Gu:if(n.byteLength!=t.byteLength||n.byteOffset!=t.byteOffset)return!1;n=n.buffer,t=t.buffer;case Vu:return!(n.byteLength!=t.byteLength||!a(new Nr(n),new Nr(t)));case Ou:case Lu:case ku:return Bt(+n,+t);case Nu:return n.name==t.name&&n.message==t.message;case Mu:case Fu:return n==t+"";case Ru:var l=Ki;case Bu:var f=r&Pu;if(l||(l=Zi),n.size!=t.size&&!f)return!1;var u=s.get(n);if(u)return u==t;r|=Cu,s.set(n,t);var d=ze(l(n),l(t),r,i,a,s);return s.delete(n),d;case Uu:if(Rr)return Rr.call(n)==Rr.call(t)}return!1}var eo=Du;var $u=1,Wu=Object.prototype,qu=Wu.hasOwnProperty;function ju(n,t,e,r,i,a){var s=e&$u,l=Or(n),f=l.length,u=Or(t),d=u.length;if(f!=d&&!s)return!1;for(var c=f;c--;){var m=l[c];if(!(s?m in t:qu.call(t,m)))return!1}var w=a.get(n),y=a.get(t);if(w&&y)return w==t&&y==n;var b=!0;a.set(n,t),a.set(t,n);for(var E=s;++c<f;){m=l[c];var x=n[m],v=t[m];if(r)var g=s?r(v,x,m,t,n,a):r(x,v,m,n,t,a);if(!(g===void 0?x===v||i(x,v,e,r,a):g)){b=!1;break}E||(E=m=="constructor")}if(b&&!E){var I=n.constructor,U=t.constructor;I!=U&&"constructor"in n&&"constructor"in t&&!(typeof I=="function"&&I instanceof I&&typeof U=="function"&&U instanceof U)&&(b=!1)}return a.delete(n),a.delete(t),b}var ro=ju;var zu=1,no="[object Arguments]",io="[object Array]",Ye="[object Object]",Yu=Object.prototype,oo=Yu.hasOwnProperty;function Xu(n,t,e,r,i,a){var s=F(n),l=F(t),f=s?io:Lr(n),u=l?io:Lr(t);f=f==no?Ye:f,u=u==no?Ye:u;var d=f==Ye,c=u==Ye,m=f==u;if(m&&ie(n)){if(!ie(t))return!1;s=!0,d=!1}if(m&&!d)return a||(a=new Wt),s||Ue(n)?ze(n,t,e,r,i,a):eo(n,t,f,e,r,i,a);if(!(e&zu)){var w=d&&oo.call(n,"__wrapped__"),y=c&&oo.call(t,"__wrapped__");if(w||y){var b=w?n.value():n,E=y?t.value():t;return a||(a=new Wt),i(b,E,e,r,a)}}return m?(a||(a=new Wt),ro(n,t,e,r,i,a)):!1}var so=Xu;function ao(n,t,e,r,i){return n===t?!0:n==null||t==null||!Y(n)&&!Y(t)?n!==n&&t!==t:so(n,t,e,r,ao,i)}var Xe=ao;var Hu=1,Qu=2;function Ju(n,t,e,r){var i=e.length,a=i,s=!r;if(n==null)return!a;for(n=Object(n);i--;){var l=e[i];if(s&&l[2]?l[1]!==n[l[0]]:!(l[0]in n))return!1}for(;++i<a;){l=e[i];var f=l[0],u=n[f],d=l[1];if(s&&l[2]){if(u===void 0&&!(f in n))return!1}else{var c=new Wt;if(r)var m=r(u,d,f,n,t,c);if(!(m===void 0?Xe(d,u,Hu|Qu,r,c):m))return!1}}return!0}var lo=Ju;function Ku(n){return n===n&&!V(n)}var He=Ku;function Zu(n){for(var t=Ve(n),e=t.length;e--;){var r=t[e],i=n[r];t[e]=[r,i,He(i)]}return t}var fo=Zu;function td(n,t){return function(e){return e==null?!1:e[n]===t&&(t!==void 0||n in Object(e))}}var Qe=td;function ed(n){var t=fo(n);return t.length==1&&t[0][2]?Qe(t[0][0],t[0][1]):function(e){return e===n||lo(e,n,t)}}var uo=ed;function rd(n,t){return n!=null&&t in Object(n)}var co=rd;function nd(n,t,e){t=Ge(t,n);for(var r=-1,i=t.length,a=!1;++r<i;){var s=dt(t[r]);if(!(a=n!=null&&e(n,s)))break;n=n[s]}return a||++r!=i?a:(i=n==null?0:n.length,!!i&&Ft(i)&&Mt(s,i)&&(F(n)||Fe(n)))}var ho=nd;function id(n,t){return n!=null&&ho(n,t,co)}var po=id;var od=1,sd=2;function ad(n,t){return Ut(n)&&He(t)?Qe(dt(n),t):function(e){var r=Ci(e,n);return r===void 0&&r===t?po(e,n):Xe(t,r,od|sd)}}var mo=ad;function ld(n){return function(t){return t==null?void 0:t[n]}}var go=ld;function fd(n){return function(t){return De(t,n)}}var _o=fd;function ud(n){return Ut(n)?go(dt(n)):_o(n)}var xo=ud;function dd(n){return typeof n=="function"?n:n==null?Wn:typeof n=="object"?F(n)?mo(n[0],n[1]):uo(n):xo(n)}var yo=dd;var cd=function(){return N.Date.now()},Je=cd;var hd="Expected a function",pd=Math.max,md=Math.min;function gd(n,t,e){var r,i,a,s,l,f,u=0,d=!1,c=!1,m=!0;if(typeof n!="function")throw new TypeError(hd);t=re(t)||0,V(e)&&(d=!!e.leading,c="maxWait"in e,a=c?pd(re(e.maxWait)||0,t):a,m="trailing"in e?!!e.trailing:m);function w(T){var L=r,C=i;return r=i=void 0,u=T,s=n.apply(C,L),s}function y(T){return u=T,l=setTimeout(x,t),d?w(T):s}function b(T){var L=T-f,C=T-u,P=t-L;return c?md(P,a-C):P}function E(T){var L=T-f,C=T-u;return f===void 0||L>=t||L<0||c&&C>=a}function x(){var T=Je();if(E(T))return v(T);l=setTimeout(x,b(T))}function v(T){return l=void 0,m&&r?w(T):(r=i=void 0,s)}function g(){l!==void 0&&clearTimeout(l),u=0,r=f=i=l=void 0}function I(){return l===void 0?s:v(Je())}function U(){var T=Je(),L=E(T);if(r=arguments,i=this,f=T,L){if(l===void 0)return y(f);if(c)return clearTimeout(l),l=setTimeout(x,t),w(f)}return l===void 0&&(l=setTimeout(x,t)),s}return U.cancel=g,U.flush=I,U}var bo=gd;function _d(n,t){return n<t}var vo=_d;function xd(n,t,e){for(var r=-1,i=n.length;++r<i;){var a=n[r],s=t(a);if(s!=null&&(l===void 0?s===s&&!K(s):e(s,l)))var l=s,f=a}return f}var wo=xd;function yd(n,t){return n&&n.length?wo(n,yo(t,2),vo):void 0}var Ke=yd;function bd(n){return Li(2,n)}var kr=bd;var vd=Math.floor,wd=Math.random;function Ed(n,t){return n+vd(wd()*(t-n+1))}var Eo=Ed;var Td=parseFloat,Id=Math.min,Sd=Math.random;function Ad(n,t,e){if(e&&typeof e!="boolean"&&Xn(n,t,e)&&(t=e=void 0),e===void 0&&(typeof t=="boolean"?(e=t,t=void 0):typeof n=="boolean"&&(e=n,n=void 0)),n===void 0&&t===void 0?(n=0,t=1):(n=ne(n),t===void 0?(t=n,n=0):t=ne(t)),n>t){var r=n;n=t,t=r}if(e||n%1||t%1){var i=Sd();return Id(n+i*(t-n+Td("1e-"+((i+"").length-1))),t)}return Eo(n,t)}var ae=Ad;var Pd="Expected a function";function Cd(n,t,e){var r=!0,i=!0;if(typeof n!="function")throw new TypeError(Pd);return V(e)&&(r="leading"in e?!!e.leading:r,i="trailing"in e?!!e.trailing:i),bo(n,t,{leading:r,maxWait:t,trailing:i})}var Mr=Cd;var ct={};Xr(ct,{BOUNDARY:()=>Z,CCW:()=>Od,CONTAINS:()=>Bd,CW:()=>Ld,END_VERTEX:()=>wt,INSIDE:()=>kd,INTERLACE:()=>Fd,NOT_VERTEX:()=>Ze,ORIENTATION:()=>Nd,OUTSIDE:()=>Md,OVERLAP_OPPOSITE:()=>Vd,OVERLAP_SAME:()=>Ud,PIx2:()=>Rd,START_VERTEX:()=>le});var Od=!0,Ld=!1,Nd={CCW:-1,CW:1,NOT_ORIENTABLE:0},Rd=2*Math.PI,kd=1,Md=0,Z=2,Bd=3,Fd=4,Ud=1,Vd=2,Ze=0,le=1,wt=2;var tr={};Xr(tr,{DECIMALS:()=>Gd,EQ:()=>qt,EQ_0:()=>Dd,GE:()=>Wd,GT:()=>$d,LE:()=>jd,LT:()=>qd,getTolerance:()=>Fr,setTolerance:()=>Br});var tt=1e-6;function Br(n){tt=n}function Fr(){return tt}var Gd=3;function Dd(n){return n<tt&&n>-tt}function qt(n,t){return n-t<tt&&n-t>-tt}function $d(n,t){return n-t>tt}function Wd(n,t){return n-t>-tt}function qd(n,t){return n-t<-tt}function jd(n,t){return n-t<tt}var To=class{static get ILLEGAL_PARAMETERS(){return new ReferenceError("Illegal Parameters")}static get ZERO_DIVISION(){return new Error("Zero division")}static get UNRESOLVED_BOUNDARY_CONFLICT(){return new Error("Unresolved boundary conflict in boolean operation")}static get INFINITE_LOOP(){return new Error("Infinite loop")}},fe=To;var Ur={Utils:tr,Errors:fe,Matrix:void 0,Planar_set:void 0,Point:void 0,Vector:void 0,Line:void 0,Circle:void 0,Segment:void 0,Arc:void 0,Box:void 0,Edge:void 0,Face:void 0,Ray:void 0,Ray_shooting:void 0,Multiline:void 0,Polygon:void 0,Distance:void 0,Inversion:void 0};for(let n in ct)Ur[n]=ct[n];Object.defineProperty(Ur,"DP_TOL",{get:function(){return Fr()},set:function(n){Br(n)}});var er=Ur;var Io=class{constructor(t,e){this.first=t,this.last=e||this.first}[Symbol.iterator](){let t;return{next:()=>(t=t?t.next:this.first,{value:t,done:t===void 0})}}get size(){let t=0;for(let e of this)t++;return t}toArray(t=void 0,e=void 0){let r=[],i=t||this.first,a=e||this.last,s=i;if(s===void 0)return r;do r.push(s),s=s.next;while(s!==a.next);return r}append(t){return this.isEmpty()?this.first=t:(t.prev=this.last,this.last.next=t),this.last=t,this.last.next=void 0,this.first.prev=void 0,this}insert(t,e){if(this.isEmpty())this.first=t,this.last=t;else if(e==null)t.next=this.first,this.first.prev=t,this.first=t;else{let r=e.next;e.next=t,r&&(r.prev=t),t.prev=e,t.next=r,this.last===e&&(this.last=t)}return this.last.next=void 0,this.first.prev=void 0,this}remove(t){return t===this.first&&t===this.last?(this.first=void 0,this.last=void 0):(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t===this.first&&(this.first=t.next),t===this.last&&(this.last=t.prev)),this}isEmpty(){return this.first===void 0}static testInfiniteLoop(t){let e=t,r=t;do{if(e!=t&&e===r)throw er.Errors.INFINITE_LOOP;e=e.next,r=r.next.next}while(e!=t)}},So=Io;function ue(n,t,e){let r=e.length,i=n.shape.split(t);if(i.length===0)return;let a=0;i[0]===null?a=0:i[1]===null?a=n.shape.length:a=i[0].length;let s=Ze;qt(a,0)&&(s|=le),qt(a,n.shape.length)&&(s|=wt);let l=s&wt&&n.next.arc_length===0?0:n.arc_length+a;e.push({id:r,pt:t,arc_length:l,edge_before:n,edge_after:void 0,face:n.face,is_vertex:s})}function rr(n){n.int_points1_sorted=Ao(n.int_points1),n.int_points2_sorted=Ao(n.int_points2)}function Ao(n){let t=new Map,e=0;for(let i of n)t.has(i.face)||(t.set(i.face,e),e++);for(let i of n)i.faceId=t.get(i.face);return n.slice().sort(zd)}function zd(n,t){return n.faceId<t.faceId?-1:n.faceId>t.faceId?1:n.arc_length<t.arc_length?-1:n.arc_length>t.arc_length?1:0}function Po(n){if(n.int_points1.length<2)return;let t=!1,e,r,i,a;for(let s=0;s<n.int_points1_sorted.length;s++)if(n.int_points1_sorted[s].id!==-1){e=n.int_points1_sorted[s],r=n.int_points2[e.id];for(let l=s+1;l<n.int_points1_sorted.length&&(i=n.int_points1_sorted[l],!!qt(i.arc_length,e.arc_length));l++)i.id!==-1&&(a=n.int_points2[i.id],a.id!==-1&&i.edge_before===e.edge_before&&i.edge_after===e.edge_after&&a.edge_before===r.edge_before&&a.edge_after===r.edge_after&&(i.id=-1,a.id=-1,t=!0))}r=n.int_points2_sorted[0],e=n.int_points1[r.id];for(let s=1;s<n.int_points2_sorted.length;s++){let l=n.int_points2_sorted[s];if(l.id==-1)continue;if(r.id==-1||!qt(l.arc_length,r.arc_length)){r=l,e=n.int_points1[r.id];continue}let f=n.int_points1[l.id];f.edge_before===e.edge_before&&f.edge_after===e.edge_after&&l.edge_before===r.edge_before&&l.edge_after===r.edge_after&&(f.id=-1,l.id=-1,t=!0)}t&&(n.int_points1=n.int_points1.filter(s=>s.id>=0),n.int_points2=n.int_points2.filter(s=>s.id>=0),n.int_points1.forEach((s,l)=>s.id=l),n.int_points2.forEach((s,l)=>s.id=l))}function Vr(n){for(let t of n)t.edge_before.bvStart=void 0,t.edge_before.bvEnd=void 0,t.edge_before.bv=void 0,t.edge_before.overlap=void 0,t.edge_after.bvStart=void 0,t.edge_after.bvEnd=void 0,t.edge_after.bv=void 0,t.edge_after.overlap=void 0;for(let t of n)t.edge_before.bvEnd=Z,t.edge_after.bvStart=Z}function Gr(n,t){for(let e of n)e.edge_before.setInclusion(t),e.edge_after.setInclusion(t)}function Co(n){let t,e,r,i=n.int_points1.length;for(let a=0;a<i;a++){let s=n.int_points1_sorted[a];s.face!==t&&(e=a,t=s.face);let l=a,f=Et(n.int_points1_sorted,a,t),u;l+f<i&&n.int_points1_sorted[l+f].face===t?u=l+f:u=e;let d=Et(n.int_points1_sorted,u,t);r=null;for(let x=u;x<u+d;x++){let v=n.int_points1_sorted[x];if(v.face===t&&n.int_points2[v.id].face===n.int_points2[s.id].face){r=v;break}}if(r===null)continue;let c=s.edge_after,m=r.edge_before;if(!(c.bv===Z&&m.bv===Z)||c!==m)continue;let w=n.int_points2[s.id],y=n.int_points2[r.id],b=w.edge_after,E=y.edge_before;b.bv===Z&&E.bv===Z&&b===E||(w=n.int_points2[r.id],y=n.int_points2[s.id],b=w.edge_after,E=y.edge_before),b.bv===Z&&E.bv===Z&&b===E&&c.setOverlap(b)}}function Et(n,t,e){let r,i,a=1;if(n.length==1)return 1;r=n[t];for(let s=t+1;s<n.length&&!(r.face!=e||(i=n[s],!(i.pt.equalTo(r.pt)&&i.edge_before===r.edge_before&&i.edge_after===r.edge_after)));s++)a++;return a}function Dr(n,t){if(!!t){for(let e of t){let r=e.edge_before;if(e.is_vertex=Ze,r.shape.start&&r.shape.start.equalTo(e.pt)&&(e.is_vertex|=le),r.shape.end&&r.shape.end.equalTo(e.pt)&&(e.is_vertex|=wt),e.is_vertex&le){e.edge_before=r.prev,e.is_vertex=wt;continue}if(e.is_vertex&wt)continue;let i=n.addVertex(e.pt,r);e.edge_before=i}for(let e of t)e.edge_after=e.edge_before.next}}var{INSIDE:et,OUTSIDE:rt,BOUNDARY:M,OVERLAP_SAME:Yd,OVERLAP_OPPOSITE:Xd}=ct,{NOT_VERTEX:qx,START_VERTEX:Oo,END_VERTEX:Lo}=ct,Uo=1,Vo=2,de=3;function Go(n,t){let r=t.clone().reverse(),[i,a]=Jd(n,r,de,!0);return i}function Hd(n,t,e,r){let i=No(n,e.int_points1),a=No(t,e.int_points2);for(Ro(i,t),Ro(a,n),Vr(e.int_points1),Vr(e.int_points2),Gr(e.int_points1,t),Gr(e.int_points2,n);Zd(n,t,e.int_points1,e.int_points1_sorted,e.int_points2,e););Co(e),ko(n,r,e.int_points1_sorted,!0),ko(t,r,e.int_points2_sorted,!1),Fo(n,i,r,!0),Fo(t,a,r,!1)}function Qd(n,t,e,r){tc(n,t,r,e.int_points2),ec(n,t,e),Mo(n,e.int_points1),Mo(t,e.int_points2),Bo(n,e.int_points1,e.int_points2),Bo(n,e.int_points2,e.int_points1)}function Jd(n,t,e,r){let i=n,a=t.clone(),s=Kd(i,a);return rr(s),Dr(i,s.int_points1_sorted),Dr(a,s.int_points2_sorted),Po(s),rr(s),Hd(i,a,s,e),r&&Qd(i,a,s,e),[i,a]}function Kd(n,t){let e={int_points1:[],int_points2:[]};for(let r of t.edges){let i=n.edges.search(r.box);for(let a of i){let s=r.shape.intersect(a.shape);for(let l of s)ue(r,l,e.int_points2),ue(a,l,e.int_points1)}}return e}function No(n,t){let e=[];for(let r of n.faces)t.find(i=>i.face===r)||e.push(r);return e}function Ro(n,t){for(let e of n)e.first.bv=e.first.bvStart=e.first.bvEnd=void 0,e.first.setInclusion(t)}function Zd(n,t,e,r,i,a){let s,l,f,u=r.length,d=!1;for(let c=0;c<u;c++){let m=r[c];m.face!==s&&(l=c,s=m.face);let w=c,y=Et(r,c,s),b;w+y<u&&r[w+y].face===s?b=w+y:b=l;let E=Et(r,b,s);f=null;for(let g=b;g<b+E;g++){let I=r[g];if(I.face===s&&i[I.id].face===i[m.id].face){f=I;break}}if(f===null)continue;let x=m.edge_after,v=f.edge_before;if(x.bv===M&&v.bv!=M){x.bv=v.bv;continue}if(x.bv!=M&&v.bv===M){v.bv=x.bv;continue}if(x.bv===M&&v.bv===M&&x!=v||x.bv===et&&v.bv===rt||x.bv===rt&&v.bv===et){let g=x.next;for(;g!=v;)g.bvStart=void 0,g.bvEnd=void 0,g.bv=void 0,g.setInclusion(t),g=g.next}if(x.bv===M&&v.bv===M&&x!=v){let g=x.next,I;for(;g!=v;){if(g.bv!=M){if(I===void 0)I=g.bv;else if(g.bv!=I)throw fe.UNRESOLVED_BOUNDARY_CONFLICT}g=g.next}I!=null&&(x.bv=I,v.bv=I);continue}if(x.bv===et&&v.bv===rt||x.bv===rt&&v.bv===et){let g=x;for(;g!=v;){if(g.bvStart===x.bv&&g.bvEnd===v.bv){let[I,U]=g.shape.distanceTo(t);if(I<10*er.DP_TOL){ue(g,U.ps,e);let T=e[e.length-1];if(T.is_vertex&Oo)T.edge_after=g,T.edge_before=g.prev,g.bvStart=M,g.bv=void 0,g.setInclusion(t);else if(T.is_vertex&Lo)T.edge_after=g.next,g.bvEnd=M,g.bv=void 0,g.setInclusion(t);else{let P=t.addVertex(T.pt,g);T.edge_before=P,T.edge_after=P.next,P.setInclusion(t),P.next.bvStart=M,P.next.bvEnd=void 0,P.next.bv=void 0,P.next.setInclusion(t)}let L=t.findEdgeByPoint(U.pe);ue(L,U.pe,i);let C=i[i.length-1];if(C.is_vertex&Oo)C.edge_after=L,C.edge_before=L.prev;else if(C.is_vertex&Lo)C.edge_after=L.next;else{let P=i.find(or=>or.edge_after===L),O=t.addVertex(C.pt,L);C.edge_before=O,C.edge_after=O.next,P&&(P.edge_after=O),O.bvStart=void 0,O.bvEnd=M,O.bv=void 0,O.setInclusion(n),O.next.bvStart=M,O.next.bvEnd=void 0,O.next.bv=void 0,O.next.setInclusion(n)}rr(a),d=!0;break}}g=g.next}if(d)break;throw fe.UNRESOLVED_BOUNDARY_CONFLICT}}return d}function ko(n,t,e,r){if(!e)return;let i,a,s,l;for(let f=0;f<e.length;f++){if(s=e[f],s.face!==i&&(a=f,i=s.face),i.isEmpty())continue;let u=f,d=Et(e,f,i),c;u+d<e.length&&e[u+d].face===s.face?c=u+d:c=a,l=e[c];let m=c,w=Et(e,m,i),y=s.edge_after,b=l.edge_before;if(y.bv===et&&b.bv===et&&t===Uo||y.bv===rt&&b.bv===rt&&t===Vo||(y.bv===rt||b.bv===rt)&&t===de&&!r||(y.bv===et||b.bv===et)&&t===de&&r||y.bv===M&&b.bv===M&&y.overlap&Yd&&r||y.bv===M&&b.bv===M&&y.overlap&Xd){n.removeChain(i,y,b);for(let E=u;E<u+d;E++)e[E].edge_after=void 0;for(let E=m;E<m+w;E++)e[E].edge_before=void 0}f+=d-1}}function tc(n,t,e,r){for(let i of t.faces){for(let a of i)n.edges.add(a);r.find(a=>a.face===i)===void 0&&n.addFace(i.first,i.last)}}function ec(n,t,e){if(e.int_points1.length!==0)for(let r=0;r<e.int_points1.length;r++){let i=e.int_points1[r],a=e.int_points2[r];if(i.edge_before!==void 0&&i.edge_after===void 0&&a.edge_before===void 0&&a.edge_after!==void 0&&(i.edge_before.next=a.edge_after,a.edge_after.prev=i.edge_before,i.edge_after=a.edge_after,a.edge_before=i.edge_before),a.edge_before!==void 0&&a.edge_after===void 0&&i.edge_before===void 0&&i.edge_after!==void 0&&(a.edge_before.next=i.edge_after,i.edge_after.prev=a.edge_before,a.edge_after=i.edge_after,i.edge_before=a.edge_before),i.edge_before!==void 0&&i.edge_after===void 0)for(let s of e.int_points1_sorted)s!==i&&s.edge_before===void 0&&s.edge_after!==void 0&&s.pt.equalTo(i.pt)&&(i.edge_before.next=s.edge_after,s.edge_after.prev=i.edge_before,i.edge_after=s.edge_after,s.edge_before=i.edge_before);if(a.edge_before!==void 0&&a.edge_after===void 0)for(let s of e.int_points2_sorted)s!==a&&s.edge_before===void 0&&s.edge_after!==void 0&&s.pt.equalTo(a.pt)&&(a.edge_before.next=s.edge_after,s.edge_after.prev=a.edge_before,a.edge_after=s.edge_after,s.edge_before=a.edge_before)}}function Mo(n,t){for(let e of t)n.faces.delete(e.face),e.face=void 0,e.edge_before&&(e.edge_before.face=void 0),e.edge_after&&(e.edge_after.face=void 0)}function Bo(n,t,e){for(let r of t){if(r.edge_before===void 0||r.edge_after===void 0||r.face||r.edge_after.face||r.edge_before.face)continue;let i=r.edge_after,a=r.edge_before;So.testInfiniteLoop(i);let s=n.addFace(i,a);for(let l of t)l.edge_before&&l.edge_after&&l.edge_before.face===s&&l.edge_after.face===s&&(l.face=s);for(let l of e)l.edge_before&&l.edge_after&&l.edge_before.face===s&&l.edge_after.face===s&&(l.face=s)}}function Fo(n,t,e,r){for(let i of t){let a=i.first.bv;(e===Uo&&a===et||e===de&&a===et&&r||e===de&&a===rt&&!r||e===Vo&&a===rt)&&n.deleteFace(i)}}var $r=class{multipolygon=new p.Polygon;constructor(t){let e=se(this.intersects,r=>{let{cache:i}=e;return i.size===3e4&&i.clear?.(),`${r.xmin}_${r.xmax}_${r.ymin}_${r.ymax}`});this.intersects=e;for(let r of t)this.multipolygon.addFace(r.map(i=>new p.Point(i.x,i.y)))}makeHole(t,e,r){Go(this.multipolygon,new p.Polygon(new p.Circle(new p.Point(t,e),r))),this.intersects.cache.clear()}intersects(t){let e=new Array;for(let{shape:r}of this.multipolygon.edges.search(t)){let i=r.intersect(t);i.length>0&&e.push({shape:r,points:i})}return e}intersectsSeg(t){for(let{shape:e}of this.multipolygon.edges.search(t.box))if(e.intersect(t).length>0)return!0;return!1}};var G=class{x;y;velocity;constructor(t,e,r=0,i=0){this.x=t,this.y=e,this.velocity=new p.Vector(r,i)}beforeUpdate(t){}onEntityCollide(t){}onOutOfWorld(t){}onUnderwater(){}onGroundCollide(t,e,r){return!0}onResolve(t,e){}};var Wr=new Map;function Do(n){for(let t of h.gameEntities){Wr.set(t,{x:t.x,y:t.y,velocity:t.velocity.clone()});let e=1/n;if(t.beforeUpdate(e),t.type===1){let i=new p.Vector(0,t.mass*1540);t.velocity=t.velocity.add(i.multiply(e))}t.x+=t.velocity.x*e,t.y+=t.velocity.y*e}for(let t of h.gameEntities){if(t.collideWithEntities)for(let a of h.gameEntities){if(a===t)continue;let s=new p.Box(t.x,t.y,t.x+t.width,t.y+t.height),l=new p.Box(a.x,a.y,a.x+a.width,a.y+a.height);s.intersect(l)&&t.onEntityCollide(a)}t.y<=-5e3||t.x>=5e3||t.x<=-5e3?(t.onOutOfWorld(!1),t.type===0&&h.gameEntities.delete(t)):t.y>=h.waterOffset+150&&(t.onOutOfWorld(!0),h.gameEntities.delete(t)),t.y>=h.waterOffset-t.height&&t.onUnderwater();let e=t.x-h.terrainOffsetX,r=t.y-h.terrainOffsetY,i=t.collideWithGround?h.terrain.intersects(new p.Box(e,r,e+t.width,r+t.height)):[];if(i.length>0){if(!t.onGroundCollide(e,r,i))continue;let s=Wr.get(t);if(t.x=s.x,t.y=s.y,t.velocity=s.velocity,t.velocity.length<t.bounceThreshold){t.velocity=new p.Vector,t.onResolve(!0,i);continue}let l=i[0],f;l.shape instanceof p.Arc?f=new p.Vector(l.points[0],l.shape.pc).normalize():f=new p.Vector(l.shape.ps,l.shape.pe).rotate90CCW().normalize();let u=f.multiply(t.velocity.dot(f)),d=t.velocity.subtract(u);t.velocity=d.multiply(t.COF).subtract(u.multiply(t.COR))}t.onResolve(!1,i)}Wr.clear()}var rc=Mr((...n)=>{console.log(...n)},75),qr=!1,Tt=class extends G{type=0;width=6;height=6;COF=1;COR=1;bounceThreshold=1/0;collideWithEntities=!1;mass=1;get collideWithGround(){return!1}i;active=!0;checkpoint=!1;halfWidth=this.width/2;halfHeight=this.height/2;beforeUpdateFired=!1;updateToMatchChar(t){let e=h.currentControlledChar.collider,r=e.pointX,i=e.pointY;t&&(r=e.initialPointX,i=e.initialPointY);let a=new p.Vector(new p.Point(r,i),new p.Point(e.x+e.width/2,e.y+e.height/2)),s=(this.i-globalThis.point_i)*10;this.x=r+s*Math.cos(a.slope)-this.halfWidth,this.y=i+s*Math.sin(a.slope)-this.halfHeight}beforeUpdate(t){let e=h.currentControlledChar.collider;this.beforeUpdateFired=!0,qr=!1,e.testGavnina===!1&&(e.testGavnina=!0),this.active&&this.updateToMatchChar(!1)}onGroundCollide(t,e){if(qr)return!1;let r=h.currentControlledChar.collider,i=new p.Point(r.pointX??r.initialPointX,r.pointY??r.initialPointY),[a]=i.distanceTo(new p.Point(r.x+r.width/2,r.y+r.height/2)),[s]=i.distanceTo(new p.Point(this.x+this.halfWidth,this.y+this.halfHeight));if(s<a){if(this.beforeUpdateFired===!1)return r.testGavnina=!1,!1;r.x=r.prevState.x,r.y=r.prevState.y,r.velocity=r.prevState.velocity,r.aVelocity=r.prevState.aVelocity;for(let l of h.hookSegments)l.active&&l.updateToMatchChar(!1);qr=!0,this.checkpoint=!0,this.arr=[this,r.pointX,r.pointY,new p.Vector(new p.Point(r.pointX,r.pointY),new p.Point(r.x+r.width/2,r.y+r.height/2)),globalThis.point_i,r.aVelocity<0?"LEFT":r.aVelocity===0?"STOP":"RIGHT"];for(let l=0;l<this.i-1+1;l++)h.hookSegments[l].active=!1;r.pointX=this.x+this.halfWidth,r.pointY=this.y+this.halfHeight,globalThis.point_i=this.i}return!1}onResolve(t){let e=h.currentControlledChar.collider;if(this.active){let s=new p.Point(this.x+this.halfWidth,this.y+this.halfHeight);var r=new p.Point(e.pointX??e.initialPointX,e.pointY??e.initialPointY);let l=new p.Vector(s,r),f=10,u=l.normalize().multiply(f/2),d=u.rotate(Math.PI),c=new p.Segment(new p.Point(s.x+u.x,s.y+u.y),new p.Point(s.x+d.x,s.y+d.y));h.terrain.intersectsSeg(c)&&this.onGroundCollide()}let i=h.hookSegments;if(this!==i[0])return;let a=new Array;for(let s of i)s.checkpoint&&a.push(s);a.reverse(),a=a.slice(0,1);for(let s of a){let[l,f,u,d,c,m]=s.arr,w=new p.Vector(new p.Point(f,u),new p.Point(e.x+e.width/2,e.y+e.height/2)).cross(d);if(m==="RIGHT"&&w<0||m==="LEFT"&&w>0){if(rc("join"),c===0)for(let y of i)y.active=!0;else for(let y of i)y.i>c&&(y.active=!0);e.pointX=f,e.pointY=u,globalThis.point_i=c,l.checkpoint=!1;break}}}};var nr=450,It=class extends G{type=0;width=10;height=10;COF=1;COR=1;bounceThreshold=9e3;collideWithEntities=!1;collideWithGround=!1;mass=1;halfWidth=this.width/2;halfHeight=this.height/2;initialX;initialY;pinPoint=null;initialCenterOfChar;pinDist;needPin=0;constructor(t,e,...r){t-=5,e-=5;super(t,e,...r);this.initialX=t,this.initialY=e;let i=h.currentControlledChar.collider,a=new p.Point(i.x+i.width/2,i.y+i.height/2),s=this.velocity.normalize().multiply(nr),l=h.terrain.multipolygon.intersect(new p.Segment(a,new p.Point(a.x+s.x,a.y+s.y)));l.length>0&&(this.pinPoint=Ke(l,f=>f.distanceTo(a)[0]),this.initialCenterOfChar=a,[this.pinDist]=this.pinPoint.distanceTo(a))}beforeUpdate(t){let e=h.currentControlledChar.collider;if(e.testGavnina===!1){let[r]=new p.Point(e.x,e.y).distanceTo(new p.Point(this.x+this.halfWidth,this.y+this.halfHeight));if(r>nr){h.gameEntities.delete(this),ce("idle");return}if(this.pinPoint===null||this.needPin===2)return;let i=this.velocity.length/144,a=this.velocity.normalize().multiply(i),s=new p.Point(this.x+this.halfWidth+a.x,this.y+this.halfHeight+a.y),[l]=this.initialCenterOfChar.distanceTo(s);l>this.pinDist&&(this.needPin=1,this.velocity=new p.Vector)}}onResolve(t,e){if(this.needPin===1){this.needPin=2,this.x=this.pinPoint.x-this.halfWidth,this.y=this.pinPoint.y-this.halfHeight;let r=h.currentControlledChar.collider,i=this.x+this.halfWidth,a=this.y+this.halfHeight,s=new p.Point(r.x+r.width/2,r.y+r.height/2),l=new p.Vector(s,new p.Point(i,a)).normalize().multiply(nr),f=h.terrain.multipolygon.intersect(new p.Segment(s,new p.Point(s.x+l.x,s.y+l.y)));if(f.length>0){let c=Ke(f,w=>w.distanceTo(s)[0]).distanceTo(s)[0],m=new p.Point(i,a).distanceTo(s)[0];c>m&&c-m<17}i=this.x+this.halfWidth,a=this.y+this.halfHeight,this.collideWithGround=!1,h.hookShot=this;let u=10;globalThis.point_i=0,r.initialPointX=i,r.initialPointY=a,h.hookSegments=[];for(let d=1;d<nr/u;d++){let c=new Tt(0,0,0,0);c.i=d,c.updateToMatchChar(!0),h.gameEntities.add(c),h.hookSegments.push(c)}}}};var he=class extends G{type=1;width=15;height=25;COF=.3;COR=.5;bounceThreshold=75;collideWithEntities=!1;collideWithGround=!0;mass=1;angle=0;boom=kr(()=>{setTimeout(()=>{h.holes2.push({cx:this.x,cy:this.y,r:75}),h.terrain.makeHole(this.x,this.y,75),h.gameEntities.delete(this),D("grenadeExplosion");let t=new p.Circle(new p.Point(this.x,this.y),90);for(let e of h.gameEntities)if(!(e instanceof Tt||e instanceof It)){for(let r of new p.Box(e.x,e.y,e.x+e.width,e.y+e.height).toPoints())if(t.contains(r)){let i=new p.Vector(0,-1e3);e.velocity=e.velocity.add(i);break}}},1e3)});beforeUpdate(t){let e=i(this.velocity.slope),r=40;this.angle+=this.velocity.length/r*(e>270||e<90?1:-1)*t,this.angle%=Math.PI*2;function i(a){var s=Math.PI;return a*(180/s)}}onResolve(t,e){e.length>0&&!t&&D("grenadeBounce"),t&&this.boom()}onOutOfWorld(t){t&&D("waterSplash1")}};var pe=class extends G{type=1;width=20;height=20;COF=1;COR=1;bounceThreshold=1e3;collideWithEntities=!0;collideWithGround=!0;mass=1;beforeUpdate(t){let e=new p.Vector(-1e3,0);this.velocity=this.velocity.add(e.multiply(t))}onOutOfWorld(t){t&&D("waterSplash1")}onGroundCollide(t,e){return this.boom(),!1}boom(){h.holes2.push({cx:this.x,cy:this.y,r:75}),h.terrain.makeHole(this.x,this.y,75),h.gameEntities.delete(this),D("rocketExplosion")}};var me=class extends G{type=0;width=10;height=10;COF=1;COR=1;bounceThreshold=1e3;collideWithEntities=!0;collideWithGround=!0;mass=1;beforeUpdate(t){}onOutOfWorld(t){t&&D("waterSplash1")}onGroundCollide(t,e){return this.boom(),!1}boom(){h.holes2.push({cx:this.x,cy:this.y,r:30}),h.terrain.makeHole(this.x,this.y,30),h.gameEntities.delete(this),D("grenadeExplosion")}};var ge=class extends G{type=1;width=13;height=60;COF=.7;COR=.15;bounceThreshold=1100;collideWithEntities=!1;collideWithGround=!0;mass=1;_testGavnina=!1;pointX;pointY;initialPointX;initialPointY;aVelocity=0;pull="none";prevState;set testGavnina(t){if(this._testGavnina=t,t){ce("rope"),this.type=0,this.bounceThreshold=1/0;let e=h.hookShot;this.pointX=e.x+e.halfWidth,this.pointY=e.y+e.halfHeight;let r=new p.Vector(new p.Point(this.x+this.width/2,this.y+this.height/2),new p.Point(this.pointX,this.pointY)),i=r.slope;this.aVelocity=(i>=1.5*Math.PI||i<=.5*Math.PI?this.velocity.length:-this.velocity.length)/2,this.aVelocity=r.cross(this.velocity)/300,this.aVelocity=r.normalize().cross(this.velocity)*.66,console.log(this.aVelocity),this.velocity=new p.Vector}else{this.type=1,this.bounceThreshold=1100,h.gameEntities.delete(h.hookShot);for(let e of h.hookSegments)h.gameEntities.delete(e);ce("idle")}}get testGavnina(){return this._testGavnina}beforeUpdate(t){if(this.prevState={x:this.x,y:this.y,velocity:this.velocity,aVelocity:this.aVelocity},this.testGavnina===!1)return;let e=new p.Point(this.x+this.width/2,this.y+this.height/2),r=new p.Point(this.pointX,this.pointY),i=new p.Vector(e,r),a=4,s=.997,l=new p.Vector(0,1).cross(i)/i.length;this.aVelocity+=-1*a*l,this.aVelocity*=s;let f=i.normalize().multiply(this.aVelocity),u=f.rotate90CCW(),d=new p.Vector(0,0);if(this.pull==="W")d=f.normalize().multiply(this.aVelocity>0?200:-200);else if(this.pull==="S"){let c=h.hookSegments.at(-1),[m]=r.distanceTo(e),[w]=r.distanceTo(new p.Point(c.x+c.halfWidth,c.y+c.halfHeight));w<m||(d=f.normalize().multiply(this.aVelocity>0?-200:200))}this.velocity=u.add(f.multiply(t).add(d))}onGroundCollide(t,e,r){this.testGavnina===!0&&(this.aVelocity=this.aVelocity*-1);let i=e,a=e+this.height,s=e+this.height*.75,l;for(let f of r)for(let u of f.points)if(u.y>=s){l=!0;break}if(l===!0)for(let f of h.characters)f.collider===this&&(f.animState.anim.spriteName==="rabbitJump"||f.animState.anim.spriteName==="rabbitJumpBack")&&(f.animState=new $(R.rabbitBreath));return!0}onResolve(t){if(this.testGavnina!==!0&&h.characters.size){let e=[...h.characters][0],r=e.collider;if(r.velocity.length>90){e.animState.anim.spriteName==="rabbitGo"&&(e.animState=new $(R.rabbitBreath));return}if(globalThis.walkingMode){let l=function(){let u=150/ir*(e.looksToLeft?-1:1),d=0;for(let c=s;c<=s*8;c+=s)if(h.terrain.intersects(new p.Box(i+u,a+c,i+u+r.width,a+c+r.height)).length!==0){d=c-s;break}if(d>0){r.y+=d,r.x+=u;return}for(let c=0;c<=s*7;c+=s)if(h.terrain.intersects(new p.Box(i+u,a-c,i+u+r.width,a-c+r.height)).length===0){r.y-=c,r.x+=u;return}},i=r.x-h.terrainOffsetX,a=r.y-h.terrainOffsetY,s=7.5/8;l()}}}onUnderwater(){this.testGavnina===!0&&(this.testGavnina=!1),this.velocity=new p.Vector,this.x=ae(300,2900),this.y=-300}};globalThis.curWeap="bazooka";var ir=144;function $o(n,t){let r=0;for(let i of n)for(let a of i)a.y>r&&(r=a.y);Hr({terrain:new $r(n),waterOffset:r-150,gameEntities:new Set,characters:new Set,weaponBoxes:new Set,holes2:[],terrainOffsetX:0,terrainOffsetY:0}),setInterval(function(){if(h.weaponBoxes.size===25)return;let a=new qo(ae(300,2900),-300);h.gameEntities.add(a.collider),h.weaponBoxes.add(a)},3e3),setInterval(nc,1e3/ir)}var Wo=class extends G{type=1;width=30;height=30;COF=.7;COR=.15;bounceThreshold=100;collideWithEntities=!0;collideWithGround=!0;mass=1;onOutOfWorld(){}onEntityCollide(t){t instanceof ge&&(h.gameEntities.delete(this),[...h.weaponBoxes].forEach(e=>{e.collider===this&&h.weaponBoxes.delete(e)}))}},qo=class{collider;creationTime;constructor(t,e){this.collider=new Wo(t,e),this.creationTime=performance.now()}},jr=class{collider;looksToLeft;name;health;team;animState;constructor(t,e,r){this.collider=t,this.looksToLeft=!1,this.name=e,this.health=530,this.team=r}get isGrounded(){return this.collider.velocity.x===0&&this.collider.velocity.y===0}startMoving(t){this.animState.anim.spriteName!=="rabbitPrepareToJump"&&this.isGrounded&&(this.looksToLeft=t,globalThis.walkingMode=!0,this.animState.anim.spriteName!=="rabbitGo"&&(this.animState=new $(R.rabbitGo)))}stopMoving(){delete globalThis.walkingMode,this.animState.anim.spriteName==="rabbitGo"&&(this.animState=new $(R.rabbitBreath))}startJumping(t){this.animState.anim.spriteName!=="rabbitPrepareToJump"&&(globalThis.walkingMode||this.isGrounded)&&(delete globalThis.walkingMode,globalThis.startJumpAnim=t,this.animState=new $(R.rabbitPrepareToJump))}};function nc(){for(let n of h.characters)if(n.animState.anim.spriteName==="rabbitPrepareToJump"){let t=performance.now()-n.animState.startTime,e=1e3/24;if(t>=n.animState.anim.frameCount*e)if(globalThis.startJumpAnim==="FORWARD"){if(n.animState=new $(R.rabbitJump),n.collider.testGavnina)continue;n.collider.velocity=new p.Vector(n.looksToLeft?-265:265,-420)}else{if(n.animState=new $(R.rabbitJumpBack),n.collider.testGavnina)continue;n.collider.velocity=new p.Vector(n.looksToLeft?60:-60,-575)}}Do(ir*(globalThis.bulletTime?7:1))}function jo(n,t){let e=[...h.characters][0],r=1500;t<1e3&&(r=75*Math.ceil(t/50)),curWeap==="rifle"?r=1500:curWeap==="hook"&&(r=1400);let i=(e.looksToLeft?n+90:450-n)*Math.PI/180,a=r*Math.cos(i),s=r*Math.sin(i);switch(curWeap){case"gren":h.gameEntities.add(new he(e.collider.x,e.collider.y,a,s)),D("grenadeAttack");break;case"bazooka":h.gameEntities.add(new pe(e.collider.x,e.collider.y,a,s)),D("rocketAttack");break;case"rifle":D("grenadeAttack"),h.gameEntities.add(new me(e.collider.x,e.collider.y,a,s));break;case"hook":h.gameEntities.add(new It(e.collider.x+e.collider.width/2,e.collider.y+e.collider.height/2,a,s)),D("grenadeAttack");break}}globalThis.onmessage=async n=>{let t=n.data,e=t.params,r;switch(h&&h.characters&&(r=[...h.characters][0]),t.method){case"join":{let i;try{let l=await fetch(`./${t.params.map}.json`);if(l.ok===!1)throw new Error("");i=await l.json(),$o(i,t.params.map)}catch(l){throw l}let a=new ge(1570,-200);h.gameEntities.add(a);let s=new jr(a,t.params.nickname??"\u041F\u0435\u0442\u044F",Math.random()>.5?1:0);s.animState=new $(R.rabbitBreath),h.characters.add(s),h.currentControlledChar=s,globalThis.postMessage({type:"debug",data:[i]}),zr(!0),setTimeout(zr,1e3/zo);break}case"stopMoving":r.stopMoving();break;case"startMoving":r.startMoving(e.direction);break;case"startJumping":r.startJumping(e.direction);break;case"setWeapon":globalThis.curWeap=e.name;break;case"fireTest":jo(e.angle,e.force);break;case"toggleBulletTime":globalThis.bulletTime=!globalThis.bulletTime;break;case"stopPull":r.collider.pull="none";break;case"startPull":r.collider.pull=e.direction;break;case"deattach":r.collider.testGavnina===!0&&(r.collider.testGavnina=!1);break;case"changeDirection":r.looksToLeft=e.direction;break;case"makeHole":return h.holes2.push({cx:e.cx,cy:e.cy,r:60}),h.terrain.makeHole(e.cx,e.cy,60),new Response(JSON.stringify({result:{data:""}}))}};var ic={},zo=64;async function zr(n=!1){let t={characters:[...h.characters].map(e=>({name:e.name,health:e.health,team:e.team,colX:e.collider.x,colY:e.collider.y,colWidth:e.collider.width,colHeight:e.collider.height,direction:e.looksToLeft,visual:e.animState})),weaponBoxes:[...h.weaponBoxes].map(e=>({colX:e.collider.x,colY:e.collider.y,colWidth:e.collider.width,colHeight:e.collider.height,creationTime:e.creationTime})),holes:[...h.holes2],meta:{terrainOffsetX:h.terrainOffsetX,terrainOffsetY:h.terrainOffsetY,waterOffset:h.waterOffset}};t.testGrenades=[];for(let e of h.gameEntities)e instanceof he&&t.testGrenades.push({x:e.x,y:e.y,w:e.width,h:e.height,angle:e.angle});t.testBullets=[];for(let e of h.gameEntities)e instanceof me&&t.testBullets.push({x:e.x,y:e.y,w:e.width,h:e.height,angle:e.velocity.slope});t.testBazookas=[];for(let e of h.gameEntities)e instanceof pe&&t.testBazookas.push({x:e.x,y:e.y,w:e.width,h:e.height,angle:e.velocity.slope});t.testHookShot=[];for(let e of h.gameEntities)e instanceof It&&t.testHookShot.push({x:e.x,y:e.y,w:e.width,h:e.height});t.testHookSegments=[];for(let e of h.gameEntities)if(e instanceof Tt){let i=[...h.characters][0].collider;if(i.pointX===void 0)continue;let a=new p.Vector(new p.Point(i.pointX,i.pointY),new p.Point(i.x+i.width/2,i.y+i.height/2)),s=new p.Vector(new p.Point(i.pointX,i.pointY),new p.Point(e.x+e.width/2,e.y+e.height/2));(e.active===!1||s.length<a.length)&&t.testHookSegments.push({x:e.x,y:e.y,w:e.width,h:e.height})}ic=t,globalThis.postMessage({type:"fullSnapshot",data:t}),setTimeout(zr,1e3/zo)}function D(n){globalThis.postMessage({type:"playSound",data:n})}function ce(n){globalThis.postMessage({type:"setInputMode",data:n})}})();
/**
 * @license
 * Lodash (Custom Build) <https://lodash.com/>
 * Build: `lodash modularize exports="es" -o ./`
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
